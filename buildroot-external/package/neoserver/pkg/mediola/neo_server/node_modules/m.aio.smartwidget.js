var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;$jscomp.ISOLATE_POLYFILLS=!1;$jscomp.FORCE_POLYFILL_PROMISE=!1;$jscomp.FORCE_POLYFILL_PROMISE_WHEN_NO_UNHANDLED_REJECTION=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(d,c,a){if(d==Array.prototype||d==Object.prototype)return d;d[c]=a.value;return d};
$jscomp.getGlobal=function(d){d=["object"==typeof globalThis&&globalThis,d,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global];for(var c=0;c<d.length;++c){var a=d[c];if(a&&a.Math==Math)return a}throw Error("Cannot find global object");};$jscomp.global=$jscomp.getGlobal(this);$jscomp.IS_SYMBOL_NATIVE="function"===typeof Symbol&&"symbol"===typeof Symbol("x");$jscomp.TRUST_ES6_POLYFILLS=!$jscomp.ISOLATE_POLYFILLS||$jscomp.IS_SYMBOL_NATIVE;$jscomp.polyfills={};
$jscomp.propertyToPolyfillSymbol={};$jscomp.POLYFILL_PREFIX="$jscp$";var $jscomp$lookupPolyfilledValue=function(d,c){var a=$jscomp.propertyToPolyfillSymbol[c];if(null==a)return d[c];a=d[a];return void 0!==a?a:d[c]};$jscomp.polyfill=function(d,c,a,b){c&&($jscomp.ISOLATE_POLYFILLS?$jscomp.polyfillIsolated(d,c,a,b):$jscomp.polyfillUnisolated(d,c,a,b))};
$jscomp.polyfillUnisolated=function(d,c,a,b){a=$jscomp.global;d=d.split(".");for(b=0;b<d.length-1;b++){var e=d[b];if(!(e in a))return;a=a[e]}d=d[d.length-1];b=a[d];c=c(b);c!=b&&null!=c&&$jscomp.defineProperty(a,d,{configurable:!0,writable:!0,value:c})};
$jscomp.polyfillIsolated=function(d,c,a,b){var e=d.split(".");d=1===e.length;b=e[0];b=!d&&b in $jscomp.polyfills?$jscomp.polyfills:$jscomp.global;for(var g=0;g<e.length-1;g++){var k=e[g];if(!(k in b))return;b=b[k]}e=e[e.length-1];a=$jscomp.IS_SYMBOL_NATIVE&&"es6"===a?b[e]:null;c=c(a);null!=c&&(d?$jscomp.defineProperty($jscomp.polyfills,e,{configurable:!0,writable:!0,value:c}):c!==a&&(void 0===$jscomp.propertyToPolyfillSymbol[e]&&($jscomp.propertyToPolyfillSymbol[e]=$jscomp.IS_SYMBOL_NATIVE?$jscomp.global.Symbol(e):
$jscomp.POLYFILL_PREFIX+e),$jscomp.defineProperty(b,$jscomp.propertyToPolyfillSymbol[e],{configurable:!0,writable:!0,value:c})))};$jscomp.polyfill("Object.is",function(d){return d?d:function(c,a){return c===a?0!==c||1/c===1/a:c!==c&&a!==a}},"es6","es3");
$jscomp.polyfill("Array.prototype.includes",function(d){return d?d:function(c,a){var b=this;b instanceof String&&(b=String(b));var e=b.length;a=a||0;for(0>a&&(a=Math.max(a+e,0));a<e;a++){var g=b[a];if(g===c||Object.is(g,c))return!0}return!1}},"es7","es3");
$jscomp.checkStringArgs=function(d,c,a){if(null==d)throw new TypeError("The 'this' value for String.prototype."+a+" must not be null or undefined");if(c instanceof RegExp)throw new TypeError("First argument to String.prototype."+a+" must not be a regular expression");return d+""};$jscomp.polyfill("String.prototype.includes",function(d){return d?d:function(c,a){return-1!==$jscomp.checkStringArgs(this,c,"includes").indexOf(c,a||0)}},"es6","es3");var m=m||{};m.aio=m.aio||{};
m.aio.smartwidget=m.aio.smartwidget||{};
m.aio.smartwidget.Handler=function(){this._supportedGeneralDeviceType="switch light dimmer blind motion smoke door contact powermeter temperature weatherstation powerswitch heater water window co2 rain brightness home".split(" ");this.supportSmartWidget=function(d,c){if(!d||!d.sys)return!1;if("hm"==d.sys){var a=require("xnm.aio.hm.js");a=a.devicemanager;return a.supportSmartWidget(d)}if("hue"==d.sys)return a=require("xnm.aio.hue.js"),a=a.devicemanager,a.supportSmartWidget(d);if(["bose","heos","raumfeld",
"sonos"].includes(d.sys))return!0;a=require("m.aio.modulemanager.js").getModule(d.sys);a=a.devicemanager;if(!a)return!1;if(a.toGeneralDevice){var b=a.toGeneralDevice(d);if(b&&b.type&&-1!=this._supportedGeneralDeviceType.indexOf(b.type))return!0}return a.supportSmartWidget?a.supportSmartWidget(d,c):!1};this.applySmartWidgetFilter=function(d,c,a,b){if(!d||!d.sys)return!1;if("hm"==d.sys){var e=require("xnm.aio.hm.js");e=e.devicemanager;return e.applySmartWidgetFilter(d,a,b)}if("hue"==d.sys)return e=
require("xnm.aio.hue.js"),e=e.devicemanager,e.applySmartWidgetFilter(d,a,b);e=require("m.aio.modulemanager.js").getModule(d.sys);e=e.devicemanager;if(!e)return!1;var g;if(e.toGeneralDevice){var k=e.toGeneralDevice(d,null,null,c);if(k){var l=this._getSupportWidgetTypes(k);var h=this._getCommandMap(k),p=this._getStatusMap(k);k=this._getIconMap(k);l=this._injectToSmartWidgetTemplate(a,l,b,h,p,k)}}e.applySmartWidgetFilter&&(g=e.applySmartWidgetFilter(this,d,c,a,b));if(!l)return g;if(!g)return l;d=l;c=
0;for(a=g.length;c<a;c++){b=g[c];k=!1;for(h=0;h<l.length;h++)if(e=l[h],b.meta&&e.meta&&b.meta.id==e.meta.id){k=!0;break}!k&&b&&d.push(b)}return d};this._getSupportWidgetTypes=function(d){var c=[];switch(d.type){case "switch":case "light":c.push("switch");d.states&&(d.states.power||d.states.consumption)&&c.push("powermeter");break;case "dimmer":c.push("switch");c.push("dimmer");d.commands&&(d.commands.color||d.commands.colorTemperature)&&c.push("rgb");break;case "blind":d.commands&&(d.commands.rotation||
d.commands.lamellaUp||d.commands.lamellaDown)&&c.push("blind");c.push("shutter");break;case "motion":c.push("motion");break;case "smoke":c.push("smoke");break;case "door":case "contact":c.push("contact");break;case "powermeter":c.push("powermeter");break;case "temperature":c.push("climate");break;case "weatherstation":c.push("weather_station");c.push("climate");break;case "powerswitch":c.push("switch");c.push("powermeter");break;case "heater":c.push("thermostat");break;case "water":c.push("sensor_water");
break;case "window":c.push("window");break;case "co2":c.push("sensor_co2");break;case "rain":c.push("rain");break;case "brightness":c.push("generic_state")}return c};this._getCommandMap=function(d){var c={},a=d.details?d.details.commands:null;if(!a)return null;switch(d.type){case "switch":case "light":case "powerswitch":a.on&&(c["%on%"]=a.on);a.off&&(c["%off%"]=a.off);a.toggle&&(c["%toggle%"]=a.toggle);break;case "dimmer":a.on&&(c["%on%"]=a.on,c["%dimOn%"]=a.on);a.off&&(c["%dimOff%"]=a.off,c["%off%"]=
a.off);a.toggle&&(c["%toggle%"]=a.toggle);a.up&&(c["%dimUp%"]=a.up);a.down&&(c["%dimDown%"]=a.down);a.brightness&&(c["%dimTo%"]=a.brightness);a.color&&(c["%rgb%"]=a.color);a.white?c["%white%"]=a.white:a.color&&a.color.ext&&d.commands.color&&"RGB"==d.commands.color.type&&(c["%white%"]=JSON.parse(JSON.stringify(a.color)),c["%white%"].ext="FFFFFF");a.colorTemperature&&(c["%colorTemp%"]=a.colorTemperature);break;case "blind":a.up&&(c["%moveUp%"]=a.up);a.down&&(c["%moveDown%"]=a.down);a.stop&&(c["%stop%"]=
a.stop);a.stepUp&&(c["%stepUp%"]=a.stepUp);a.stepDown&&(c["%stepDown%"]=a.stepDown);a.position&&(c["%moveTo%"]=a.position);a.lamellaUp&&(c["%lamellaUp%"]=a.lamellaUp);a.lamellaDown&&(c["%lamellaDown%"]=a.lamellaDown);a.rotation&&(c["%lamellaTo%"]=a.rotation);break;case "heater":a.auto&&(c["%thermoAuto%"]=a.auto),a.manu&&(c["%thermoManu%"]=a.manu),a.boost&&(c["%thermoBoost%"]=a.boost),a.up&&(c["%thermoTempUp%"]=a.up),a.down&&(c["%thermoTempDown%"]=a.down),a.temperature&&(c["%thermoTempTo%"]=a.temperature),
a.tempTo&&(c["%thermoTempTo%"]=a.tempTo)}return c};this._getStatusMap=function(d){var c=function(e,g){if(e&&!g)return e;if(!e&&g)return g;if(!e&&!g)return null;var k={},l;for(l in e){var h=e[l];h&&g[h]&&(k[l]=g[h])}return k},a={},b=d.details?d.details.states:null;if(!b)return null;switch(d.type){case "switch":case "light":b.state&&(a["%switchState%"]=b.state,a["%switchState%"].conv_s=c(b.state.conv_s,null));b.consumption&&(a["%meterEnergyCounter%"]=b.consumption);b.power&&(a["%meterPower%"]=b.power);
break;case "dimmer":b.state&&(a["%switchState%"]=b.state,a["%switchState%"].conv_s=c(b.state.conv_s,null));b.brightness&&(a["%dimmerState%"]=b.brightness,a["%dimmerState%"].conv_s=c(b.brightness.conv_s,null));b.colorTemperature&&(a["%colorTempState%"]=b.colorTemperature,a["%colorTempState%"].conv_s=c(b.colorTemperature.conv_s,null));break;case "blind":b.position&&(a["%blindState%"]=b.position,a["%shutterState%"]=b.position);b.rotation&&(a["%lamellaState%"]=b.rotation);break;case "heater":b.state&&
(a["%thermoSetTemp%"]=b.state);b.setpoint&&(a["%thermoSetTemp%"]=b.setpoint);b.temperature&&(a["%thermoCurrentTemp%"]=b.temperature);b.humidity&&(a["%thermoHum%"]=b.humidity);b.mode&&(a["%thermoMode%"]=b.mode,d.states&&d.states.mode&&d.states.mode.values&&-1!=d.states.mode.values.indexOf("boost")&&(a["%thermoBoostMode%"]=JSON.parse(JSON.stringify(b.mode)),a["%thermoBoostMode%"].conv_s=c(b.mode.conv_s,{auto:"off",manu:"off",boost:"on"})));b.boostMode&&(a["%thermoBoostMode%"]=b.boostMode,a["%thermoBoostMode%"].conv_s=
c(b.boostMode.conv_s,null));break;case "motion":b.motion&&(a["%motionState%"]=b.motion,a["%motionState%"].conv_s=c(b.motion.conv_s,{on:"true",off:"false"}));break;case "smoke":b.smoke&&(a["%smokeState%"]=b.smoke,a["%smokeState%"].conv_s=c(b.smoke.conv_s,{on:"true",off:"false"}));break;case "rain":b.rain&&(a["%rainState%"]=b.rain,a["%rainState%"].conv_s=c(b.rain.conv_s,{on:"true",off:"false"}));break;case "water":b.water&&(a["%waterState%"]=b.water,a["%waterState%"].conv_s=c(b.water.conv_s,{on:"water",
off:"dry"}));break;case "contact":case "door":b.state&&(a["%contactState%"]=b.state,a["%contactState%"].conv_s=c(b.state.conv_s,null));break;case "powermeter":case "powerswitch":b.state&&(a["%switchState%"]=b.state,a["%switchState%"].conv_s=c(b.state.conv_s,null));b.consumption&&(a["%meterEnergyCounter%"]=b.consumption,a["%meterEnergyCounter%"].conv_s=c(b.consumption.conv_s,null));b.power&&(a["%meterPower%"]=b.power,a["%meterPower%"].conv_s=c(b.power.conv_s,null));b.voltage&&(a["%meterVoltage%"]=
b.voltage,a["%meterVoltage%"].conv_s=c(b.voltage.conv_s,null));break;case "temperature":b.temperature&&(a["%tempState%"]=b.temperature);b.humidity&&(a["%humState%"]=b.humidity);break;case "weatherstation":b.temperature&&(a["%tempState%"]=b.temperature);b.humidity&&(a["%humState%"]=b.humidity);b.brightness&&(a["%brightnessState%"]=b.brightness);b.windSpeed&&(a["%windspeedState%"]=b.windSpeed);b.windDirection&&(a["%windDirection%"]=b.windDirection,a["%windDirection%"].conv_i=b.windDirection.conv_i);
b.rain&&(a["%rainingState%"]=b.rain,a["%rainingState%"].conv_s=c(b.rain.conv_s,null));b.rainCount&&(a["%rainingCounterState%"]=b.rainCount);b.sunshine&&(a["%sunshineState%"]=b.sunshine);break;case "window":b.state&&(a["%windowState%"]=b.state,a["%windowState%"].conv_s=c(b.state.conv_s,null));break;case "co2":b.co2&&(a["%co2State%"]=b.co2,a["%co2State%"].conv_s=c(b.co2.conv_s,{normal:"normal",medium:"added",high:"added_strong"}));break;case "brightness":b.brightness&&(a["%state%"]=b.brightness)}return a};
this._getIconMap=function(d){var c={};if(!d.details||!d.details.states)return null;switch(d.type){case "brightness":c["%icon%"]="sun"}return c};this._injectToSmartWidgetTemplate=function(d,c,a,b,e,g){var k=[];if(!c)return k;d||(d={});b||(b={});e||(e={});console.log("support widgets",c);for(var l=0;l<d.length;l++){var h=d[l];if(h.meta&&-1!=c.indexOf(h.meta.type)&&h.elements){h=JSON.parse(JSON.stringify(h));console.log("check widget",h.meta.id,h.meta.type);var p=!1,q=!1,r;for(r in h.elements){var t=
h.elements[r];if(t&&Array.isArray(t))for(var u=0;u<t.length;u++){var f=t[u];if(f){if(f.action&&("command"==f.action.type||"camera"==f.action.type)&&f.action.ref&&f.action.ref.value){var n=f.action.ref.ext;b[f.action.ref.value]?(f.action.ref=JSON.parse(JSON.stringify(b[f.action.ref.value])),"undefined"!=typeof n&&null!=n&&(f.action.ref.ext=n),f.action.device=a,"sliders"!=r&&"roundsliders"!=r||!f.action.ref.extMeta||(n=f.action.ref.extMeta.indexOf("-",1),-1!=n&&(p=f.action.ref.extMeta.substr(0,n),p=
parseFloat(p),n=f.action.ref.extMeta.substr(n+1),n=parseFloat(n),isNaN(p)||(f.min=p),isNaN(n)||(f.max=n))),p=!0):(console.log("no match action",f.action),q=!0,f.action=null)}f.status&&f.status.ref&&f.status.ref.value&&(e[f.status.ref.value]?(f.status.ref=JSON.parse(JSON.stringify(e[f.status.ref.value])),f.status.device=a,p=!0):(console.log("no match status",f.status),q=!0,f.status=null));f.maxValFromStatus&&f.maxValFromStatus.ref&&f.maxValFromStatus.ref.value&&(e[f.maxValFromStatus.ref.value]?(f.maxValFromStatus.ref=
JSON.parse(JSON.stringify(e[f.maxValFromStatus.ref.value])),f.maxValFromStatus.device=a,p=!0):(console.log("no match maxValFromStatus",f.maxValFromStatus),q=!0,f.maxValFromStatus=null));f.widget&&"%icon%"==f.widget.key_img&&g&&(f.widget.key_img=g["%icon%"])}}}p&&!q&&(console.log("find match widget",h.meta.id,h.meta.type),k.push(h))}}return k}};"undefined"!=typeof module&&null!=module&&(module.exports=new m.aio.smartwidget.Handler);
