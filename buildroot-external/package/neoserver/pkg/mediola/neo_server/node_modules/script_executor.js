process.__require=function(a){switch(a){case "child_process":case "vm":return}return require(a)};
process.__console={log:function(){var a=Array.prototype.slice.call(arguments);return sysConsole.log.apply(sysConsole,a)},error:function(){for(var a=Array.prototype.slice.call(arguments),b=0;b<a.length;b++)a[b]instanceof Error&&(a[b]=a[b].message);sysConsole.error.apply(sysConsole,a)},debug:function(){var a=Array.prototype.slice.call(arguments);sysConsole.log.apply(sysConsole,a)},info:function(){var a=Array.prototype.slice.call(arguments);sysConsole.log.apply(sysConsole,a)},warn:function(){var a=Array.prototype.slice.call(arguments);
sysConsole.log.apply(sysConsole,a)}};process.__executeDeviceCommand=function(a,b,c,d){jsonrpc.doRPC("executeCommand",{func:"executeCommand",device:{device:b,room:a},command:c},d)};process.__getDeviceStatus=function(a,b,c,d){jsonrpc.doRPC("getStatus",{func:"getStatus",device:{device:b,room:a},status:c},function(a,b){a?d&&d(a):d&&d(null,b?b.value:null)})};process.__executeMacro=function(a,b,c){jsonrpc.doRPC("executeMacro",{func:"executeMacro",groupName:a,macroName:b},c)};
var sysConsole={_console:console,log:function(){var a=Array.prototype.slice.call(arguments);this._console.log.apply(this._console,a);if("win32"===process.platform){var b=this;process.send({log:a},function(a){b._console.log("ipc log finish",a)})}},error:function(){var a=Array.prototype.slice.call(arguments);this._console.error.apply(this._console,a);if("win32"===process.platform){var b=this;process.send({error:a},function(a){b._console.error("ipc error finish",a)})}}},jsonrpc={_rpcID:0,_calls:[],doRPC:function(a,
b,c){this._rpcID++;a={jsonrpc:"2.0",method:a,params:b,id:this._rpcID};process.send(a);a.callback=c;this._calls.push(a)},doRPCCallback:function(a){if(a&&a.id){for(var b=-1,c=null,b=0;b<this._calls.length;b++)if(this._calls[b]&&this._calls[b].id==a.id){c=this._calls[b];break}if(c){this._calls.splice(b,1);var d=b=null;a.error&&(b=Error(a.error.message?a.error.message:"unknown error"),b.code=a.error.code);a.result&&(d=a.result);c.callback&&c.callback(b,d)}}}},_processJsFile=function(a,b){var c=require("fs"),
d=require("path").resolve(__dirname,"runner2.js"),f=require("loop-protect");f.method="protect";c.readFile(d,{encoding:"utf8"},function(c,d){if(c)b(c);else{var e=d.replace("//%CODE",a),e=f.rewriteLoops(e);b(null,e)}})},_readScript=function(a,b){var c=require("fs");require("path");c.readFile(a,"utf8",function(a,c){b&&b(a,c)})},_runScript=function(a){_readScript(a,function(b,c){b?console.error("read script "+a+" error",b):_processJsFile(c,function(b,c){b?console.error("process script "+a+" error",b):
require("vm").runInThisContext(c)})})};process.on("SIGINT",function(){console.log("Got SIGINT.");process.exit(1)});process.on("SIGTERM",function(){console.log("Got SIGTERM.  Process exit.");process.exit(1)});process.on("uncaughtException",function(a){console.error(a.stack)});process.on("message",function(a){a&&a.runScript?_runScript(a.runScript):a&&"2.0"==a.jsonrpc&&jsonrpc.doRPCCallback(a)});process.argv.forEach(function(a,b,c){});
