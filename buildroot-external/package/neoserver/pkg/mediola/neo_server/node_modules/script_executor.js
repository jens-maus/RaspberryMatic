process.__require=function(o){if(/^[A-Za-z_-]+$/.test(o)&&!(["child_process","fs","fs-extra","vm"].indexOf(o)>=0))return require(o);},process.__console={log:function log(){var o=Array.prototype.slice.call(arguments);return sysConsole.log.apply(sysConsole,o);},error:function error(){for(var o=Array.prototype.slice.call(arguments),r=0;r<o.length;r++)o[r]instanceof Error&&(o[r]=o[r].message);sysConsole.error.apply(sysConsole,o);},debug:function debug(){var o=Array.prototype.slice.call(arguments);sysConsole.log.apply(sysConsole,o);},info:function info(){var o=Array.prototype.slice.call(arguments);sysConsole.log.apply(sysConsole,o);},warn:function warn(){var o=Array.prototype.slice.call(arguments);sysConsole.log.apply(sysConsole,o);}},process.__executeDeviceCommand=function(o,r,e,s){var c={func:"executeCommand",device:{device:r,room:o},command:e};jsonrpc.doRPC("executeCommand",c,s);},process.__getDeviceStatus=function(o,r,e,s){var c={func:"getStatus",device:{device:r,room:o},status:e};jsonrpc.doRPC("getStatus",c,function(o,r){o?s&&s(o):s&&s(null,r?r.value:null);});},process.__executeMacro=function(o,r,e){var s={func:"executeMacro",groupName:o,macroName:r};jsonrpc.doRPC("executeMacro",s,e);};var sysConsole={_console:console,log:function log(){var o=Array.prototype.slice.call(arguments);if(this._console.log.apply(this._console,o),"win32"===process.platform){var r=this;process.send({log:o},function(o){r._console.log("ipc log finish",o);});}},error:function error(){var o=Array.prototype.slice.call(arguments);if(this._console.error.apply(this._console,o),"win32"===process.platform){var r=this;process.send({error:o},function(o){r._console.error("ipc error finish",o);});}}},jsonrpc={_rpcID:0,_calls:[],doRPC:function doRPC(o,r,e){this._rpcID++;var s={jsonrpc:"2.0",method:o,params:r,id:this._rpcID};process.send(s),s.callback=e,this._calls.push(s);},doRPCCallback:function doRPCCallback(o){if(o&&o.id){var r=-1,e=null;for(r=0;r<this._calls.length;r++)if(this._calls[r]&&this._calls[r].id==o.id){e=this._calls[r];break;}if(e){this._calls.splice(r,1);var s=null,c=null;o.error&&((s=new Error(o.error.message?o.error.message:"unknown error")).code=o.error.code),o.result&&(c=o.result),e.callback&&e.callback(s,c);}}}},_processJsFile=function _processJsFile(o,r){var e=require("fs"),s=require("path").resolve(__dirname,"runner2.js"),c=require("loop-protect");c.method="protect",e.readFile(s,{encoding:"utf8"},function(e,s){if(e)r(e);else try{var n=s.replace("//%CODE",o),l=c.rewriteLoops(n);r(null,l);}catch(o){r(o);}});},_readScript=function _readScript(o,r){var e=require("fs");require("path"),e.readFile(o,"utf8",function(o,e){r&&r(o,e);});},_runScript=function _runScript(o){_readScript(o,function(r,e){r?console.error("read script "+o+" error",r):_processJsFile(e,function(r,e){r?console.error("process script "+o+" error",r):require("vm").runInThisContext(e);});});};process.on("SIGINT",function(){console.log("Got SIGINT."),process.exit(1);}),process.on("SIGTERM",function(){console.log("Got SIGTERM.  Process exit."),process.exit(1);}),process.on("uncaughtException",function(o){console.error(o.stack);}),process.on("message",function(o){o&&o.runScript?_runScript(o.runScript):o&&"2.0"==o.jsonrpc&&jsonrpc.doRPCCallback(o);}),process.argv.forEach(function(o,r,e){});