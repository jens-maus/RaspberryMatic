function _typeof(o){"@babel/helpers - typeof";return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(o){return typeof o;}:function(o){return o&&"function"==typeof Symbol&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o;},_typeof(o);}require("./x.nodeext.js");var XCXMLNode=function XCXMLNode(t,e,r,n){this._name=t,this._attributes=e,this._parent=r,this._value=n,this._children=[],XCXMLNode.prototype.addChild=function(t){this._children.push(t);},XCXMLNode.prototype.getParent=function(){return this._parent;},XCXMLNode.prototype.prop=function(t){return"tagName"==t?this._name:null;},XCXMLNode.prototype.text=function(){return this._unescapeXml(this._value);},XCXMLNode.prototype.getAttributes=function(){return this._attributes;},XCXMLNode.prototype.children=function(){var t=this._children;return t.each=function(e){for(var r=0;r<t.length;r++)e.call(t[r]);},t;},XCXMLNode.prototype.attr=function(t,e){return null!=e&&(this._attributes[t]=e),this._attributes[t];},XCXMLNode.prototype.attr2=function(t){var e;if((e=this.attr(t))&&""!=e&&"null"!=e)return e;},XCXMLNode.prototype.find=function(t,e){null==e&&((e=[]).each=function(t){for(var r=0;r<e.length;r++)t.call(e[r]);});var r=(t=(t=t.trim()).replace(/\\./g,".")).indexOf(" ",0),n=t.indexOf("[",0),i=t,o=null,s=null;if(-1!=r||-1!=n)if(-1==n||r>-1&&r<n)o=t.substring(r+1).trim(),i=t.substring(0,r);else if((-1==r||n>-1&&n<r)&&-1!=(h=t.indexOf("]",n))){o=t.substring(h+1).trim(),i=t.substring(0,n);var a=t.substring(n+1,h).trim().split("=");2==a.length&&((s={}).id=a[0].trim(),s.value=a[1].replace(/'/g,"").replace(/\"/g,"").trim());}if(null==this._parent&&(l=this._name)&&((h=l.indexOf(":"))>0&&(l=l.substr(h+1)),l==i)){var u=!0;s&&(u=!1,this.getAttributes()[s.id]==s.value&&(u=!0)),u&&(o?this.find(o,e):e.push(this));}if(this._children.length>0)for(var d=0;d<this._children.length;d++){var l,h;(h=(l=this._children[d]._name).indexOf(":"))>0&&(l=l.substr(h+1)),l==i&&(u=!0,s&&(u=!1,this._children[d].getAttributes()[s.id]==s.value&&(u=!0)),u&&(o?this._children[d].find(o,e):e.push(this._children[d]))),this._children[d].find(t,e);}return e;},XCXMLNode.prototype.getXMLString=function(){return this._getXMLString(0);},XCXMLNode.prototype._getXMLString=function(t){for(var e="",r=0;r<t;r++)e+="  ";var n=e+"<"+this._name;if(this._attributes)for(var i in this._attributes)n+=" "+i+'="'+this._attributes[i]+'"';if(this._children.length>0){for(n+=">\r\n",r=0;r<this._children.length;r++)n+=this._children[r]._getXMLString(t+1);n+=e+"</"+this._name+">\r\n";}else null!=this._value?n+=">"+this._value+"</"+this._name+">\r\n":n+="/>\r\n";return n;},XCXMLNode.prototype.XML_CHAR_MAP={"<":"&lt;",">":"&gt;","&":"&amp;",'"':"&quot;","'":"&apos;"},XCXMLNode.prototype._escapeXml=function(t){return t.replace(/[<>&"']/g,function(t){return x.xmlrpc.XML_CHAR_MAP[t];});},XCXMLNode.prototype._unescapeXml=function(t){return t?t=(t=(t=(t=(t=t.replace(/&lt;/g,"<")).replace(/&gt;/g,">")).replace(/&amp;/g,"&")).replace(/&quot;/g,'"')).replace(/&apos;/g,"'"):t;};},XCXMLDocument=function XCXMLDocument(t,e){this._XMLString=null,t&&(this._XMLString=t.trim()),this._rootNode=null,this._XMLHead='<?xml version="1.0" encoding="UTF-8" ?>';var r=-1;if(null!=this._XMLString&&this._XMLString.length>5&&("<?xml"==this._XMLString.substring(0,5)&&(r=this._XMLString.indexOf(">",0),this._XMLHead=this._XMLString.substring(0,r+1)),r=this._XMLString.indexOf("<",r)),r>-1){var n=null;try{require("sax")&&(n=require("sax"));}catch(t){n=null;}if(e||null==n)this._rootNode=this._parseNode(r,[],null);else{var i=n.parser(!0),o=null,s=this;i.ontext=function(t){o&&(o._value=t);},i.onopentag=function(t){var e=new XCXMLNode(t.name,t.attributes,o,null);o&&o._children.push(e),o=e,s._rootNode||(s._rootNode=o);},i.onclosetag=function(t){o&&(o=o._parent);},i.write(this._XMLString.substr(r)).close();}}else this._rootNode=new XCXMLNode();this._XMLString=null;};XCXMLDocument.prototype.getRootNode=function(){return this._rootNode;},XCXMLDocument.prototype.getXMLString=function(){var t=this._XMLHead+"\r\n";return this._rootNode&&(t+=this._rootNode.getXMLString()),t;},XCXMLDocument.prototype.find=function(t,e){return this._rootNode.find(t,e);},XCXMLDocument.prototype.attr=function(t,e){return this._rootNode.attr(t,e);},XCXMLDocument.prototype.children=function(){return[this._rootNode];},XCXMLDocument.prototype._parseAttributes=function(t,e){var r=this._XMLString.indexOf("=",t),n=this._XMLString.indexOf(">",t);if(r>-1&&r<n){var i=this._XMLString.substring(t+1,r).trim(),o='"',s='"',a=this._XMLString.indexOf(o,r);if(-1==a&&(o="'",s="'",a=this._XMLString.indexOf(o,r)),(r=a)>-1){var u=this._XMLString.indexOf(s,r+1);if(u>-1){var d=this._XMLString.substring(r+1,u);return e[i]=d,u+1;}}}return-1;},XCXMLDocument.prototype._parseNode=function(t,e,r){for(var n=null,i=!0;i;){i=!1;var o=null,s=e.length;if(!this._XMLString)return null;var a=this._XMLString.indexOf(" ",t),u=this._XMLString.indexOf(">",t),d=null,l=null,h={};if(a>-1&&a<u){if("!--"!=(d=this._XMLString.substring(t+1,a))){for(var c=this._parseAttributes(a,h);-1!=c;)a=c,c=this._parseAttributes(a,h);a=this._XMLString.indexOf(">",a);}}else u>-1&&(a=u,d=this._XMLString.substring(t+1,u));if(u=this._XMLString.indexOf("<",a),a>-1&&u>-1&&u>a+1){var f=this._XMLString.substring(a+1,u).trim();f.length>0&&">"!=f[0]&&(l=f);}if(-1!=(a=this._XMLString.indexOf(">",a))){if(null!=d)if("/"!=this._XMLString.charAt(a-1)&&"/"!=d.charAt(0)&&e.push(d),"/"==d.charAt(0)){d=d.substring(1);var p=e.pop();if(!(d==p||d&&p&&d.trim()==p.trim()))return console.log("INVALID XML ("+d+"<->"+p+")!!!"),null;}else d=d.replace("/",""),o=new XCXMLNode(d,h,r,l),n||(n=o),null!=r&&r.addChild(o);(t=this._XMLString.indexOf("<",a))>-1&&(e.length<s?this._parseNode(t,e,r.getParent()):e.length==s?this._parseNode(t,e,r):(r=o,i=!0));}}return n;};var XCLogWriter=function XCLogWriter(){};XCLogWriter.prototype.writeConsole=function(t){console.log(t);},XCLogWriter.prototype.writeFile=function(t,e,r){var n=this,i=require("fs");i.exists(e,function(o){o?i.stat(e,function(o,s){if(o&&XC.debugf(o),!o&&s){var a=Date.now();s.size/1024>=r?n._copyFile(e,e+".1",function(n){n&&XC.debugf(n);var o=i.statSync(e);o.size>=0&&o.size/1024<r?i.appendFile(e,t+"\n",function(t){t&&XC.debugf(t);}):(XC.debugf(a+" "+e+" is cleaned, size is "+o.size),i.writeFile(e,t+"\n",function(t){t&&XC.debugf(t);}));},a):i.appendFile(e,t+"\n",function(t){t&&XC.debugf(t);});}}):(XC.debugf(e+" does not exist, write for first time"),i.writeFile(e,t+"\n",function(t){t&&XC.debugf(t);}));});},XCLogWriter.prototype._copyFile=function(t,e,r,n){var _this=this;try{require("fs").copyFile(t,e,function(i){if(i)return XC.debugf(i),void _this._copyOldWay(t,e,r,n);r&&r();});}catch(i){this._copyOldWay(t,e,r,n);}},XCLogWriter.prototype._copyOldWay=function(t,e,r,n){var _this2=this;if(this.isCopying)setTimeout(function(){r&&r();},1e3);else{var i=require("child_process");require("fs").statSync(t).size>0?(this.isCopying=!0,i.execFile("/bin/cp",["-T",t,e],function(t){_this2.isCopying=!1,t&&XC.debugf(t),r&&r(t);})):setTimeout(function(){r&&r();},1e3);}},XCLogWriter.prototype.isCopying=!1,"undefined"==typeof XC&&(XC=new function(){}()),XC.debugf=function(t){var e=null;try{var r=require("x.logger.js");r&&(e=r.getLogger("x.core.debugf")).log("trace",t);}catch(t){e=null;}e||console.log(t);},XC.getHexVal=function(t,e){for(var r=t.toString(16).toUpperCase();r.length<e;)r="0"+r;return r;},XC.getBytes=function(t,e){var r=[],n=t.length;if(e)for(var i=0;i<n;i+=2)r.push(parseInt(t.substr(i,2),16));else for(i=0;i<n;i++)r.push(t.charCodeAt(i));return r;},XC.createObject=function(t){return"x.logger.writer"===t?new XCLogWriter():null;},dateFormat=function(t){"use strict";var e,r,n,i=(e=/d{1,4}|m{1,4}|yy(?:yy)?|([HhMsTt])\1?|[LloSZWN]|'[^']*'|'[^']*'/g,r=/\b(?:[PMCEA][SDP]T|(?:Pacific|Mountain|Central|Eastern|Atlantic) (?:Standard|Daylight|Prevailing) Time|(?:GMT|UTC)(?:[-+]\d{4})?)\b/g,n=/[^-+\dA-Z]/g,function(t,s,a,u){if(1!==arguments.length||"string"!==function(t){return null===t?"null":void 0===t?"undefined":"object"!=_typeof(t)?_typeof(t):Array.isArray(t)?"array":{}.toString.call(t).slice(8,-1).toLowerCase();}(t)||/\d/.test(t)||(s=t,t=void 0),(t=t||new Date())instanceof Date||(t=new Date(t)),isNaN(t))throw TypeError("Invalid date");var d=(s=String(i.masks[s]||s||i.masks["default"])).slice(0,4);"UTC:"!==d&&"GMT:"!==d||(s=s.slice(4),a=!0,"GMT:"===d&&(u=!0));var l=a?"getUTC":"get",h=t[l+"Date"](),c=t[l+"Day"](),f=t[l+"Month"](),p=t[l+"FullYear"](),g=t[l+"Hours"](),m=t[l+"Minutes"](),y=t[l+"Seconds"](),X=t[l+"Milliseconds"](),M=a?0:t.getTimezoneOffset(),_=function(t){var e=new Date(t.getFullYear(),t.getMonth(),t.getDate());e.setDate(e.getDate()-(e.getDay()+6)%7+3);var r=new Date(e.getFullYear(),0,4);r.setDate(r.getDate()-(r.getDay()+6)%7+3);var n=e.getTimezoneOffset()-r.getTimezoneOffset();e.setHours(e.getHours()-n);var i=(e-r)/6048e5;return 1+Math.floor(i);}(t),C=function(t){var e=t.getDay();return 0===e&&(e=7),e;}(t),L={d:h,dd:o(h),ddd:i.i18n.dayNames[c],dddd:i.i18n.dayNames[c+7],m:f+1,mm:o(f+1),mmm:i.i18n.monthNames[f],mmmm:i.i18n.monthNames[f+12],yy:String(p).slice(2),yyyy:p,h:g%12||12,hh:o(g%12||12),H:g,HH:o(g),M:m,MM:o(m),s:y,ss:o(y),l:o(X,3),L:o(Math.round(X/10)),t:g<12?"a":"p",tt:g<12?"am":"pm",T:g<12?"A":"P",TT:g<12?"AM":"PM",Z:u?"GMT":a?"UTC":(String(t).match(r)||[""]).pop().replace(n,""),o:(M>0?"-":"+")+o(100*Math.floor(Math.abs(M)/60)+Math.abs(M)%60,4),S:["th","st","nd","rd"][h%10>3?0:(h%100-h%10!=10)*h%10],W:_,N:C};return s.replace(e,function(t){return t in L?L[t]:t.slice(1,t.length-1);});});function o(t,e){for(t=String(t),e=e||2;t.length<e;)t="0"+t;return t;}return i.masks={"default":"ddd mmm dd yyyy HH:MM:ss",shortDate:"m/d/yy",mediumDate:"mmm d, yyyy",longDate:"mmmm d, yyyy",fullDate:"dddd, mmmm d, yyyy",shortTime:"h:MM TT",mediumTime:"h:MM:ss TT",longTime:"h:MM:ss TT Z",isoDate:"yyyy-mm-dd",isoTime:"HH:MM:ss",isoDateTime:"yyyy-mm-dd'T'HH:MM:sso",isoUtcDateTime:"UTC:yyyy-mm-dd'T'HH:MM:ss'Z'",expiresHeaderFormat:"ddd, dd mmm yyyy HH:MM:ss Z"},i.i18n={dayNames:["Sun","Mon","Tue","Wed","Thu","Fri","Sat","Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],monthNames:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec","January","February","March","April","May","June","July","August","September","October","November","December"]},i;}(),"undefined"==typeof window&&(window={},window.XCHost={},window.XCHost.getType=function(){return"node-webkit";},window.XCHost.getVersion=function(){return"1.0";},window.XC_Text={}),$=function $(t){return t;},$.parseXML=function(t){if("string"!=typeof t||!t)return new XCXMLDocument();var e=null;try{e=new XCXMLDocument(t);}catch(t){e=new XCXMLDocument(),XC.debugf("failed to parse XML");}return e;},$.parseJSON=function(t){try{return JSON.parse(t);}catch(t){}return null;},$.ajax=function(t){var e,r=require("url").parse(t.url),n={host:r.hostname,port:r.port,path:r.path,method:"GET"},i="string";t.dataType&&(i=t.dataType),t.method&&(n.method=t.method),t.type&&(n.method=t.type),t.headers&&(n.headers=t.headers),(t.username||t.password)&&(n.auth=(t.username?t.username:"")+":"+(t.password?t.password:"")),t.timeout&&(n.timeout=t.timeout),t.data&&("object"==_typeof(t.data)?(n.headers||(n.headers={}),e=require("querystring").stringify(t.data,null,null,{encodeURIComponent:encodeURI}),n.headers["Content-Type"]="application/x-www-form-urlencoded","POST"==n.method||"PUT"==n.method?n.headers["Content-Length"]=e.length:"GET"==n.method&&(n.path=n.path+"?"+e)):"string"==typeof t.data&&(n.headers||(n.headers={}),"POST"!=n.method&&"PUT"!=n.method||(n.headers["Content-Length"]=Buffer.byteLength(t.data,"utf8")))),t.contentType&&(n.headers||(n.headers={}),n.headers["Content-Type"]=t.contentType),t.complete&&(t.error=t.complete);var o=require("http");"https:"==r.protocol&&(o=require("https"),process&&process.env&&(process.env.NODE_TLS_REJECT_UNAUTHORIZED="0"),n.port||(n.port=443));var s=o.request(n,function(e){t.statusCode&&t.statusCode[e.statusCode]&&t.statusCode[e.statusCode]();var r="";e.on("data",function(t){r+=t;}),e.on("end",function(){var n={getAllResponseHeaders:function getAllResponseHeaders(){return e.headers;},getResponseHeader:function getResponseHeader(t){return e.headers[t];}};if(200==e.statusCode){if(t.complete)t.complete({responseText:r});else if(t.success)if("json"==i){try{r=JSON.parse(r);}catch(n){return t.error&&t.error({status:e.statusCode,responseText:r},"error","json parse error"),void(t.error=void 0);}t.success(r,"200",n);}else t.success(r,"200",n);}else t.error&&t.error({status:e.statusCode,responseText:r},"error",r),t.error=void 0;});});s.on("error",function(e){t.error&&t.error(null,e.message),t.error=void 0;}),t.timeout&&s.setTimeout(t.timeout,function(){s.abort(),t.error&&t.error(null,"timeout"),t.error=void 0;}),t.data&&"get"!=n.method.toLowerCase()&&"delete"!=n.method.toLowerCase()&&("string"==typeof t.data||t.data instanceof Buffer?s.write(t.data):"object"==_typeof(t.data)?e&&s.write(e):s.write(t.data)),s.end();},$.trim=function(t){return t.trim();};