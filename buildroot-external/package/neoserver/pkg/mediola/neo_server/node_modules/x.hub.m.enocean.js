var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.arrayIteratorImpl=function(q){var h=0;return function(){return h<q.length?{done:!1,value:q[h++]}:{done:!0}}};$jscomp.arrayIterator=function(q){return{next:$jscomp.arrayIteratorImpl(q)}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;$jscomp.ISOLATE_POLYFILLS=!1;$jscomp.FORCE_POLYFILL_PROMISE=!1;$jscomp.FORCE_POLYFILL_PROMISE_WHEN_NO_UNHANDLED_REJECTION=!1;
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(q,h,e){if(q==Array.prototype||q==Object.prototype)return q;q[h]=e.value;return q};$jscomp.getGlobal=function(q){q=["object"==typeof globalThis&&globalThis,q,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global];for(var h=0;h<q.length;++h){var e=q[h];if(e&&e.Math==Math)return e}throw Error("Cannot find global object");};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.IS_SYMBOL_NATIVE="function"===typeof Symbol&&"symbol"===typeof Symbol("x");$jscomp.TRUST_ES6_POLYFILLS=!$jscomp.ISOLATE_POLYFILLS||$jscomp.IS_SYMBOL_NATIVE;$jscomp.polyfills={};$jscomp.propertyToPolyfillSymbol={};$jscomp.POLYFILL_PREFIX="$jscp$";var $jscomp$lookupPolyfilledValue=function(q,h){var e=$jscomp.propertyToPolyfillSymbol[h];if(null==e)return q[h];e=q[e];return void 0!==e?e:q[h]};
$jscomp.polyfill=function(q,h,e,g){h&&($jscomp.ISOLATE_POLYFILLS?$jscomp.polyfillIsolated(q,h,e,g):$jscomp.polyfillUnisolated(q,h,e,g))};$jscomp.polyfillUnisolated=function(q,h,e,g){e=$jscomp.global;q=q.split(".");for(g=0;g<q.length-1;g++){var f=q[g];if(!(f in e))return;e=e[f]}q=q[q.length-1];g=e[q];h=h(g);h!=g&&null!=h&&$jscomp.defineProperty(e,q,{configurable:!0,writable:!0,value:h})};
$jscomp.polyfillIsolated=function(q,h,e,g){var f=q.split(".");q=1===f.length;g=f[0];g=!q&&g in $jscomp.polyfills?$jscomp.polyfills:$jscomp.global;for(var m=0;m<f.length-1;m++){var p=f[m];if(!(p in g))return;g=g[p]}f=f[f.length-1];e=$jscomp.IS_SYMBOL_NATIVE&&"es6"===e?g[f]:null;h=h(e);null!=h&&(q?$jscomp.defineProperty($jscomp.polyfills,f,{configurable:!0,writable:!0,value:h}):h!==e&&(void 0===$jscomp.propertyToPolyfillSymbol[f]&&($jscomp.propertyToPolyfillSymbol[f]=$jscomp.IS_SYMBOL_NATIVE?$jscomp.global.Symbol(f):
$jscomp.POLYFILL_PREFIX+f),$jscomp.defineProperty(g,$jscomp.propertyToPolyfillSymbol[f],{configurable:!0,writable:!0,value:h})))};$jscomp.initSymbol=function(){};
$jscomp.polyfill("Symbol",function(q){if(q)return q;var h=function(f,m){this.$jscomp$symbol$id_=f;$jscomp.defineProperty(this,"description",{configurable:!0,writable:!0,value:m})};h.prototype.toString=function(){return this.$jscomp$symbol$id_};var e=0,g=function(f){if(this instanceof g)throw new TypeError("Symbol is not a constructor");return new h("jscomp_symbol_"+(f||"")+"_"+e++,f)};return g},"es6","es3");
$jscomp.polyfill("Symbol.iterator",function(q){if(q)return q;q=Symbol("Symbol.iterator");for(var h="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),e=0;e<h.length;e++){var g=$jscomp.global[h[e]];"function"===typeof g&&"function"!=typeof g.prototype[q]&&$jscomp.defineProperty(g.prototype,q,{configurable:!0,writable:!0,value:function(){return $jscomp.iteratorPrototype($jscomp.arrayIteratorImpl(this))}})}return q},"es6",
"es3");$jscomp.iteratorPrototype=function(q){q={next:q};q[Symbol.iterator]=function(){return this};return q};$jscomp.iteratorFromArray=function(q,h){q instanceof String&&(q+="");var e=0,g=!1,f={next:function(){if(!g&&e<q.length){var m=e++;return{value:h(m,q[m]),done:!1}}g=!0;return{done:!0,value:void 0}}};f[Symbol.iterator]=function(){return f};return f};$jscomp.polyfill("Array.prototype.keys",function(q){return q?q:function(){return $jscomp.iteratorFromArray(this,function(h){return h})}},"es6","es3");
var util=require("util"),EventEmitter=require("events"),crypto=require("crypto"),fs_extra=require("fs-extra"),fileman=require("x.hub.fileman.js"),x=x||{};x.hub=x.hub||{};x.hub.m=x.hub.m||{};x.hub.m.enocean=x.hub.m.enocean||{};x.hub.m.enocean.SENDER_ID=null;x.hub.m.enocean.MANUFACTURE_ID=2047;
x.hub.m.enocean._CRC8Table=[0,7,14,9,28,27,18,21,56,63,54,49,36,35,42,45,112,119,126,121,108,107,98,101,72,79,70,65,84,83,90,93,224,231,238,233,252,251,242,245,216,223,214,209,196,195,202,205,144,151,158,153,140,139,130,133,168,175,166,161,180,179,186,189,199,192,201,206,219,220,213,210,255,248,241,246,227,228,237,234,183,176,185,190,171,172,165,162,143,136,129,134,147,148,157,154,39,32,41,46,59,60,53,50,31,24,17,22,3,4,13,10,87,80,89,94,75,76,69,66,111,104,97,102,115,116,125,122,137,142,135,128,
149,146,155,156,177,182,191,184,173,170,163,164,249,254,247,240,229,226,235,236,193,198,207,200,221,218,211,212,105,110,103,96,117,114,123,124,81,86,95,88,77,74,67,68,25,30,23,16,5,2,11,12,33,38,47,40,61,58,51,52,78,73,64,71,82,85,92,91,118,113,120,127,106,109,100,99,62,57,48,55,34,37,44,43,6,1,8,15,26,29,20,19,174,169,160,167,178,181,188,187,150,145,152,159,138,141,132,131,222,217,208,215,194,197,204,203,230,225,232,239,250,253,244,243];
x.hub.m.enocean.CRC8=function(q){for(var h=0,e=0;e<q.length;e++)h=x.hub.m.enocean._CRC8Table[h^q[e]];return h};
x.hub.m.enocean.Serial=function(){var q=function(h,e){this._logger=require("x.logger.js").getLogger("x.hub.m.enocean.Serial.("+h+")");this._port=h;this._serialPort=null;this._baudrate=e;this._baudrate||(this._baudrate=57600)};q.prototype.getPort=function(){return this._port};q.prototype.setListener=function(h){this._listener=h};q.prototype.open=function(h){if(this._serialPort)this._logger.log("warn","port:"+this._port+" already opened"),h&&h();else{var e=h;try{this._logger.log("trace","try to listen to port:"+
this._port);var g=require("serialport");if(g){var f=g.SerialPort?new g.SerialPort(this._port,{baudrate:this._baudrate}):new g(this._port,{baudRate:this._baudrate});var m=this;f.on("open",function(){m._logger.log("trace","port:"+m._port+" opened");m._serialPort=f;f.flush(function(){e&&e();e=null})});f.on("error",function(p){m._logger.log("warn","enocean error:"+p.message);m._serialPort=null;if(e)e&&e(p),e=null;else if(m._listener&&m._listener.onSerialError)m._listener.onSerialError(p)});f.on("data",
function(p){m._logger.log("trace","receive data "+p.toString("hex"));if(m._listener&&m._listener.onSerialData)m._listener.onSerialData(p)});f.on("close",function(){m._logger.log("trace","port closed")})}else this._logger.log("warn","no seiralport module"),h&&h(Error("no seiralport modul"))}catch(p){this._logger.log("warn","init enocean via "+this._port+" error:"+p.message),e&&e(p),e=null}}};q.prototype.close=function(){this._listener=null;try{this._serialPort&&this._serialPort.close()}catch(h){this._logger.log("warn",
"close enocean via "+this._port+" error:"+h.message)}this._serialPort=null};q.prototype.sendPacket=function(h,e){this._serialPort?this._serialPort.write(h,e):e&&e(Error("port not opened"))};return q}();
x.hub.m.enocean.ReComm=function(){var q=function(h){this._logger=require("x.logger.js").getLogger("x.hub.m.enocean.ReComm");this._esp3=h};q.prototype.sendRawSysEx=function(h,e,g,f){var m=this;h=new x.hub.m.enocean.ESP3.Telegram.ADT(197,h,e,g);this._esp3.sendTelegram(h,!0,function(p,l){setTimeout(function(){p?(m._logger.log("warn","ReComm command failed with err:"+p.message),f&&f(p)):l&&0!=l.retCode?(m._logger.log("warn","ReComm command failed with retCode:"+l.retCode),p=Error("ReComm command failed:"+
l.retCode),p.code=l.retCode,f&&f(p,l)):f&&f(null,l)},50)})};return q}();
x.hub.m.enocean.SecurityHandler=function(){var q=new Buffer("3410de8f1aba3eff9f5a117172eacabd","hex"),h=function(){this._logger=require("x.logger.js").getLogger("x.hub.m.enocean.SecurityHandler");this._secInfo={};this._unsync={}};h.prototype.SECURITY_FILE="enocean_sec.json";h.prototype.init=function(e){this._logger.log("trace","init");var g=this;this._loadSec(function(f,m){f&&g._logger.log("warn","init error:"+f.message);m&&(g._secInfo=m);e&&e()})};h.prototype.getUnsyncDevice=function(){return this._unsync};
h.prototype.isSecureDevice=function(e){return this._secInfo[e]};h.prototype.secureTeachIn=function(e,g,f){this._logger.log("trace","secure teach-in:"+e);e&&(g.key&&delete g.key,this._secInfo[e]=g);this._saveSec(this._secInfo,f)};h.prototype.resolve=function(e){if(!e)return null;switch(e.rorg){case 53:return this._resolveSecureTeachIn(e);case 49:return this._resolveSecureMessage(e);default:return null}};h.prototype._resolveSecureTeachIn=function(e){var g={};e=e.userData;var f=e.readUInt8(0);g.teachInInfo=
{};g.teachInInfo.idx=f>>6&3;g.teachInInfo.cnt=f>>4&3;g.teachInInfo.psk=f>>3&1;g.teachInInfo.type=f>>2&1;g.teachInInfo.info=f&3;0==g.teachInInfo.idx?(f=e.readUInt8(1),g.slf={},g.slf.rlc_algo=f>>6&3,g.slf.rlc_tx=f>>5&1,g.slf.mac_alro=f>>3&3,g.slf.data_enc=f&7,f=0,1==g.slf.rlc_algo?f=2:2==g.slf.rlc_algo&&(f=3),f&&(g.rlc=e.slice(2,2+f)),g.key=e.slice(2+f),g.completeKey=null):g.key=e.slice(1);return g};h.prototype._resolveSecureMessage=function(e){var g=e.senderID,f=this._secInfo[g];if(!f||!f.completeKey)return null;
var m=0,p=0;1==f.slf.mac_alro?m=3:2==f.slf.mac_alro&&(m=4);1==f.slf.rlc_tx&&(1==f.slf.rlc_algo?p=2:2==f.slf.rlc_algo&&(p=3));var l=e.userData.length-m-p,u=e.userData.slice(0,l),w=null,E=null;p&&(E=e.userData.slice(l,l+p));m&&(w=e.userData.slice(l+p));m=E?E:f.rlc;p=!0;w&&(w=this.checkCmac(e.rorg,u,m,f.completeKey,w),w.rlc&&m.toString("hex")!=w.rlc.toString("hex")&&(m=w.rlc,f.rlc=w.rlc),w&&w.ok?(this._logger.log("trace","receive from "+g+" with cmac rlc:"+m.toString("hex")),delete this._unsync[g]):
(p=!1,this._logger.log("warn","receive from "+g+" with cmac out of snyc, last rlc:"+m.toString("hex")),this._unsync[g]=m.toString("hex")));g=null;p&&3==f.slf.data_enc&&(u=this.decryptVAES(m,q,f.completeKey,u),g=e.convertToPacket(u).toRadioTelegram());f.rlc=this._incRLC(m);this._logger.log("trace","senderID next rlc:"+f.rlc.toString("hex"));this._saveSec(this._secInfo);return g};h.prototype.decryptVAES=function(e,g,f,m){for(var p=m.length,l=Math.ceil(p/16),u=[],w=null,E=0;E<l;E++){var A=16*E,L=A+16;
L>p&&(L=p);A=m.slice(A,L);w=this._doVAESblock(e,g,f,w,A);u.push(w.data);w=w.enc}return Buffer.concat(u)};h.prototype._doVAESblock=function(e,g,f,m,p){e=this._xor(e,g);m&&(e=this._xor(e,m));f=this._doAES128(f,null,e);m=this._xor(f,p);m=m.slice(0,p.length);return{data:m,enc:f}};h.prototype.checkCmac=function(e,g,f,m,p){if(f){for(var l=this._bufToInt(f),u=0;128>u;u++){if(0!=u){l+=1;var w=65535;3==f.length&&(w=16777215);l>w&&(l=0)}w=this._intToBuf(l,f.length);w=this.calcCmac(e,g,w,m,p.length);if(w.toString("hex")==
p.toString("hex"))return{ok:!0,rlc:this._intToBuf(l,f.length)}}return{ok:!1,rlc:this._intToBuf(l,f.length)}}w=this.calcCmac(e,g,null,m,p.length);return w.toString("hex")==p.toString("hex")?{ok:!0}:{ok:!1}};h.prototype.calcCmac=function(e,g,f,m,p){var l=this._getCmacSubkey(m),u=new Buffer(1);u.writeUInt8(e);u=Buffer.concat([u,g]);f&&(u=Buffer.concat([u,f]));e=u.length;g=Math.ceil(e/16);f=null;for(var w=0;w<g;w++){var E=16*w;var A=E+16;A>e&&(A=e);E=u.slice(E,A);f=E=this._doCmacBlock(m,l.k1,l.k2,E,f)}return E.slice(0,
p)};h.prototype._doCmacBlock=function(e,g,f,m,p){for(var l=new Buffer(16),u=0;16>u;u++)u<m.length?l.writeUInt8(m.readUInt8(u),u):u==m.length?l.writeUInt8(128,u):l.writeUInt8(0,u);p&&(l=this._xor(l,p));l=16>m.length?this._xor(l,f):this._xor(l,g);return this._doAES128(e,null,l)};h.prototype._getCmacSubkey=function(e){var g=new Buffer("00000000000000000000000000000000","hex");var f=new Buffer("00000000000000000000000000000087","hex");g=this._doAES128(e,null,g);e=new Buffer(g.toString("hex"),"hex");this._bufShiftLeft(e,
1);g.readUInt8(0)&128&&(e=this._xor(e,f));g=new Buffer(e.toString("hex"),"hex");this._bufShiftLeft(g,1);e.readUInt8(0)&128&&(g=this._xor(g,f));return{k1:e,k2:g}};h.prototype._doAES128=function(e,g,f){g||(g=new Buffer("00000000000000000000000000000000","hex"));e=crypto.createCipheriv("aes128",e,g);e.setAutoPadding(!1);f=e.update(f);e=e.final();return Buffer.concat([f,e])};h.prototype._xor=function(e,g){for(var f=Math.max(e.length,g.length),m=new Buffer(f),p=0;p<f;p++){var l=0,u=0;p<e.length&&(l=e.readUInt8(p));
p<g.length&&(u=g.readUInt8(p));m.writeUInt8(l^u,p)}return m};h.prototype._bufShiftLeft=function(e,g){if(g!==(g|0))throw Error("shiftBits must be a 32 bit int");var f=2*((g>>4)+(0!==(g&15)));g=8*f-g;for(var m=0,p=0;p-f<e.length;p+=2)if(m<<=16,p<e.length-1?m|=e.readUInt16BE(p):p<e.length&&(m|=e[p]<<8),0<=p-f)if(p-f<e.length-1)e.writeUInt16BE(m>>>g&65535,p-f);else{if(p-f!==e.length-1)throw Error();e[p-f]=m>>>g+8}else-1===p-f&&(e[0]=m>>>g)};h.prototype._bufToInt=function(e){e=e.toString("hex");return parseInt(e,
16)};h.prototype._intToBuf=function(e,g){for(e=e.toString(16);e.length<2*g;)e="0"+e;return new Buffer(e,"hex")};h.prototype._incRLC=function(e){var g=this._bufToInt(e);g+=1;var f=65535;3==e.length&&(f=16777215);g>f&&(g=0);return this._intToBuf(g,e.length)};h.prototype._getFile=function(){var e=require("x.hub.fileman.js").fileManager,g=require("path");require("fs");e=e.getUserRootDataPath();return g.resolve(e,this.SECURITY_FILE)};h.prototype._loadSec=function(e){var g=this._getFile();fs_extra.ensureFile(g,
function(f){f?e&&e(f):fs_extra.readFile(g,"utf8",function(m,p){if(m)e&&e(m);else{try{var l=JSON.parse(p);for(var u in l)if(l.hasOwnProperty(u)){var w=l[u];w.rlc&&(w.rlc=new Buffer(w.rlc,"hex"));w.completeKey&&(w.completeKey=new Buffer(w.completeKey,"hex"))}}catch(E){}e&&e(null,l)}})})};h.prototype._saveSec=function(e,g){var f=this._getFile(),m={},p;for(p in e)m[p]={},m[p].teachInInfo=e[p].teachInInfo,m[p].slf=e[p].slf,m[p].rlc=e[p].rlc.toString("hex"),m[p].completeKey=e[p].completeKey.toString("hex");
fs_extra.writeFile(f,JSON.stringify(m,null,2),function(l){g&&g(l)})};return h}();
x.hub.m.enocean.LearnHandler=function(){var q=function(){var e=function(g){this._handler=g};e.prototype.onTelegram=function(g){var f=this;switch(g.rorg){case 176:if(this._isProfileMatch(g.getManufacturerId(),g.getProductId())){var m={address:g.senderID,data:this._getLearnProfile(),vendor:this._getLearnVendor(),senderID:x.hub.m.enocean.SENDER_ID,gpInfo:g.toJSON()};if(0==g.purpose)this._handler._controller._deviceHandler.onLearnDevice(null,m,function(p,l){p?f._sendTeachInResponse(0,null,x.hub.m.enocean.SENDER_ID,
g.senderID,function(){f._handler._learnFinish(p,-1,l)}):f._sendTeachInResponse(1,null,x.hub.m.enocean.SENDER_ID,g.senderID,function(){f._handler._learnFinish(p,0,l)})});else if(1==g.purpose)this._handler._controller._deviceHandler.deleteDevice(m,function(p,l){p?f._sendTeachInResponse(0,null,x.hub.m.enocean.SENDER_ID,g.senderID,function(){f._handler._learnFinish(p,-1,l)}):f._sendTeachInResponse(2,null,x.hub.m.enocean.SENDER_ID,g.senderID,function(){f._handler._learnFinish(p,1,l)})});else if(2==g.purpose)this._handler._controller._deviceHandler.onLearnAddDeleteDevice(m,
function(p,l,u){p?f._sendTeachInResponse(0,null,x.hub.m.enocean.SENDER_ID,g.senderID,function(){f._handler._learnFinish(p,l,u)}):f._sendTeachInResponse(0==l?1:2,null,x.hub.m.enocean.SENDER_ID,g.senderID,function(){f._handler._learnFinish(p,l,u)})})}}};e.prototype._sendTeachInResponse=function(g,f,m,p,l){m||(m=x.hub.m.enocean.SENDER_ID);g=new x.hub.m.enocean.ESP3.Telegram.GP_TR(2047,g,f,m,0);g.setDstId(p);this._handler._controller._esp3.sendTelegram(g,!0,function(u){l&&l(u)})};e.prototype._isProfileMatch=
function(g,f){var m=this._handler._learnProfile;if(!m||"gp"==m)return!0;var p=x.hub.m.enocean.profiles[m];if(!p)return!1;p=new p;return p._data!=m?!1:p.isGPMatch?p.isGPMatch(g,f):!0};e.prototype._getLearnProfile=function(){return this._handler._learnProfile?this._handler._learnProfile:"gp"};e.prototype._getLearnVendor=function(){return this._handler._learnVendor};return e}(),h=function(e){this._controller=e;this._logger=require("x.logger.js").getLogger("x.hub.m.enocean.LearnHandler");this._learning=
!1;this._saParams=this._learnVendor=this._learnSenderID=this._learnAddress=this._learnProfile=this._learnCallback=null;this._secTeachInFrames={};this._teaching=!1;this._teachingTO=this._teachVendor=this._teachSenderID=this._teachID=this._teachProfile=this._teachCallback=null;var g=this;this._teachinTelegramCB={_onEOTelegram:function(f){g.onTeachInResponseTelegram(f)}};this._gpLearn=new q(this)};h.prototype.learn=function(e,g,f,m,p,l,u){if(this._learning)l&&l(Error("learning process running"));else if(this._teaching)l&&
l(Error("teach-in process running"));else{if(!p||0>=p)p=3E4;this._learning=!0;this._learnCallback=l;this._learnProfile=e?e.toLowerCase():null;this._learnAddress=g?g.toLowerCase():null;this._learnVendor=m?m:"general";this._learnSenderID=f?f.toLowerCase():null;this._secTeachInFrames={};this._saParams=null;!e||"bb-aa-cc"!=e.toLowerCase()&&"d2-06-10"!=e.toLowerCase()&&"d2-06-ff"!=e.toLowerCase()&&"smartguard2"!=e.toLowerCase()||(this._saParams={extended:1},u&&"undefined"!=typeof u.saLearnMode&&null!=
u.saLearnMode&&(e=parseInt(u.saLearnMode),isNaN(e)&&(e=1),0>e&&(e=1),2<e&&(e=1),this._saParams.extended=e));var w=this;this._controller._esp3.startLearn(this,p,this._saParams,function(E){if(E){var A=w._learnCallback;w._learning=!1;w._learnProfile=null;w._learnCallback=null;w._secTeachInFrames={};A&&A(E)}})}};h.prototype.onLearnTimeout=function(){this._learnFinish(Error("learn timeout"))};h.prototype.onTelegram=function(e){if(e){if(this._learnProfile){var g=x.hub.m.enocean.profiles[this._learnProfile];
if(g&&(g=new g,g.handleLearnTelegram)){g.handleLearnTelegram(this,e);return}}switch(e.rorg){case 212:0==e.cmd&&this._learnUTE(e);break;case 213:0==e.getLearnBit()&&this._learn1BS(e);break;case 165:0==e.getLearnBit()&&this._learn4BS(e);break;case 176:case 177:this._gpLearn.onTelegram(e);break;case 246:this._learnRPS(e);break;case 53:var f=this._controller._secHandler.resolve(e);e=e.senderID;g=this._secTeachInFrames[e];this._logger.log("trace","ts");this._logger.log("trace",f);f&&(f.teachInInfo&&0==
f.teachInInfo.idx?(g||(this._secTeachInFrames[e]=[],g=this._secTeachInFrames[e]),g.push(f)):f.teachInInfo&&0!=f.teachInInfo.idx&&g&&g.push(f));if(g&&g[0]&&(f=g[0])&&f.teachInInfo){var m=f.teachInInfo.cnt;if(m&&g.length==m){if(1<m){m=[];for(var p=0;p<g.length;p++)m.push(g[p].key);f.completeKey=Buffer.concat(m)}else f.completeKey=f.key;this._controller._secHandler.secureTeachIn(e,f)}}}}};h.prototype.onEvent=function(e){if(e&&e instanceof x.hub.m.enocean.ESP3.Event.SA_CONFIRM_LEARN){var g=e.getEEP();
if(!this._learnProfile||this._isLearningProfileEquals(g)){var f=this._learnProfile?this._learnProfile:g;"d2-06-ff"==g&&"smartguard2"==this._learnProfile&&(f="d2-06-ff");var m=this,p=x.hub.m.enocean.profiles[f];if(!p){var l=new x.hub.m.enocean.ESP3.Response.Response_OK_SA_CONFIRM_LEARN(500,17);this._controller._esp3.sendResponse(l,function(w){m._learnFinish(Error("eep not supported"))})}p=new p;var u=e.getPMCandidateId();u||(u=p.UNIQUE_GATEWAY_SENDERID?this._controller._deviceHandler.getNextFreeSenderId():
x.hub.m.enocean.SENDER_ID);g={address:e.getSAClientId(),data:f,vendor:this._learnVendor,senderID:u,hopCount:e.getHopCount(),saLearnMode:this._saParams?this._saParams.extended:null,originalEEP:g};this._controller._deviceHandler.onLearnAddDeleteDevice(g,function(w,E,A){if(w)l=new x.hub.m.enocean.ESP3.Response.Response_OK_SA_CONFIRM_LEARN(500,19),m._controller._esp3.sendResponse(l,function(N){m._learnFinish(N)});else{w=0;1==E&&(w=32);var L=e.getHopCount();l=new x.hub.m.enocean.ESP3.Response.Response_OK_SA_CONFIRM_LEARN(128*
(L+1),w);m._controller._esp3.sendResponse(l,function(N){m._learnFinish(N,E,A)})}})}}};h.prototype.onTeachInResponseTelegram=function(e){if(e&&this._teaching){var g=this;if(this._teachProfile){var f=x.hub.m.enocean.profiles[this._teachProfile];if(f&&(f=new f,f.handleTeachinTelegram)){f.handleTeachinTelegram(this,e);return}}switch(e.rorg){case 165:if(0==e.getLearnBit()&&1==e.getLearnStatus()){f=e.getFunc();var m=e.getType();this._toProfileStr(165,f,m);if(1==e.getLearnResult())this._controller._deviceHandler.onLearnDevice({address:this._teachID,
senderID:this._teachSenderID,data:this._teachProfile,vendor:this._teachVendor},{address:e.senderID,senderID:this._teachSenderID,data:this._teachProfile,vendor:this._teachVendor},function(p,l){g._teachFinish(p,l)});else 0==e.getLearnResult()&&(e=this._controller._deviceHandler.getDevice(this._teachID),g._teachFinish(null,e,1))}}}};h.prototype._learnRPS=function(e){var g=this._getRealProfile(this._learnProfile),f=this;g&&"f6"!=g.substr(0,2)||((g=this._learnProfile)||(g="f6-??-??"),this._controller._deviceHandler.onLearnDevice({address:this._learnAddress,
senderID:this._learnSenderID,data:this._learnProfile,vendor:this._learnVendor},{address:e.senderID,senderID:this._learnSenderID,data:g,vendor:this._learnVendor},function(m,p){f._learnFinish(m,0,p)}))};h.prototype._learn1BS=function(e){var g=this,f=this._getRealProfile(this._learnProfile);f&&"d5"!=f.substr(0,2)||((f=this._learnProfile)||(f="d5-??-??"),this._controller._deviceHandler.onLearnDevice({address:this._learnAddress,senderID:this._learnSenderID,data:this._learnProfile,vendor:this._learnVendor},
{address:e.senderID,senderID:this._learnSenderID,data:f,vendor:this._learnVendor},function(m,p){g._learnFinish(m,0,p)}))};h.prototype._learn4BS=function(e){if(0==e.getLearnType())this._learn4BSV1(e);else{var g=e.getFunc(),f=e.getType();g=this._toProfileStr(165,g,f);(g=x.hub.m.enocean.profiles[g])&&(3==(new g).TEACH_IN_VARIATION?this._learn4BSV3(e):this._learn4BSV2(e))}};h.prototype._learn4BSV1=function(e){var g=this._getRealProfile(this._learnProfile);if(g){if("a5"!=g.substr(0,2))return;g=x.hub.m.enocean.profiles[this._learnProfile];
if(!g||1!=(new g).TEACH_IN_VARIATION)return}var f=this;(g=this._learnProfile)||(g="a5-??-??");this._controller._deviceHandler.onLearnDevice({address:this._learnAddress,senderID:this._learnSenderID,data:this._learnProfile,vendor:this._learnVendor},{address:e.senderID,senderID:this._learnSenderID,data:g,vendor:this._learnVendor},function(m,p){f._learnFinish(m,0,p)})};h.prototype._learn4BSV2=function(e){var g=e.getFunc(),f=e.getType();g=this._toProfileStr(165,g,f);if(!this._learnProfile||this._isLearningProfileEquals(g))if(g=
this._learnProfile?this._learnProfile:g,f=x.hub.m.enocean.profiles[g])if(3==(new f).TEACH_IN_VARIATION)this._learn4BSV3(e);else{var m=this;this._controller._deviceHandler.onLearnDevice({address:this._learnAddress,senderID:this._learnSenderID,data:this._learnProfile,vendor:this._learnVendor},{address:e.senderID,senderID:this._learnSenderID,data:g,vendor:this._learnVendor},function(p,l){m._learnFinish(p,0,l)})}};h.prototype._learn4BSV3=function(e){var g=e.getFunc(),f=e.getType();g=this._toProfileStr(165,
g,f);if(!this._learnProfile||this._isLearningProfileEquals(g)){g=this._learnProfile?this._learnProfile:g;f=x.hub.m.enocean.profiles[g];var m=this;if(f){f=new f;var p=m._learnSenderID;!p&&f.UNIQUE_GATEWAY_SENDERID&&(p=require("x.hub.m.enocean.js")._deviceHandler.getNextFreeSenderId());this._controller._deviceHandler.onLearnDevice({address:this._learnAddress,senderID:p,data:this._learnProfile,vendor:this._learnVendor},{address:e.senderID,senderID:p,data:g,vendor:this._learnVendor},function(l,u){l?m._send4BSResponse(null,
1,0,e,function(){m._learnFinish(l,0,u)}):m._send4BSResponse(p,1,1,e,function(){m._learnFinish(null,0,u)})})}else this._send4BSResponse(null,0,0,e,function(){m._learnFinish(Error("eep not supported"))})}};h.prototype._send4BSResponse=function(e,g,f,m,p){e||(e=x.hub.m.enocean.SENDER_ID);var l=m.getFunc(),u=m.getType();m.getManufacturerId();e=new x.hub.m.enocean.ESP3.Telegram.BS4(new Buffer([(l&63)<<2|u>>5&3,(u&31)<<3|x.hub.m.enocean.MANUFACTURE_ID>>8&7,x.hub.m.enocean.MANUFACTURE_ID&255,128|g<<6|f<<
5|16]),e,0);e.setDstId(m.senderID);this._controller._esp3.sendTelegram(e,!0,function(w){p&&p(w)})};h.prototype._learnUTE=function(e){var g=this._toProfileStr(e.eepRorg,e.eepFunc,e.eepType),f,m=this;if(!this._learnProfile||this._isLearningProfileEquals(g)){g=this._learnProfile?this._learnProfile:g;var p=x.hub.m.enocean.profiles[g];if(p)switch(p=new p,(f=this._learnSenderID)||(f=p.UNIQUE_GATEWAY_SENDERID?require("x.hub.m.enocean.js")._deviceHandler.getNextFreeSenderId():x.hub.m.enocean.SENDER_ID),g=
{address:e.senderID,data:g,vendor:this._learnVendor,senderID:f},e.subtype){case 0:this._controller._deviceHandler.onLearnDevice({address:this._learnAddress,senderID:this._learnSenderID,data:this._learnProfile,vendor:this._learnVendor},g,function(l,u){if(0==e.rspExpected){var w=0;l&&404==l.errorCode?w=3:l||(w=1);m._sendUTEResponse(f,w,e,function(){m._learnFinish(l,0,u)})}else m._learnFinish(l,0,u)});break;case 1:this._controller._deviceHandler.deleteDevice(g,function(l,u){if(0==e.rspExpected){var w=
0;l&&404==l.errorCode?w=3:l||(w=2);m._sendUTEResponse(f,w,e,function(){m._learnFinish(l,1,u)})}else m._learnFinish(l,1,u)});break;case 2:this._controller._deviceHandler.onLearnAddDeleteDevice(g,function(l,u,w){if(0==e.rspExpected){var E=0;l&&404==l.errorCode?E=3:l||(0==u?E=1:1==u&&(E=2));m._sendUTEResponse(f,E,e,function(){m._learnFinish(l,u,w)})}else m._learnFinish(l,u,w)})}}};h.prototype._sendUTEResponse=function(e,g,f,m){e||(e=x.hub.m.enocean.SENDER_ID);e=new x.hub.m.enocean.ESP3.Telegram.UTE(1,
f.ute,0,g,f.numChannel,f.manufactureID,f.eepType,f.eepFunc,f.eepRorg,e,0);e.setDstId(f.senderID);this._controller._esp3.sendTelegram(e,!0,function(p){m&&m(p)})};h.prototype._learnFinish=function(e,g,f){var m=this._learnCallback;this._learning=!1;this._learnVendor=this._learnSenderID=this._learnAddress=this._learnProfile=this._learnCallback=null;this._secTeachInFrames={};var p=this._saParams;this._saParams=null;this._controller._esp3.stopLearn(this,p,function(){});m&&m(e,g,f);!e&&0==g&&f&&f.init&&
setTimeout(function(){f.init()},1E3)};h.prototype._toProfileStr=function(e,g,f){for(e=e.toString(16);2>e.length;)e="0"+e;for(g=g.toString(16);2>g.length;)g="0"+g;for(f=f.toString(16);2>f.length;)f="0"+f;return(e+"-"+g+"-"+f).toLowerCase()};h.prototype._fromProfileStr=function(e){e=e.split("-");return{rorg:parseInt(e[0],16),func:parseInt(e[1],16),type:parseInt(e[2],16)}};h.prototype._getRealProfile=function(e){if(!e)return null;var g=x.hub.m.enocean.profiles[e];if(!g)return e;g=new g;return g._eepAlias?
g._eepAlias:e};h.prototype._isLearningProfileEquals=function(e){if(!this._learnProfile)return!1;if(this._learnProfile==e||"bb-aa-cc"==this._learnProfile&&"d2-06-10"==e||"d2-06-10"==this._learnProfile&&"bb-aa-cc"==e||"smartguard2"==this._learnProfile&&"d2-06-11"==e||"smartguard2"==this._learnProfile&&"d2-06-ff"==e)return!0;var g=x.hub.m.enocean.profiles[this._learnProfile];return g?(new g)._eepAlias==e:!1};h.prototype.teachin=function(e,g,f,m,p){if(this._teaching)p&&p(Error("teach-in process running"));
else if(this._learning)p&&p(Error("learning process running"));else if(e){e=e.toLowerCase();g||(g=this._controller._deviceHandler.getNextFreeAddress());var l=this;this._teachCallback=p;this._teachProfile=e;this._teachID=g;this._teachSenderID=f;this._teachVendor=m?m:"general";this._teaching=!0;this._teachingTO=setTimeout(function(){l._teachFinish(Error("teach-in timeout"))},3E4);var u;m=e;if(p=x.hub.m.enocean.profiles[m])p=new p,p.getTeachinType&&(u=p.getTeachinType()),p.isTeachinBidirectional&&p.isTeachinBidirectional();
!u&&(m=this._getRealProfile(m),p=x.hub.m.enocean.profiles[m])&&(p=new p,p.getTeachinType&&(u=p.getTeachinType()),p.isTeachinBidirectional&&p.isTeachinBidirectional());if(!u)switch(m.substr(0,2)){case "f6":u="RPS";break;case "d5":u="1BS";break;case "a5":u="4BS"}switch(u){case "RPS":this._teachinRPS(e,g,f);break;case "1BS":this._teachin1BS(e,g,f);break;case "4BS":this._teachin4BS(e,g,f);break;case "UTE":this._teachinUTE(e,g,f);break;default:this._teachFinish(Error("profile not supported"))}}else p&&
p(Error("profile is null"))};h.prototype._teachinRPS=function(e,g,f){this._teachFinish(Error("RPS teach-in should be done by execute command directly"))};h.prototype._teachin1BS=function(e,g,f){};h.prototype._teachin4BS=function(e,g,f){var m=2,p=x.hub.m.enocean.profiles[e];if(p)m=(new p).TEACH_IN_VARIATION;else if(this._getRealProfile(e),p=x.hub.m.enocean.profiles[e])m=(new p).TEACH_IN_VARIATION;switch(m){case 1:this._teachin4BSV1(e,g,f);break;case 2:this._teachin4BSV2(e,g,f);break;case 3:this._teachin4BSV3(e,
g,f);break;default:this._teachFinish(Error("no supported"))}};h.prototype._teachin4BSV1=function(e,g,f){};h.prototype._teachin4BSV2=function(e,g,f){var m=f;if(!f&&(m=require("x.hub.m.enocean.js")._deviceHandler.getNextFreeSenderId(),!m)){this._teachFinish(Error("no more sender ID available"));return}f=e;var p=x.hub.m.enocean.profiles[f];p||(f=this._getRealProfile(f),p=x.hub.m.enocean.profiles[e]);p&&(p=new p,p._eepAlias&&(e=p._eepAlias));p&&p.getTeachinTelegram?e=p.getTeachinTelegram(g,m,x.hub.m.enocean.MANUFACTURE_ID):
(e=this._fromProfileStr(e),e=new Buffer([(e.func&63)<<2|e.type>>6&2,(e.type&31)<<3|x.hub.m.enocean.MANUFACTURE_ID>>8&7,x.hub.m.enocean.MANUFACTURE_ID&255,128]),e=new x.hub.m.enocean.ESP3.Telegram.BS4(e,m,0));var l=this;this._controller._esp3.sendTelegram(e,!0,function(u){u?l._teachFinish(u):(g||(g=m),l._controller._deviceHandler.addDevice({address:g,data:l._teachProfile,senderID:m,vendor:l._teachVendor},function(w,E){l._teachFinish(w,E)}))})};h.prototype._teachin4BSV3=function(e,g,f){var m=f;if(!f){m=
require("x.hub.m.enocean.js")._deviceHandler.getNextFreeSenderId();if(!m){this._teachFinish(Error("no more sender ID available"));return}this._teachSenderID=m}f=e;var p=x.hub.m.enocean.profiles[f];p||(f=this._getRealProfile(f),p=x.hub.m.enocean.profiles[e]);p&&(p=new p,p._eepAlias&&(e=p._eepAlias));p&&p.getTeachinTelegram?m=p.getTeachinTelegram(g,m,x.hub.m.enocean.MANUFACTURE_ID):(e=this._fromProfileStr(e),e=new Buffer([(e.func&63)<<2|e.type>>6&2,(e.type&31)<<3|x.hub.m.enocean.MANUFACTURE_ID>>8&7,
x.hub.m.enocean.MANUFACTURE_ID&255,128]),m=new x.hub.m.enocean.ESP3.Telegram.BS4(e,m,0));var l=this;this._controller._esp3.addListener(this._teachinTelegramCB);this._controller._esp3.sendTelegram(m,!0,function(u){u&&l._teachFinish(u)})};h.prototype._teachinUTE=function(e,g,f){g=f;if(!f){g=require("x.hub.m.enocean.js")._deviceHandler.getNextFreeSenderId();if(!g){this._teachFinish(Error("no more sender ID available"));return}this._teachSenderID=g}f=e;var m=x.hub.m.enocean.profiles[f];m||(f=this._getRealProfile(f),
m=x.hub.m.enocean.profiles[e]);m&&(m=new m,m._eepAlias&&(e=m._eepAlias));e=e.split("-");e=new x.hub.m.enocean.ESP3.Telegram.UTE(0,1,0,2,255,x.hub.m.enocean.MANUFACTURE_ID,parseInt(e[2],16),parseInt(e[1],16),parseInt(e[0],16),g,0);e.setDstId(reqTelegram.senderID);this._controller._esp3.sendTelegram(e,!0,function(p){p&&self._teachFinish(p)})};h.prototype._teachFinish=function(e,g,f){this._controller._esp3.removeListener(this._teachinTelegramCB);var m=this._teachCallback;this._teachingTO&&clearTimeout(this._teachingTO);
this._teachingTO=null;this._teaching=!1;this._saParams=this._teachVendor=this._teachSenderID=this._teachID=this._teachProfile=this._teachCallback=null;m&&m(e,g,f)};return h}();
x.hub.m.enocean.DeviceHandler=function(){var q=function(h){this._logger=require("x.logger.js").getLogger("x.hub.m.enocean.DeviceHandler");this._controller=h;this._devices={}};util.inherits(q,EventEmitter);q.prototype.SENSOR_FILE="enocean.json";q.prototype.UNKNOWN_PROFILE_ERR=404;q.prototype.ALREADY_EXISTS_ERR=400;q.prototype.init=function(h){this._logger.log("trace","init");var e=this;this._loadDevices(function(g,f){g&&e._logger.log("warn","init error:"+g.message);f&&(e._devices=f);e._initDevices();
h&&h()})};q.prototype._initDevices=function(){var h=Object.keys(this._devices),e=0,g=this,f=function(){e++;e<h.length&&(g._devices[h[e]]&&g._devices[h[e]].init?g._devices[h[e]].init(f):f())};this._devices[h[e]]&&this._devices[h[e]].init?this._devices[h[e]].init(f):f()};q.prototype.getDevice=function(h){if(!h)return null;var e=this._devices[h];if(e)return e;h=parseInt(h,16);for(h=(h-1).toString(16);8>h.length;)h="0"+h;return(e=this._devices[h])&&e instanceof x.hub.m.enocean.profiles.eltako_f6t?e:null};
q.prototype.getAllDevices=function(){return this._devices};q.prototype.findDevice=function(h){return h&&h.address?this._devices[h.address]:null};q.prototype.findDeviceWithData=function(h){if(!h)return null;var e=[],g;for(g in this._devices){var f=this._devices[g];f&&f.getData()==h&&e.push(f)}return e};q.prototype.addDevice=function(h,e){if(h&&h.data){h.address||(h.address=this.getNextFreeAddress());h.address=h.address.toLowerCase();h.senderID&&(h.senderID=h.senderID.toLowerCase());var g=x.hub.m.enocean.profiles.parseJson(h);
if(g){h=g._address;var f=this._devices[h];f&&f._data==g._data&&(g._states=f._states);this._devices[h]=g;this._saveDevices(this._devices,function(m){e&&e(m,g)})}else h=Error("unknow profile"),h.errorCode=this.UNKNOWN_PROFILE_ERR,e&&e(h)}else h=Error("device json invalid"),e&&e(h)};q.prototype.updateDevice=function(h,e,g){if(h)if(e&&e.data){var f=this._devices[h];e.address||(e.address=h);e.address=e.address.toLowerCase();e.senderID&&(e.senderID=e.senderID.toLowerCase());var m=x.hub.m.enocean.profiles.parseJson(e);
m?(f&&f._data==m._data&&(m._params=f._params,m._states=f._states),this._devices[e.address]=m,e.address!=h&&delete this._devices[h],this._saveDevices(this._devices,function(p){g&&g(p,m)})):(h=Error("unknow profile"),h.errorCode=this.UNKNOWN_PROFILE_ERR,g&&g(h))}else h=Error("device json invalid"),g&&g(h);else h=Error("address invalid"),g&&g(h)};q.prototype.deleteDevice=function(h,e){if(h&&h.address&&this._devices[h.address]){var g=this._devices[h.address];g&&g.finalize&&g.finalize();var f=this._devices[h.address];
delete this._devices[h.address];this.emit("deleteDevice",f);this._saveDevices(this._devices,function(m){e&&e(m,g)})}else e&&e()};q.prototype.onLearnAddDeleteDevice=function(h,e){if(h&&h.address)if(this._devices[h.address])this.deleteDevice(h,function(g,f){e&&e(g,1,f)});else this.onLearnDevice(null,h,function(g,f){e&&e(g,0,f)});else e&&e()};q.prototype.onLearnDevice=function(h,e,g){if(e&&e.address&&e.data){var f=x.hub.m.enocean.profiles.parseJson(e);if(f){var m=e.address;if(this._devices[m]){var p=
this._devices[m];m=p.toJSON();if(m.data!=e.data||m.vendor!=e.vendor)e=Error("address "+e.address+" already exists, please delete it first"),e.errorCode=this.ALREADY_EXISTS_ERR,g&&g(e);else if(m.senderID!=e.senderID){p._senderID=e.senderID;if("bb-aa-cc"==p._data||"d2-06-10"==p._data||"d2-06-ff"==p._data||"smartguard2"==f._data)p.executeCommand(null,{value:"alertOn"}),p.executeCommand(null,{value:"preAlarmOn"});else if("afriso_water_eco"==f._data)f.onLearn();this._saveDevices(this._devices,function(l){g&&
g(l,p)})}else g&&g(null,p)}else{h&&(e=h.address)&&e!=m&&this._devices[e]&&delete this._devices[e];this._devices[m]=f;if("bb-aa-cc"==f._data||"d2-06-10"==f._data||"d2-06-ff"==f._data||"smartguard2"==f._data)f.executeCommand(null,{value:"alertOn"}),f.executeCommand(null,{value:"preAlarmOn"});else if("afriso_water_eco"==f._data)f.onLearn();this._saveDevices(this._devices,function(l){g&&g(l,f)})}}else e=Error("unknow profile"),e.errorCode=this.UNKNOWN_PROFILE_ERR,g&&g(e)}else e=Error("device json invalid"),
g&&g(e)};q.prototype.deviceParamsUpdated=function(h,e){this._saveDevices(this._devices,function(g){e&&e(g)})};q.prototype.isVirtual=function(h){var e=x.hub.m.enocean.SENDER_ID;if(!e)return!1;var g=parseInt(e,16)+1;e=parseInt(e,16)+128;h=parseInt(h,16);return h>=g&&h<=e};q.prototype.getVirtualSenderID=function(){var h=x.hub.m.enocean.SENDER_ID;if(!h)return[];var e=parseInt(h,16)+1;h=parseInt(h,16)+128;var g=[],f=this._devices,m;for(m in f){var p=f[m];p&&p._senderID&&(p=parseInt(p._senderID,16),p>=
e&&p<=h&&g.push(p))}return g};q.prototype.getVirtualAddress=function(){var h=[],e=this._devices,g;for(g in e)"x"==g.charAt(0)&&(e=parseInt(g.substr(1),16),0<=e&&268435455>=e&&h.push(g));return h};q.prototype.getFreeSenderIdCount=function(){return 128-this.getVirtualSenderID().length};q.prototype.getNextFreeSenderId=function(){var h=x.hub.m.enocean.SENDER_ID;if(!h)return null;var e=parseInt(h,16)+1;h=parseInt(h,16)+128;for(var g=this.getVirtualSenderID(),f=null;e<=h;e++)if(-1==g.indexOf(e)){f=e;break}if(f)for(f=
f.toString(16).toLowerCase();8>f.length;)f="0"+f;return f};q.prototype.getNextFreeAddress=function(){for(var h=this.getVirtualAddress(),e=null,g=0;268435455>=g;g++){for(var f=g.toString(16);7>f.length;)f="0"+f;f="x"+f;if(-1==h.indexOf(f)){e=f;break}}return e};q.prototype.generateVirtual=function(h,e){if(h&&h.data){var g=h.senderID;if(!g&&(g=this.getNextFreeSenderId(),!g)){e&&e(Error("no sender id available"));return}h.senderID=g;h.address=g;h.virtual=!0;if(g=this.findDevice(h)){var f=g.toJSON();h.data!=
f.data?e&&e(Error("device of another type with the same address exists")):h.vendor&&h.vendor!=f.vendor?e&&e(Error("device of another vendor with the same address exists")):e&&e(null,g)}else(h=x.hub.m.enocean.profiles.parseJson(h))?this.addDevice(h.toJSON(),function(m,p){e&&e(m,p)}):e&&e(Error("unknow profile"))}else e&&e(Error("query is null"))};q.prototype._getFile=function(){var h=fileman.fileManager,e=require("path");h=h.getUserRootDataPath();return e.resolve(h,this.SENSOR_FILE)};q.prototype._loadDevices=
function(h){var e=require("fs-extra"),g=this._getFile();e.ensureFile(g,function(f){f?h&&h(f):e.readFile(g,"utf8",function(m,p){if(m)h&&h(m);else if(p)try{m={};var l=JSON.parse(p),u;for(u in l){var w=x.hub.m.enocean.profiles.parseDBJson(l[u]);w&&(m[u]=w)}h&&h(null,m)}catch(E){h&&h(E)}else h&&h(null,{})})})};q.prototype._saveDevices=function(h,e){var g=this._getFile(),f={},m;for(m in h)f[m]=h[m].toDBJSON();fs_extra.writeFile(g,JSON.stringify(f,null,2),function(p){e&&e(p)})};return q}();
x.hub.m.enocean.ESP3=function(){var q=function(k,t,y){this.type=k;this.data=t;this.optData=y};q.TYPE={1:"RADIO_ERP1",2:"RESPONSE",3:"RADIO_SUB_TEL",4:"EVENT",5:"COMMAND_COMMAND",6:"SMART_ACK_COMMAND",7:"REMOTE_MAN_COMMAND",9:"RADIO_MESSAGE",10:"RADIO_ERP2",16:"RADIO_802_15_4",17:"COMMAND_2_4"};q.prototype.toBuffer=function(){var k=new Buffer(6);k.writeUInt8(85,0);k.writeUInt16BE(this.data.length,1);k.writeUInt8(this.optData?this.optData.length:0,3);k.writeUInt8(this.type,4);k.writeUInt8(0,5);var t=
x.hub.m.enocean.CRC8(k.slice(1,5));k.writeUInt8(t,5);var y=this.optData?Buffer.concat([this.data,this.optData],this.data.length+this.optData.length):this.data;t=x.hub.m.enocean.CRC8(y);k=Buffer.concat([k,y],6+y.length+1);k.writeUInt8(t,k.length-1);return k};q.prototype.toJSON=function(){return{dataLen:this.data.length,optLen:this.optData?this.optData.length:0,type:this.type,typeName:q.TYPE[this.type],data:this.data.toString("hex"),optData:this.optData?this.optData.toString("hex"):null}};q.prototype.toPacket=
function(){return h.resolve(this)};var h=function(){};h.resolve=function(k){switch(k.type){case 1:return g.resolve(k);case 2:return e.resolve(k);case 4:return p.resolve(k);case 5:return m.resolve(k);case 6:return f.resolve(k);default:return null}};var e=function(k,t,y){this.retCode=k;this.resData=t;this.optData=y};e.CODE={0:"RET_OK",1:"RET_ERROR",2:"RET_NOT_SUPPORTED",3:"RET_WRONG_PARAM",4:"RET_OPERATION_DENIED",5:"RET_LOCK_SET",6:"RET_BUFFER_TO_SMALL",7:"RET_NO_FREE_BUFFER"};e.prototype.toJSON=function(){return{retCodeName:e.CODE[this.retCode],
retCode:this.retCode.toString(16),resData:this.resData?this.resData.toString("hex"):null,optData:this.optData?this.optData.toString("hex"):null}};e.prototype.toFrame=function(){var k=new Buffer(1);k.writeUInt8(this.retCode,0);this.resData&&(k=Buffer.concat([k,this.resData]));return new q(2,k,this.optData)};e.prototype.toResponse=function(){return R.resolve(this)};e.resolve=function(k){var t;var y=k.data.readUInt8(0);1<k.data.length&&(t=k.data.slice(1));return new e(y,t,k.optData)};var g=function(k,
t,y,C,D,K){this.data=k;if(this.hasOpt=t)this.subTelNum=y,this.dstId=C,this.dBm=D,this.securityLvl=K};g.prototype.toJSON=function(){var k={data:this.data.toString("hex")};this.hasOpt&&(k.subTelNum=this.subTelNum.toString(16),k.dstId=this.dstId,k.dBm=this.dBm.toString(16),k.securityLvl=this.securityLvl);return k};g.prototype.toFrame=function(){var k=this.data,t=null;this.hasOpt&&(t=new Buffer([this.subTelNum]),t=Buffer.concat([t,new Buffer(this.dstId,"hex")]),t=Buffer.concat([t,new Buffer([this.dBm,
this.securityLvl])]));return new q(1,k,t)};g.prototype.toRadioTelegram=function(){return l.resolve(this)};g.resolve=function(k){var t=!1;if(k.optData){t=!0;var y=k.optData.readUInt8(0);var C=k.optData.slice(1,5).toString("hex");var D=k.optData.readUInt8(5);var K=k.optData.readUInt8(6)}return new g(k.data,t,y,C,D,K)};var f=function(k){this.data=k};f.prototype.toJSON=function(){return{data:this.data.toString("hex")}};f.prototype.toFrame=function(){return new q(6,this.data,null)};f.prototype.toSACommand=
function(){return pa.resolve(this)};f.resolve=function(k){return new f(k.data)};var m=function(k){this.data=k};m.prototype.toJSON=function(){return{data:this.data.toString("hex")}};m.prototype.toFrame=function(){return new q(5,this.data,null)};m.prototype.toCommandCommand=function(){return Na.resolve(this)};m.resolve=function(k){return new m(k.data)};var p=function(k){this.data=k};p.prototype.toJSON=function(){return{data:this.data.toString("hex")}};p.prototype.toFrame=function(){return new q(4,this.data,
null)};p.prototype.toEvent=function(){return O.resolve(this)};p.resolve=function(k){return new p(k.data)};var l=function(k,t){this.rorg=k;this.optData=t;this.optData||(this.optData={subTelNum:1,dstId:"FFFFFFFF",dBm:255,securityLvl:0})};l.prototype.setDstId=function(k){this.optData.dstId=k?k:"FFFFFFFF"};l.resolve=function(k){if(!k.data)return null;switch(k.data.readUInt8(0)){case 208:return L.resolve(k);case 246:return N.resolve(k);case 213:return G.resolve(k);case 165:return Q.resolve(k);case 210:return J.resolve(k);
case 212:return ia.resolve(k);case 53:return ka.resolve(k);case 49:return da.resolve(k);case 64:return A.resolve(k);case 176:return u.resolve(k);case 178:return E.resolve(k);default:return null}};var u=function(){var k=function(H,I,T){8<=T&&(T=8);0>=T&&(T=1);var X=Math.floor(I/8),Z=I%8;I=Math.pow(2,T)-1;if(8<Z+T)return T=16-Z-T,H.readUInt16BE(X)>>T&I;T=8-Z-T;return H.readUInt8(X)>>T&I},t=function(H){this.type=H};t.prototype.getType=function(){return this.type};t.resolve=function(H,I){if(I+2>8*H.length)return null;
var T=k(H,I,2),X=null;switch(T){case 0:X=y.resovle(H,I);break;case 1:X={type:T,sigType:H.readUInt16BE(0)>>6&255,valueType:H.readUInt16BE(0)>>2&3,resolution:H.readUInt16BE(0)&15,engMin:H.readUInt8(2),scalingMin:H.readUInt16BE(3)>>12&15,engMax:H.readUInt16BE(3)>>4&255,scalingMax:H.readUInt16BE(3)&15};break;case 2:X=D.resovle(H,I);break;case 3:X=K.resovle(H,I)}return X};var y=function(H,I,T){this.type=0;this.sigType=H;this.dataLen=I;this.data=T};y.prototype=new t;y.prototype.constructor=y;y.prototype.getBitLength=
function(){return 2==this.sigType?50:18};y.prototype.getProductID=function(){return 2==this.sigType?this.data?this.data.readUInt32BE(0):null:null};y.resovle=function(H,I){if(I+18>8*H.legnth)return null;var T=k(H,I+2,8),X=k(H,I+10,8),Z=null;if(2==T){if(I+50>8*H.legnth)return null;Z=new Buffer(4);Z.writeUInt8(k(H,I+18,8),0);Z.writeUInt8(k(H,I+26,8),1);Z.writeUInt8(k(H,I+34,8),2);Z.writeUInt8(k(H,I+42,8),3)}else 1==T&&(Z=null);return new y(T,X,Z)};var C=function(H,I,T,X,Z,na,Ja){this.type=1;this.sigType=
H;this.valueType=I;this.resolution=T;this.engMin=X;this.scalMin=Z;this.engMax=na;this.scalMax=Ja};C.prototype=new t;C.prototype.constructor=C;C.prototype.getBitLength=function(){return 40};C.prototype.toJSON=function(){return{sigType:this.sigType,valueType:this.valueType,resolution:this.resolution,engMin:this.engMin,scalMin:this.scalMin,engMax:this.engMax,scalMax:this.scalMax}};C.resovle=function(H,I){if(I+40>8*H.length)return null;var T=k(H,I+2,8),X=k(H,I+10,2),Z=k(H,I+12,4),na=k(H,I+16,8),Ja=k(H,
I+24,4),kb=k(H,I+28,8);H=k(H,I+36,4);return new C(T,X,Z,na,Ja,kb,H)};var D=function(H,I){this.type=2;this.sigType=H;this.valueType=I};D.prototype=new t;D.prototype.constructor=D;D.prototype.getBitLength=function(){return 12};D.resovle=function(H,I){if(I+12>8*H.length)return null;var T=k(H,I+2,8);H=k(H,I+10,2);return new D(T,H)};D.prototype.toJSON=function(){return{sigType:this.sigType,valueType:this.valueType}};var K=function(H,I,T){this.type=3;this.sigType=H;this.valueType=I;this.resolution=T};K.prototype=
new t;K.prototype.constructor=K;K.prototype.getBitLength=function(){return 16};K.prototype.toJSON=function(){return{sigType:this.sigType,valueType:this.valueType,resolution:this.resolution}};K.resovle=function(H,I){if(I+16>8*H.length)return null;var T=k(H,I+2,8),X=k(H,I+10,2);H=k(H,I+12,4);return new K(T,X,H)};var S=function(H,I,T){l.call(this,176);this.manufacturerID=H;this.dataDirection=I;this.purpose=T;this.productID=null;this.outboudChannels={};this.inboundChannels={};this.status=this.senderID=
null};S.prototype=new l;S.prototype.constructor=S;S.prototype.getManufacturerId=function(){return this.manufacturerID};S.prototype.getProductId=function(){return this.productID};S.prototype.toJSON=function(){var H={manufacturerID:this.manufacturerID,dataDirection:this.dataDirection,purpose:this.purpose,productID:this.productID,outboudChannels:{},inboundChannels:{}},I;for(I in this.outboudChannels)H.outboudChannels[I]=this.outboudChannels[I].toJSON();for(I in this.inboundChannels)H.inboundChannels[I]=
this.inboundChannels[I].toJSON();return H};S.resolve=function(H){var I=H.data;H=I.readUInt16BE(1)>>5&2047;var T=I.readUInt16BE(1)>>4&1,X=I.readUInt16BE(1)>>2&3;H=new S(H,T,X);T=I.slice(3,I.length-5);X=I.slice(I.length-5,I.length-1);I=I.readUInt8(I.length-1);H.senderID=X.toString("hex");H.status=I;for(var Z=X=I=0;;){var na=t.resolve(T,X);if(!na)break;0==I?0==na.getType()?H.productID=na.getProductID():(H.outboudChannels[Z]=na,Z++,I=1):1==I?0==na.getType()?I=2:(H.outboudChannels[Z]=na,Z++,I=1):2==I&&
(H.inboundChannels[Z]=na,Z++);X+=na.getBitLength()}return H};return S}(),w=function(){var k=function(t,y,C,D,K){l.call(this,177);this.manufacturerID=t;this.result=y;this.chnAcknoledgement=C;this.senderID=D;this.status=K};k.prototype=new l;k.prototype.constructor=k;k.prototype.toPacket=function(){var t=new Buffer(3);t.writeUInt8(this.rorg,0);t.writeUInt16BE(this.manufacturerID<<5|this.result<<3,1);if(3==this.result){var y=[];if(this.chnAcknoledgement){for(var C=Math.ceil(this.chnAcknoledgement.length/
8),D=0;D<C.length;D++)y.push(0);for(C=0;C<this.chnAcknoledgement.length;C++)D=Math.floor(C/8),y[D]|=chnAcknoledgement[C]<<8-C%8-1}t=Buffer.concat([t,new Buffer(y)])}t=Buffer.concat([t,new Buffer(this.senderID,"hex")]);t=Buffer.concat([t,new Buffer([this.status])]);y=1;C="FFFFFFFF";D=255;var K=0;this.optData&&(y=this.optData.subTelNum,C=this.optData.dstId,D=this.optData.dBm,K=this.optData.securityLvl);return new g(t,!0,y,C,D,K)};k.prototype.toJSON=function(){return{rorg:this.rorg.toString(16),manufacturerID:this.manufacturerID.toString(16),
result:this.result,chnAcknoledgement:this.chnAcknoledgement,senderID:this.senderID,receiverID:this.receiverID}};return k}(),E=function(){var k=function(t,y,C){l.call(this,178);this.data=t;this.senderID=y;this.status=C};k.prototype=new l;k.prototype.constructor=k;k.prototype.toPacket=function(){var t=new Buffer(1);t.writeUInt8(this.rorg,0);this.data&&(t=Buffer.concat([t,this.data]));t=Buffer.concat([t,new Buffer(this.senderID,"hex")]);t=Buffer.concat([t,new Buffer([this.status])]);var y=1,C="FFFFFFFF",
D=255,K=0;this.optData&&(y=this.optData.subTelNum,C=this.optData.dstId,D=this.optData.dBm,K=this.optData.securityLvl);return new g(t,!0,y,C,D,K)};k.prototype.toJSON=function(){return{rorg:this.rorg.toString(16),data:this.data?this.data.toString("hex"):null,senderID:this.senderID,status:this.status}};k.resolve=function(t){var y=t.data;t=y.slice(1,y.length-5);var C=y.slice(y.length-5,y.length-1);y=y.readUInt8(y.length-1);return new k(t,C.toString("hex"),y)};return k}(),A=function(k,t,y,C,D,K,S,H){l.call(this,
64,H);this.seq=k;this.idx=t;this.len=y;this.crorg=C;this.data=D;this.senderID=K;this.status=S};A.prototype=new l;A.prototype.constructor=A;A.prototype.getSenderID=function(){return this.senderID};A.prototype.getSeq=function(){return this.seq};A.prototype.getIdx=function(){return this.idx};A.prototype.getLen=function(){return this.len};A.prototype.getCRORG=function(){return this.crorg};A.prototype.getData=function(){return this.data};A.prototype.toJSON=function(){return{rorg:this.rorg.toString(16),
seq:this.seq,idx:this.idx,len:this.len,crorg:this.crorg?this.crorg.toString(16):null,data:this.data.toString("hex"),senderID:this.senderID,status:this.status}};A.resolve=function(k){var t=k.data,y=t.readUInt8(1)>>6&3,C=t.readUInt8(1)&63;if(0==C){var D=t.readUInt16BE(2);var K=t.readUInt8(4);var S=t.slice(5,t.length-5)}else K=D=null,S=t.slice(2,t.length-5);var H=t.slice(t.length-5,t.length-1).toString("hex");t=t.readUInt8(t.length-1);var I;k.hasOpt&&(I={subTelNum:k.subTelNum,dstId:k.dstId,dBm:k.dBm,
securityLvl:k.securityLvl});return new A(y,C,D,K,S,H,t,I)};var L=function(k,t,y,C){l.call(this,208,C);this.messageIndex=k;this.userData=t;this.senderID=y};L.prototype=new l;L.prototype.constructor=L;L.prototype.toJSON=function(){return{rorg:this.rorg.toString(16),messageIndex:this.messageIndex,userData:this.userData?this.userData.toString("hex"):null,senderID:this.senderID}};L.prototype.toPacket=function(){var k=new Buffer(2);k.writeUInt8(this.rorg,0);k.writeUInt8(this.messageIndex,1);this.userData&&
(k=Buffer.concat([k,this.userData]));k=Buffer.concat([k,new Buffer(this.senderID,"hex")]);var t=1,y="FFFFFFFF",C=255,D=0;this.optData&&(t=this.optData.subTelNum,y=this.optData.dstId,C=this.optData.dBm,D=this.optData.securityLvl);return new g(k,!0,t,y,C,D)};L.resolve=function(k){var t=k.data,y=t.readUInt8(1),C=null,D=null;switch(y){case 1:C=0;D=t.slice(2,6).toString("hex");break;case 4:case 6:C=t.slice(2,3),D=t.slice(3,7).toString("hex")}var K;k.hasOpt&&(K={subTelNum:k.subTelNum,dstId:k.dstId,dBm:k.dBm,
securityLvl:k.securityLvl});return new L(y,C,D,K)};var N=function(k,t,y,C,D,K){l.call(this,246,K);this.userData=k?k:0;this.senderID=t;this.t21=y?y:0;this.nu=C?C:0;this.rc=D?D:0};N.prototype=new l;N.prototype.constructor=N;N.prototype.toJSON=function(){return{rorg:this.rorg.toString(16),userData:this.userData.toString(16),senderID:this.senderID,t21:this.t21,nu:this.nu,rc:this.rc}};N.prototype.toPacket=function(){var k=new Buffer(2);k.writeUInt8(this.rorg,0);k.writeUInt8(this.userData,1);k=Buffer.concat([k,
new Buffer(this.senderID,"hex")]);k=Buffer.concat([k,new Buffer([this.t21<<5|this.nu<<4||this.rc])]);var t=1,y="FFFFFFFF",C=255,D=0;this.optData&&(t=this.optData.subTelNum,y=this.optData.dstId,C=this.optData.dBm,D=this.optData.securityLvl);return new g(k,!0,t,y,C,D)};N.resolve=function(k){var t=k.data,y=t.readUInt8(1),C=t.slice(2,6).toString("hex"),D=t.readUInt8(6)>>5&1,K=t.readUInt8(6)>>4&1,S;k.hasOpt&&(S={subTelNum:k.subTelNum,dstId:k.dstId,dBm:k.dBm,securityLvl:k.securityLvl});return new N(y,C,
D,K,t&15,S)};var G=function(k,t,y,C){l.call(this,213,C);this.userData=k;this.senderID=t;this.rc=y?y:0};G.prototype=new l;G.prototype.constructor=G;G.prototype.getLearnBit=function(){return this.userData>>3&1};G.prototype.toJSON=function(){return{rorg:this.rorg.toString(16),userData:this.userData.toString(16),learn:this.getLearnBit(),senderID:this.senderID,rc:this.rc}};G.prototype.toPacket=function(){var k=new Buffer(2);k.writeUInt8(this.rorg,0);k.writeUInt8(this.userData,1);k=Buffer.concat([k,new Buffer(this.senderID,
"hex")]);k=Buffer.concat([k,new Buffer([this.rc])]);var t=1,y="FFFFFFFF",C=255,D=0;this.optData&&(t=this.optData.subTelNum,y=this.optData.dstId,C=this.optData.dBm,D=this.optData.securityLvl);return new g(k,!0,t,y,C,D)};G.resolve=function(k){var t=k.data,y=t.readUInt8(1),C=t.slice(2,6).toString("hex");t=t.readUInt8(6)&15;var D;k.hasOpt&&(D={subTelNum:k.subTelNum,dstId:k.dstId,dBm:k.dBm,securityLvl:k.securityLvl});return new G(y,C,t,D)};var Q=function(k,t,y,C){l.call(this,165,C);this.userData=k;this.senderID=
t;this.rc=y?y:0};Q.prototype=new l;Q.prototype.constructor=Q;Q.prototype.getLearnType=function(){return this.userData.readUInt8(3)>>7&1};Q.prototype.getLearnBit=function(){return this.userData.readUInt8(3)>>3&1};Q.prototype.getLearnStatus=function(){return this.userData.readUInt8(3)>>4&1};Q.prototype.getLearnResult=function(){return this.userData.readUInt8(3)>>5&1};Q.prototype.getEEPResult=function(){return this.userData.readUInt8(3)>>6&1};Q.prototype.getFunc=function(){return this.userData.readUInt8(0)>>
2&63};Q.prototype.getType=function(){var k=this.userData.readUInt8(0)&3,t=this.userData.readUInt8(1)>>3&31;return k<<5|t};Q.prototype.getManufacturerId=function(){var k=this.userData.readUInt8(1)&7,t=this.userData.readUInt8(2);return k<<8|t};Q.prototype.toJSON=function(){return{rorg:this.rorg.toString(16),userData:this.userData.toString("hex"),learnType:this.getLearnType(),learn:this.getLearnBit(),learnStatus:this.getLearnStatus(),learnResult:this.getLearnResult(),eepResult:this.getEEPResult(),func:this.getFunc(),
type:this.getType(),manufacturerId:this.getManufacturerId(),senderID:this.senderID,rc:this.rc}};Q.prototype.toPacket=function(){var k=new Buffer(1);k.writeUInt8(this.rorg,0);k=Buffer.concat([k,this.userData]);k=Buffer.concat([k,new Buffer(this.senderID,"hex")]);k=Buffer.concat([k,new Buffer([this.rc&15])]);return this.optData?new g(k,!0,this.optData.subTelNum,this.optData.dstId,this.optData.dBm,this.optData.securityLvl):new g(k,!1)};Q.resolve=function(k){var t=k.data,y=t.slice(1,5),C=t.slice(5,9).toString("hex");
t=t.readUInt8(9)&15;var D;k.hasOpt&&(D={subTelNum:k.subTelNum,dstId:k.dstId,dBm:k.dBm,securityLvl:k.securityLvl});return new Q(y,C,t,D)};var J=function(k,t,y,C){l.call(this,210,C);this.userData=k;this.senderID=t;this.status=y};J.prototype=new l;J.prototype.constructor=J;J.prototype.toJSON=function(){return{rorg:this.rorg.toString(16),userData:this.userData.toString("hex"),senderID:this.senderID,status:this.status,optData:this.optData}};J.prototype.toPacket=function(){var k=new Buffer(1);k.writeUInt8(this.rorg,
0);k=Buffer.concat([k,this.userData]);k=Buffer.concat([k,new Buffer(this.senderID,"hex")]);k=Buffer.concat([k,new Buffer([this.status])]);return this.optData?new g(k,!0,this.optData.subTelNum,this.optData.dstId,this.optData.dBm,this.optData.securityLvl):new g(k,!1)};J.resolve=function(k){var t=k.data,y=t.slice(1,t.length-5),C=t.slice(t.length-5,t.length-1).toString("hex");t=t.readUInt8(t.length-1);var D;k.hasOpt&&(D={subTelNum:k.subTelNum,dstId:k.dstId,dBm:k.dBm,securityLvl:k.securityLvl});return new J(y,
C,t,D)};var ca=function(k,t,y,C,D){l.call(this,166);this.rorg_en=k;this.data=t;this.dstID=y;this.senderID=C;this.status=D};ca.prototype=new l;ca.prototype.constructor=ca;ca.prototype.toPacket=function(){var k=new Buffer(2);k.writeUInt8(this.rorg,0);k.writeUInt8(this.rorg_en,1);k=Buffer.concat([k,this.data]);k=Buffer.concat([k,new Buffer(this.dstID,"hex")]);k=Buffer.concat([k,new Buffer(this.senderID,"hex")]);k=Buffer.concat([k,new Buffer([this.status])]);return new g(k,!1)};var ia=function(k,t,y,
C,D,K,S,H,I,T,X){l.call(this,212);this.cmd=k;this.ute=t;this.rspExpected=y;this.subtype=C;this.numChannel=D;this.manufactureID=K;this.eepType=S;this.eepFunc=H;this.eepRorg=I;this.senderID=T;this.status=X};ia.prototype=new l;ia.prototype.constructor=ia;ia.prototype.toJSON=function(){return{rorg:this.rorg.toString(16),ute:this.ute,rspExpected:this.rspExpected,subtype:this.subtype,cmd:this.cmd,numChannel:this.numChannel,manufactureID:this.manufactureID,eepType:this.eepType.toString(16),eepFunc:this.eepFunc.toString(16),
eepRorg:this.eepRorg.toString(16),senderID:this.senderID,status:this.status}};ia.prototype.toPacket=function(){var k=new Buffer(8);k.writeUInt8(this.rorg,0);k.writeUInt8(this.ute<<7|this.rspExpected<<6|this.subtype<<4|this.cmd,1);k.writeUInt8(this.numChannel,2);k.writeUInt16BE(parseInt(this.manufactureID,16),3);k.writeUInt8(this.eepType,5);k.writeUInt8(this.eepFunc,6);k.writeUInt8(this.eepRorg,7);k=Buffer.concat([k,new Buffer(this.senderID,"hex")]);k=Buffer.concat([k,new Buffer([this.status])]);return this.optData?
new g(k,!0,this.optData.subTelNum,this.optData.dstId,this.optData.dBm,this.optData.securityLvl):new g(k,!1)};ia.resolve=function(k){var t=k.data.slice(1,8),y=k.data.slice(8,12).toString("hex"),C=k.data.readUInt8(12),D=t.readUInt8(0)>>7&1,K=t.readUInt8(0)&15,S=t.readUInt8(1),H=t.slice(2,4).toString("hex"),I=t.readUInt8(4),T=t.readUInt8(5),X=t.readUInt8(6),Z=t.readUInt8(0)>>6&1;t=t.readUInt8(0)>>4&3;y=new ia(K,D,Z,t,S,H,I,T,X,y,C);k.hasOpt&&(y.optData={subTelNum:k.subTelNum,dstId:k.dstId,dBm:k.dBm,
securityLvl:k.securityLvl});return y};var ka=function(k,t,y,C){l.call(this,53,C);this.userData=k;this.senderID=t;this.status=y};ka.prototype=new l;ka.prototype.constructor=ka;ka.prototype.toJSON=function(){return{rorg:this.rorg.toString(16),userData:this.userData.toString("hex"),senderID:this.senderID,status:this.status,optData:this.optData}};ka.resolve=function(k){var t=k.data,y=t.slice(1,t.length-5),C=t.slice(t.length-5,t.length-1).toString("hex");t=t.readUInt8(t.length-1);var D;k.hasOpt&&(D={subTelNum:k.subTelNum,
dstId:k.dstId,dBm:k.dBm,securityLvl:k.securityLvl});return new ka(y,C,t,D)};var da=function(k,t,y,C){l.call(this,49,C);this.userData=k;this.senderID=t;this.status=y};da.prototype=new l;da.prototype.constructor=da;da.prototype.toJSON=function(){return{rorg:this.rorg.toString(16),userData:this.userData.toString("hex"),senderID:this.senderID,status:this.status,optData:this.optData}};da.prototype.convertToPacket=function(k){k=Buffer.concat([k,new Buffer(this.senderID,"hex"),new Buffer([this.status])]);
return this.optData?new g(k,!0,this.optData.subTelNum,this.optData.dstId,this.optData.dBm,this.optData.securityLvl):new g(k,!1)};da.resolve=function(k){var t=k.data,y=t.slice(1,t.length-5),C=t.slice(t.length-5,t.length-1).toString("hex");t=t.readUInt8(t.length-1);var D;k.hasOpt&&(D={subTelNum:k.subTelNum,dstId:k.dstId,dBm:k.dBm,securityLvl:k.securityLvl});return new da(y,C,t,D)};l.SIG=L;l.RPS=N;l.BS1=G;l.BS4=Q;l.VLD=J;l.ADT=ca;l.UTE=ia;l.TS=ka;l.SM=da;l.GP_TI=u;l.GP_TR=w;l.GP_CD=E;var R=function(k,
t){this._code=k;this._rspData=t};R.CODE={0:"RET_OK",1:"RET_ERROR",2:"RET_NOT_SUPPORTED",3:"RET_WRONG_PARAM",4:"RET_OPERATION_DENIED",5:"RET_LOCK_SET",6:"RET_BUFFER_TO_SMALL",7:"RET_NO_FREE_BUFFER"};R.prototype.toJSON=function(){return{code:this._code,rspData:this._rspData?this._rspData.toString("hex"):null}};R.prototype.toPacket=function(){return new e(this._code,this._rspData)};R.resolve=function(k){return new R(k.retCode,k.resData)};w=function(k,t){R.call(this,0);this._responseTime=k;this._confirmCode=
t};w.prototype.toPacket=function(){var k=new Buffer(3);k.writeUInt16BE(this._responseTime,0);k.writeUInt8(this._confirmCode,2);return new e(this._code,k)};w.prototype.toJSON=function(){return{code:this._code,responseTime:this._responseTime,confirmCode:this._confirmCode}};R.Response_OK_SA_CONFIRM_LEARN=w;var O=function(k){this._code=k};O.resolve=function(k){if(!k.data)return null;switch(k.data.readUInt8(0)){case 1:return xa.resolve(k);case 2:return ma.resolve(k);default:return null}};var xa=function(){this._code=
1};xa.prototype=new O;xa.prototype.constructor=xa;xa.prototype.toJSON=function(){return{code:this._code}};xa.prototype.toPacket=function(){var k=new Buffer(1);k.writeUInt8(this._code,0);return new p(k)};xa.resolve=function(k){return new xa};var ma=function(k,t,y,C,D,K,S){this._code=2;this._priority=k;this._manufacturerId=t;this._eep=y;this._rssi=C;this._pm_candidateId=D;this._sa_clientId=K;this._hop_count=S};ma.prototype=new O;ma.prototype.constructor=ma;ma.prototype.getEEP=function(){return this._eep?
this._eep.substr(0,2)+"-"+this._eep.substr(2,2)+"-"+this._eep.substr(4,2):null};ma.prototype.getPMCandidateId=function(){return this._pm_candidateId};ma.prototype.getSAClientId=function(){return this._sa_clientId};ma.prototype.getHopCount=function(){return this._hop_count};ma.prototype.toJSON=function(){return{code:this._code,priority:this._priority,manufacturerId:this._manufacturerId,eep:this.getEEP(),rssi:this._rssi,pm_candidateId:this._pm_candidateId,sa_clientId:this._sa_clientId,hop_count:this._hop_count}};
ma.prototype.toPacket=function(){var k=new Buffer(4);k.writeUInt8(this._code,0);k.writeUInt8(this._priority,1);k.writeUInt16BE(this._manufacturerId&1023,2);k=Buffer.concat([k,new Buffer(this._eep,"hex")]);k=Buffer.concat([k,new Buffer([this._rssi])]);k=Buffer.concat([k,new Buffer(this._pm_candidateId,"hex")]);k=Buffer.concat([k,new Buffer(this._sa_clientId,"hex")]);k=Buffer.concat([k,new Buffer([this._hop_count])]);return new p(k)};ma.resolve=function(k){var t=k.data;k=t.readUInt8(1);var y=t.readUInt16BE(2)&
1023,C=t.slice(4,7).toString("hex"),D=t.readUInt8(7),K=t.slice(8,12).toString("hex"),S=t.slice(12,16).toString("hex");t=t.readUInt8(16);return new ma(k,y,C,D,K,S,t)};O.SA_RECLAIM_NOT_SUCCESSFUL=xa;O.SA_CONFIRM_LEARN=ma;var Na=function(k){this._code=k};Na.resolve=function(k){if(!k.data)return null;switch(k.data.readUInt8(0)){case 9:return CO_WR_REPEATER.resolve(k);default:return null}};CO_WR_REPEATER=function(k,t){this._code=9;this._enable=k;this._level=t};CO_WR_REPEATER.prototype=new Na;CO_WR_REPEATER.prototype.constructor=
CO_WR_REPEATER;CO_WR_REPEATER.prototype.toJSON=function(){return{code:this._code,enable:this._enable,level:this._level}};CO_WR_REPEATER.prototype.toPacket=function(){var k=new Buffer(3);k.writeUInt8(this._code,0);k.writeUInt8(this._enable,1);k.writeUInt8(this._level,2);return new m(k)};CO_WR_REPEATER.resolve=function(k){k=k.data.readUInt8(1);var t=CO_WR_REPEATER.readUInt8(2);return new CO_WR_REPEATER(k,t)};Na.CO_WR_REPEATER=CO_WR_REPEATER;var pa=function(k){this._code=k};pa.resolve=function(k){if(!k.data)return null;
switch(k.data.readUInt8(0)){case 1:return qa.resolve(k);case 6:return ya.resolve(k);case 8:return za.resolve(k);default:return null}};var qa=function(k,t,y){this._code=1;this._enable=k;this._extended=t;this._timeout=y};qa.prototype=new pa;qa.prototype.constructor=qa;qa.prototype.toJSON=function(){return{code:this._code,enable:this._enable,extended:this._extended,timeout:this._timeout}};qa.prototype.toPacket=function(){var k=new Buffer(7);k.writeUInt8(this._code,0);k.writeUInt8(this._enable,1);k.writeUInt8(this._extended,
2);k.writeUInt32BE(this._timeout,3);return new f(k)};qa.resolve=function(k){var t=k.data;k=t.readUInt8(1);var y=t.readUInt8(2);t=t.readUInt32BE(3);return new qa(k,y,t)};var Ba=function(k){this._code=5;this._saClientId=k};Ba.prototype=new pa;Ba.prototype.constructor=Ba;Ba.prototype.toJSON=function(){return{code:this._code,clientId:this._saClientId}};Ba.prototype.toPacket=function(){var k=new Buffer(1);k.writeUInt8(this._code,0);k=Buffer.concat([k,new Buffer(this._saClientId,"hex")]);return new f(k)};
Ba.resolve=function(k){k=k.data.slice(1,5).toString("hex");return new Ba(k)};var ya=function(){this._code=6};ya.prototype=new pa;ya.prototype.constructor=ya;ya.prototype.toJSON=function(){return{code:this._code}};ya.prototype.toPacket=function(){var k=new Buffer(1);k.writeUInt8(this._code,0);return new f(k)};ya.resolve=function(k){return new ya};var za=function(k){this._code=8;this._mailBoxCount=k};za.prototype=new pa;za.prototype.constructor=za;za.prototype.toJSON=function(){return{code:this._code,
mailBoxCount:this._mailBoxCount}};za.prototype.toPacket=function(){var k=new Buffer(2);k.writeUInt8(this._code,0);k.writeUInt8(this._mailBoxCount,1);return new f(k)};za.resolve=function(k){k=k.data.readUInt8(1);return new za(k)};pa.SA_WR_LEARNMODE=qa;pa.SA_WR_RESET=Ba;pa.SA_RD_LEARNEDCLIENTS=ya;pa.SA_WR_POSTMASTER=za;var lb=function(){var k=function(t){this._esp3=t;this._buffer={}};k.prototype.receiveChainedTelegram=function(t){var y=t.getSenderID(),C=t.getSeq(),D=t.getIdx();this._buffer[y]||(this._buffer[y]=
{});var K=this._buffer[y];K[C]||(K[C]=[]);K=K[C];for(var S=0;S<=D;S++)S!=D?K.length<D&&(K[S]=null):K[S]=t;this._checkChain(y,C)};k.prototype._checkChain=function(t,y){var C=this._buffer[t][y];if(C[0]){var D=C[0],K=D.getLen(),S=D.getCRORG();D=0;var H=new Buffer(1);H.writeUInt8(S);for(S=0;S<C.length;S++){var I=C[S];if(!I)return;I=I.getData();D+=I.length;H=Buffer.concat([H,I])}D>=K&&(delete this._buffer[t][y],H=Buffer.concat([H,new Buffer(t,"hex")]),H=Buffer.concat([H,new Buffer("00","hex")]),t=new g(H,
!1),this._esp3._onEORadio_ERP1(t))}};return k}(),V=function(k){this._logger=require("x.logger.js").getLogger("x.hub.m.enocean.ESP3");this._controller=k;this._listeners=[];k&&this._listeners.push(k);this._recomm=new x.hub.m.enocean.ReComm(this);this._baseID=this._serial=null;this._rdata=new Buffer([]);this._frameBuffer=[];this._learnHandler=null;this._learning=!1;this._learnTO=null;this._cdmHandler=new lb(this)};V.RESPONSE_TO=1500;V.prototype.attachSerial=function(k,t){var y=this;this._serial=new x.hub.m.enocean.Serial(k);
this._serial.setListener(this);this._serial.open(function(C){C?(y._serial.setListener(null),y._serial=null,t&&t(C)):y.readBaseID(function(D,K){D?(y._serial.setListener(null),y._serial.close(),y._serial=null,t&&t(D)):(x.hub.m.enocean.SENDER_ID||(x.hub.m.enocean.SENDER_ID=K,localStorage&&localStorage.setItem("x.hub.m.enocean.SENDER_ID",K)),y._baseID=K,t&&t())})})};V.prototype.removeSerial=function(k,t){this._serial.setListener(null);this._serial.close();this._baseID=this._serial=null;t&&t()};V.prototype.getSerial=
function(){return this._serial};V.prototype.addListener=function(k){k&&-1==this._listeners.indexOf(k)&&this._listeners.push(k)};V.prototype.removeListener=function(k){k&&(k=this._listeners.indexOf(k),-1!=k&&this._listeners.splice(k,1))};V.prototype.readBaseID=function(k){var t=this,y=new q(5,new Buffer("08","hex"));this.sendFrame(y,!0,function(C,D){C?(t._logger.log("warn","read base id error:"+C.stack),k&&k(C)):D&&D.retCode?(C=Error("read BaseID error"),C.code=D.retCode,t._logger.log("warn","read base id error return code:"+
D.retCode),k&&k(C)):(C=D.resData.toString("hex"),k&&k(null,C.toLowerCase()))},8E3)};V.prototype.startLearn=function(k,t,y,C){if(this._serial){if(!t||0>=t)t=3E4;if(this._learning)C&&C(Error("learning another type right now"));else{this._learnHandler=k;this._learning=!0;var D=this;this._learnTO=setTimeout(function(){D._learning=!1;D._learnTO=null;var K=D._learnHandler;D._learnHandler=null;if(K&&K.onLearnTimeout)K.onLearnTimeout()},t);y?(k=new qa(1,y.extended?y.extended:0,0),this.sendSACommand(k,!0,
function(K){C&&C(K)})):C&&C()}}else C&&C(Error("port not opened"))};V.prototype.stopLearn=function(k,t,y){this._learnTO&&clearTimeout(this._learnTO);this._learning=!1;this._learnTO=this._learnHandler=null;if(t){y&&y();var C=this;setTimeout(function(){var D=new qa(0,t.extended?t.extended:0,0);C.sendSACommand(D,!0,function(K){y&&y(K)})},2E3)}else y&&y()};V.prototype.sendTelegram=function(k,t,y){this.sendPacket(k.toPacket(),t,y)};V.prototype.sendResponse=function(k,t){this._logger.log("trace","send RESPONSE:"+
JSON.stringify(k.toJSON()));this.sendPacket(k.toPacket(),!1,t)};V.prototype.sendSACommand=function(k,t,y){this._logger.log("trace","send SA_COMMAND:"+JSON.stringify(k.toJSON()));this.sendPacket(k.toPacket(),t,y)};V.prototype.sendCommandCommand=function(k,t,y){this._logger.log("trace","send COMMAND_COMMAND:"+JSON.stringify(k.toJSON()));this.sendPacket(k.toPacket(),t,y)};V.prototype.sendPacket=function(k,t,y){this.sendFrame(k.toFrame(),t,y)};V.prototype.sendFrame=function(k,t,y,C){var D=this._frameBuffer.length;
this._frameBuffer.push({frame:k,callback:y,timeout:null,response:t,to:C});0==D&&this._sendNextFrame()};V.prototype._sendNextFrame=function(){if(0!=this._frameBuffer.length){var k=this._frameBuffer[0],t=k.frame,y=k.callback,C=k.response;if(this._serial){var D=this;t=t.toBuffer();this._logger.log("trace","send raw frame:"+t.toString("hex"));this._serial.sendPacket(t,function(K){if(K||!C){try{y&&y(K)}catch(S){}D._frameBuffer.splice(0,1);D._sendNextFrame()}else K=k.to,K||(K=V.RESPONSE_TO),k.timeout=setTimeout(function(){var S=
D._frameBuffer[0];if(S){S=S.callback;var H=Error("enocean response timeout");H.code=100;try{S&&S(H)}catch(I){}}D._frameBuffer.splice(0,1);D._sendNextFrame()},K)})}else y&&y(Error("port not opened")),this._frameBuffer.splice(0,1),this._sendNextFrame()}};V.prototype.onSerialData=function(k){k=this._rdata=Buffer.concat([this._rdata,k]);for(var t=0;t<k.length;)if(85!=k[t])t++;else{if(t+6>=k.length)break;var y=(k[t+1]<<8)+k[t+2],C=k[t+3],D=k[t+5];if(k.length<t+y+C+7)break;if(x.hub.m.enocean.CRC8(k.slice(t+
1,t+5))!=D)t++;else if(D=k[t+y+C+6],x.hub.m.enocean.CRC8(k.slice(t+6,t+6+y+C))!=D)t++;else{D={type:k[t+4],dataLen:y,optLen:C,radioType:k[t+6],data:k.slice(t+6,t+6+y),optData:k.slice(t+6+y,t+6+y+C),rawByte:k.slice(0,t+6+y+C+1).toString("hex")};var K=new q(D.type,D.data,D.optData);if(166==D.radioType||210==D.radioType||165==D.radioType||246==D.radioType||213==D.radioType)D.senderId=D.data.slice(y-5,y-1).toString("hex");try{this._onEOFrame(K,D)}catch(S){this._logger.log("warn","process frame exception:"+
S.stack)}t=t+6+y+C+1}}0!=t&&0<k.length&&t<=k.length&&(k=k.slice(t));this._rdata=k};V.prototype.onSerialError=function(k){this._serial.setListener(null);this._serial=null};V.prototype._onEOFrame=function(k,t){this._logger.log("trace","receive raw frame:"+t.rawByte);this._logger.log("debug","receive enocean frame:"+JSON.stringify(k.toJSON()));this._listeners.forEach(function(C){C._onEOFrame&&C._onEOFrame(k,t.rawByte)});var y=k.toPacket();y&&this._onEOPacket(y)};V.prototype._onEOPacket=function(k){this._logger.log("debug",
"receive enocean packet:"+JSON.stringify(k.toJSON()));this._listeners.forEach(function(t){t._onEOPacket&&t._onEOPacket(k)});k instanceof g?this._onEORadio_ERP1(k):k instanceof e?this._onEOResponse_Packet(k):k instanceof p&&this._onEOEvent_Packet(k)};V.prototype._onEORadio_ERP1=function(k){(k=k.toRadioTelegram())&&this._onEO_ERP1_Telegram(k)};V.prototype._onEOResponse_Packet=function(k){try{var t=k.toResponse();this._onEO_Response(t)}catch(C){}if(0!=this._frameBuffer.length){var y=this._frameBuffer[0];
t=y.callback;(y=y.timeout)&&clearTimeout(y);try{t&&t(null,k)}catch(C){}this._frameBuffer.splice(0,1);this._sendNextFrame()}};V.prototype._onEOEvent_Packet=function(k){(k=k.toEvent())&&this._onEO_Event(k)};V.prototype._onEO_ERP1_Telegram=function(k){this._logger.log("debug","receive enocean telegram:"+JSON.stringify(k.toJSON()));if(64==k.rorg)this._cdmHandler.receiveChainedTelegram(k);else if(this._listeners.forEach(function(t){t._onEOTelegram&&t._onEOTelegram(k)}),49==k.rorg&&(k=this._controller._secHandler.resolve(k))&&
this._listeners.forEach(function(t){t._onEOTelegram&&t._onEOTelegram(k)}),this._learning&&this._learnHandler&&this._learnHandler.onTelegram)this._learnHandler.onTelegram(k)};V.prototype._onEO_Response=function(k){this._logger.log("debug","receive enocean response:"+JSON.stringify(k.toJSON()))};V.prototype._onEO_Event=function(k){this._logger.log("debug","receive enocean event:"+JSON.stringify(k.toJSON()));if(this._learning&&this._learnHandler&&this._learnHandler.onEvent)this._learnHandler.onEvent(k)};
V.ESP3_Frame=q;V.Telegram=l;V.RADIO_ERP1_Packet=g;V.Event=O;V.Response=R;V.COMMAND_COMMAND=Na;V.SA_COMMAND=pa;return V}();
x.hub.m.enocean.ESP2=function(){var q=function(l,u){this._logger=require("x.logger.js").getLogger("x.hub.m.enocean.ESP2.Telegram");this._type=l;this._data=u};q.prototype.toBuffer=function(){var l=new Buffer(3+this._data.length+1),u=0;l.writeUInt8(165,0);l.writeUInt8(90,1);var w=this._type<<5|this._data.length+1&31;u+=w;l.writeUInt8(w,2);for(w=0;w<this._data.length;w++){var E=this._data.readUInt8(w);l.writeUInt8(E,w+3);u+=E}l.writeUInt8(u&255,l.length-1);return l};q.resolve=function(l,u){switch(l){case 0:return e.resolve(u);
case 3:return h.resolve(u);case 4:return g.resolve(u);case 5:return f.resolve(u);default:return null}};var h=function(){var l=function(u){q.call(this,3,u)};l.prototype=new q;l.prototype.constructor=l;l.prototype.getData=function(){return this._data.slice(1,5)};l.prototype.getSenderID=function(){return this._data.slice(5,9).toString("hex")};l.prototype.getStatus=function(){return this._data.readUInt8(9)};l.prototype.toJSON=function(){return{type:"TRT",org:"0x"+this._data.slice(0,1).toString("hex"),
data:this.getData().toString("hex"),senderID:this.getSenderID(),status:this.getStatus()}};l.prototype.fromPayload=function(u){this._data=u._data};l.resolve=function(u){return u&&u.length?new l(u):null};return l}(),e=function(){var l=function(u){q.call(this,0,u)};l.prototype=new q;l.prototype.constructor=l;l.prototype.getData=function(){return this._data.slice(1,5)};l.prototype.getSenderID=function(){return this._data.slice(5,9).toString("hex")};l.prototype.getStatus=function(){return this._data.readUInt8(9)};
l.prototype.toJSON=function(){return{type:"RRT",org:"0x"+this._data.slice(0,1).toString("hex"),data:this.getData().toString("hex"),senderID:this.getSenderID(),status:this.getStatus()}};l.prototype.toPayload=function(){return m.resolve(this._data)};l.resolve=function(u){return u&&u.length?new l(u):null};return l}(),g=function(){var l=function(J){q.call(this,4,J)};l.prototype=new q;l.prototype.constructor=l;l.prototype.toJSON=function(){return{type:"RCT",org:"0x"+this._data.readUInt8(0).toString(16)}};
l.resolve=function(J){if(!J||!J.length)return null;var ca=J[0];switch(ca){case 88:return new u;case 25:return new w;case 34:return new A;case 26:return new L;case 8:case 11:case 9:case 10:return new E(ca);case 152:return new N(J.slice(1,5).toString("hex"));case 136:return new G(J[2]);case 140:return new Q(J.slice(1));default:return null}};var u=function(){var J=new Buffer([88,0,0,0,0,0,0,0,0]);q.call(this,4,J)};u.prototype=new l;u.prototype.constructor=u;u.prototype.toJSON=function(){var J=l.prototype.toJSON.call(this);
J.subtype="OK";return J};var w=function(){var J=new Buffer([25,0,0,0,0,0,0,0,0]);q.call(this,4,J)};w.prototype=new l;w.prototype.constructor=w;w.prototype.toJSON=function(){var J=l.prototype.toJSON.call(this);J.subtype="ERR";return J};var E=function(J){J=new Buffer([J,0,0,0,0,0,0,0,0]);q.call(this,4,J)};E.prototype=new l;E.prototype.constructor=E;E.prototype.getField=function(){return this._data.readUInt8(0)};E.prototype.getFieldName=function(){switch(this._data.readUInt8(0)){case 8:return"H_SEQ";
case 9:return"LENGTH";case 10:return"CHKSUM";case 11:return"ORG";default:return"UNKNOWN"}};E.prototype.toJSON=function(){var J=l.prototype.toJSON.call(this);J.subtype="ERR_SYNTAX";J.field=this.getFieldName();return J};var A=function(){var J=new Buffer([34,0,0,0,0,0,0,0,0]);q.call(this,4,J)};A.prototype=new l;A.prototype.constructor=A;A.prototype.toJSON=function(){var J=l.prototype.toJSON.call(this);J.subtype="ERR_TX_IDRANGE";return J};var L=function(){var J=new Buffer([26,0,0,0,0,0,0,0,0]);q.call(this,
4,J)};L.prototype=new l;L.prototype.constructor=L;L.prototype.toJSON=function(){var J=l.prototype.toJSON.call(this);J.subtype="ERR_IDRANGE";return J};var N=function(J){J=new Buffer("98"+J+"00000000","hex");q.call(this,4,J)};N.prototype=new l;N.prototype.constructor=N;N.prototype.getBaseID=function(){return this._data.slice(1,5).toString("hex")};N.prototype.toJSON=function(){var J=l.prototype.toJSON.call(this);J.subtype="INF_BASEID";J.baseID=this.getBaseID();return J};var G=function(J){J=new Buffer([136,
J&255,0,0,0,0,0,0,0]);q.call(this,4,J)};G.prototype=new l;G.prototype.constructor=G;var Q=function(J){J=new Buffer("8C"+J.toString("hex"),"hex");q.call(this,4,J)};Q.prototype=new l;Q.prototype.constructor=Q;l.OK=u;l.ERR=w;l.ERR_SYNTAX=E;l.ERR_TX_IDRANGE=A;l.ERR_IDRANGE=L;l.INF_BASEID=N;l.INF_RX_SENSITIVITY=G;l.INF_SW_VER=Q;return l}(),f=function(){var l=function(G){q.call(this,5,G)};l.prototype=new q;l.prototype.constructor=l;l.prototype.toJSON=function(){return{type:"TCT",org:"0x"+this._data.readUInt8(0).toString(16)}};
l.resolve=function(G){if(!G||!G.length)return null;switch(G[0]){case 24:return new u(G.slice(1,4).toString("hex"));case 88:return new w;case 8:return new E(G[2]);case 72:return new A;case 75:return new N;case 10:return new L;default:return null}};var u=function(G){G=new Buffer("18"+G+"0000000000","hex");q.call(this,5,G)};u.prototype=new l;u.prototype.constructor=u;u.prototype.getBaseID=function(){return this._data.slice(1,5).toString("hex")};u.prototype.toJSON=function(){var G=l.prototype.toJSON.call(this);
G.subtype="SET_BASEID";G.baseID=this.getBaseID();return G};var w=function(){var G=new Buffer("58000000000000000000","hex");q.call(this,5,G)};w.prototype=new l;w.prototype.constructor=w;w.prototype.toJSON=function(){var G=l.prototype.toJSON.call(this);G.subtype="RD_BASEID";return G};var E=function(G){G=new Buffer([8,G&255,0,0,0,0,0,0,0,0]);q.call(this,5,G)};E.prototype=new l;E.prototype.constructor=E;E.prototype.getSensitivity=function(){return this._data.readUInt8(1)};E.prototype.toJSON=function(){var G=
l.prototype.toJSON.call(this);G.subtype="SET_RX_SENSITIVITY";G.sensitivity=this.getSensitivity();return G};var A=function(){var G=new Buffer("48000000000000000000","hex");q.call(this,5,G)};A.prototype=new l;A.prototype.constructor=A;A.prototype.toJSON=function(){var G=l.prototype.toJSON.call(this);G.subtype="RD_RX_SENSITIVITY";return G};var L=function(){var G=new Buffer("0A000000000000000000","hex");q.call(this,5,G)};L.prototype=new l;L.prototype.constructor=L;L.prototype.toJSON=function(){var G=
l.prototype.toJSON.call(this);G.subtype="RESET";return G};var N=function(){var G=new Buffer("4B000000000000000000","hex");q.call(this,5,G)};N.prototype=new l;N.prototype.constructor=N;N.prototype.toJSON=function(){var G=l.prototype.toJSON.call(this);G.subtype="RD_SW_VER";return G};l.SET_BASEID=u;l.RD_BASEID=w;l.SET_RX_SENSITIVITY=E;l.RD_RX_SENSITIVITY=A;l.RESET=L;l.RD_SW_VER=N;return l}(),m=function(){var l=function(A,L){if(A&&L){var N=Buffer.alloc(1);N.writeUInt8(A);this._data=Buffer.concat([N,L])}};
l.prototype.getData=function(){throw Error("not implemented by this child class");};l.prototype.getSenderID=function(){throw Error("not implemented by this child class");};l.prototype.getStatus=function(){throw Error("not implemented by this child class");};l.prototype.toJSON=function(){return{type:null,org:"0x"+this._data.slice(0,1).toString("hex"),data:this.getData().toString("hex"),senderID:this.getSenderID(),status:this.getStatus()}};l.resolve=function(A){if(!A||!A.length)return null;switch(A[0]){case 5:return u.resolve(A.slice(1));
case 6:return w.resolve(A.slice(1));case 7:return E.resolve(A.slice(1));default:return null}};var u=function(A,L,N){var G=Buffer.alloc(9);G.writeUInt8(A,0);G.writeUInt8(0,1);G.writeUInt8(0,2);G.writeUInt8(0,3);A=0;for(var Q=4;8>A;A+=2,Q++){var J=L.substr(A,2);G.writeUInt8(parseInt(J,16),Q)}G.writeUInt8(N,8);l.call(this,5,G)};u.prototype=new l;u.prototype.constructor=u;u.prototype.getData=function(){return this._data.slice(1,2)};u.prototype.getSenderID=function(){return this._data.slice(5,9).toString("hex")};
u.prototype.getStatus=function(){return this._data.readUInt8(9)};u.prototype.toJSON=function(){var A=l.prototype.toJSON.call(this);A.type="RPS";return A};u.resolve=function(A){var L=A.readUInt8(0),N=A.slice(4,8).toString("hex");A=A.readUInt8(8);return new u(L,N,A)};var w=function(A,L,N){var G=Buffer.alloc(9);G.writeUInt8(A,0);G.writeUInt8(0,1);G.writeUInt8(0,2);G.writeUInt8(0,3);A=0;for(var Q=4;8>A;A+=2,Q++){var J=L.substr(A,2);G.writeUInt8(parseInt(J,16),Q)}G.writeUInt8(N,8);l.call(this,6,G)};w.prototype=
new l;w.prototype.constructor=w;w.prototype.isTeachIn=function(){return 0==(this._data.readUInt8(1)&8)};w.prototype.getData=function(){return this._data.slice(1,2)};w.prototype.getSenderID=function(){return this._data.slice(5,9).toString("hex")};w.prototype.getStatus=function(){return this._data.readUInt8(9)};w.prototype.toJSON=function(){var A=l.prototype.toJSON.call(this);A.type="1BS";A.teachin=this.isTeachIn();return A};w.resolve=function(A){var L=A.readUInt8(0),N=A.slice(4,8).toString("hex");
A=A.readUInt8(8);return new w(L,N,A)};var E=function(A,L,N){for(var G=Buffer.alloc(9),Q=0;4>Q;Q++)G.writeUInt8(A.readUInt8(Q),Q);A=0;for(Q=4;8>A;A+=2,Q++){var J=L.substr(A,2);G.writeUInt8(parseInt(J,16),Q)}G.writeUInt8(N,8);l.call(this,7,G)};E.prototype=new l;E.prototype.constructor=E;E.prototype.isTeachIn=function(){return 0==(this.getData().readUInt8(3)&8)};E.prototype.getProfile=function(){var A=this.getData(),L=A.readUInt8(0)>>2;A=(A.readUInt8(0)&3)<<5|A.readUInt8(1)>>3&31;return Buffer.from([7,
L,A])};E.prototype.getProfileText=function(){var A=this.getProfile().toString("hex");return A.substr(0,2)+"-"+A.substr(2,2)+"-"+A.substr(4,2)};E.prototype.getManufacturerId=function(){var A=this.getData().slice(1,3);A.writeUInt8(A.readUInt8(0)&7,0);return A.toString("hex")};E.prototype.getLearnType=function(){return this.getData().readUInt8(3)>>7&1};E.prototype.getEEPResult=function(){return this.getData().readUInt8(3)>>6&1};E.prototype.getLearnResult=function(){return this.getData().readUInt8(3)>>
5&1};E.prototype.getLearnStaus=function(){return this.getData().readUInt8(3)>>4&1};E.prototype.getData=function(){return this._data.slice(1,5)};E.prototype.getSenderID=function(){return this._data.slice(5,9).toString("hex")};E.prototype.getStatus=function(){return this._data.readUInt8(9)};E.prototype.toJSON=function(){var A=l.prototype.toJSON.call(this);A.type="4BS";A.teachin=this.isTeachIn();A.teachin&&(A.teachin_info={profile:this.getProfileText(),learn_type:this.getLearnType(),eep_result:this.getEEPResult(),
learn_result:this.getLearnResult(),learn_status:this.getLearnStaus()},A.teachin_info.learn_type&&(A.teachin_info.manufactureID=this.getManufacturerId()));return A};E.resolve=function(A){var L=A.slice(0,4),N=A.slice(4,8).toString("hex");A=A.readUInt8(8);return new E(L,N,A)};l.RPS=u;l.BS1=w;l.BS4=E;return l}(),p=function(l,u){this._logger=require("x.logger.js").getLogger("x.hub.m.enocean.ESP2");this._controller=l;this._listeners=[];l&&this._listeners.push(l);this._baudrate=u;this._baudrate||(this._baudrate=
9600);this._baseID=this._serial=null;this._rdata=new Buffer([]);this._telegramBuffer=[];this._learnHandler=null;this._learning=!1;this._learnTO=null};p.RESPONSE_TO=1500;p.prototype.attachSerial=function(l,u){var w=this;this._serial=new x.hub.m.enocean.Serial(l,this._baudrate);this._serial.setListener(this);this._serial.open(function(E){E?(w._serial.setListener(null),w._serial=null,u&&u(E)):w.readBaseID(function(A,L){A?(w._serial.setListener(null),w._serial.close(),w._serial=null,u&&u(A)):(w._baseID=
L,u&&u())})})};p.prototype.removeSerial=function(l,u){this._serial.setListener(null);this._serial.close();this._baseID=this._serial=null;u&&u()};p.prototype.getSerial=function(){return this._serial};p.prototype.readBaseID=function(l){var u=this,w=new f.RD_BASEID;this.sendTelegram(w,2E3,function(E,A){E?(u._logger.log("warn","read base id error:"+E.stack),l&&l(E)):A instanceof g.INF_BASEID?(E=A.getBaseID(),l&&l(null,E.toLowerCase())):(E=Error("read base id failed"),u._logger.log("warn","read base id failed:"+
A.retCode),l&&l(E))})};p.prototype.sendTelegram=function(l,u,w){this._logger.log("debug","send enocean telegram:"+JSON.stringify(l.toJSON()));var E=this._telegramBuffer.length;this._telegramBuffer.push({telegram:l,callback:w,timeout:null,to:u});0==E&&this._sendNextTelegram()};p.prototype._sendNextTelegram=function(){if(0!=this._telegramBuffer.length){var l=this._telegramBuffer[0],u=l.telegram,w=l.callback,E=!0;if(u instanceof f.RESET||u instanceof h)E=!1;if(this._serial){var A=this;u=u.toBuffer();
this._logger.log("trace","send raw telegram:"+u.toString("hex"));this._serial.sendPacket(u,function(L){if(L||!E){try{w&&w(L)}catch(N){}A._telegramBuffer.splice(0,1);A._sendNextTelegram()}else L=l.to,L||(L=p.RESPONSE_TO),l.timeout=setTimeout(function(){var N=Error("enocean response timeout");N.code=100;try{w&&w(N)}catch(G){}A._telegramBuffer.splice(0,1);A._sendNextTelegram()},L)})}else w&&w(Error("port not opened")),this._telegramBuffer.splice(0,1),this._sendNextTelegram()}};p.prototype.onSerialData=
function(l){for(var u=this._rdata=Buffer.concat([this._rdata,l]),w=0;w<u.length;)if(165!=u[w])w++;else{if(w+w>=u.length)break;if(90!=u[w+1])w+=2;else{if(w+2>=u.length)break;var E=u[w+2]>>5&7,A=u[w+2]&31;if(2>=A)w+=3;else{if(w+3+A>u.length)break;l=u.slice(w+3,w+3+A-1);for(var L=u[w+3+A-1],N=0,G=w+2;G<w+3+A-1;G++)N+=u[G];N&=255;if(N!=L)this._logger.log("trace","acctual crc:"+N.toString(16)+" expected crc:"+L.toString(16));else{this._logger.log("trace","hseq:"+E+" len:"+A+" data:"+l.toString("hex")+
" crc:"+L.toString(16));l=q.resolve(E,l);try{l&&this._onESP2Telegram(l)}catch(Q){this._logger.log("warn","process esp2 telegram exception:"+Q.stack)}}w=w+3+A}}}0!=w&&0<u.length&&w<=u.length&&(u=u.slice(w));this._rdata=u};p.prototype.onSerialError=function(l){this._serial.setListener(null);this._serial=null};p.prototype._onESP2Telegram=function(l){if(!(l instanceof h||l instanceof f)){this._logger.log("debug","receive enocean telegram:"+JSON.stringify(l.toJSON()));if(l instanceof e){var u=l.toPayload();
this._logger.log("debug","receive enocean payload:"+JSON.stringify(u.toJSON()));this._listeners.forEach(function(E){E._onESP2Telegram&&E._onESP2Telegram(l)})}if(0!=this._telegramBuffer.length&&l instanceof g){var w=this._telegramBuffer[0];u=w.callback;(w=w.timeout)&&clearTimeout(w);try{u&&u(null,l)}catch(E){}this._telegramBuffer.splice(0,1);this._sendNextTelegram()}}};p.TRT=h;p.Payload=m;p.Telegram=q;return p}();
x.hub.m.enocean.profiles=function(){var q=function(a){this._address=a?a.address:null;this._senderID=a?a.senderID:null;this._data=a?a.data:null;this._params=a?a.params:null;this._vendor="general";this._virtual=!1;this._eepAlias=null;this.setDefaultParams();this._states={};this._logger=require("x.logger.js").getLogger("x.hub.m.enocean.profiles."+(this._data?this._data:"Profile"))};q.prototype.getAddress=function(){return this._address};q.prototype.getData=function(){return this._data};q.prototype.finalize=
function(a){a&&a()};q.prototype.evalData=function(a,b,c){(a=this.evalTelegram(b))?(a=this.checkStateChange(a),c&&c(null,a)):c&&c(Error("data format invalid"))};q.prototype.evalTelegram=function(a){return null};q.prototype.getStatesBuffer=function(){return this._states};q.prototype.getBufferedState=function(a){var b=this.getStatesBuffer();return b&&b[a]?b[a].value:null};q.prototype.getCurrentStates=function(){var a={},b=this.getStatesBuffer(),c;for(c in b)b.hasOwnProperty(c)&&b[c]&&(a[c]=b[c].value);
return a};q.prototype.getStatesLegacy=function(){var a=this.getCurrentStates();return{type:"ENOCEAN",adr:this._address,data:this._data,vendor:this._vendor,state:a}};q.prototype.checkStateChange=function(a){var b=this._states,c=[],d=(new Date).getTime(),n;for(n in a){var r={};r.key=n;r.value=a[n];r.changed=!1;var v=b[n]?b[n].value:null;v!=a[n]&&(r.oldvalue=v,r.changed=!0);this._states[n]={value:a[n],time:d};c.push(r)}return c};q.prototype.setDefaultParams=function(){};q.prototype.activeStateChange=
function(a){a=this.checkStateChange(a);0<a.length&&require("x.hub.m.enocean.js")._onEOEvents(this,a)};q.prototype.toJSON=function(){return{type:"ENOCEAN",address:this._address,data:this._data,senderID:this._senderID,vendor:this._vendor,virtual:this._virtual,params:this._params}};q.prototype.fromJSON=function(a){if(!a||!a.address||!a.data||a.data!=this._data)return null;this._address=a.address;this._senderID=a.senderID;this._vendor=a.vendor?a.vendor:this._vendor;this._virtual=a.virtual?!0:!1;this._params=
a.params;this.setDefaultParams();return this};q.prototype.toDBJSON=function(){return{id:this._address,senderID:this._senderID,eep:this._data,vendor:this._vendor,params:this._params,virtual:this._virtual}};q.prototype.fromDBJSON=function(a){if(!a||!a.id||!a.eep||a.eep!=this._data)return null;this._address=a.id;this._senderID=a.senderID;this._vendor=a.vendor?a.vendor:this._vendor;this._virtual=a.virtual?!0:!1;this._params=a.params;this.setDefaultParams();return this};var h=function(a){q.call(this,a);
this._logger=require("x.logger.js").getLogger("x.hub.m.enocean.profiles.SiegeniaWindow");this._data="d2-06-50";this._vendor="siegenia";this._desc="Window";this._states={counter00:{value:"?",time:-1},counter01:{value:"?",time:-1},counter02:{value:"?",time:-1},counter03:{value:"?",time:-1},counter04:{value:"?",time:-1},counter05:{value:"?",time:-1},counter06:{value:"?",time:-1},counter07:{value:"?",time:-1},counter08:{value:"?",time:-1},counter09:{value:"?",time:-1},counter0A:{value:"?",time:-1},aliveTimeout:{value:!1,
time:-1}};var b=this;this._params=a?a.params:null;this._params||(this._params={alive:900,sync:0,eep:1,type:0,alarm:0,alarm_sens:0});this._aliveTO=setTimeout(function(){b._aliveTimeout()},2E3*this._params.alive);this._lastAlarm=null};h.TEMPALTE={id:null,eep:null,desc:"Window",manufacturer:"SIEGENIA-AUBI KG",vendor:"siegenia",params:{alive:900,sync:0,eep:1,type:0,alarm:0,alarm_sens:0}};h.prototype=new q;h.prototype.constructor=h;h.prototype.evalTelegram=function(a){var b={};if(210==a.rorg)if(a=a.userData,
1==a[0]&&8==a.length){var c=a[1]&239,d=(a[2]<<24)+(a[3]<<16)+(a[4]<<8)+a[5],n=a[6]>>7;b={type:1,TBT:!1,batteryOK:!0,battery:a[6]&127,motionSensor:a[7]>>6,accelerationSensor:(a[7]&48)>>4,magneticSensor:(a[7]&12)>>2,error:a[7]&3,count:d};n&&(b.batteryOK=!1);100<b.battery&&(b.battery=100);b.code=c;switch(c){case 0:b.state="?";b.handle="?";b.counter00=d;break;case 1:b.state="closed";b.handle="closed";b.counter01=d;break;case 2:b.state="closed";b.handle="open";b.counter02=d;break;case 3:b.state="closed";
b.handle="tilted";b.counter03=d;break;case 4:b.state="open";b.handle="closed";b.counter04=d;break;case 5:b.state="open";b.handle="open";b.TBT=!0;b.counter05=d;break;case 6:b.state="open";b.handle="tilted";b.TBT=!0;b.counter06=d;break;case 7:b.state="tilted";b.handle="closed";b.TBT=!0;b.counter07=d;break;case 8:b.state="tilted";b.handle="open";b.TBT=!0;b.counter08=d;break;case 9:b.state="tilted";b.handle="tilted";b.counter09=d;break;case 10:b.state="?",b.handle="?",b.counter0A=d}}else if(2==a[0]&&
2==a.length)switch(b.type=2,a[1]&15){case 1:b.burglary=!0;break;default:b.burglary=!1}else if(17==a[0]&&2==a.length){b.type=17;switch((a[1]&192)>>6){case 0:b.calibrationState="ok";break;case 1:b.calibrationState="error";break;case 2:b.calibrationState="invalid";break;case 3:b.calibrationState="not_supported"}a=a[1]&63;b.calibrationStep=a;switch(a){case 0:b.calibrationCasement="none";b.calibrationHandle="none";break;case 1:b.calibrationCasement="closed";b.calibrationHandle="closed";break;case 2:b.calibrationCasement=
"closed";b.calibrationHandle="open";break;case 3:b.calibrationCasement="closed";b.calibrationHandle="tilted";break;case 4:b.calibrationCasement="open";b.calibrationHandle="closed";break;case 5:b.calibrationCasement="open";b.calibrationHandle="open";break;case 6:b.calibrationCasement="open";b.calibrationHandle="tilted";break;case 7:b.calibrationCasement="tilted";b.calibrationHandle="closed";break;case 8:b.calibrationCasement="tilted";b.calibrationHandle="open";break;case 9:b.calibrationCasement="tilted",
b.calibrationHandle="tilted"}}return b};h.prototype.evalData=function(a,b,c){var d=this;d._states.aliveTimeout.value=!1;clearTimeout(this._aliveTO);this._aliveTO=setTimeout(function(){d._aliveTimeout()},2E3*this._params.alive);if(a=this.evalTelegram(b)){if(2==a.type){b=(new Date).getTime();if(this._lastAlarm&&4E3>b-this._lastAlarm){c&&c(Error("duplicated alarm"));return}this._lastAlarm=b}b=[];a.aliveMsg||(b=this.checkStateChange(a));c&&c(null,b)}else c&&c(Error("data format invalid"))};h.prototype.checkStateChange=
function(a){var b=this._states,c=[],d;for(d in a)if("aliveMsg"!=d&&"type"!=d){var n={};n.key=d;n.value=a[d];n.changed=!1;var r=b[d]?b[d].value:null;r!=a[d]&&(n.oldvalue=r,n.changed=!0);"burglary"!=d&&"calibrationState"!=d&&"calibrationCasement"!=d&&"calibrationHandle"!=d&&(this._states[d]={value:a[d],time:(new Date).getTime()});c.push(n)}return c};h.prototype._resolveStates=function(a,b){b={};if(210==a[0])if(a=a.slice(1,a.length-5),1==a[0]&&8==a.length){var c=a[1]&239,d=(a[2]<<24)+(a[3]<<16)+(a[4]<<
8)+a[5],n=a[6]>>7;b={aliveMsg:1==(a[1]&128)>>7,TBT:!1,batteryOK:!0,battery:a[6]&127,motionSensor:a[7]>>6,accelerationSensor:(a[7]&48)>>4,magneticSensor:(a[7]&12)>>2,error:a[7]&3,count:d};n&&(b.batteryOK=!1);100<b.battery&&(b.battery=100);switch(c){case 0:b.state="closed";b.handle="closed";b.counter00=d;break;case 1:b.state="closed";b.handle="open";b.counter01=d;break;case 2:b.state="open";b.handle="open";b.counter02=d;break;case 3:b.state="closed";b.handle="tilted";b.counter03=d;break;case 4:b.state=
"tilted";b.handle="tilted";b.counter04=d;break;case 5:b.state="closed";b.handle="tilted";b.TBT=!0;b.counter05=d;break;case 6:b.state="tilted";b.handle="tilted";b.TBT=!0;b.counter06=d;break;case 7:b.state="closed";b.handle="open";b.TBT=!0;b.counter07=d;break;case 8:b.state="open";b.handle="open";b.TBT=!0;b.counter08=d;break;case 9:b.state="open";b.handle="closed";b.counter09=d;break;case 10:b.state="open",b.handle="tilted",b.counter0A=d}}else if(2==a[0]&&2==a.length)switch(a[1]&15){case 1:b.burglary=
!0;break;default:b.burglary=!1}else if(17==a[0]&&2==a.length){switch((a[1]&192)>>6){case 0:b.calibrationState="ok";break;case 1:b.calibrationState="error";break;case 2:b.calibrationState="invalid";break;case 3:b.calibrationState="not_supported"}switch(a[1]&63){case 0:b.calibrationCasement="none";b.calibrationHandle="none";break;case 1:b.calibrationCasement="closed";b.calibrationHandle="closed";break;case 2:b.calibrationCasement="closed";b.calibrationHandle="open";break;case 3:b.calibrationCasement=
"closed";b.calibrationHandle="tilted";break;case 4:b.calibrationCasement="open";b.calibrationHandle="closed";break;case 5:b.calibrationCasement="open";b.calibrationHandle="open";break;case 6:b.calibrationCasement="open";b.calibrationHandle="tilted";break;case 7:b.calibrationCasement="tilted";b.calibrationHandle="closed";break;case 8:b.calibrationCasement="tilted";b.calibrationHandle="open";break;case 9:b.calibrationCasement="tilted",b.calibrationHandle="tilted"}}return b};h.prototype._aliveTimeout=
function(){this.activeStateChange({aliveTimeout:!0})};h.prototype.fromJSON=function(a){if(!q.prototype.fromJSON.call(this,a))return null;this._params||(this._params={alive:900,sync:0,eep:1,type:0,alarm:0,alarm_sens:0});return this};h.prototype.fromDBJSON=function(a){if(!q.prototype.fromDBJSON.call(this,a))return null;this._params||(this._params={alive:900,sync:0,eep:1,type:0,alarm:0,alarm_sens:0});return this};var e=function(a){q.call(this,a);this._logger=require("x.logger.js").getLogger("x.hub.m.enocean.profiles.MacoWindow");
this._data="d5-xx-xx";this._desc="Window";this._vendor="maco"};e.TEMPALTE={id:null,eep:null,desc:"Window",manufacturer:"Mayer & Co Beschl\u00e4ge GmbH"};e.prototype=new q;e.prototype.constructor=e;e.prototype.evalData=function(a,b,c){(a=this._resolveStates(a,b))?(a=this.checkStateChange(a),c&&c(null,a)):c&&c(Error("data format invalid"))};e.prototype._resolveStates=function(a,b){b={};if(213==a[0]){a=a.slice(1,a.length-5);var c=(a[0]&8)>>3,d=(a[0]&6)>>1,n=a[0]&1;switch((a[0]&48)>>4){case 0:b.state=
"unused";break;case 1:b.state="tilted";break;case 2:b.state="open";break;case 3:b.state="closed"}b.learn=c;b.battery=d;b.alarm=n}return b};e.prototype.toDBJSON=function(){return{id:this._address,eep:this._data,desc:this._desc,manufacturer:"Mayer & Co Beschl\u00e4ge GmbH",vendor:this._vendor}};var g=function(a){q.call(this,a);this._logger=require("x.logger.js").getLogger("x.hub.m.enocean.profiles.SodaHandle");this._data="f6-so-da"};g.TEMPALTE={id:null,eep:null};g.prototype=new q;g.prototype.constructor=
g;g.prototype.evalTelegram=function(a){var b={};if(246==a.rorg)switch(a.userData){case 240:b.state="tilted";break;case 192:b.state="open";break;case 208:b.state="closed"}return b};g.prototype.evalData=function(a,b,c){(a=this.evalTelegram(b))?(a=this.checkStateChange(a),c&&c(null,a)):c&&c(Error("data format invalid"))};g.prototype.toJSON=function(a,b){return{address:this._address,data:this._data,vendor:"soda"}};g.prototype.toDBJSON=function(){return{id:this._address,eep:this._data,desc:"Window_Handle",
manufacturer:"SODA",vendor:"soda"}};var f=function(a){q.call(this,a);this._data="f6-??-??"};f.prototype=new q;f.prototype.constructor=f;var m=function(a){f.call(this,a);this._data="f6-01-01";this._longPressThreshold=1E3};m.STATES=["button"];m.COMMANDS=["shortPress","longPress","press","release"];m.prototype=new f;m.prototype.constructor=p;m.prototype.evalTelegram=function(a){var b={};246==a.rorg&&(b.button=a.userData>>4&1?"pressed":"released");return b};m.prototype.buildData=function(a){return a<<
4};m.prototype.checkStateChange=function(a){var b=this._states,c=[],d=(new Date).getTime(),n;for(n in a){var r={};r.key=n;r.value=a[n];r.changed=!1;var v=b[n]?b[n].value:null,z=b[n]?b[n].time:null,F=a[n];v!=F&&(r.oldvalue=v,r.changed=!0);this._states[n]={value:a[n],time:d};r.changed&&c.push(r);"pressed"==v&&"released"==F&&(!z||d-z<this._longPressThreshold?(r={},r.key=n,r.value="shortPress"):(r={},r.key=n,r.value="longPress"),r.changed=!0,c.push(r))}return c};m.prototype.executeCommand=function(a,
b,c){if(this._senderID)if(b&&b.value){var d=this,n=100;switch(b.value){case "longPress":n=this._longPressThreshold;case "shortPress":var r=this.buildData(1);var v=new x.hub.m.enocean.ESP3.Telegram.RPS(r,this._senderID,1,1,0,null);a.sendTelegram(v,!0,function(z){z?c&&c(z):(d.activeStateChange({button:"pressed"}),setTimeout(function(){r=d.buildData(0);v=new x.hub.m.enocean.ESP3.Telegram.RPS(r,d._senderID,1,1,0,null);a.sendTelegram(v,!0,function(F){d.activeStateChange({button:"released"});c&&c(F)})},
n))});break;case "press":r=this.buildData(1);v=new x.hub.m.enocean.ESP3.Telegram.RPS(r,this._senderID,1,1,0,null);a.sendTelegram(v,!0,function(z){d.activeStateChange({button:"pressed"});c&&c(z)});break;case "release":r=this.buildData(0),v=new x.hub.m.enocean.ESP3.Telegram.RPS(r,this._senderID,1,1,0,null),a.sendTelegram(v,!0,function(z){d.activeStateChange({button:"released"});c&&c(z)})}}else c&&c(Error("command invalid"));else c&&c(Error("sender id is null"))};var p=function(a){f.call(this,a);this._data=
"f6-02-01";this._longPressThreshold=1E3};p.STATES=["buttonAI","buttonAO","buttonBI","buttonBO"];p.COMMANDS="shortPressAI longPressAI pressAI releaseAI shortPressAO longPressAO pressAO releaseAO shortPressBI longPressBI pressBI releaseBI shortPressBO longPressBO pressBO releaseBO".split(" ");p.prototype=new f;p.prototype.constructor=p;p.prototype.evalTelegram=function(a){var b={};if(246==a.rorg){var c=a.userData>>5&7,d=a.userData>>1&7,n=a.userData&1,r=a.t21,v=a.nu;a=a.userData>>4&1?"pressed":"released";
if(1==r&&1==v){switch(c){case 0:var z=a;break;case 1:var F=a;break;case 2:var P=a;break;case 3:var U=a}if(n)switch(d){case 0:z=a;break;case 1:F=a;break;case 2:P=a;break;case 3:U=a}}else if(1==r&&0==v)switch(c){case 0:U=P=F=z=a}z&&(b.buttonAI=z);F&&(b.buttonAO=F);P&&(b.buttonBI=P);U&&(b.buttonBO=U)}return b};p.prototype.buildData=function(a,b,c,d){return a<<5|b<<4|c<<1|d};p.prototype.checkStateChange=function(a){var b=this._states,c=[],d=(new Date).getTime(),n;for(n in a){var r={};r.key=n;r.value=
a[n];r.changed=!1;var v=b[n]?b[n].value:null,z=b[n]?b[n].time:null,F=a[n];v!=F&&(r.oldvalue=v,r.changed=!0);this._states[n]={value:a[n],time:d};r.changed&&("pressed"==F||"released"==F&&"pressed"==v)&&c.push(r);"pressed"==v&&"released"==F&&(!z||d-z<this._longPressThreshold?(r={},r.key=n,r.value="shortPress"):(r={},r.key=n,r.value="longPress"),r.changed=!0,c.push(r))}return c};p.prototype.executeCommand=function(a,b,c){if(this._senderID)if(b&&b.value){var d=this,n=100,r=b.value.substr(b.value.length-
2),v={},z=0;switch(r){case "AI":z=0;break;case "AO":z=1;break;case "BI":z=2;break;case "BO":z=3}switch(b.value){case "longPressAI":case "longPressAO":case "longPressBI":case "longPressBO":n=this._longPressThreshold;case "shortPressAI":case "shortPressAO":case "shortPressBI":case "shortPressBO":var F=this.buildData(z,1,0,0);var P=new x.hub.m.enocean.ESP3.Telegram.RPS(F,this._senderID,1,1,0,null);a.sendTelegram(P,!0,function(U){U?c&&c(U):(v["button"+r]="pressed",d.activeStateChange(v),setTimeout(function(){F=
d.buildData(0,0,0,0);P=new x.hub.m.enocean.ESP3.Telegram.RPS(F,d._senderID,1,1,0,null);a.sendTelegram(P,!0,function(B){v["button"+r]="released";d.activeStateChange(v);c&&c(B)})},n))});break;case "pressAI":case "pressAO":case "pressBI":case "pressBO":F=this.buildData(z,1,0,0);P=new x.hub.m.enocean.ESP3.Telegram.RPS(F,this._senderID,1,1,0,null);a.sendTelegram(P,!0,function(U){v["button"+r]="pressed";d.activeStateChange(v);c&&c(U)});break;case "releaseAI":case "releaseAO":case "releaseBI":case "releaseBO":F=
d.buildData(0,0,0,0);P=new x.hub.m.enocean.ESP3.Telegram.RPS(F,this._senderID,1,1,0,null);a.sendTelegram(P,!0,function(U){v["button"+r]="released";d.activeStateChange(v);c&&c(U)});break;default:c&&c(Error("unknow command"))}}else c&&c(Error("command invalid"));else c&&c(Error("sender id is null"))};var l=function(a){p.call(this,a);this._data="f6-02-02"};p.STATES=["buttonAI","buttonAO","buttonBI","buttonBO"];l.COMMANDS="shortPressAI longPressAI pressAI releaseAI shortPressAO longPressAO pressAO releaseAO shortPressBI longPressBI pressBI releaseBI shortPressBO longPressBO pressBO releaseBO".split(" ");
l.prototype=new p;l.prototype.constructor=l;var u=function(a){f.call(this,a);this._data="f6-02-03"};u.STATES=["state"];u.COMMANDS=["auto","manu","dimUp","dimDown"];u.prototype=new f;u.prototype.constructor=u;u.prototype.evalTelegram=function(a){var b={};if(246==a.rorg)switch(a.userData){case 48:b.state="auto";break;case 16:b.state="manu";break;case 112:b.state="dimUp";break;case 80:b.state="dimDown"}return b};u.prototype.executeCommand=function(a,b,c){if(this._senderID)if(b&&b.value){switch(b.value){case "auto":var d=
48;break;case "manu":d=16;break;case "dimUp":d=112;break;case "dimDown":d=80;break;default:c&&c(Error("unknow command"))}this.activeStateChange({state:b.value});b=new x.hub.m.enocean.ESP3.Telegram.RPS(d,this._senderID,1,1,0,null);a.sendTelegram(b,!0,function(n){c&&c(n)})}else c&&c(Error("command invalid"));else c&&c(Error("sender id is null"))};var w=function(a){p.call(this,a);this._data="f6-02-04";this._longPressThreshold=1E3};w.STATES=["buttonAI","buttonAO","buttonBI","buttonBO","energyBow"];w.prototype=
new p;w.prototype.constructor=w;w.prototype.evalTelegram=function(a){var b={};if(246==a.rorg){var c=a.userData>>3&1,d=a.userData>>2&1,n=a.userData>>1&1,r=a.userData&1;b.energyBow=a.userData>>7&1?"pressed":"released";b.buttonBI=c?"pressed":"released";b.buttonBO=d?"pressed":"released";b.buttonAI=n?"pressed":"released";b.buttonAO=r?"pressed":"released"}return b};var E=function(a){p.call(this,a);this._data="f6-03-01";this._longPressThreshold=1E3};E.STATES="buttonAI buttonAO buttonBI buttonBO buttonCI buttonCO buttonDI buttonDO".split(" ");
E.COMMANDS="shortPressAI longPressAI pressAI releaseAI shortPressAO longPressAO pressAO releaseAO shortPressBI longPressBI pressBI releaseBI shortPressBO longPressBO pressBO releaseBO shortPressCI longPressCI pressCI releaseCI shortPressCO longPressCO pressCO releaseCO shortPressDI longPressDI pressDI releaseDI shortPressDO longPressDO pressDO releaseDO".split(" ");E.prototype=new p;E.prototype.constructor=E;E.prototype.evalTelegram=function(a){var b={};if(246==a.rorg){var c=a.userData>>5&7,d=a.userData>>
1&7,n=a.userData&1,r=a.t21,v=a.nu;a=a.userData>>4&1?"pressed":"released";if(0==r&&1==v){switch(c){case 0:var z=a;break;case 1:var F=a;break;case 2:var P=a;break;case 3:var U=a;break;case 4:var B=a;break;case 5:var M=a;break;case 6:var W=a;break;case 7:var aa=a}if(n)switch(d){case 0:z=a;break;case 1:F=a;break;case 2:P=a;break;case 3:U=a;break;case 4:B=a;break;case 5:M=a;break;case 6:W=a;break;case 7:aa=a}}else if(0==r&&0==v)switch(c){case 0:case 7:aa=W=M=B=U=P=F=z=a}z&&(b.buttonAI=z);F&&(b.buttonAO=
F);P&&(b.buttonBI=P);U&&(b.buttonBO=U);B&&(b.buttonCI=B);M&&(b.buttonCO=M);W&&(b.buttonDI=W);aa&&(b.buttonDO=aa)}return b};E.prototype.executeCommand=function(a,b,c){if(this._senderID)if(b&&b.value){var d=this,n=100,r=b.value.substr(b.value.length-2),v={},z=0;switch(r){case "AI":z=0;break;case "AO":z=1;break;case "BI":z=2;break;case "BO":z=3;break;case "CI":z=4;break;case "CO":z=5;break;case "DI":z=6;break;case "DO":z=7}switch(b.value){case "longPressAI":case "longPressAO":case "longPressBI":case "longPressBO":case "longPressCI":case "longPressCO":case "longPressDI":case "longPressDO":n=
this._longPressThreshold;case "shortPressAI":case "shortPressAO":case "shortPressBI":case "shortPressBO":case "shortPressCI":case "shortPressCO":case "shortPressDI":case "shortPressDO":var F=this.buildData(z,1,0,0);var P=new x.hub.m.enocean.ESP3.Telegram.RPS(F,this._senderID,1,1,0,null);a.sendTelegram(P,!0,function(U){U?c&&c(U):(v["button"+r]="pressed",d.activeStateChange(v),setTimeout(function(){F=d.buildData(0,0,0,0);P=new x.hub.m.enocean.ESP3.Telegram.RPS(F,d._senderID,1,1,0,null);a.sendTelegram(P,
!0,function(B){v["button"+r]="released";d.activeStateChange(v);c&&c(B)})},n))});break;case "pressAI":case "pressAO":case "pressBI":case "pressBO":case "pressCI":case "pressCO":case "pressDI":case "pressDO":F=this.buildData(z,1,0,0);P=new x.hub.m.enocean.ESP3.Telegram.RPS(F,this._senderID,1,1,0,null);a.sendTelegram(P,!0,function(U){v["button"+r]="pressed";d.activeStateChange(v);c&&c(U)});break;case "releaseAI":case "releaseAO":case "releaseBI":case "releaseBO":case "releaseCI":case "releaseCO":case "releaseDI":case "releaseDO":F=
d.buildData(0,0,0,0);P=new x.hub.m.enocean.ESP3.Telegram.RPS(F,this._senderID,1,1,0,null);a.sendTelegram(P,!0,function(U){v["button"+r]="released";d.activeStateChange(v);c&&c(U)});break;default:c&&c(Error("unknow command"))}}else c&&c(Error("command invalid"));else c&&c(Error("sender id is null"))};var A=function(a){E.call(this,a);this._data="f6-03-02"};A.STATES="buttonAI buttonAO buttonBI buttonBO buttonCI buttonCO buttonDI buttonDO".split(" ");A.COMMANDS="shortPressAI longPressAI pressAI releaseAI shortPressAO longPressAO pressAO releaseAO shortPressBI longPressBI pressBI releaseBI shortPressBO longPressBO pressBO releaseBO shortPressCI longPressCI pressCI releaseCI shortPressCO longPressCO pressCO releaseCO shortPressDI longPressDI pressDI releaseDI shortPressDO longPressDO pressDO releaseDO".split(" ");
A.prototype=new E;A.prototype.constructor=A;var L=function(a){f.call(this,a);this._data="f6-04-01"};L.STATES=["keycard"];L.prototype=new f;L.prototype.constructor=L;L.prototype.evalTelegram=function(a){var b={};if(246==a.rorg){var c=a.t21,d=a.nu;a=a.userData;1==c&&1==d&&112==a?b.keycard="inserted":1==c&&0==d&&0==a&&(b.keycard="takeout")}return b};var N=function(a){f.call(this,a);this._data="f6-04-02"};N.STATES=["keycard"];N.prototype=new f;N.prototype.constructor=N;N.prototype.evalTelegram=function(a){var b=
{};if(246==a.rorg){var c=a.userData>>7&1;a=a.userData>>2&1;1==c&&1==a?b.keycard="inserted":0==c&&0==a&&(b.keycard="takeout")}return b};var G=function(a){f.call(this,a);this._data="f6-05-00"};G.STATES=["wind","lowbat"];G.prototype=new f;G.prototype.constructor=G;G.prototype.evalTelegram=function(a){var b={};if(246==a.rorg)switch(a.userData){case 0:b.wind="ok";this._states.lowbat||(b.lowbat=!1);break;case 16:b.wind="alarm";this._states.lowbat||(b.lowbat=!1);break;case 48:b.lowbat=!0}return b};var Q=
function(a){f.call(this,a);this._data="f6-05-01"};Q.COMMANDS=["reset"];Q.STATES=["water"];Q.prototype=new f;Q.prototype.constructor=Q;Q.prototype.evalTelegram=function(a){var b={};if(246==a.rorg){var c=a.nu,d=a.userData;1==a.t21&&1==c&&17==d&&(b.water="alarm")}return b};Q.prototype.executeCommand=function(a,b,c){if(b&&b.value)switch(b.value){case "reset":this.activeStateChange({water:"ok"});c&&c();break;default:c&&c(Error("no such command"))}else c&&c(Error("command invalid"))};var J=function(a){f.call(this,
a);this._data="f6-05-02"};J.STATES=["smoke","lowbat"];J.prototype=new f;J.prototype.constructor=J;J.prototype.evalTelegram=function(a){var b={};if(246==a.rorg)switch(a.userData){case 0:b.smoke="ok";this._states.lowbat||(b.lowbat=!1);break;case 16:b.smoke="alarm";this._states.lowbat||(b.lowbat=!1);break;case 48:b.lowbat=!0}return b};var ca=function(a){f.call(this,a);this._data="f6-10-00"};ca.STATES=["window","handle_pos","handle_raw"];ca.prototype=new f;ca.prototype.constructor=ca;ca.prototype.evalTelegram=
function(a){var b={};246==a.rorg&&(a=a.userData,0==(a&208^192)?(b.window="open",b.handle_pos="middle"):0==(a&240^240)?(b.window="closed",b.handle_pos="down"):0==(a&240^208)&&(b.window="tilted",b.handle_pos="up"),b.handle_raw=a);return b};var ia=function(a){f.call(this,a);this._data="f6-10-01"};ia.STATES=["window","handle_pos","handle_raw"];ia.prototype=new f;ia.prototype.constructor=ia;ia.prototype.evalTelegram=function(a){var b={};246==a.rorg&&(a=a.userData&15,0==(a&13^12)?(b.window="open",b.handle_pos=
"middle"):0==(a&15^15)?(b.window="closed",b.handle_pos="down"):0==(a&15^13)&&(b.window="tilted",b.handle_pos="up"),b.handle_raw=a);return b};var ka=function(a){q.call(this,a);this._data="d5-??-??"};ka.prototype=new q;ka.prototype.constructor=ka;var da=function(a){ka.call(this,a);this._data="d5-00-01"};da.STATES=["contact","contact_raw"];da.prototype=new ka;da.prototype.constructor=da;da.prototype.evalTelegram=function(a){var b={};213==a.rorg&&(a=a.userData,1==(a>>3&1)&&(a&=1,b.contact=a?"closed":
"open",b.contact_raw=a));return b};var R=function(a){q.call(this,a);this._data="a5-??-??";this.TEACH_IN_VARIATION=2;this.UNIQUE_GATEWAY_SENDERID=!0};R.prototype=new q;R.prototype.constructor=R;R.prototype.getTeachinType=function(){return"4BS"};R.prototype.isTeachinBidirectional=function(){return!1};var O=function(a){R.call(this,a);this._data="a5-02-??";this._tmpMin=-40;this._tmpMax=0};O.STATES=["temperature","temperature_raw"];O.prototype=new R;O.prototype.constructor=O;O.prototype.evalTelegram=function(a){var b=
{};if(165==a.rorg){var c=a.userData.readUInt8(3);a=a.userData.readUInt8(2);1==(c>>3&1)&&(b.temperature=parseFloat(((255-a)/255*(this._tmpMax-this._tmpMin)+this._tmpMin).toFixed(1)),b.temperature_raw=a)}return b};var xa=function(a){O.call(this,a);this._data="a5-02-01";this._tmpMin=-40;this._tmpMax=0};xa.STATES=["temperature","temperature_raw"];xa.prototype=new O;xa.prototype.constructor=xa;var ma=function(a){O.call(this,a);this._data="a5-02-02";this._tmpMin=-30;this._tmpMax=10};ma.STATES=["temperature",
"temperature_raw"];ma.prototype=new O;ma.prototype.constructor=ma;var Na=function(a){O.call(this,a);this._data="a5-02-03";this._tmpMin=-20;this._tmpMax=20};Na.STATES=["temperature","temperature_raw"];Na.prototype=new O;Na.prototype.constructor=Na;var pa=function(a){O.call(this,a);this._data="a5-02-04";this._tmpMin=-10;this._tmpMax=30};pa.STATES=["temperature","temperature_raw"];pa.prototype=new O;pa.prototype.constructor=pa;var qa=function(a){O.call(this,a);this._data="a5-02-05";this._tmpMin=0;this._tmpMax=
40};qa.STATES=["temperature","temperature_raw"];qa.prototype=new O;qa.prototype.constructor=qa;var Ba=function(a){O.call(this,a);this._data="a5-02-06";this._tmpMin=10;this._tmpMax=50};Ba.STATES=["temperature","temperature_raw"];Ba.prototype=new O;Ba.prototype.constructor=Ba;var ya=function(a){O.call(this,a);this._data="a5-02-07";this._tmpMin=20;this._tmpMax=60};ya.STATES=["temperature","temperature_raw"];ya.prototype=new O;ya.prototype.constructor=ya;var za=function(a){O.call(this,a);this._data="a5-02-08";
this._tmpMin=30;this._tmpMax=70};za.STATES=["temperature","temperature_raw"];za.prototype=new O;za.prototype.constructor=za;var lb=function(a){O.call(this,a);this._data="a5-02-09";this._tmpMin=40;this._tmpMax=80};lb.STATES=["temperature","temperature_raw"];lb.prototype=new O;lb.prototype.constructor=lb;var V=function(a){O.call(this,a);this._data="a5-02-0a";this._tmpMin=50;this._tmpMax=90};V.STATES=["temperature","temperature_raw"];V.prototype=new O;V.prototype.constructor=V;var k=function(a){O.call(this,
a);this._data="a5-02-0b";this._tmpMin=60;this._tmpMax=100};k.STATES=["temperature","temperature_raw"];k.prototype=new O;k.prototype.constructor=k;var t=function(a){O.call(this,a);this._data="a5-02-10";this._tmpMin=-60;this._tmpMax=20};t.STATES=["temperature","temperature_raw"];t.prototype=new O;t.prototype.constructor=t;var y=function(a){O.call(this,a);this._data="a5-02-11";this._tmpMin=-50;this._tmpMax=30};y.STATES=["temperature","temperature_raw"];y.prototype=new O;y.prototype.constructor=y;var C=
function(a){O.call(this,a);this._data="a5-02-12";this._tmpMin=-40;this._tmpMax=40};C.STATES=["temperature","temperature_raw"];C.prototype=new O;C.prototype.constructor=C;var D=function(a){O.call(this,a);this._data="a5-02-13";this._tmpMin=-30;this._tmpMax=50};D.STATES=["temperature","temperature_raw"];D.prototype=new O;D.prototype.constructor=D;var K=function(a){O.call(this,a);this._data="a5-02-14";this._tmpMin=-20;this._tmpMax=60};K.STATES=["temperature","temperature_raw"];K.prototype=new O;K.prototype.constructor=
K;var S=function(a){O.call(this,a);this._data="a5-02-15";this._tmpMin=-10;this._tmpMax=70};S.STATES=["temperature","temperature_raw"];S.prototype=new O;S.prototype.constructor=S;var H=function(a){O.call(this,a);this._data="a5-02-16";this._tmpMin=0;this._tmpMax=80};H.STATES=["temperature","temperature_raw"];H.prototype=new O;H.prototype.constructor=H;var I=function(a){O.call(this,a);this._data="a5-02-17";this._tmpMin=10;this._tmpMax=90};I.STATES=["temperature","temperature_raw"];I.prototype=new O;
I.prototype.constructor=I;var T=function(a){O.call(this,a);this._data="a5-02-18";this._tmpMin=20;this._tmpMax=100};T.STATES=["temperature","temperature_raw"];T.prototype=new O;T.prototype.constructor=T;var X=function(a){O.call(this,a);this._data="a5-02-19";this._tmpMin=30;this._tmpMax=110};X.STATES=["temperature","temperature_raw"];X.prototype=new O;X.prototype.constructor=X;var Z=function(a){O.call(this,a);this._data="a5-02-1a";this._tmpMin=40;this._tmpMax=120};Z.STATES=["temperature","temperature_raw"];
Z.prototype=new O;Z.prototype.constructor=Z;var na=function(a){O.call(this,a);this._data="a5-02-1b";this._tmpMin=50;this._tmpMax=130};na.STATES=["temperature","temperature_raw"];na.prototype=new O;na.prototype.constructor=na;var Ja=function(a){R.call(this,a);this._data="a5-02-20";this._tmpMin=-10;this._tmpMax=41.2};Ja.STATES=["temperature","temperature_raw"];Ja.prototype=new R;Ja.prototype.constructor=Ja;Ja.prototype.evalTelegram=function(a){var b={};if(165==a.rorg){var c=a.userData.readUInt8(3);
a=a.userData.readUInt16BE(1);1==(c>>3&1)&&(c=a&1023,b.temperature=parseFloat(((1023-c)/1023*(this._tmpMax-this._tmpMin)+this._tmpMin).toFixed(1)),b.temperature_raw=c)}return b};var kb=function(a){Ja.call(this,a);this._data="a5-02-30";this._tmpMin=-40;this._tmpMax=62.3};kb.STATES=["temperature","temperature_raw"];kb.prototype=new Ja;kb.prototype.constructor=kb;var Fa=function(a){R.call(this,a);this._data="a5-04-??";this._humMin=0;this._humMax=100;this._tempMin=0;this._tempMax=40};Fa.STATES=["humidity",
"humidity_raw","temperature","temperature_raw","available"];Fa.prototype=new R;Fa.prototype.constructor=Fa;Fa.prototype.evalTelegram=function(a){var b={};if(165==a.rorg){var c=a.userData.readUInt8(3),d=a.userData.readUInt8(2);a=a.userData.readUInt8(1);1==(c>>3&1)&&(b.humidity=parseFloat((a/250*(this._humMax-this._humMin)+this._humMin).toFixed(1)),b.humidity_raw=a,b.temperature=parseFloat((d/250*(this._tempMax-this._tempMin)+this._tempMin).toFixed(1)),b.temperature_raw=d,b.available=c>>1&1?!0:!1)}return b};
var zc=function(a){Fa.call(this,a);this._data="a5-04-01"};zc.STATES=Fa.STATES;zc.prototype=new Fa;zc.prototype.constructor=zc;var mb=function(a){Fa.call(this,a);this._data="a5-04-02";this._tempMin=-20;this._tempMax=60};mb.STATES=Fa.STATES;mb.prototype=new Fa;mb.prototype.constructor=mb;var Ab=function(a){Fa.call(this,a);this._data="a5-04-03";this._tempMin=-20;this._tempMax=60};Ab.STATES=["humidity","humidity_raw","temperature","temperature_raw","type"];Ab.prototype=new Fa;Ab.prototype.constructor=
Ab;Ab.prototype.evalTelegram=function(a){var b={};if(165==a.rorg){var c=a.userData.readUInt8(3),d=a.userData.readUInt16BE(1);a=a.userData.readUInt8(0);1==(c>>3&1)&&(b.humidity=parseFloat((a/255*(this._humMax-this._humMin)+this._humMin).toFixed(1)),b.humidity_raw=a,d&=1023,b.temperature=parseFloat((d/1023*(this._tempMax-this._tempMin)+this._tempMin).toFixed(1)),b.temperature_raw=d,b.type=c&1?"event":"heartbeat")}return b};var oa=function(a){R.call(this,a);this._data="a5-06-??";this._svcMin=0;this._svcMax=
5.1;this._ill2Min=300;this._ill2Max=3E4;this._ill1Min=600;this._ill1Max=6E4};oa.STATES="voltage voltage_raw illumination2 illumination2_raw illumination1 illumination1_raw illumination illumination_raw range range_raw".split(" ");oa.prototype=new R;oa.prototype.constructor=oa;oa.prototype.evalTelegram=function(a){var b={};if(165==a.rorg){var c=a.userData.readUInt8(3),d=a.userData.readUInt8(2),n=a.userData.readUInt8(1);a=a.userData.readUInt8(0);if(1==(c>>3&1)){b.voltage=parseFloat((a/255*(this._svcMax-
this._svcMin)+this._svcMin).toFixed(1));b.voltage_raw=a;b.illumination2=parseFloat((n/255*(this._ill2Max-this._ill2Min)+this._ill2Min).toFixed(1));b.illumination2_raw=n;b.illumination1=parseFloat((d/255*(this._ill1Max-this._ill1Min)+this._ill1Min).toFixed(1));b.illumination1_raw=d;c&=1;switch(c){case 0:b.range="db1";b.illumination=b.illumination1;b.illumination_raw=d;break;case 1:b.range="db2",b.illumination=b.illumination2,b.illumination_raw=d}b.range_raw=c}}return b};var nb=function(a){oa.call(this,
a);this._data="a5-06-01"};nb.STATES=oa.STATES;nb.prototype=new oa;nb.prototype.constructor=nb;var db=function(a){oa.call(this,a);this._data="a5-06-02";this._ill2Min=0;this._ill2Max=510;this._ill1Min=0;this._ill1Max=1020};db.STATES=oa.STATES;db.prototype=new oa;db.prototype.constructor=db;var Bb=function(a){oa.call(this,a);this._data="a5-06-03";this._svcMin=0;this._svcMax=5.1};Bb.STATES=["voltage","voltage_raw","illumination","illumination_raw"];Bb.prototype=new oa;Bb.prototype.constructor=Bb;Bb.prototype.evalTelegram=
function(a){var b={};if(165==a.rorg){var c=a.userData.readUInt8(3),d=a.userData.readUInt16BE(1);a=a.userData.readUInt8(0);1==(c>>3&1)&&(b.voltage=parseFloat((a/255*(this._svcMax-this._svcMin)+this._svcMin).toFixed(1)),b.voltage_raw=a,c=d>>6&1023,b.illumination=c,b.illumination_raw=c)}return b};var Cb=function(a){oa.call(this,a);this._data="a5-06-04";this._tmpMin=-20;this._tmpMax=60};Cb.STATES="temperature temperature_raw illumination illumination_raw energy energy_raw temperature_avail energy_avail".split(" ");
Cb.prototype=new oa;Cb.prototype.constructor=Cb;Cb.prototype.evalTelegram=function(a){var b={};if(165==a.rorg){var c=a.userData.readUInt8(3),d=a.userData.readUInt16BE(1);a=a.userData.readUInt8(0);1==(c>>3&1)&&(b.temperature=parseFloat((a/255*(this._tmpMax-this._tmpMin)+this._tmpMin).toFixed(1)),b.temperature_raw=a,b.illumination=d,b.illumination_raw=d,d=c>>4&15,b.energy=parseFloat((d/15*100).toFixed(1)),b.energy_raw=d,b.temperature_avail=c>>1&1?!0:!1,b.temperature_avail||delete b.temperature,b.energy_avail=
c&1?!0:!1,b.energy_avail||delete b.energy)}return b};var Ac=function(a){oa.call(this,a);this._data="a5-06-05";this._ill2Min=0;this._ill2Max=5100;this._ill1Min=0;this._ill1Max=10200};Ac.STATES=oa.STATES;Ac.prototype=new oa;Ac.prototype.constructor=Ac;var va=function(a){R.call(this,a);this._data="a5-07-??";this._params||(this._params={reset_timeout:30});this._resetTO=null};va.COMMANDS=["reset"];va.prototype=new R;va.prototype.constructor=va;va.prototype._startPIROffTO=function(){this._resetTO&&(clearTimeout(this._resetTO),
this._resetTO=null);if(this._params.reset_timeout&&!(0>this._params.reset_timeout)){var a=this;this._resetTO=setTimeout(function(){a._resetTO=null;a._reset()},1E3*this._params.reset_timeout)}};va.prototype._stopPIROffTO=function(){this._resetTO&&(clearTimeout(this._resetTO),this._resetTO=null)};va.prototype._reset=function(){this._resetTO&&(clearTimeout(this._resetTO),this._resetTO=null);var a={key:"state",value:"off",changed:!1},b=this._states.state?this._states.state.value:null;"off"!=b&&(a.oldvalue=
b,a.changed=!0);this._states.state={value:"off",time:(new Date).getTime()};require("x.hub.m.enocean.js")._onEOEvents(this,[a])};va.prototype.executeCommand=function(a,b,c){if(b&&b.value)switch(b.value){case "reset":this._reset();c&&c();break;default:c&&c(Error("no such command"))}else c&&c(Error("command invalid"))};va.prototype.fromJSON=function(a){if(!q.prototype.fromJSON.call(this,a))return null;this._params||(this._params={reset_timeout:30});return this};va.prototype.fromDBJSON=function(a){if(!q.prototype.fromDBJSON.call(this,
a))return null;this._params||(this._params={reset_timeout:30});return this};var Ca=function(a){va.call(this,a);this._data="a5-07-01"};Ca.COMMANDS=["reset"];Ca.STATES=["voltage","voltage_raw","state","state_raw","voltage_avail"];Ca.prototype=new va;Ca.prototype.constructor=Ca;Ca.prototype.evalTelegram=function(a){var b={};if(165==a.rorg){var c=a.userData.readUInt8(3),d=a.userData.readUInt8(2);a=a.userData.readUInt8(0);1==(c>>3&1)&&(b.voltage=parseFloat((a/250*5).toFixed(1)),b.voltage_raw=a,b.state=
128<=d?"on":"off",b.state_raw=d,b.voltage_avail=c&1?!0:!1,b.voltage_avail||delete b.voltage)}"on"==b.state?this._startPIROffTO():"off"==b.state&&this._stopPIROffTO();return b};var ob=function(a){va.call(this,a);this._data="a5-07-02"};ob.COMMANDS=["reset"];ob.STATES=["voltage","voltage_raw","state","state_raw"];ob.prototype=new va;ob.prototype.constructor=ob;ob.prototype.evalTelegram=function(a){var b={};if(165==a.rorg){var c=a.userData.readUInt8(3);a=a.userData.readUInt8(0);1==(c>>3&1)&&(b.voltage=
parseFloat((a/250*5).toFixed(1)),b.voltage_raw=a,c=c>>7&1,b.state=c?"on":"off",b.state_raw=c)}"on"==b.state?this._startPIROffTO():"off"==b.state&&this._stopPIROffTO();return b};var pb=function(a){va.call(this,a);this._data="a5-07-03"};pb.COMMANDS=["reset"];pb.STATES="voltage voltage_raw illumination illumination_raw state state_raw".split(" ");pb.prototype=new va;pb.prototype.constructor=pb;pb.prototype.evalTelegram=function(a){var b={};if(165==a.rorg){var c=a.userData.readUInt8(3),d=a.userData.readUInt16BE(1);
a=a.userData.readUInt8(0);1==(c>>3&1)&&(b.voltage=parseFloat((a/250*5).toFixed(1)),b.voltage_raw=a,d=d>>6&1023,b.illumination=d,b.illumination_raw=d,c=c>>7&1,b.state=c?"on":"off",b.state_raw=c)}"on"==b.state?this._startPIROffTO():"off"==b.state&&this._stopPIROffTO();return b};var Wa=function(a){R.call(this,a);this._data="a5-08-??";this._svcMin=0;this._svcMax=5.1;this._illMin=0;this._illMax=510;this._tmpMin=0;this._tmpMax=51};Wa.prototype=new R;Wa.prototype.constructor=Wa;Wa.prototype.evalTelegram=
function(a){var b={};if(165==a.rorg){var c=a.userData.readUInt8(3),d=a.userData.readUInt8(2),n=a.userData.readUInt8(1);a=a.userData.readUInt8(0);if(1==(c>>3&1)){b.voltage=parseFloat((a/255*(this._svcMax-this._svcMin)+this._svcMin).toFixed(1));b.voltage_raw=a;b.illumination=parseFloat((n/255*(this._illMax-this._illMin)+this._illMin).toFixed(1));b.illumination_raw=n;b.temperature=parseFloat((d/255*(this._tmpMax-this._tmpMin)+this._tmpMin).toFixed(1));b.temperature_raw=d;d=c>>1&1;switch(d){case 0:b.state=
"on";break;case 1:b.state="off"}b.state_raw=d;c&=1;switch(c){case 0:b.button="pressed";break;case 1:b.button="released"}b.button_raw=c}}return b};var qb=function(a){Wa.call(this,a);this._data="a5-08-01"};qb.STATES="voltage voltage_raw illumination illumination_raw temperature temperature_raw state state_raw button button_raw".split(" ");qb.prototype=new Wa;qb.prototype.constructor=qb;var Bc=function(a){Wa.call(this,a);this._data="a5-08-02";this._illMax=1020};Bc.STATES="voltage voltage_raw illumination illumination_raw temperature temperature_raw state state_raw button button_raw".split(" ");
Bc.prototype=new Wa;Bc.prototype.constructor=Bc;var Cc=function(a){Wa.call(this,a);this._data="a5-08-03";this._illMax=1530;this._tmpMin=-30;this._tmpMax=50};Cc.STATES="voltage voltage_raw illumination illumination_raw temperature temperature_raw state state_raw button button_raw".split(" ");Cc.prototype=new Wa;Cc.prototype.constructor=Cc;var ea=function(a){R.call(this,a);this._data="a5-09-??"};ea.prototype=new R;ea.prototype.constructor=ea;var Db=function(a){ea.call(this,a);this._data="a5-09-02";
this._svcMin=0;this._svcMax=5.1;this._gasMin=0;this._gasMax=1020;this._tmpMin=0;this._tmpMax=51};Db.STATES="voltage voltage_raw gas gas_raw temperature temperature_raw temperature_available".split(" ");Db.prototype=new ea;Db.prototype.constructor=Db;Db.prototype.evalTelegram=function(a){var b={};if(165==a.rorg){var c=a.userData.readUInt8(3),d=a.userData.readUInt8(2),n=a.userData.readUInt8(1);a=a.userData.readUInt8(0);1==(c>>3&1)&&(b.voltage=parseFloat((a/255*(this._svcMax-this._svcMin)+this._svcMin).toFixed(1)),
b.voltage_raw=a,b.gas=parseFloat((n/255*(this._gasMax-this._gasMin)+this._gasMin).toFixed(1)),b.gas_raw=n,b.temperature=parseFloat((d/255*(this._tmpMax-this._tmpMin)+this._tmpMin).toFixed(1)),b.temperature_raw=d,c=c>>1&1,b.temperature_available=c?!0:!1,c||delete b.temperature)}return b};var Eb=function(a){ea.call(this,a);this._data="a5-09-04";this._humMin=0;this._humMax=100;this._gasMin=0;this._gasMax=2550;this._tmpMin=0;this._tmpMax=51};Eb.STATES="humidity humidity_raw gas gas_raw temperature temperature_raw temperature_available humidity_available".split(" ");
Eb.prototype=new ea;Eb.prototype.constructor=Eb;Eb.prototype.evalTelegram=function(a){var b={};if(165==a.rorg){var c=a.userData.readUInt8(3),d=a.userData.readUInt8(2),n=a.userData.readUInt8(1);a=a.userData.readUInt8(0);1==(c>>3&1)&&(b.humidity=parseFloat((a/255*(this._humMax-this._humMin)+this._humMin).toFixed(1)),b.humidity_raw=a,b.gas=parseFloat((n/255*(this._gasMax-this._gasMin)+this._gasMin).toFixed(1)),b.gas_raw=n,b.temperature=parseFloat((d/255*(this._tmpMax-this._tmpMin)+this._tmpMin).toFixed(1)),
b.temperature_raw=d,d=c>>2&1,b.humidity_available=d?!0:!1,d||delete b.humidity,c=c>>1&1,b.temperature_available=c?!0:!1,c||delete b.temperature)}return b};var Fb=function(a){ea.call(this,a);this._data="a5-09-05"};Fb.STATES=["voc","voc_raw","voc_id","voc_id_raw","scale"];Fb.prototype=new ea;Fb.prototype.constructor=Fb;Fb.prototype.evalTelegram=function(a){var b={};if(165==a.rorg){var c=a.userData.readUInt8(3),d=a.userData.readUInt8(2);a=a.userData.readUInt16BE(0);if(1==(c>>3&1)){c&=3;var n=1;switch(c){case 0:n=
.01;break;case 1:n=.1;break;case 2:n=1;break;case 3:n=10}b.scale=n;b.voc=a*n;b.voc_raw=a;switch(c){case 0:b.voc_id="VOCT";break;case 1:b.voc_id="Formaldehyde";break;case 2:b.voc_id="Benzene";break;case 3:b.voc_id="Styrene";break;case 4:b.voc_id="Toluene";break;case 5:b.voc_id="Tetrachloroethylene";break;case 6:b.voc_id="Xylene";break;case 7:b.voc_id="n-Hexane";break;case 8:b.voc_id="n-Octane";break;case 9:b.voc_id="Cyclopentane";break;case 10:b.voc_id="Methanol";break;case 11:b.voc_id="Ethanol";break;
case 12:b.voc_id="1-Pentanol";break;case 13:b.voc_id="Acetone";break;case 14:b.voc_id="ethylene Oxide";break;case 15:b.voc_id="Acetaldehyde ue";break;case 16:b.voc_id="Acetic Acid";break;case 17:b.voc_id="Propionice Acid";break;case 18:b.voc_id="Valeric Acid";break;case 19:b.voc_id="Butyric Acid";break;case 20:b.voc_id="Ammoniac";break;case 22:b.voc_id="Hydrogen Sulfide";break;case 23:b.voc_id="Dimethylsulfide";break;case 24:b.voc_id="2-Butanol";break;case 25:b.voc_id="2-Methylpropanol";break;case 26:b.voc_id=
"Diethyl ether";break;case 255:b.voc_id="ozone"}b.voc_id_raw=d}}return b};var Gb=function(a){ea.call(this,a);this._data="a5-09-06"};Gb.STATES=["radon"];Gb.prototype=new ea;Gb.prototype.constructor=Gb;Gb.prototype.evalTelegram=function(a){var b={};if(165==a.rorg){var c=a.userData.readUInt8(3);a=a.userData.readUInt16BE(0);1==(c>>3&1)&&(b.radon=a>>6&1023)}return b};var Hb=function(a){ea.call(this,a);this._data="a5-09-07"};Hb.STATES="pm10 pm25 pm1 pm10_active pm25_active pm25_active".split(" ");Hb.prototype=
new ea;Hb.prototype.constructor=Hb;Hb.prototype.evalTelegram=function(a){var b={};if(165==a.rorg){var c=a.userData.readUInt8(3),d=a.userData.readUInt16BE(2),n=a.userData.readUInt16BE(1);a=a.userData.readUInt16BE(0);1==(c>>3&1)&&(b.pm10=a>>7&511,b.pm25=n>>6&511,b.pm1=d>>5&511,d=c>>2&1,b.pm10_active=d?!0:!1,d||delete b.pm10,d=c>>1&1,b.pm25_active=d?!0:!1,d||delete b.pm25,c&=1,b.pm1_active=c?!0:!1,c||delete b.pm1)}return b};var Ib=function(a){ea.call(this,a);this._data="a5-09-08"};Ib.STATES=["co2","co2_raw"];
Ib.prototype=new ea;Ib.prototype.constructor=Ib;Ib.prototype.evalTelegram=function(a){var b={};if(165==a.rorg){var c=a.userData.readUInt8(3);a=a.userData.readUInt8(2);1==(c>>3&1)&&(b.co2=parseFloat((a/255*2E3).toFixed(1)),b.co2_raw=a)}return b};var Jb=function(a){ea.call(this,a);this._data="a5-09-09"};Jb.STATES=["co2","co2_raw","power_failure_detected"];Jb.prototype=new ea;Jb.prototype.constructor=Jb;Jb.prototype.evalTelegram=function(a){var b={};if(165==a.rorg){var c=a.userData.readUInt8(3);a=a.userData.readUInt8(2);
1==(c>>3&1)&&(b.co2=parseFloat((a/255*2E3).toFixed(1)),b.co2_raw=a,b.power_failure_detected=c>>2&1?!0:!1)}return b};var Kb=function(a){ea.call(this,a);this._data="a5-09-0a";this._svcMin=2;this._svcMax=5;this._tmpMin=-20;this._tmpMax=60};Kb.STATES="voltage voltage_raw gas gas_raw temperature temperature_raw temperature_available voltage_available".split(" ");Kb.prototype=new ea;Kb.prototype.constructor=Kb;Kb.prototype.evalTelegram=function(a){var b={};if(165==a.rorg){var c=a.userData.readUInt8(3),
d=a.userData.readUInt8(2);a=a.userData.readUInt16BE(0);1==(c>>3&1)&&(b.gas=a,b.gas_raw=a,b.temperature=parseFloat((d/255*(this._tmpMax-this._tmpMin)+this._tmpMin).toFixed(1)),b.temperature_raw=d,d=c>>4&15,b.voltage=parseFloat((d/15*(this._svcMax-this._svcMin)+this._svcMin).toFixed(1)),b.voltage_raw=d,d=c>>1&1,b.temperature_available=d?!0:!1,d||delete b.temperature,c&=1,b.voltage_available=c?!0:!1,c||delete b.voltage)}return b};var Lb=function(a){ea.call(this,a);this._data="a5-09-0b";this._svcMin=
2;this._svcMax=5};Lb.STATES="voltage voltage_raw radio radio_raw scale unit unit_raw voltage_available".split(" ");Lb.prototype=new ea;Lb.prototype.constructor=Lb;Lb.prototype.evalTelegram=function(a){var b={};if(165==a.rorg){var c=a.userData.readUInt8(3),d=a.userData.readUInt16BE(2);a=a.userData.readUInt8(0);if(1==(c>>3&1)){a=a>>4&15;b.voltage=parseFloat((a/15*(this._svcMax-this._svcMin)+this._svcMin).toFixed(1));b.voltage_raw=a;a=1;switch(c>>4&15){case 0:a=.001;break;case 1:a=.01;break;case 2:a=
.1;break;case 3:a=1;break;case 4:a=10;break;case 5:a=100;break;case 6:a=1E3;break;case 7:a=1E4;break;case 8:a=1E5}b.scale=a;b.radio=d/10*a;b.radio_raw=d;d=c>>1&3;switch(d){case 0:b.unit="\u03bcSv/h";break;case 1:b.unit="cpm";break;case 2:b.unit="Bq/L";break;case 3:b.unit="Bq/kg"}b.unit_raw=d;c&=1;b.voltage_available=c?!0:!1;c||delete b.voltage}}return b};var Mb=function(a){ea.call(this,a);this._data="a5-09-0c"};Mb.STATES="voc voc_raw voc_id voc_id_raw unit unit_raw scale".split(" ");Mb.prototype=
new ea;Mb.prototype.constructor=Mb;Mb.prototype.evalTelegram=function(a){var b={};if(165==a.rorg){var c=a.userData.readUInt8(3),d=a.userData.readUInt8(2);a=a.userData.readUInt16BE(0);if(1==(c>>3&1)){var n=c&3,r=1;switch(n){case 0:r=.01;break;case 1:r=.1;break;case 2:r=1;break;case 3:r=10}b.scale=r;c=c>>1&1;switch(c){case 0:b.unit="ppb";break;case 1:b.unit="\u03bcSv/m3"}b.unit_raw=c;b.voc=a*r;b.voc_raw=a;switch(n){case 0:b.voc_id="VOCT";break;case 1:b.voc_id="Formaldehyde";break;case 2:b.voc_id="Benzene";
break;case 3:b.voc_id="Styrene";break;case 4:b.voc_id="Toluene";break;case 5:b.voc_id="Tetrachloroethylene";break;case 6:b.voc_id="Xylene";break;case 7:b.voc_id="n-Hexane";break;case 8:b.voc_id="n-Octane";break;case 9:b.voc_id="Cyclopentane";break;case 10:b.voc_id="Methanol";break;case 11:b.voc_id="Ethanol";break;case 12:b.voc_id="1-Pentanol";break;case 13:b.voc_id="Acetone";break;case 14:b.voc_id="ethylene Oxide";break;case 15:b.voc_id="Acetaldehyde ue";break;case 16:b.voc_id="Acetic Acid";break;
case 17:b.voc_id="Propionice Acid";break;case 18:b.voc_id="Valeric Acid";break;case 19:b.voc_id="Butyric Acid";break;case 20:b.voc_id="Ammoniac";break;case 22:b.voc_id="Hydrogen Sulfide";break;case 23:b.voc_id="Dimethylsulfide";break;case 24:b.voc_id="2-Butanol";break;case 25:b.voc_id="2-Methylpropanol";break;case 26:b.voc_id="Diethyl ether";break;case 27:b.voc_id="Naphthalene";break;case 28:b.voc_id="4-Phenylcyclohexene";break;case 29:b.voc_id="Limonene";break;case 30:b.voc_id="Trichloroethylene";
break;case 31:b.voc_id="Isovaleric acid";break;case 32:b.voc_id="Indole";break;case 33:b.voc_id="Cadaverine";break;case 34:b.voc_id="Putrescine";break;case 35:b.voc_id="Caproic acid";break;case 255:b.voc_id="ozone"}b.voc_id_raw=d}}return b};var rb=function(a){R.call(this,a);this._data="a5-10-??"};rb.prototype=new R;rb.prototype.constructor=rb;var ba=function(a){rb.call(this,a);this._data="a5-10-01";this._params||(this._params={minSP:18,maxSP:26})};ba.STATES="fan_speed fan_speed_raw setpoint setpoint_raw temperature temperature_raw button button_raw".split(" ");
ba.prototype=new rb;ba.prototype.constructor=ba;ba.prototype.evalTelegram=function(a){var b={};if(165==a.rorg){var c=a.userData.readUInt8(3),d=a.userData.readUInt8(2),n=a.userData.readUInt8(1);a=a.userData.readUInt8(0);if(1==(c>>3&1)){b.fan_speed=144>=a?"3":164>=a?"2":189>=a?"1":209>=a?"0":"auto";b.fan_speed_raw=a;b.setpoint=parseFloat((n/255*(this._params.maxSP-this._params.minSP)+this._params.minSP).toFixed(1));b.setpoint_raw=n;b.temperature=parseFloat(((255-d)/255*40).toFixed(1));b.temperature_raw=
d;c&=1;switch(c){case 0:b.button="pressed";break;case 1:b.button="released"}b.button_raw=c}}return b};ba.prototype.fromJSON=function(a){if(!q.prototype.fromJSON.call(this,a))return null;this._params||(this._params={minSP:18,maxSP:26});return this};ba.prototype.fromDBJSON=function(a){if(!q.prototype.fromDBJSON.call(this,a))return null;this._params||(this._params={minSP:18,maxSP:26});return this};var Ka=function(a){ba.call(this,a);this._data="a5-10-02"};Ka.STATES="fan_speed fan_speed_raw setpoint setpoint_raw temperature temperature_raw slider slider_raw".split(" ");
Ka.prototype=new ba;Ka.prototype.constructor=Ka;Ka.prototype.evalTelegram=function(a){var b=ba.prototype.evalTelegram.call(this,a);if(0==Object.keys(b).length)return b;delete b.button;delete b.button_raw;a=a.userData.readUInt8(3)&1;b.slider=a?"day":"night";b.slider_raw=a;return b};var eb=function(a){ba.call(this,a);this._data="a5-10-03";this.TEACH_IN_VARIATION=1};eb.STATES=["setpoint","setpoint_raw","temperature","temperature_raw"];eb.prototype=new ba;eb.prototype.constructor=eb;eb.prototype.evalTelegram=
function(a){a=ba.prototype.evalTelegram.call(this,a);if(0==Object.keys(a).length)return a;delete a.fan_speed;delete a.fan_speed_raw;delete a.button;delete a.button_raw;return a};var Nb=function(a){ba.call(this,a);this._data="a5-10-04"};Nb.STATES="fan_speed fan_speed_raw setpoint setpoint_raw temperature temperature_raw".split(" ");Nb.prototype=new ba;Nb.prototype.constructor=Nb;Nb.prototype.evalTelegram=function(a){a=ba.prototype.evalTelegram.call(this,a);if(0==Object.keys(a).length)return a;delete a.button;
delete a.button_raw;return a};var Ob=function(a){ba.call(this,a);this._data="a5-10-05"};Ob.STATES="setpoint setpoint_raw temperature temperature_raw button button_raw".split(" ");Ob.prototype=new ba;Ob.prototype.constructor=Ob;Ob.prototype.evalTelegram=function(a){a=ba.prototype.evalTelegram.call(this,a);if(0==Object.keys(a).length)return a;delete a.fan_speed;delete a.fan_speed_raw;return a};var Za=function(a){Ka.call(this,a);this._data="a5-10-06"};Za.STATES="setpoint setpoint_raw temperature temperature_raw slider slider_raw".split(" ");
Za.prototype=new Ka;Za.prototype.constructor=Za;Za.prototype.evalTelegram=function(a){a=Ka.prototype.evalTelegram.call(this,a);if(0==Object.keys(a).length)return a;delete a.fan_speed;delete a.fan_speed_raw;return a};var Pb=function(a){ba.call(this,a);this._data="a5-10-07"};Pb.STATES=["fan_speed","fan_speed_raw","temperature","temperature_raw"];Pb.prototype=new ba;Pb.prototype.constructor=Pb;Pb.prototype.evalTelegram=function(a){a=ba.prototype.evalTelegram.call(this,a);if(0==Object.keys(a).length)return a;
delete a.setpoint;delete a.setpoint_raw;delete a.button;delete a.button_raw;return a};var Oa=function(a){ba.call(this,a);this._data="a5-10-08";this._params=null};Oa.STATES="fan_speed fan_speed_raw temperature temperature_raw button button_raw".split(" ");Oa.prototype=new ba;Oa.prototype.constructor=Oa;Oa.prototype.evalTelegram=function(a){a=ba.prototype.evalTelegram.call(this,a);if(0==Object.keys(a).length)return a;delete a.setpoint;delete a.setpoint_raw;return a};Oa.prototype.fromJSON=function(a){return q.prototype.fromJSON.call(this,
a)};Oa.prototype.fromDBJSON=function(a){return q.prototype.fromDBJSON.call(this,a)};var Pa=function(a){Ka.call(this,a);this._data="a5-10-09";this._params=null};Pa.STATES="fan_speed fan_speed_raw temperature temperature_raw slider slider_raw".split(" ");Pa.prototype=new Ka;Pa.prototype.constructor=Pa;Pa.prototype.evalTelegram=function(a){a=Ka.prototype.evalTelegram.call(this,a);if(0==Object.keys(a).length)return a;delete a.setpoint;delete a.setpoint_raw;return a};Pa.prototype.fromJSON=function(a){return q.prototype.fromJSON.call(this,
a)};Pa.prototype.fromDBJSON=function(a){return q.prototype.fromDBJSON.call(this,a)};var $a=function(a){ba.call(this,a);this._data="a5-10-0a"};$a.STATES="setpoint setpoint_raw temperature temperature_raw contact contact_raw".split(" ");$a.prototype=new ba;$a.prototype.constructor=$a;$a.prototype.evalTelegram=function(a){var b=ba.prototype.evalTelegram.call(this,a);if(0==Object.keys(b).length)return b;delete b.fan_speed;delete b.fan_speed_raw;delete b.button;delete b.button_raw;a=a.userData.readUInt8(3)&
1;b.contact=a?"open":"closed";b.contact_raw=a;return b};var fb=function(a){$a.call(this,a);this._data="a5-10-0b";this._params=null};fb.STATES=["temperature","temperature_raw","contact","contact_raw"];fb.prototype=new $a;fb.prototype.constructor=fb;fb.prototype.evalTelegram=function(a){a=$a.prototype.evalTelegram.call(this,a);if(0==Object.keys(a).length)return a;delete a.setpoint;delete a.setpoint_raw;return a};fb.prototype.fromJSON=function(a){return q.prototype.fromJSON.call(this,a)};fb.prototype.fromDBJSON=
function(a){return q.prototype.fromDBJSON.call(this,a)};var Qb=function(a){Oa.call(this,a);this._data="a5-10-0c"};Qb.STATES=["temperature","temperature_raw","button","button_raw"];Qb.prototype=new Oa;Qb.prototype.constructor=Qb;Qb.prototype.evalTelegram=function(a){a=Oa.prototype.evalTelegram.call(this,a);if(0==Object.keys(a).length)return a;delete a.fan_speed;delete a.fan_speed_raw;return a};var Rb=function(a){Pa.call(this,a);this._data="a5-10-0d"};Rb.STATES=["temperature","temperature_raw","slider",
"slider_raw"];Rb.prototype=new Pa;Rb.prototype.constructor=Rb;Rb.prototype.evalTelegram=function(a){a=Pa.prototype.evalTelegram.call(this,a);if(0==Object.keys(a).length)return a;delete a.fan_speed;delete a.fan_speed_raw;return a};var ra=function(a){rb.call(this,a);this._data="a5-10-10";this._params||(this._params={minSP:18,maxSP:26})};ra.STATES="setpoint setpoint_raw humidity humidity_raw temperature temperature_raw button button_raw".split(" ");ra.prototype=new rb;ra.prototype.constructor=ra;ra.prototype.evalTelegram=
function(a){var b={};if(165==a.rorg){var c=a.userData.readUInt8(3),d=a.userData.readUInt8(2),n=a.userData.readUInt8(1);a=a.userData.readUInt8(0);if(1==(c>>3&1)){b.setpoint=parseFloat((a/255*(this._params.maxSP-this._params.minSP)+this._params.minSP).toFixed(1));b.setpoint_raw=a;b.humidity=parseFloat((n/250*100).toFixed(1));b.humidity_raw=n;b.temperature=parseFloat((d/250*40).toFixed(1));b.temperature_raw=d;c&=1;switch(c){case 0:b.button="pressed";break;case 1:b.button="released"}b.button_raw=c}}return b};
ra.prototype.fromJSON=function(a){if(!q.prototype.fromJSON.call(this,a))return null;this._params||(this._params={minSP:18,maxSP:26});return this};ra.prototype.fromDBJSON=function(a){if(!q.prototype.fromDBJSON.call(this,a))return null;this._params||(this._params={minSP:18,maxSP:26});return this};var ab=function(a){ra.call(this,a);this._data="a5-10-11"};ab.STATES="setpoint setpoint_raw humidity humidity_raw temperature temperature_raw slider slider_raw".split(" ");ab.prototype=new ra;ab.prototype.constructor=
ab;ab.prototype.evalTelegram=function(a){var b=ra.prototype.evalTelegram.call(this,a);if(0==Object.keys(b).length)return b;delete b.button;delete b.button_raw;a=a.userData.readUInt8(3)&1;b.slider=a?"day":"night";b.slider_raw=a;return b};var Sb=function(a){ra.call(this,a);this._data="a5-10-12"};Sb.STATES="setpoint setpoint_raw humidity humidity_raw temperature temperature_raw".split(" ");Sb.prototype=new ra;Sb.prototype.constructor=Sb;Sb.prototype.evalTelegram=function(a){a=ra.prototype.evalTelegram.call(this,
a);if(0==Object.keys(a).length)return a;delete a.button;delete a.button_raw;return a};var Tb=function(a){ra.call(this,a);this._data="a5-10-13"};Tb.STATES="humidity humidity_raw temperature temperature_raw button button_raw".split(" ");Tb.prototype=new ra;Tb.prototype.constructor=Tb;Tb.prototype.evalTelegram=function(a){a=ra.prototype.evalTelegram.call(this,a);if(0==Object.keys(a).length)return a;delete a.setpoint;delete a.setpoint_raw;return a};var Ub=function(a){ab.call(this,a);this._data="a5-10-14"};
Ub.STATES="humidity humidity_raw temperature temperature_raw slider slider_raw".split(" ");Ub.prototype=new ab;Ub.prototype.constructor=Ub;Ub.prototype.evalTelegram=function(a){a=ab.prototype.evalTelegram.call(this,a);if(0==Object.keys(a).length)return a;delete a.setpoint;delete a.setpoint_raw;return a};var sb=function(a){R.call(this,a);this._data="a5-11-??"};sb.prototype=new R;sb.prototype.constructor=sb;var Vb=function(a){sb.call(this,a);this._data="a5-11-03"};Vb.STATES="position angle position_flag position_flag_raw angle_flag angle_flag_raw error error_raw end_position end_position_raw state state_raw service_mode position_mode power energy current voltage power_raw power_unit energy_unit current_unit voltage_unit power_unit_raw".split(" ");
Vb.prototype=new sb;Vb.prototype.constructor=Vb;Vb.prototype.evalTelegram=function(a){var b={};if(165==a.rorg){var c=a.userData.readUInt8(3),d=a.userData.readUInt8(2),n=a.userData.readUInt8(1);a=a.userData.readUInt8(0);if(1==(c>>3&1)){b.position=a;a=n&127;b.angle=2*(n>>7&1?0-a:a);n=d>>7&1;b.position_flag=n?!0:!1;b.position_flag_raw=n;n=d>>6&1;b.angle_flag=n?!0:!1;b.angle_flag_raw=n;n=d>>4&3;b.error_raw=n;switch(n){case 0:b.error="no_error";break;case 1:b.error="no_end_position";break;case 2:b.error=
"intern_failure"}n=d>>2&3;b.end_position_raw=n;switch(n){case 0:b.end_position="no_end_position";break;case 1:b.end_position="end_position_not_reach";break;case 2:b.end_position="fully_open";break;case 3:b.end_position="fully_closed"}d&=3;b.state_raw=d;switch(d){case 0:b.state="no_status";break;case 1:b.state="stopped";break;case 2:b.state="opens";break;case 3:b.state="closes"}b.service_mode=c>>7&1;b.position_mode=c>>6&1}}return b};var tb=function(a){sb.call(this,a);this._data="a5-11-04"};tb.STATES=
"state state_raw level rgb power energy current voltage power_raw power_unit energy_unit current_unit voltage_unit power_unit_raw op_hour error error_raw service_mode op_hour_flag op_hour_flag_raw mode_raw".split(" ");tb.prototype=new sb;tb.prototype.constructor=tb;tb.prototype.evalTelegram=function(a){var b={};if(165==a.rorg){var c=a.userData.readUInt8(3),d=a.userData.readUInt8(2),n=a.userData.readUInt8(1);a=a.userData.readUInt8(0);if(1==(c>>3&1)){b.service_mode=c>>7&1;var r=c>>6&1;b.op_hour_flag=
r?!0:!1;b.op_hour_flag_raw=r;r=c>>4&3;b.error_raw=r;switch(r){case 0:b.error="no_error";break;case 1:b.error="lamp_failure";break;case 2:b.error="intern_failure";break;case 3:b.error="extern_failure"}r=c&1;b.state=r?"on":"off";b.state_raw=r;c=c>>1&3;b.mode_raw=c;switch(c){case 0:b.level=a;b.op_hour=n<<8|d;break;case 1:c=a.toString(16);2>c.length&&(c="0"+c);n=n.toString(16);2>n.length&&(n="0"+n);d=d.toString(16);2>d.length&&(d="0"+d);b.rgb=c.toUpperCase()+n.toUpperCase()+d.toUpperCase();break;case 2:b.power_raw=
a<<8|n,b.power_unit_raw=d,n="mW W kW MW Wh kWh MWh GWh mA 1/10A mV 1/10V".split(" "),3>=d?(b.power=b.power_raw,b.power_unit=n[d]):7>=d?(b.energy=b.power_raw,b.energy_unit=n[d]):9>=d?(b.current=b.power_raw,b.current_unit=n[d]):11>=d&&(b.voltage=b.power_raw,b.voltage_unit=n[d])}}}return b};var Da=function(a){R.call(this,a);this._data="a5-12-??"};Da.STATES="meter_raw channel_raw type_raw scale_raw scale meter current cumulative".split(" ");Da.prototype=new R;Da.prototype.constructor=Da;Da.prototype.evalTelegram=
function(a){var b={};if(165==a.rorg){var c=a.userData.readUInt8(3);a=a.userData.readUInt32BE(0);if(1==(c>>3&1)){a=a>>8&16777215;b.meter_raw=a;b.channel_raw=c>>4&15;var d=c>>2&1;b.type_raw=d;c&=3;b.scale_raw=c;switch(c){case 0:b.scale=1;b.meter=a;break;case 1:b.scale=.1;b.meter=.1*a;break;case 2:b.scale=.01;b.meter=.01*a;break;case 3:b.scale=.001,b.meter=.001*a}d?b.current=b.meter:b.cumulative=b.meter}}return b};var Wb=function(a){Da.call(this,a);this._data="a5-12-00"};Wb.STATES=["current","counter",
"channel"];Wb.prototype=new Da;Wb.prototype.constructor=Wb;Wb.prototype.evalTelegram=function(a){a=Da.prototype.evalTelegram.call(this,a);a.counter=a.cumulative;a.channel=a.channel_raw;return a};var La=function(a){Da.call(this,a);this._data="a5-12-01"};La.STATES=["power","energy","tariff"];La.prototype=new Da;La.prototype.constructor=La;La.prototype.evalTelegram=function(a){a=Da.prototype.evalTelegram.call(this,a);a.energy=a.cumulative;a.power=a.current;a.tariff=a.channel_raw;return a};var gb=function(a){Da.call(this,
a);this._data="a5-12-02"};gb.STATES=["volume","flow","tariff"];gb.prototype=new Da;gb.prototype.constructor=gb;gb.prototype.evalTelegram=function(a){a=Da.prototype.evalTelegram.call(this,a);a.volume=a.cumulative;a.flow=a.current;a.tariff=a.channel_raw;return a};var Dc=function(a){gb.call(this,a);this._data="a5-12-03"};Dc.STATES=["volume","flow","tariff"];Dc.prototype=new gb;Dc.prototype.constructor=Dc;var sa=function(a){R.call(this,a);this._data="a5-13-??"};sa.STATES="lux lux_raw temperature temperature_raw wind wind_raw day_night rain sun_west sun_west_raw sun_south sun_south_raw sun_east sun_east_raw hemisphere day month year date_src weekday hour min sec time_format am_pm time_src elv azm latitude longitude latitude_raw longitude_raw".split(" ");
sa.prototype=new R;sa.prototype.constructor=sa;sa.prototype.evalTelegram=function(a){var b={};if(165==a.rorg){var c=a.userData.readUInt8(3),d=a.userData.readUInt8(2),n=a.userData.readUInt8(1),r=a.userData.readUInt8(0);if(1==(c>>3&1))switch(c>>4&15){case 1:b.lux=parseFloat((r/255*1E3).toFixed(1));b.lux_raw=r;var v=n;b.temperature=parseFloat((v/255*120-40).toFixed(1));b.temperature_raw=v;b.wind=parseFloat((d/255*70).toFixed(1));b.wind_raw=d;b.day_night=c>>2&1?"night":"day";b.rain=c>>1&1?"true":"false";
break;case 2:b.sun_west=parseFloat((r/255*150).toFixed(1));b.sun_west_raw=r;b.sun_south=parseFloat((n/255*150).toFixed(1));b.sun_south_raw=v;b.sun_east=parseFloat((d/255*150).toFixed(1));b.sun_east_raw=d;b.hemisphere=c>>2&1?"south":"north";break;case 3:b.day=r&15;b.month=n&7;b.year=(d&127)+2E3;b.date_src=c&1?"gps":"rtc";break;case 4:b.weekday=r>>5&7;b.hour=r&31;b.min=n&63;b.sec=d&63;b.time_format=c>>2&1?"12":"24";b.am_pm=c>>1&1?"pm":"am";b.time_src=c&1?"gps":"rtc";break;case 5:b.elv=r-90;b.elv_raw=
r;d=a.userData.readUInt16BE(1)&511;b.azm=d;b.azm_raw=d;break;case 6:a=(r>>4&15)<<8|n,d|=(r&15)<<8,b.latitude=parseFloat((a/4095*180-90).toFixed(1)),b.latitude_raw=a,b.longitude=parseFloat((d/4095*360-180).toFixed(1)),b.longitude_raw=d}}return b};var Ec=function(a){sa.call(this,a);this._data="a5-13-01"};Ec.STATES="lux lux_raw temperature temperature_raw wind wind_raw day_night rain sun_west sun_west_raw sun_south sun_south_raw sun_east sun_east_raw hemisphere day month year date_src weekday hour min sec time_format am_pm time_src elv azm latitude longitude latitude_raw longitude_raw".split(" ");
Ec.prototype=new sa;Ec.prototype.constructor=Ec;var Fc=function(a){sa.call(this,a);this._data="a5-13-02"};Fc.STATES="sun_west sun_west_raw sun_south sun_south_raw sun_east sun_east_raw hemisphere".split(" ");Fc.prototype=new sa;Fc.prototype.constructor=Fc;var Gc=function(a){sa.call(this,a);this._data="a5-13-03"};Gc.STATES=["day","month","year","date_src"];Gc.prototype=new sa;Gc.prototype.constructor=Gc;var Hc=function(a){sa.call(this,a);this._data="a5-13-04"};Hc.STATES="weekday hour min sec time_format am_pm time_src".split(" ");
Hc.prototype=new sa;Hc.prototype.constructor=Hc;var Ic=function(a){sa.call(this,a);this._data="a5-13-05"};Ic.STATES=["elv","azm"];Ic.prototype=new sa;Ic.prototype.constructor=Ic;var Jc=function(a){sa.call(this,a);this._data="a5-13-06"};Jc.STATES=["latitude","longitude"];Jc.prototype=new sa;Jc.prototype.constructor=Jc;var Xb=function(a){q.call(this,a);this._data="a5-14-01"};Xb.STATES=["voltage","voltage_raw","state"];Xb.prototype=new q;Xb.prototype.constructor=Xb;Xb.prototype.evalTelegram=function(a){var b=
{};if(165==a.rorg){var c=a.userData.readUInt8(3);a=a.userData.readUInt8(0);if(1==(c>>3&1)){b.voltage=a/250*5;b.voltage_raw=a;c&=1;switch(c){case 0:b.state="closed";break;case 1:b.state="open"}b.state_raw=c}}return b};var Yb=function(a){q.call(this,a);this._data="a5-14-02"};Yb.STATES=["voltage","voltage_raw","illumination","illumination_raw","state"];Yb.prototype=new q;Yb.prototype.constructor=Yb;Yb.prototype.evalTelegram=function(a){var b={};if(165==a.rorg){var c=a.userData.readUInt8(3),d=a.userData.readUInt8(1);
a=a.userData.readUInt8(0);if(1==(c>>3&1))switch(b.voltage=a/250*5,b.voltage_raw=a,b.illumination=d/250*1E3,b.illumination_raw=d,c&=1,b.state_raw=c,c){case 0:b.state="closed";break;case 1:b.state="open"}}return b};var Zb=function(a){q.call(this,a);this._data="a5-14-03"};Zb.STATES=["voltage","voltage_raw","state","viberation"];Zb.prototype=new q;Zb.prototype.constructor=Zb;Zb.prototype.evalTelegram=function(a){var b={};if(165==a.rorg){var c=a.userData.readUInt8(3);a=a.userData.readUInt8(0);if(1==(c>>
3&1)){b.voltage=a/250*5;b.voltage_raw=a;switch(c&1){case 0:b.state="closed";break;case 1:b.state="open"}switch(c>>1&1){case 0:b.viberation=!1;break;case 1:b.viberation=!0}}}return b};var $b=function(a){q.call(this,a);this._data="a5-14-04"};$b.STATES="voltage voltage_raw illumination illumination_raw state viberation".split(" ");$b.prototype=new q;$b.prototype.constructor=$b;$b.prototype.evalTelegram=function(a){var b={};if(165==a.rorg){var c=a.userData.readUInt8(3),d=a.userData.readUInt8(1);a=a.userData.readUInt8(0);
if(1==(c>>3&1)){b.voltage=a/250*5;b.voltage_raw=a;b.illumination=d/250*1E3;b.illumination_raw=d;switch(c&1){case 0:b.state="closed";break;case 1:b.state="open"}switch(c>>1&1){case 0:b.viberation=!1;break;case 1:b.viberation=!0}}}return b};var ac=function(a){q.call(this,a);this._data="a5-14-05"};ac.STATES=["voltage","voltage_raw","viberation"];ac.prototype=new q;ac.prototype.constructor=ac;ac.prototype.evalTelegram=function(a){var b={};if(165==a.rorg){var c=a.userData.readUInt8(3);a=a.userData.readUInt8(0);
if(1==(c>>3&1))switch(b.voltage=a/250*5,b.voltage_raw=a,c>>1&1){case 0:b.viberation=!1;break;case 1:b.viberation=!0}}return b};var bc=function(a){q.call(this,a);this._data="a5-14-06"};bc.STATES=["voltage","voltage_raw","illumination","illumination_raw","viberation"];bc.prototype=new q;bc.prototype.constructor=bc;bc.prototype.evalTelegram=function(a){var b={};if(165==a.rorg){var c=a.userData.readUInt8(3),d=a.userData.readUInt8(1);a=a.userData.readUInt8(0);if(1==(c>>3&1))switch(b.voltage=a/250*5,b.voltage_raw=
a,b.illumination=d/250*1E3,b.illumination_raw=d,c>>1&1){case 0:b.viberation=!1;break;case 1:b.viberation=!0}}return b};var cc=function(a){q.call(this,a);this._data="a5-14-07"};cc.STATES=["voltage","voltage_raw","state","lock"];cc.prototype=new q;cc.prototype.constructor=cc;cc.prototype.evalTelegram=function(a){var b={};if(165==a.rorg){var c=a.userData.readUInt8(3);a=a.userData.readUInt8(0);if(1==(c>>3&1)){b.voltage=a/250*5;b.voltage_raw=a;switch(c>>2&1){case 0:b.state="closed";break;case 1:b.state=
"open"}switch(c>>1&1){case 0:b.lock="locked";break;case 1:b.lock="unlocked"}}}return b};var dc=function(a){q.call(this,a);this._data="a5-14-08"};dc.STATES=["voltage","voltage_raw","state","lock","viberation"];dc.prototype=new q;dc.prototype.constructor=dc;dc.prototype.evalTelegram=function(a){var b={};if(165==a.rorg){var c=a.userData.readUInt8(3);a=a.userData.readUInt8(0);if(1==(c>>3&1)){b.voltage=a/250*5;b.voltage_raw=a;switch(c>>2&1){case 0:b.state="closed";break;case 1:b.state="open"}switch(c>>
1&1){case 0:b.lock="locked";break;case 1:b.lock="unlocked"}switch(c&1){case 0:b.viberation=!1;break;case 1:b.viberation=!0}}}return b};var ec=function(a){q.call(this,a);this._data="a5-14-09"};ec.STATES=["voltage","voltage_raw","state"];ec.prototype=new q;ec.prototype.constructor=ec;ec.prototype.evalTelegram=function(a){var b={};if(165==a.rorg){var c=a.userData.readUInt8(3);a=a.userData.readUInt8(0);if(1==(c>>3&1))switch(b.voltage=a/250*5,b.voltage_raw=a,c>>1&3){case 0:b.state="closed";break;case 1:b.state=
"tilted";break;case 2:b.state="reserved";break;case 3:b.state="open"}}return b};var fc=function(a){q.call(this,a);this._data="a5-14-0a"};fc.STATES=["voltage","voltage_raw","state","viberation"];fc.prototype=new q;fc.prototype.constructor=fc;fc.prototype.evalTelegram=function(a){var b={};if(165==a.rorg){var c=a.userData.readUInt8(3);a=a.userData.readUInt8(0);if(1==(c>>3&1)){b.voltage=a/250*5;b.voltage_raw=a;switch(c>>1&3){case 0:b.state="closed";break;case 1:b.state="tilted";break;case 2:b.state="reserved";
break;case 3:b.state="open"}switch(c&1){case 0:b.viberation=!1;break;case 1:b.viberation=!0}}}return b};var Ga=function(a){R.call(this,a);this._data="a5-20-04";this.TEACH_IN_VARIATION=3;this._defaultSetpoint=15;this._defaultWakeupCycle=3;this._defaultDisplay=0;this._states={pending:{value:!1,time:(new Date).getTime()}};this._service_command_new=this._button_lock_new=this._display_new=this._wakeup_cycle_new=this._measurement_new=this._setpoint_new=this._valve_new=null};Ga.COMMANDS="setValve setTo up down measureOn measureOff setWakeup setDisplay buttonLock buttonUnlock openValve closeValve init".split(" ");
Ga.STATES="valve measurement button_lock temperature_selection feed_temperature setpoint error temperature wakeup_cycle display pending".split(" ");Ga.prototype=new R;Ga.prototype.constructor=Ga;Ga.prototype.setDefaultParams=function(){this._params||(this._params={});if("undefined"==typeof this._params.wakeup_cycle||null==this._params.wakeup_cycle)this._params.wakeup_cycle=this._defaultWakeupCycle;if("undefined"==typeof this._params.display||null==this._params.display)this._params.display=this._defaultDisplay};
Ga.prototype.getStatesBuffer=function(){var a=JSON.parse(JSON.stringify(this._states));a.wakeup_cycle={value:this._params.wakeup_cycle,time:-1};a.display={value:this._params.display,time:-1};"undefined"!=typeof this._wakeup_cycle_new&&null!=this._wakeup_cycle_new&&(a.wakeup_cycle={value:this._wakeup_cycle_new,time:-1});"undefined"!=typeof this._display_new&&null!=this._display_new&&(a.display={value:this._display_new,time:-1});"undefined"!=typeof this._valve_new&&null!=this._valve_new&&(a.valve={value:this._valve_new,
time:-1});"undefined"!=typeof this._setpoint_new&&null!=this._setpoint_new&&(a.setpoint={value:this._setpoint_new,time:-1});"undefined"!=typeof this._measurement_new&&null!=this._measurement_new&&(a.measurement={value:this._measurement_new,time:-1});"undefined"!=typeof this._button_lock_new&&null!=this._button_lock_new&&(a.button_lock={value:this._button_lock_new,time:-1});return a};Ga.prototype.getCurrentStates=function(){var a={},b=this.getStatesBuffer(),c;for(c in b)b.hasOwnProperty(c)&&b[c]&&
(a[c]=b[c].value);return a};Ga.prototype.executeCommand=function(a,b,c){var d=(new Date).getTime();if(b&&b.value){"setValve"==b.value.substr(0,8)&&8<b.value.length?(a=b.value.substr(8),b={value:"setValve",ext:a}):"setTo"==b.value.substr(0,5)&&5<b.value.length?(a=b.value.substr(5),b={value:"setTo",ext:a}):"tempTo"==b.value.substr(0,6)&&6<b.value.length?(a=b.value.substr(6),b={value:"setTo",ext:a}):"up"==b.value.substr(0,2)&&2<b.value.length?(a=b.value.substr(2),b={value:"up",ext:a}):"down"==b.value.substr(0,
4)&&4<b.value.length?(a=b.value.substr(4),b={value:"down",ext:a}):"setWakeup"==b.value.substr(0,9)&&9<b.value.length?(a=b.value.substr(9),b={value:"setWakeup",ext:a}):"setDisplay"==b.value.substr(0,10)&&10<b.value.length&&(a=b.value.substr(10),b={value:"setDisplay",ext:a});var n=[];switch(b.value){case "setValve":if("undefined"==typeof b.ext||null==b.ext){c&&c(Error("set valve value invalid"));return}a=parseInt(b.ext);0>a&&(a=0);100<a&&(a=100);this._valve_new=a;this._states.pending={value:!0,time:d};
b={key:"valve",value:a,changed:!1};d=this._states.valve?this._states.valve.value:null;d!=a&&(b.oldvalue=d,b.changed=!0);n.push(b);break;case "setTo":if("undefined"==typeof b.ext||null==b.ext){c&&c(Error("set valve value invalid"));return}a=parseFloat(b.ext);10>a&&(a=10);30<a&&(a=30);this._setpoint_new=a;this._states.pending={value:!0,time:d};b={key:"setpoint",value:this._setpoint_new,changed:!1};d=this._states.setpoint?this._states.setpoint.value:null;d!=this._setpoint_new&&(b.oldvalue=d,b.changed=
!0);n.push(b);break;case "up":(a=b.ext)||(a=.5);a=parseFloat(a);if("undefined"!=typeof this._setpoint_new&&null!=this._setpoint_new)this._setpoint_new+=a;else if(this._states&&this._states.setpoint&&"undefined"!=typeof this._states.setpoint.value&&null!=this._states.setpoint.value)this._setpoint_new=this._states.setpoint.value+a;else{c&&c(Error("not current setpoint value"));return}10>this._setpoint_new&&(this._setpoint_new=10);30<this._setpoint_new&&(this._setpoint_new=30);this._states.pending={value:!0,
time:d};b={key:"setpoint",value:this._setpoint_new,changed:!1};d=this._states.setpoint?this._states.setpoint.value:null;d!=this._setpoint_new&&(b.oldvalue=d,b.changed=!0);n.push(b);break;case "down":(a=b.ext)||(a=.5);a=parseFloat(a);if("undefined"!=typeof this._setpoint_new&&null!=this._setpoint_new)this._setpoint_new-=a;else if(this._states&&this._states.setpoint&&"undefined"!=typeof this._states.setpoint.value&&null!=this._states.setpoint.value)this._setpoint_new=this._states.setpoint.value-a;else{c&&
c(Error("not current setpoint value"));return}10>this._setpoint_new&&(this._setpoint_ne=10);30<this._setpoint_new&&(this._setpoint_new=30);this._states.pending={value:!0,time:d};b={key:"setpoint",value:this._setpoint_new,changed:!1};d=this._states.setpoint?this._states.setpoint.value:null;d!=this._setpoint_new&&(b.oldvalue=d,b.changed=!0);n.push(b);break;case "measureOn":this._measurement_new="active";this._states.pending={value:!0,time:d};b={key:"measurement",value:this._measurement_new,changed:!1};
d=this._states.measurement?this._states.measurement.value:null;d!=this._measurement_new&&(b.oldvalue=d,b.changed=!0);n.push(b);break;case "measureOff":this._measurement_new="inactive";this._states.pending={value:!0,time:d};b={key:"measurement",value:this._measurement_new,changed:!1};d=this._states.measurement?this._states.measurement.value:null;d!=this._measurement_new&&(b.oldvalue=d,b.changed=!0);n.push(b);break;case "setWakeup":if("undefined"==typeof b.ext||null==b.ext){c&&c(Error("set wakup cycle value invalid"));
return}this._wakeup_cycle_new=a=parseInt(b.ext);this._states.pending={value:!0,time:d};b={key:"wakeup_cycle",value:this._wakeup_cycle_new,changed:!1};d=this._params.wakeup_cycle;d!=this._wakeup_cycle_new&&(b.oldvalue=d,b.changed=!0);n.push(b);break;case "setDisplay":if("undefined"==typeof b.ext||null==b.ext){c&&c(Error("set display orientation value invalid"));return}this._display_new=a=parseInt(b.ext);this._states.pending={value:!0,time:d};b={key:"display",value:this._display_new,changed:!1};d=this._params.display;
d!=this._display_new&&(b.oldvalue=d,b.changed=!0);n.push(b);break;case "buttonLock":this._button_lock_new="locked";this._states.pending={value:!0,time:d};b={key:"button_lock",value:this._button_lock_new,changed:!1};d=this._states.button_lock?this._states.button_lock.value:null;d!=this._button_lock_new&&(b.oldvalue=d,b.changed=!0);n.push(b);break;case "buttonUnlock":this._button_lock_new="unlocked";this._states.pending={value:!0,time:d};b={key:"button_lock",value:this._button_lock_new,changed:!1};
d=this._states.button_lock?this._states.button_lock.value:null;d!=this._button_lock_new&&(b.oldvalue=d,b.changed=!0);n.push(b);break;case "openValve":this._service_command_new=1;this._states.pending={value:!0,time:d};break;case "closeValve":this._service_command_new=3;this._states.pending={value:!0,time:d};break;case "init":this._service_command_new=2,this._states.pending={value:!0,time:d}}0<n.length&&require("x.hub.m.enocean.js")._onEOEvents(this,n);c&&c()}else c&&c(Error("command invalid"))};Ga.prototype.evalData=
function(a,b,c){if(b=this.evalTelegram(b)){var d=this;this._sendResponse(a,b,function(n,r){n=d.checkStateChange(r);c&&c(null,n)})}else c&&c(Error("data format invalid"))};Ga.prototype.evalTelegram=function(a){var b={};if(165==a.rorg){var c=a.userData.readUInt8(3),d=a.userData.readUInt8(2),n=a.userData.readUInt8(1);a=a.userData.readUInt8(0);if(1==(c>>3&1)){b.valve=a;b.measurement=c>>7&1?"inactive":"active";b.button_lock=c>>2&1?"locked":"unlocked";a=c>>1&1;c&=1;b.temperature_selection=a?"setpoint":
"feed_temperature";switch(a){case 0:b.feed_temperature=parseFloat((n/255*60+20).toFixed(1));break;case 1:b.setpoint=parseFloat((n/255*20+10).toFixed(1))}if(0==c)b.error="no_error",b.temperature=parseFloat((d/255*20+10).toFixed(1));else switch(d){case 17:b.error="measurement_error";break;case 18:b.error="battery_empty";break;case 20:b.error="frost_protection";break;case 33:b.error="blocked_valve";break;case 36:b.error="end_point_detection_error";break;case 40:b.error="no_valve";break;case 49:b.error=
"not_taught_in";break;case 53:b.error="no_response_from_controller";break;case 54:b.error="teach_in_error";break;default:b.error="unknow_error"}}}return b};Ga.prototype._sendResponse=function(a,b,c){var d=(new Date).getTime(),n=JSON.parse(JSON.stringify(b));this._states.pending={value:!1,time:d};var r=!1;if("undefined"!=typeof this._valve_new&&null!=this._valve_new){var v=this._valve_new;this._states.valve={value:this._valve_new,time:d};this._valve_new=null;delete n.valve}else v="undefined"!=typeof b.valve&&
null!=b.valve?b.valve:this._states.valve?this._states.valve.value:null;if("undefined"==typeof v||null==v)v=0,n.valve=0;if("undefined"!=typeof this._setpoint_new&&null!=this._setpoint_new){var z=Math.round((this._setpoint_new-10)/20*255);this._states.setpoint={value:this._setpoint_new,time:d};this._setpoint_new=null;delete n.setpoint}else"undefined"!=typeof b.setpoint&&null!=b.setpoint?z=Math.round((b.setpoint-10)/20*255):this._states.setpoint&&"undefined"!=this._states.setpoint.value&&null!=this._states.setpoint.value&&
(z=Math.round((this._states.setpoint.value-10)/20*255));if("undefined"==typeof z||null==z)z=this._defaultSetpoint,z=Math.round((z-10)/20*255),n.setpoint=this._defaultSetpoint;if("undefined"!=typeof this._measurement_new&&null!=this._measurement_new){var F="active"==this._measurement_new?0:1;this._states.measurement={value:this._measurement_new,time:d};this._measurement_new=null;delete n.measurement}else"undefined"!=typeof b.measurement&&null!=b.measurement?F="active"==b.measurement?0:1:this._states.measurement&&
"undefined"!=this._states.measurement.value&&null!=this._states.measurement.value&&(F="active"==this._states.measurement.value?0:1);if("undefined"==typeof F||null==F)F=0,n.measurement="active";var P=this._params.wakeup_cycle;"undefined"!=typeof this._wakeup_cycle_new&&null!=this._wakeup_cycle_new&&(P=this._wakeup_cycle_new,this._params.wakeup_cycle=this._wakeup_cycle_new,r=!0,this._wakeup_cycle_new=null);if("undefined"==typeof P||null==P)P=this._defaultWakeupCycle,this._params.wakeup_cycle=P;var U=
this._params.display;"undefined"!=typeof this._display_new&&null!=this._display_new&&(U=this._display_new,this._params.display=this._display_new,r=!0,this._display_new=null);if("undefined"==typeof U||null==U)U=this._defaultDisplay,this._params.display=U;if("undefined"!=typeof this._button_lock_new&&null!=this._button_lock_new){var B="locked"==this._button_lock_new?1:0;this._states.button_lock={value:this._button_lock_new,time:d};this._button_lock_new=null;delete n.button_lock}else"undefined"!=typeof b.button_lock&&
null!=b.button_lock?B="locked"==b.button_lock?1:0:this._states.button_lock&&this._states.button_lock.value&&(B="locked"==this._states.button_lock.value?1:0);if("undefined"==typeof B||null==B)B=0,n.button_lock="unlocked";b=0;"undefined"!=typeof this._service_command_new&&null!=this._service_command_new&&(b=this._service_command_new,this._service_command_new=null);v=new Buffer([v,z,(F&1)<<6|P&63,(U&3)<<4|8|(B&1)<<2|b&3]);r&&require("x.hub.m.enocean.js")._deviceHandler.deviceParamsUpdated();r=this._senderID;
r||(r=x.hub.m.enocean.SENDER_ID);r=new x.hub.m.enocean.ESP3.Telegram.ADT(165,v,this._address,r,0);a.sendTelegram(r,!0,function(M){c&&c(M,n)})};var ub=function(a){R.call(this,a);this._data="a5-30-??"};ub.prototype=new R;ub.prototype.constructor=ub;var hb=function(a){q.call(this,a);this._data="a5-30-01"};hb.STATES=["battery_low","battery_raw","state","state_raw"];hb.prototype=new ub;hb.prototype.constructor=hb;hb.prototype.evalTelegram=function(a){var b={};if(165==a.rorg){var c=a.userData.readUInt8(3),
d=a.userData.readUInt8(2);a=a.userData.readUInt8(1);1==(c>>3&1)&&(b.battery_low=120>=a?!0:!1,b.battery_raw=a,b.state=195>=d?"closed":"open",b.state_raw=d)}return b};var gc=function(a){q.call(this,a);this._data="a5-30-01\u00b4"};gc.STATES=["state"];gc.prototype=new ub;gc.prototype.constructor=gc;gc.prototype.evalTelegram=function(a){var b={};165==a.rorg&&(a=a.userData.readUInt8(3),1==(a>>3&1)&&(b.state=a&1?"open":"closed"));return b};var wa=function(a){q.call(this,a);this._data="a5-30-03"};wa.STATES=
"temperature temperature_raw wake input3 input2 input1 input0".split(" ");wa.prototype=new ub;wa.prototype.constructor=wa;wa.prototype.evalTelegram=function(a){var b={};if(165==a.rorg){var c=a.userData.readUInt8(3),d=a.userData.readUInt8(2);a=a.userData.readUInt8(1);1==(c>>3&1)&&(b.temperature=(255-a)/255*40,b.temperature_raw=a,b.wake=d>>4&1,b.input3=d>>3&1,b.input2=d>>2&1,b.input1=d>>1&1,b.input0=d&1)}return b};var hc=function(a){q.call(this,a);this._data="a5-30-04"};hc.STATES=["analog_input","input2",
"input1","input0"];hc.prototype=new ub;hc.prototype.constructor=hc;hc.prototype.evalTelegram=function(a){var b={};if(165==a.rorg){var c=a.userData.readUInt8(3);a=a.userData.readUInt8(2);1==(c>>3&1)&&(b.analog_input=a,b.input2=c>>2&1,b.input1=c>>1&1,b.input0=c&1)}return b};var Kc=function(a){R.call(this,a);this._data="a5-38-??"};Kc.prototype=new R;Kc.prototype.constructor=Kc;var la=function(a){Kc.call(this,a);this._data="a5-38-08"};la.prototype=new Kc;la.prototype.constructor=la;la.prototype.evalTelegram=
function(a){var b={};if(165==a.rorg){var c=a.userData.readUInt8(3),d=a.userData.readUInt8(2),n=a.userData.readUInt8(1);a=a.userData.readUInt8(0);if(1==(c>>3&1))switch(a){case 2:b.level=Math.round(n/255*100),b.ramp=d,b.dim_range=c>>2&1?"relative":"absolute",b.store_final_value=c>>1&1,b.state=c&1?"on":"off"}}return b};la.prototype.switching=function(a,b,c){var d=this._senderID;this._senderID||(d=x.hub.m.enocean.SENDER_ID);b=new Buffer([1,b.TIM>>8&255,b.TIM&255,8|(b.LCK&1)<<2|(b.DEL&1)<<1|b.SW&1]);d=
new x.hub.m.enocean.ESP3.Telegram.BS4(b,d,0);d.setDstId(this._address);a.sendTelegram(d,!0,function(n){c&&c(n)})};la.prototype.dimming=function(a,b,c){var d=this._senderID;this._senderID||(d=x.hub.m.enocean.SENDER_ID);b=new Buffer([2,b.EDIM,b.RMP,8|(b.EDIMR&1)<<2|(b.STR&1)<<1|b.SW&1]);d=new x.hub.m.enocean.ESP3.Telegram.BS4(b,d,0);d.setDstId(this._address);a.sendTelegram(d,!0,function(n){c&&c(n)})};la.prototype.blind=function(a,b,c){var d=this._senderID;this._senderID||(d=x.hub.m.enocean.SENDER_ID);
d?(b=new Buffer([7,b.P1,b.P2,(b.FUNC&15)<<4|8|(b.SSF&1)<<2|(b.PAF&1)<<1|b.SMF&1]),d=new x.hub.m.enocean.ESP3.Telegram.BS4(b,d,0),d.setDstId(this._address),a.sendTelegram(d,!0,function(n){c&&c(n)})):c&&c(Error("no senderID"))};var Lc=function(a){R.call(this,a);this._data="a5-3F-7F"};Lc.prototype=new R;Lc.prototype.constructor=Lc;var Ea=function(a){q.call(this,a);this._data="d2-??-??";this.UNIQUE_GATEWAY_SENDERID=!0};Ea.prototype=new q;Ea.prototype.constructor=Ea;var fa=function(a){Ea.call(this,a);
this._data="d2-01-??";this._lastQuery={};this._initCount=0};fa.STATES="power_failure_detection power_failure over_current_switch_off error_level io_channel local_control output_value output_state".split(" ");fa.prototype=new Ea;fa.prototype.constructor=fa;fa.prototype.init=function(a){var b=this.getIOs();if(0<b.length){var c=require("x.hub.m.enocean.js")._esp3,d=0,n=this,r=function(){d++;d<b.length?n.statusQuery(c,{IO:b[d]},r):a&&a()};this.statusQuery(c,{IO:b[d]},r)}else a&&a()};fa.prototype.getStatesBuffer=
function(){0==Object.keys(this._states).length?(100>=this._initCount&&0==this._initCount%10?this.init():100<=this._initCount&&600>=this._initCount&&0==this._initCount%60?this.init():this._initCount=0,this._initCount++):this._initCount=0;return this._states};fa.prototype.getIOs=function(){return[]};fa.prototype.setOutput=function(a,b,c){var d=this._senderID;this._senderID||(d=x.hub.m.enocean.SENDER_ID);b=new Buffer([1,(b.DV&7)<<5|b.IO&31,b.OV&127]);d=new x.hub.m.enocean.ESP3.Telegram.VLD(b,d,0);this._senderID!=
this._address&&d.setDstId(this._address);a.sendTelegram(d,!0,function(n){c&&c(n)})};fa.prototype.setLocal=function(a,b,c){b=new Buffer([(b.DE&1)<<7|2,(b.OC&1)<<7|(b.RO&1)<<6|(b.LC&1)<<5|b.IO&31,(b.DT2&15)<<4|b.DT3&15,(b.DN&1)<<7|(b.PF&1)<<6|(b.DS&3)<<4|b.DT1&15]);b=new x.hub.m.enocean.ESP3.Telegram.VLD(b,x.hub.m.enocean.SENDER_ID,0);b.setDstId(this._address);a.sendTelegram(b,!0,function(d){c&&c(d)})};fa.prototype.statusQuery=function(a,b,c){this._senderID?(this._lastQuery[b.IO]=(new Date).getTime(),
b=new Buffer([3,b.IO&31]),b=new x.hub.m.enocean.ESP3.Telegram.VLD(b,this._senderID,0),b.setDstId(this._address),a.sendTelegram(b,!0,function(d){c&&c(d)})):c&&c(Error("no senderID"))};fa.prototype.measurementQuery=function(a,b,c){b=new Buffer([6,(b.QU&1)<<5|b.IO&31]);b=new x.hub.m.enocean.ESP3.Telegram.VLD(b,this._senderID,0);b.setDstId(this._address);a.sendTelegram(b,!0,function(d){c&&c(d)})};fa.prototype.evalTelegram=function(a){var b={};if(210==a.rorg){var c=a.userData.readUInt8(0);switch(c&15){case 4:if(3==
a.userData.length){var d=c>>7&1,n=c>>6&1;c=a.userData.readUInt8(1);var r=c>>7&1,v=c>>5&3,z=c&31;c=a.userData.readUInt8(2);a=c&127;b.power_failure_detection=d?!0:!1;b.power_failure=n?!0:!1;b.over_current_switch_off=r;b.error_level=v;b.io_channel=z;b.local_control=c>>7&1?!0:!1;b.output_value=a;b.output_state=a?"on":"off"}break;case 7:if(6==a.userData.length){c=a.userData.readUInt8(1);d=c>>5&7;z=c&31;c=a.userData.readUInt32BE(2);switch(d){case 0:b.unit="Ws";break;case 1:b.unit="Wh";break;case 2:b.unit=
"KWh";break;case 3:b.unit="W";break;case 4:b.unit="KW"}b.io_channel=z;b.value=c}}}return b};var Ma=function(a){fa.call(this,a);this._data="d2-01-00"};Ma.COMMANDS=["on","off","toggle"];Ma.STATES="power_failure_detection power_failure over_current_switch_off error_level io_channel local_control output_value output_state".split(" ");Ma.prototype=new fa;Ma.prototype.constructor=Ma;Ma.prototype.getIOs=function(){return[0]};Ma.prototype.executeCommand=function(a,b,c){if(b&&b.value){var d=this;switch(b.value){case "on":this.activeStateChange({output_value:100,
output_state:"on"});this.setOutput(a,{DV:0,IO:0,OV:100},c);break;case "off":this.activeStateChange({output_value:0,output_state:"off"});this.setOutput(a,{DV:0,IO:0,OV:0},c);break;case "toggle":this._states.output_state?this.executeCommand(a,{value:"on"==this._states.output_state.value?"off":"on"},c):this.init(function(){setTimeout(function(){d._states.output_state?d.executeCommand(a,b,c):c&&c(Error("unkown current status"))},200)})}}else c&&c(Error("command invalid"))};var ic=function(a){Ma.call(this,
a);this._data="d2-01-01"};ic.COMMANDS=["on","off","toggle"];ic.STATES="power_failure_detection power_failure over_current_switch_off error_level io_channel local_control output_value output_state".split(" ");ic.prototype=new Ma;ic.prototype.constructor=ic;var jc=function(a){Ma.call(this,a);this._data="d2-01-03";this._lastOnLevel=-1};jc.prototype=new Ma;jc.prototype.constructor=jc;jc.prototype.evalData=function(a,b,c){(a=this.evalTelegram(b))?((0==a.output_value||"off"==a.output_state)&&this._states.output_value&&
this._states.output_value.value&&(this._lastOnLevel=this._states.output_value.value),a=this.checkStateChange(a),c&&c(null,a)):c&&c(Error("data format invalid"))};jc.prototype.executeCommand=function(a,b,c){if(b&&b.value){if("dimTo"==b.value.substr(0,5)&&5<b.value.length){var d=b.value.substr(5);b={value:"dimTo",ext:d}}else"toggleTo"==b.value.substr(0,8)&&8<b.value.length&&(d=b.value.substr(8),b={value:"toggleTo",ext:d});(new Date).getTime();var n=this;switch(b.value){case "on":d=this._lastOnLevel;
if(-1==d||0==d)d=100;this.setOutput(a,{DV:0,IO:0,OV:d},function(r){r||n.activeStateChange({output_value:d,output_state:"on"});c&&c(r)});break;case "off":this._states.output_value&&this._states.output_value.value&&(this._lastOnLevel=this._states.output_value.value);this.setOutput(a,{DV:0,IO:0,OV:0},function(r){r||n.activeStateChange({output_value:0,output_state:"off"});c&&c(r)});break;case "toggle":if(!this._states.output_state){this.init(function(){setTimeout(function(){n._states.output_state?n.executeCommand(a,
b,c):c&&c(Error("unkown current status"))},200)});break}this.executeCommand(a,{value:"on"==this._states.output_state.value?"off":"on"},c);break;case "toggleTo":if(!this._states.output_state){this.init(function(){setTimeout(function(){n._states.output_state?n.executeCommand(a,b,c):c&&c(Error("unkown current status"))},200)});break}"on"==this._states.output_state.value?this.executeCommand(a,{value:"off"},c):this.executeCommand(a,{value:"dimTo",ext:b.ext},c);break;case "dimTo":if("undefined"==typeof b.ext||
null==b.ext){c&&c(Error("dim to value invalid"));break}d=parseFloat(b.ext);0>d&&(d=0);100<d&&(d=100);this.setOutput(a,{DV:0,IO:0,OV:d},function(r){r||n.activeStateChange({output_value:d,output_state:0==d?"off":"on"});c&&c(r)});break;case "dimUp":if(!this._states.output_state){this.init(function(){setTimeout(function(){n._states.output_state?n.executeCommand(a,b,c):c&&c(Error("unkown current status"))},200)});break}d=parseInt(this._states.output_value.value);d+=5;100<d&&(d=100);this.executeCommand(a,
{value:"dimTo",ext:d},c);break;case "dimDown":if(!this._states.output_state){this.init(function(){setTimeout(function(){n._states.output_state?n.executeCommand(a,b,c):c&&c(Error("unkown current status"))},200)});break}d=parseInt(this._states.output_value.value);d-=5;0>d&&(d=0);this.executeCommand(a,{value:"dimTo",ext:d},c);break;default:c&&c(Error("unknow command"))}}else c&&c(Error("command invalid"))};var bb=function(a){fa.call(this,a);this._data="d2-01-11"};bb.COMMANDS="ch1On ch1Off ch1Toggle ch2On ch2Off ch2Toggle".split(" ");
bb.STATES="power_failure_detection power_failure over_current_switch_off error_level io_channel local_control output_value output_state ch1_output_value ch1_output_state ch2_output_value ch2_output_state".split(" ");bb.prototype=new fa;bb.prototype.constructor=bb;bb.prototype.getIOs=function(){return[0,1]};bb.prototype.evalTelegram=function(a){if(a=fa.prototype.evalTelegram.call(this,a))switch(a.io_channel){case 0:a.ch1_output_value=a.output_value;a.ch1_output_state=a.output_state;break;case 1:a.ch2_output_value=
a.output_value,a.ch2_output_state=a.output_state}return a};bb.prototype.executeCommand=function(a,b,c){if(b&&b.value){var d=this;switch(b.value){case "ch1On":this.activeStateChange({ch1_output_value:100,ch1_output_state:"on"});this.setOutput(a,{DV:0,IO:0,OV:100},c);break;case "ch1Off":this.activeStateChange({ch1_output_value:0,ch1_output_state:"off"});this.setOutput(a,{DV:0,IO:0,OV:0},c);break;case "ch1Toggle":if(!this._states.output_state){this.init(function(){setTimeout(function(){d._states.output_state?
d.executeCommand(a,b,c):c&&c(Error("unkown current status"))},200)});break}var n="on"==this._states.ch1_output_state.value?"off":"on";this.activeStateChange({ch1_output_value:"on"==n?100:0,ch1_output_state:n});this.executeCommand(a,{value:"on"==n?"ch1On":"ch1Off"},c);break;case "ch2On":this.activeStateChange({ch2_output_value:100,ch2_output_state:"on"});this.setOutput(a,{DV:0,IO:1,OV:100},c);break;case "ch2Off":this.activeStateChange({ch2_output_value:0,ch2_output_state:"off"});this.setOutput(a,{DV:0,
IO:1,OV:0},c);break;case "ch2Toggle":if(!this._states.output_state){this.init(function(){setTimeout(function(){d._states.output_state?d.executeCommand(a,b,c):c&&c(Error("unkown current status"))},200)});break}n="on"==this._states.ch2_output_state.value?"off":"on";this.activeStateChange({ch2_output_value:"on"==n?100:0,ch2_output_state:n});this.executeCommand(a,{value:"on"==n?"ch2On":"ch2Off"},c);break;default:c&&c(Error("unknown command"))}}else c&&c(Error("command invalid"))};var Qa=function(a){fa.call(this,
a);this._data="d2-01-13";this._queryInterval=3E4};Qa.COMMANDS="ch1On ch1Off ch1Toggle ch2On ch2Off ch2Toggle ch3On ch3Off ch3Toggle ch4On ch4Off ch4Toggle".split(" ");Qa.STATES="power_failure_detection power_failure over_current_switch_off error_level io_channel local_control output_value output_state ch1_output_value ch1_output_state ch2_output_value ch2_output_state ch3_output_value ch3_output_state ch4_output_value ch4_output_state".split(" ");Qa.prototype=new fa;Qa.prototype.constructor=Qa;Qa.prototype.getStatesBuffer=
function(){var a=[];this._states.ch1_output_state||(!this._lastQuery[0]||now-this._lastQuery[0]>this._queryInterval)&&a.push(0);this._states.ch2_output_state||(!this._lastQuery[1]||now-this._lastQuery[1]>this._queryInterval)&&a.push(1);this._states.ch3_output_state||(!this._lastQuery[2]||now-this._lastQuery[2]>this._queryInterval)&&a.push(2);this._states.ch4_output_state||(!this._lastQuery[3]||now-this._lastQuery[3]>this._queryInterval)&&a.push(3);0<a.length&&this._queryStates(a);return this._states};
Qa.prototype._queryStates=function(a,b){var c=require("x.hub.m.enocean.js")._esp3,d=0,n=this,r=function(){d++;d<a.length?n.statusQuery(c,{IO:a[d]},r):b&&b()};this.statusQuery(c,{IO:a[d]},r)};Qa.prototype.getIOs=function(){return[0,1,2,3]};Qa.prototype.evalTelegram=function(a){if(a=fa.prototype.evalTelegram.call(this,a))switch(a.io_channel){case 0:a.ch1_output_value=a.output_value;a.ch1_output_state=a.output_state;break;case 1:a.ch2_output_value=a.output_value;a.ch2_output_state=a.output_state;break;
case 2:a.ch3_output_value=a.output_value;a.ch3_output_state=a.output_state;break;case 3:a.ch4_output_value=a.output_value,a.ch4_output_state=a.output_state}return a};Qa.prototype.executeCommand=function(a,b,c){if(b&&b.value){var d=this;switch(b.value?b.value.substr(0,3):null){case "ch1":var n=0;var r="ch1_output_value";var v="ch1_output_state";break;case "ch2":n=1;r="ch2_output_value";v="ch2_output_state";break;case "ch3":n=2;r="ch3_output_value";v="ch3_output_state";break;case "ch4":n=3,r="ch4_output_value",
v="ch4_output_state"}switch(b.value){case "ch1On":case "ch2On":case "ch3On":case "ch4On":var z={};z[r]=100;z[v]="on";var F={DV:0,IO:n,OV:100};this.activeStateChange(z);this.setOutput(a,F,c);break;case "ch1Off":case "ch2Off":case "ch3Off":case "ch4Off":z={};z[r]=0;z[v]="off";F={DV:0,IO:n,OV:0};this.activeStateChange(z);this.setOutput(a,F,c);break;case "ch1Toggle":case "ch2Toggle":case "ch3Toggle":case "ch4Toggle":if(!this._states.output_state){this.init(function(){setTimeout(function(){d._states.output_state?
d.executeCommand(a,b,c):c&&c(Error("unkown current status"))},200)});break}if(!this._states[v]){c&&c(Error("state unknown"));break}F="on"==this._states[v].value?"off":"on";z={};z[r]="on"==F?100:0;z[v]=F;F={DV:0,IO:n,OV:"on"==F?100:0};this.activeStateChange(z);this.setOutput(a,F,c);break;default:c&&c(Error("unknown command"))}}else c&&c(Error("command invalid"))};var Ra=function(a){fa.call(this,a);this._data="d2-01-14";this._queryInterval=3E4};Ra.COMMANDS="ch1On ch1Off ch1Toggle ch2On ch2Off ch2Toggle ch3On ch3Off ch3Toggle ch4On ch4Off ch4Toggle ch5On ch5Off ch5Toggle ch6On ch6Off ch6Toggle ch7On ch7Off ch7Toggle ch8On ch8Off ch8Toggle".split(" ");
Ra.STATES="power_failure_detection power_failure over_current_switch_off error_level io_channel local_control output_value output_state ch1_output_value ch1_output_state ch2_output_value ch2_output_state ch3_output_value ch3_output_state ch4_output_value ch4_output_state ch5_output_value ch5_output_state ch6_output_value ch6_output_state ch7_output_value ch7_output_state ch8_output_value ch8_output_state".split(" ");Ra.prototype=new fa;Ra.prototype.constructor=Ra;Ra.prototype._queryStates=function(a,
b){var c=require("x.hub.m.enocean.js")._esp3,d=0,n=this,r=function(){d++;d<a.length?n.statusQuery(c,{IO:a[d]},r):b&&b()};this.statusQuery(c,{IO:a[d]},r)};Ra.prototype.getStatesBuffer=function(){var a=(new Date).getTime(),b=[];this._states.ch1_output_state||(!this._lastQuery[0]||a-this._lastQuery[0]>this._queryInterval)&&b.push(0);this._states.ch2_output_state||(!this._lastQuery[1]||a-this._lastQuery[1]>this._queryInterval)&&b.push(1);this._states.ch3_output_state||(!this._lastQuery[2]||a-this._lastQuery[2]>
this._queryInterval)&&b.push(2);this._states.ch4_output_state||(!this._lastQuery[3]||a-this._lastQuery[3]>this._queryInterval)&&b.push(3);this._states.ch5_output_state||(!this._lastQuery[4]||a-this._lastQuery[4]>this._queryInterval)&&b.push(4);this._states.ch6_output_state||(!this._lastQuery[5]||a-this._lastQuery[5]>this._queryInterval)&&b.push(5);this._states.ch7_output_state||(!this._lastQuery[6]||a-this._lastQuery[6]>this._queryInterval)&&b.push(6);this._states.ch8_output_state||(!this._lastQuery[7]||
a-this._lastQuery[7]>this._queryInterval)&&b.push(7);0<b.length&&this._queryStates(b);return this._states};Ra.prototype.getIOs=function(){return[0,1,2,3,4,5,6,7]};Ra.prototype.evalTelegram=function(a){if(a=fa.prototype.evalTelegram.call(this,a))switch(a.io_channel){case 0:a.ch1_output_value=a.output_value;a.ch1_output_state=a.output_state;break;case 1:a.ch2_output_value=a.output_value;a.ch2_output_state=a.output_state;break;case 2:a.ch3_output_value=a.output_value;a.ch3_output_state=a.output_state;
break;case 3:a.ch4_output_value=a.output_value;a.ch4_output_state=a.output_state;break;case 4:a.ch5_output_value=a.output_value;a.ch5_output_state=a.output_state;break;case 5:a.ch6_output_value=a.output_value;a.ch6_output_state=a.output_state;break;case 6:a.ch7_output_value=a.output_value;a.ch7_output_state=a.output_state;break;case 7:a.ch8_output_value=a.output_value,a.ch8_output_state=a.output_state}return a};Ra.prototype.executeCommand=function(a,b,c){if(b&&b.value){var d=this;switch(b.value?b.value.substr(0,
3):null){case "ch1":var n=0;var r="ch1_output_value";var v="ch1_output_state";break;case "ch2":n=1;r="ch2_output_value";v="ch2_output_state";break;case "ch3":n=2;r="ch3_output_value";v="ch3_output_state";break;case "ch4":n=3;r="ch4_output_value";v="ch4_output_state";break;case "ch5":n=4;r="ch5_output_value";v="ch5_output_state";break;case "ch6":n=5;r="ch6_output_value";v="ch6_output_state";break;case "ch7":n=6;r="ch7_output_value";v="ch7_output_state";break;case "ch8":n=7,r="ch8_output_value",v="ch8_output_state"}switch(b.value){case "ch1On":case "ch2On":case "ch3On":case "ch4On":case "ch5On":case "ch6On":case "ch7On":case "ch8On":var z=
{};z[r]=100;z[v]="on";var F={DV:0,IO:n,OV:100};this.activeStateChange(z);this.setOutput(a,F,c);break;case "ch1Off":case "ch2Off":case "ch3Off":case "ch4Off":case "ch5Off":case "ch6Off":case "ch7Off":case "ch8Off":z={};z[r]=0;z[v]="off";F={DV:0,IO:n,OV:0};this.activeStateChange(z);this.setOutput(a,F,c);break;case "ch1Toggle":case "ch2Toggle":case "ch3Toggle":case "ch4Toggle":case "ch5Toggle":case "ch6Toggle":case "ch7Toggle":case "ch8Toggle":if(!this._states.output_state){this.init(function(){setTimeout(function(){d._states.output_state?
d.executeCommand(a,b,c):c&&c(Error("unkown current status"))},200)});break}if(!this._states[v]){c&&c(Error("state unknown"));break}F="on"==this._states[v].value?"off":"on";z={};z[r]="on"==F?100:0;z[v]=F;F={DV:0,IO:n,OV:"on"==F?100:0};this.activeStateChange(z);this.setOutput(a,F,c);break;default:c&&c(Error("unknown command"))}}else c&&c(Error("command invalid"))};var Mc=function(a){Ea.call(this,a);this._data="d2-05-??"};Mc.prototype=new Ea;Mc.prototype.constructor=Mc;var ta=function(a){Mc.call(this,
a);this._data="d2-05-00"};ta.COMMANDS="moveUp moveDown moveTo stepUp stepDown lamellaUp lamellaDown lamellaTo stop setRunTime setRotationTime setParams[15.2s]:[10,20,30ms]:[0-3]".split(" ");ta.STATES=["state","angle","lock","channel"];ta.prototype=new Mc;ta.prototype.constructor=ta;ta.prototype.init=function(a){var b=require("x.hub.m.enocean.js")._esp3;this.query(b,{CHN:0},a)};ta.prototype.getStatesBuffer=function(){0==Object.keys(this._states).length&&this.init();return this._states};ta.prototype.goToPositionAngle=
function(a,b,c){var d=this._senderID;this._senderID||(d=x.hub.m.enocean.SENDER_ID);b=new Buffer([b.POS&127,b.ANG&127,(b.REPO&7)<<4|b.LOCK&7,(b.CHN&15)<<4|1]);d=new x.hub.m.enocean.ESP3.Telegram.VLD(b,d,0);d.setDstId(this._address);a.sendTelegram(d,!0,function(n){c&&c(n)})};ta.prototype.stop=function(a,b,c){var d=this._senderID;this._senderID||(d=x.hub.m.enocean.SENDER_ID);b=new Buffer([(b.CHN&15)<<4|2]);d=new x.hub.m.enocean.ESP3.Telegram.VLD(b,d,0);d.setDstId(this._address);a.sendTelegram(d,!0,function(n){c&&
c(n)})};ta.prototype.query=function(a,b,c){var d=this._senderID;this._senderID||(d=x.hub.m.enocean.SENDER_ID);b=new Buffer([(b.CHN&15)<<4|3]);d=new x.hub.m.enocean.ESP3.Telegram.VLD(b,d,0);d.setDstId(this._address);a.sendTelegram(d,!0,function(n){c&&c(n)})};ta.prototype.setParameters=function(a,b,c){var d=this._senderID;this._senderID||(d=x.hub.m.enocean.SENDER_ID);b=new Buffer([b.VERT>>8&127,b.VERT&255,b.ROT&255,b.AA&7,(b.CHN&15)<<4|5]);d=new x.hub.m.enocean.ESP3.Telegram.VLD(b,d,0);d.setDstId(this._address);
a.sendTelegram(d,!0,function(n){c&&c(n)})};ta.prototype.evalTelegram=function(a){var b={};if(210==a.rorg)switch(a.userData.readUInt8(a.userData.length-1)&15){case 4:if(4==a.userData.length){var c=a.userData.readUInt8(0);b.state=c&127;c=a.userData.readUInt8(1);b.angle=c&127;c=a.userData.readUInt8(2);switch(c&7){case 0:b.lock="normal";break;case 1:b.lock="blockage_mode";break;case 2:b.lock="alarm_mode"}c=a.userData.readUInt8(3);b.channel=c>>4&15}}return b};ta.prototype.executeCommand=function(a,b,c){if(b&&
b.value){if("moveTo"==b.value.substr(0,6)&&6<b.value.length){var d=b.value.substr(6);b={value:"moveTo",ext:d}}else"lamellaTo"==b.value.substr(0,9)&&9<b.value.length?(d=b.value.substr(9),b={value:"lamellaTo",ext:d}):"setRunTime"==b.value.substr(0,10)&&10<b.value.length?(d=b.value.substr(10),b={value:"setRunTime",ext:d}):"setRotationTime"==b.value.substr(0,15)&&15<b.value.length?(d=b.value.substr(15),b={value:"setRotationTime",ext:d}):"setParams"==b.value.substr(0,9)&&9<b.value.length&&(d=b.value.substr(9),
b={value:"setParams",ext:d});var n=(new Date).getTime(),r=this;switch(b.value){case "moveUp":this.goToPositionAngle(a,{POS:0,ANG:0,REPO:0,LOCK:0,CHN:0},c);break;case "moveDown":this.goToPositionAngle(a,{POS:100,ANG:100,REPO:0,LOCK:0,CHN:0},c);break;case "moveTo":if("undefined"==typeof b.ext||null==b.ext){c&&c(Error("move to value invalid"));break}d=parseFloat(b.ext);0>d&&(d=0);100<d&&(d=100);this._states.state={value:d,time:n};this.goToPositionAngle(a,{POS:d,ANG:255,REPO:0,LOCK:0,CHN:0},c);break;
case "stepUp":if(!this._states.state){this.init(function(){setTimeout(function(){r._states.state?r.executeCommand(a,b,c):c&&c(Error("get device status failed"))},200)});break}if(255==this._states.state.value||255==this._states.angle.value){c&&c(Error("device status unknonw"));break}0!=this._states.angle.value?(d=this._states.angle.value-10,0>d&&(d=0),this._states.angle={value:d,time:n},this.goToPositionAngle(a,{POS:255,ANG:d,REPO:0,LOCK:0,CHN:0},c)):(d=this._states.state.value-5,0>d&&(d=0),this._states.state=
{value:d,time:n},this.goToPositionAngle(a,{POS:d,ANG:0,REPO:0,LOCK:0,CHN:0},c));break;case "stepDown":if(!this._states.state){this.init(function(){setTimeout(function(){r._states.state?r.executeCommand(a,b,c):c&&c(Error("get device status failed"))},200)});break}if(255==this._states.state.value||255==this._states.angle.value){c&&c(Error("device status unknonw"));break}100!=this._states.angle.value?(d=this._states.angle.value+10,100<d&&(d=100),this._states.angle={value:d,time:n},this.goToPositionAngle(a,
{POS:255,ANG:d,REPO:0,LOCK:0,CHN:0},c)):(d=this._states.state.value+5,100<d&&(d=100),this._states.state={value:d,time:n},this.goToPositionAngle(a,{POS:d,ANG:100,REPO:0,LOCK:0,CHN:0},c));break;case "lamellaUp":this.goToPositionAngle(a,{POS:255,ANG:0,REPO:0,LOCK:0,CHN:0},c);break;case "lamellaDown":this.goToPositionAngle(a,{POS:255,ANG:100,REPO:0,LOCK:0,CHN:0},c);break;case "lamellaTo":if("undefined"==typeof b.ext||null==b.ext){c&&c(Error("lamella to value invalid"));break}d=parseFloat(b.ext);0>d&&
(d=0);100<d&&(d=100);this._states.angle={value:d,time:n};this.goToPositionAngle(a,{POS:255,ANG:d,REPO:0,LOCK:0,CHN:0},c);break;case "stop":this.stop(a,{CHN:0},c);break;case "setRunTime":if(!b.ext){c&&c(Error("parameters is null"));break}d=100*parseFloat(b.ext);499>=d&&(d=500);this.setParameters(a,{VERT:d,ROT:255,AA:7,CHN:0},c);break;case "setRotationTime":if(!b.ext){c&&c(Error("parameters is null"));break}d=32767;n=parseInt(b.ext)/10;this.setParameters(a,{VERT:d,ROT:n,AA:7,CHN:0},c);break;case "setParams":if(!b.ext){c&&
c(Error("parameters is null"));break}var v=b.ext.split(":");if(3!=v.length){c&&c(Error("parameters format invalid"));break}d=v[0]?100*parseFloat(v[0]):32767;499>=d&&(d=32767);n=v[1]?parseInt(v[1])/10:255;v=v[2]?parseInt(v[2]):7;this.setParameters(a,{VERT:d,ROT:n,AA:v,CHN:0},c);break;default:c&&c(Error("unknow command"))}}else c&&c(Error("command invalid"))};var Sa=function(a){ta.call(this,a);this._data="d2-05-01";this._ch1QueryCount=0;this._ch1QueryTO=null;this._ch1QueryTimestamp=0};Sa.COMMANDS="ch1moveUp ch1moveDown ch1moveTo ch1stepUp ch1stepDown ch1lamellaUp ch1lamellaDown ch1lamellaTo ch1stop ch2moveUp ch2moveDown ch2moveTo ch2stepUp ch2stepDown ch2lamellaUp ch2lamellaDown ch2lamellaTo ch2stop ch3moveUp ch3moveDown ch3moveTo ch3stepUp ch3stepDown ch3lamellaUp ch3lamellaDown ch3lamellaTo ch3stop ch4moveUp ch4moveDown ch4moveTo ch4stepUp ch4stepDown ch4lamellaUp ch4lamellaDown ch4lamellaTo ch4stop ch1setRunTime ch2setRunTime ch3setRunTime ch4setRunTime ch1setRotationTime ch2setRotationTime ch3setRotationTime ch4setRotationTime ch1setParams[15.2s]:[10,20,30ms]:[0-3] ch2setParams ch3setParams ch4setParams".split(" ");
Sa.STATES="ch1state ch1angle ch1lock ch2state ch2angle ch2lock ch3state ch3angle ch3lock ch4state ch4angle ch4lock channel".split(" ");Sa.prototype=new ta;Sa.prototype.constructor=Sa;Sa.prototype.init=function(a){this._queryStates([0,1,2,3],a)};Sa.prototype.getStatesBuffer=function(){var a=[];this._states.ch1state||a.push(0);this._states.ch2state||a.push(1);this._states.ch3state||a.push(2);this._states.ch4state||a.push(3);0<a.length&&this._queryStates(a);return this._states};Sa.prototype._queryStates=
function(a,b){var c=require("x.hub.m.enocean.js")._esp3,d=0,n=this,r=function(){d++;d<a.length?n.query(c,{CHN:a[d]},r):b&&b()};this.query(c,{CHN:a[d]},r)};Sa.prototype.evalTelegram=function(a){if(a=ta.prototype.evalTelegram.call(this,a))switch(a.channel){case 0:a.ch1state=a.state;a.ch1angle=a.angle;a.ch1lock=a.lock;break;case 1:a.ch2state=a.state;a.ch2angle=a.angle;a.ch2lock=a.lock;break;case 2:a.ch3state=a.state;a.ch3angle=a.angle;a.ch3lock=a.lock;break;case 3:a.ch4state=a.state,a.ch4angle=a.angle,
a.ch4lock=a.lock}return a};Sa.prototype.executeCommand=function(a,b,c){if(b&&b.value){b=JSON.parse(JSON.stringify(b));var d=null;switch(b.value.substr(0,3)){case "ch1":d=0;var n="ch1state";var r="ch1angle";break;case "ch2":d=1;n="ch2state";r="ch2angle";break;case "ch3":d=2;n="ch3state";r="ch3angle";break;case "ch4":d=3;n="ch4state";r="ch4angle";break;default:c&&c(Error("unknown command"))}b.value=b.value.substr(3);if("moveTo"==b.value.substr(0,6)&&6<b.value.length){var v=b.value.substr(6);b={value:"moveTo",
ext:v}}else"lamellaTo"==b.value.substr(0,9)&&9<b.value.length?(v=b.value.substr(9),b={value:"lamellaTo",ext:v}):"setRunTime"==b.value.substr(0,10)&&10<b.value.length?(v=b.value.substr(10),b={value:"setRunTime",ext:v}):"setRotationTime"==b.value.substr(0,15)&&15<b.value.length?(v=b.value.substr(15),b={value:"setRotationTime",ext:v}):"setParams"==b.value.substr(0,9)&&9<b.value.length&&(v=b.value.substr(9),b={value:"setParams",ext:v});(new Date).getTime();var z=this;switch(b.value){case "moveUp":this.goToPositionAngle(a,
{POS:0,ANG:0,REPO:0,LOCK:0,CHN:d},c);break;case "moveDown":this.goToPositionAngle(a,{POS:100,ANG:100,REPO:0,LOCK:0,CHN:d},c);break;case "moveTo":if("undefined"==typeof b.ext||null==b.ext){c&&c(Error("move to value invalid"));break}v=parseFloat(b.ext);0>v&&(v=0);100<v&&(v=100);var F={};F[n]=v;this.activeStateChange(F);this.goToPositionAngle(a,{POS:v,ANG:255,REPO:0,LOCK:0,CHN:d},c);break;case "stepUp":if(!this._states[n]){this.init(function(){setTimeout(function(){z._states[n]?z.executeCommand(a,b,
c):c&&c(Error("get device status failed"))},200)});break}if(255==this._states[n].value||255==this._states[r].value){c&&c(Error("device status unknonw"));break}0!=this._states[r].value?(v=this._states[r].value-10,0>v&&(v=0),F={},F[r]=v,this.activeStateChange(F),this.goToPositionAngle(a,{POS:255,ANG:v,REPO:0,LOCK:0,CHN:d},c)):(v=this._states[n].value-5,0>v&&(v=0),F={},F[n]=v,this.activeStateChange(F),this.goToPositionAngle(a,{POS:v,ANG:0,REPO:0,LOCK:0,CHN:d},c));break;case "stepDown":if(!this._states[n]){this.init(function(){setTimeout(function(){z._states[n]?
z.executeCommand(a,b,c):c&&c(Error("get device status failed"))},200)});break}if(255==this._states[n].value||255==this._states[r].value){c&&c(Error("device status unknonw"));break}100!=this._states[r].value?(v=this._states[r].value+10,100<v&&(v=100),F={},F[r]=v,this.activeStateChange(F),this.goToPositionAngle(a,{POS:255,ANG:v,REPO:0,LOCK:0,CHN:d},c)):(v=this._states[n].value+5,100<v&&(v=100),F={},F[n]=v,this.activeStateChange(F),this.goToPositionAngle(a,{POS:v,ANG:100,REPO:0,LOCK:0,CHN:d},c));break;
case "lamellaUp":this.goToPositionAngle(a,{POS:255,ANG:0,REPO:0,LOCK:0,CHN:d},c);break;case "lamellaDown":this.goToPositionAngle(a,{POS:255,ANG:100,REPO:0,LOCK:0,CHN:d},c);break;case "lamellaTo":if("undefined"==typeof b.ext||null==b.ext){c&&c(Error("lamella to value invalid"));break}v=parseFloat(b.ext);0>v&&(v=0);100<v&&(v=100);F={};F[r]=v;this.goToPositionAngle(a,{POS:255,ANG:v,REPO:0,LOCK:0,CHN:d},c);break;case "stop":this.stop(a,{CHN:d},c);break;case "setRunTime":if(!b.ext){c&&c(Error("parameters is null"));
break}r=100*parseFloat(b.ext);499>=r&&(r=500);this.setParameters(a,{VERT:r,ROT:255,AA:7,CHN:d},c);break;case "setRotationTime":if(!b.ext){c&&c(Error("parameters is null"));break}r=32767;F=parseInt(b.ext)/10;this.setParameters(a,{VERT:r,ROT:F,AA:7,CHN:d},c);break;case "setParams":if(!b.ext){c&&c(Error("parameters is null"));break}v=b.ext.split(":");if(3!=v.length){c&&c(Error("parameters format invalid"));break}r=v[0]?100*parseFloat(v[0]):32767;499>=r&&(r=32767);F=v[1]?parseInt(v[1])/10:255;v=v[2]?
parseInt(v[2]):7;this.setParameters(a,{VERT:r,ROT:F,AA:v,CHN:d},c);break;default:c&&c(Error("unknow command"))}}else c&&c(Error("command invalid"))};var Nc=function(a){Ea.call(this,a);this._data="d2-06-??"};Nc.prototype=new Ea;Nc.prototype.constructor=Nc;var Xa=function(a){Ea.call(this,a);this._data="d2-06-01";this._states={pending:{value:!1,time:(new Date).getTime()}};this._vbir_new=this._suir_new=this._blcr_new=this._hccr_new=this._vacation_new=null};Xa.COMMANDS="vacationOn vacationOff handleClosedClickOn handleClosedClickOff batteryLowClickOn batteryLowClickOff setSensorUpdateInterval setVacationBlinkInterval".split(" ");
Xa.STATES="bal ppal state handle window br bl motion vacation temperature humidity illumination battery hccr blcr suir vbir".split(" ");Xa.prototype=new Nc;Xa.prototype.constructor=Xa;Xa.prototype.executeCommand=function(a,b,c){a=(new Date).getTime();if(b&&b.value){"setSensorUpdateInterval"==b.value.substr(0,23)&&23<b.value.length?(b=b.value.substr(23),b={value:"setSensorUpdateInterval",ext:b}):"setVacationBlinkInterval"==b.value.substr(0,24)&&24<b.value.length&&(b=b.value.substr(24),b={value:"setVacationBlinkInterval",
ext:b});switch(b.value){case "vacationOn":this._vacation_new="on";this._states.pending={value:!0,time:a};this.activeStateChange({vacation:"on"});break;case "vacationOff":this._vacation_new="off";this._states.pending={value:!0,time:a};this.activeStateChange({vacation:"off"});break;case "handleClosedClickOn":this._hccr_new="on";this._states.pending={value:!0,time:a};this.activeStateChange({hccr:"on"});break;case "handleClosedClickOff":this._hccr_new="off";this._states.pending={value:!0,time:a};this.activeStateChange({hccr:"off"});
break;case "batteryLowClickOn":this._blcr_new="on";this._states.pending={value:!0,time:a};this.activeStateChange({blcr:"on"});break;case "batteryLowClickOff":this._blcr_new="off";this._states.pending={value:!0,time:a};this.activeStateChange({blcr:"off"});break;case "setSensorUpdateInterval":if("undefined"==typeof b.ext||null==b.ext){c&&c(Error("set sensor update interval value invalid"));return}b=parseInt(b.ext);5>b&&(b=5);65535<b&&(b=65535);this._suir_new=b;this._states.pending={value:!0,time:a};
this.activeStateChange({suir:b});break;case "setVacationBlinkInterval":if("undefined"==typeof b.ext||null==b.ext){c&&c(Error("set vacation blink interval value invalid"));return}b=parseInt(b.ext);3>b&&(b=3);255<b&&(b=255);this._vbir_new=b;this._states.pending={value:!0,time:a};this.activeStateChange({vbir:b})}c&&c()}else c&&c(Error("command invalid"))};Xa.prototype.evalData=function(a,b,c){var d=this.evalTelegram(b);this._vacation_new&&delete d.vacation;this._hccr_new&&delete d.hccr;this._blcr_new&&
delete d.blcr;this._suir_new&&delete d.suir;this._vbir_new&&delete d.vbir;210==b.rorg&&0==b.userData.readUInt8(0)&&this._sendResponse(a);d?(a=this.checkStateChange(d),c&&c(null,a)):c&&c(Error("data format invalid"))};Xa.prototype.evalTelegram=function(a){var b={};if(210==a.rorg)switch(a.userData.readUInt8(0)){case 0:var c=a.userData.readUInt8(1);var d=a.userData.readUInt8(2);var n=a.userData.readUInt8(3);var r=a.userData.readUInt8(4);var v=a.userData.readUInt8(5);var z=a.userData.readUInt8(6);var F=
a.userData.readUInt16BE(7);a=a.userData.readUInt8(9);a=a>>3&31;switch(c>>4&15){case 0:b.bal="ok";break;case 1:b.bal="alarm";break;case 14:b.bal="invalid";break;case 15:b.bal="unsupported"}switch(c&15){case 0:b.ppal="ok";break;case 1:b.ppal="alarm";break;case 14:b.ppal="invalid";break;case 15:b.ppal="unsupported"}switch(d>>4&15){case 0:b.handle="undefined";break;case 1:b.handle="up";break;case 2:b.handle="down";break;case 3:b.handle="left";break;case 4:b.handle="right";break;case 14:b.handle="invalid";
break;case 15:b.handle="unsupported"}switch(d&15){case 0:b.window="undefined";break;case 1:b.window="not_tilted";break;case 2:b.window="tilted";break;case 14:b.window="invalid";break;case 15:b.window="unsupported"}switch(n>>4&15){case 0:b.br="unchanged";break;case 1:b.br="pressed";break;case 2:b.br="releaseed";break;case 14:b.br="invalid";break;case 15:b.br="unsupported"}switch(n&15){case 0:b.bl="unchanged";break;case 1:b.bl="pressed";break;case 2:b.bl="releaseed";break;case 14:b.bl="invalid";break;
case 15:b.bl="unsupported"}switch(r>>4&15){case 0:b.motion="ok";break;case 1:b.motion="alarm";break;case 14:b.motion="invalid";break;case 15:b.motion="unsupported"}switch(r&15){case 0:b.vacation="unchanged";break;case 1:b.vacation="on";break;case 2:b.vacation="off";break;case 14:b.vacation="invalid";break;case 15:b.vacation="unsupported"}254==v?b.temperature="invalid":255==v?b.temperature="unsupported":250>=v&&(b.temperature=parseFloat((v/250*80-20).toFixed(2)));254==z?b.humidity="invalid":255==z?
b.humidity="unsupported":200>=z&&(b.humidity=parseFloat((z/2).toFixed(1)));65534==F?b.illumination="invalid":65535==F?b.illumination="unsupported":60001==F?b.illumination="over_range":6E4>=F&&(b.illumination=F);20>=a&&(b.battery=5*a);if("undefined"==b.window||"invalid"==b.window||"unsupported"==b.window||"not_tilted"==b.window)switch(b.handle){case "undefined":b.state="undefined";break;case "up":b.state="tilted";break;case "down":b.state="closed";break;case "left":b.state="open";break;case "right":b.state=
"open";break;case "invalid":b.state="invalid";break;case "unsupported":b.state="undefined"}else"tilted"==b.window&&(b.state="tilted");break;case 16:z=a.userData.readUInt8(1),F=a.userData.readUInt16BE(2),a=a.userData.readUInt8(4),c=F,d=a,b.vacation=z>>7&1?"on":"off",b.hccr=z>>6&1?"on":"off",b.blcr=z>>5&1?"on":"off",5<=c&&(b.suir=c),3<=d&&(b.vbir=d)}return b};Xa.prototype._sendResponse=function(a,b){var c=0;this._vacation_new&&"on"==this._vacation_new&&(c=1);var d=0;this._hccr_new&&"off"==this._hccr_new?
d=1:this._hccr_new&&"on"==this._hccr_new&&(d=2);var n=0;this._blcr_new&&"off"==this._blcr_new?n=1:this._blcr_new&&"on"==this._blcr_new&&(n=2);var r=0;this._suir_new&&(r=this._suir_new);var v=0;this._vbir_new&&(v=this._vbir_new);var z=new Buffer([128,128|(c&1)<<5|(d&3)<<3|(n&3)<<1,r>>8&255,r&255,v]),F=this._senderID;F||(F=x.hub.m.enocean.SENDER_ID);z=new x.hub.m.enocean.ESP3.Telegram.VLD(z,F,0);var P=this;a.sendTelegram(z,!0,function(U){P._vacation_new=null;P._hccr_new=null;P._blcr_new=null;P._suir_new=
null;P._vbir_new=null;var B={pending:!1};B.vacation=c?"on":"off";d&&(B.hccr=1==d?"off":"on");n&&(B.blcr=1==n?"off":"on");r&&(B.suir=r);v&&(B.vbir=v);P.activeStateChange(B);b&&b(U)})};var Ya=function(a){Ea.call(this,a);this._data="d2-06-02";this._states={pending:{value:!1,time:(new Date).getTime()}};this._vbis_new=this._suis_new=this._blcs_new=this._lacs_new=this._vacation_new=null};Ya.COMMANDS="vacationOn vacationOff lockActiveClickOn lockActiveClickOff batteryLowClickOn batteryLowClickOff setSensorUpdateInterval setVacationBlinkInterval".split(" ");
Ya.STATES="operation_mode handle window state temperature humidity battery vacation hccr blcr suir vbir".split(" ");Ya.prototype=new Nc;Ya.prototype.constructor=Ya;Ya.prototype.executeCommand=function(a,b,c){a=(new Date).getTime();if(b&&b.value){"setSensorUpdateInterval"==b.value.substr(0,23)&&23<b.value.length?(b=b.value.substr(23),b={value:"setSensorUpdateInterval",ext:b}):"setVacationBlinkInterval"==b.value.substr(0,24)&&24<b.value.length&&(b=b.value.substr(24),b={value:"setVacationBlinkInterval",
ext:b});switch(b.value){case "vacationOn":this._vacation_new="on";this._states.pending={value:!0,time:a};this.activeStateChange({vacation:"on"});break;case "vacationOff":this._vacation_new="off";this._states.pending={value:!0,time:a};this.activeStateChange({vacation:"off"});break;case "lockActiveClickOn":this._lacs_new="on";this._states.pending={value:!0,time:a};this.activeStateChange({hccr:"on"});break;case "lockActiveClickOff":this._lacs_new="off";this._states.pending={value:!0,time:a};this.activeStateChange({hccr:"off"});
break;case "batteryLowClickOn":this._blcs_new="on";this._states.pending={value:!0,time:a};this.activeStateChange({blcr:"on"});break;case "batteryLowClickOff":this._blcs_new="off";this._states.pending={value:!0,time:a};this.activeStateChange({blcr:"off"});break;case "setSensorUpdateInterval":if("undefined"==typeof b.ext||null==b.ext){c&&c(Error("set sensor update interval value invalid"));return}b=parseInt(b.ext);5>b&&(b=5);65535<b&&(b=65535);this._suis_new=b;this._states.pending={value:!0,time:a};
this.activeStateChange({suir:b});break;case "setVacationBlinkInterval":if("undefined"==typeof b.ext||null==b.ext){c&&c(Error("set vacation blink interval value invalid"));return}b=parseInt(b.ext);3>b&&(b=3);255<b&&(b=255);this._vbis_new=b;this._states.pending={value:!0,time:a};this.activeStateChange({vbir:b})}c&&c()}else c&&c(Error("command invalid"))};Ya.prototype.evalData=function(a,b,c){var d=this.evalTelegram(b);this._vacation_new&&delete d.vacation;this._lacs_new&&delete d.hccr;this._blcs_new&&
delete d.blcr;this._suis_new&&delete d.suir;this._vbis_new&&delete d.vbir;210==b.rorg&&0==b.userData.readUInt8(0)&&this._sendResponse(a);d?(a=this.checkStateChange(d),c&&c(null,a)):c&&c(Error("data format invalid"))};Ya.prototype.evalTelegram=function(a){var b={};if(210==a.rorg)switch(a.userData.readUInt8(0)){case 0:var c=a.userData.readUInt8(1);var d=a.userData.readUInt8(2);var n=a.userData.readUInt8(3);a=a.userData.readUInt8(4);a=a>>3&31;switch(c>>6&3){case 0:b.operation_mode="standard";break;case 1:b.operation_mode=
"hst"}switch(c>>4&3){case 0:b.lock="unlocked";break;case 1:b.lock="locked"}switch(c>>2&3){case 0:b.window="not_tilted";break;case 1:b.window="tilted"}switch(c&3){case 0:b.alarm="ok";break;case 1:b.alarm="burglary_alarm";break;case 2:b.alarm="unlock_alarm"}254==d?b.temperature="invalid":255==d?b.temperature="unsupported":250>=d&&(b.temperature=parseFloat((d/250*80-20).toFixed(2)));254==n?b.humidity="invalid":255==n?b.humidity="unsupported":200>=n&&(b.humidity=parseFloat((n/2).toFixed(1)));20>=a&&(b.battery=
5*a);if("tilted"==b.window)b.state="tilted";else switch(b.lock){case "unlocked":b.state="open";break;case "locked":b.state="closed"}break;case 16:c=a.userData.readUInt8(1),d=a.userData.readUInt16BE(2),n=a=a.userData.readUInt8(4),b.vacation=c>>7&1?"on":"off",b.hccr=c>>6&1?"on":"off",b.blcr=c>>5&1?"on":"off",5<=d&&(b.suir=d),3<=n&&(b.vbir=n)}return b};Ya.prototype._sendResponse=function(a,b){var c=0;this._vacation_new&&"on"==this._vacation_new?c=1:this._vacation_new&&"off"==this._vacation_new&&(c=2);
var d=0;this._lacs_new&&"off"==this._lacs_new?d=1:this._lacs_new&&"on"==this._lacs_new&&(d=2);var n=0;this._blcs_new&&"off"==this._blcs_new?n=1:this._blcs_new&&"on"==this._blcs_new&&(n=2);var r=0;this._suis_new&&(r=this._suis_new);var v=0;this._vbis_new&&(v=this._vbis_new);var z=new Buffer([128,128|(c&3)<<4|(d&3)<<2|n&3,r>>8&255,r&255,v]),F=this._senderID;F||(F=x.hub.m.enocean.SENDER_ID);z=new x.hub.m.enocean.ESP3.Telegram.VLD(z,F,0);var P=this;a.sendTelegram(z,!0,function(U){P._vacation_new=null;
P._lacs_new=null;P._blcs_new=null;P._suis_new=null;P._vbis_new=null;var B={pending:!1};B.vacation=c?"on":"off";d&&(B.hccr=1==d?"off":"on");n&&(B.blcr=1==n?"off":"on");r&&(B.suir=r);v&&(B.vbir=v);P.activeStateChange(B);b&&b(U)})};var Oc=function(a){Ea.call(this,a);this._data="d2-20-??"};Oc.prototype=new Ea;Oc.prototype.constructor=Oc;var Aa=function(a){Oc.call(this,a);this._data="d2-20-00";this._poller=null;this._pollInterval=6E4};Aa.COMMANDS="setFanLevel fanLevelUp fanLevelDown requestStatus setHumLevel setCo2Level".split(" ");
Aa.STATES="filter_remaining_time operating_time temperature message_code anti_freeze current_fan_level set_fan_level".split(" ");Aa.prototype=new Oc;Aa.prototype.constructor=Aa;Aa.prototype.init=function(a){var b=this;setTimeout(function(){var c=require("x.hub.m.enocean.js")._esp3;b.executeCommand(c,{value:"requestStatus"},a);b._restartPoller(c)},Math.floor(6E3*Math.random())+1E3)};Aa.prototype.finalize=function(a){this._poller&&clearInterval(this._poller);a&&a()};Aa.prototype._restartPoller=function(a){this._poller&&
clearInterval(this._poller);var b=this;this._poller=setInterval(function(){b.executeCommand(a,{value:"requestStatus"})},this._pollInterval)};Aa.prototype.executeCommand=function(a,b,c){(new Date).getTime();if(b&&b.value){if("setFanLevel"==b.value.substr(0,11)&&11<b.value.length)b=b.value.substr(11),b={value:"setFanLevel",ext:b};else if("fanLevelUp"==b.value){var d=this.getBufferedState("set_fan_level");if("undefined"==typeof d||null==d){c&&c(Error("fanLevelUp unknown current fan level"));return}if(6==
d){c&&c();return}b={value:"setFanLevel",ext:d+1}}else if("fanLevelDown"==b.value){d=this.getBufferedState("set_fan_level");if("undefined"==typeof d||null==d){c&&c(Error("fanLevelUp unknown current fan level"));return}if(0==d){c&&c();return}b={value:"setFanLevel",ext:d-1}}else if("setHumLevel"==b.value.substr(0,11)&&11<b.value.length){d=this.getBufferedState("set_fan_level");if(5!=d){c&&c(Error("humidity regulation not active"));return}b=b.value.substr(11);b={value:"setHumLevel",ext:b}}else if("setCo2Level"==
b.value.substr(0,11)&&11<b.value.length){d=this.getBufferedState("set_fan_level");if(6!=d){c&&c(Error("co2 regulation not active"));return}b=b.value.substr(11);b={value:"setCo2Level",ext:b}}var n=this;switch(b.value){case "setFanLevel":if("undefined"==typeof b.ext||null==b.ext){c&&c(Error("setFanLevel value invalid"));break}var r=parseInt(b.ext);if(0>r||6<r){c&&c(Error("setFanLevel value invalid"));break}if(5==r||6==r){this.activeStateChange({set_fan_level:r});this._activateSensorRegulation(r);c&&
c();break}this._deactivateSensorRegulation();this._sendResponse(a,{LS:r,RS:1},function(v){v||n.activeStateChange({set_fan_level:r});n._restartPoller(a);c&&c(v)});break;case "setHumLevel":if("undefined"==typeof b.ext||null==b.ext){c&&c(Error("setHumLevel value invalid"));break}r=parseInt(b.ext);if(0>r||4<r){c&&c(Error("setHumLevel value invalid"));break}this._sendResponse(a,{LS:r,RS:1},function(v){n._restartPoller(a);c&&c(v)});break;case "setCo2Level":if("undefined"==typeof b.ext||null==b.ext){c&&
c(Error("setCo2Level value invalid"));break}r=parseInt(b.ext);if(0>r||4<r){c&&c(Error("setCo2Level value invalid"));break}this._sendResponse(a,{LS:r,RS:1},function(v){n._restartPoller(a);c&&c(v)});break;case "requestStatus":this._sendResponse(a,{LS:5,RS:1},function(v){c&&c(v)});break;default:c&&c(Error("unknown command"))}}else c&&c(Error("command invalid"))};Aa.prototype.evalData=function(a,b,c){a=this.evalTelegram(b);this._states&&this._states.set_fan_level||(a.set_fan_level=a.current_fan_level);
this._states&&this._states.set_fan_level&&5!=this._states.set_fan_level.value&&6!=this._states.set_fan_level.value&&(a.set_fan_level=a.current_fan_level);a=this.checkStateChange(a);c&&c(null,a)};Aa.prototype.evalTelegram=function(a){var b={};if(210==a.rorg)if(1==a.userData.length){var c=a.userData.readUInt8(0)&7;b.current_fan_level=c}else{c=a.userData.readUInt8(0);var d=a.userData.readUInt8(1),n=a.userData.readUInt16LE(2),r=a.userData.readUInt8(4),v=a.userData.readUInt8(5),z=a.userData.readUInt8(6),
F=a.userData.readUInt16LE(7),P=a.userData.readUInt8(9),U=a.userData.readUInt8(10),B=a.userData.readInt16BE(11);a=a.userData.readUInt8(13);b.filter_remaining_time=r+":"+n+":"+d+":"+c;b.operating_time=P+":"+F+":"+z+":"+v;b.temperature=B/10;b.message_code=U;b.anti_freeze=a>>4&1?"on":"off";b.current_fan_level=a&7}return b};Aa.prototype._sendResponse=function(a,b,c){var d=this._senderID;this._senderID||(d=x.hub.m.enocean.SENDER_ID);b=new Buffer([b.LS,b.RS]);d=new x.hub.m.enocean.ESP3.Telegram.VLD(b,d,
0);this._senderID!=this._address&&d.setDstId(this._address);a.sendTelegram(d,!0,function(n){c&&c(n)})};Aa.prototype._activateSensorRegulation=function(a){var b=require("x.hub.m.enocean.js").getRehauHandler();b&&b.activateSensorRegulation(this.getAddress(),a)};Aa.prototype._deactivateSensorRegulation=function(){var a=require("x.hub.m.enocean.js").getRehauHandler();a&&a.deactivateSensorRegulation(this.getAddress())};var kc=function(a){ca.call(this,a);this._data="eltako_contact";this._vendor="eltako";
this._eepAlias="f6-10-00"};kc.STATES=["contact","contact_raw"];kc.prototype=new ca;kc.prototype.constructor=kc;kc.prototype.evalTelegram=function(a){var b={};246==a.rorg&&(a=a.userData,240==a?b.contact="closed":224==a&&(b.contact="open"),b.contact_raw=a);return b};var ib=function(a){qb.call(this,a);this._data="eltako_motion";this._vendor="eltako";this._eepAlias="a5-08-01"};ib.STATES="voltage voltage_raw illumination illumination_raw state state_raw".split(" ");ib.prototype=new qb;ib.prototype.constructor=
ib;ib.prototype.evalTelegram=function(a){var b={};if(165==a.rorg){var c=a.userData.readUInt8(3);a.userData.readUInt8(2);var d=a.userData.readUInt8(1);a=a.userData.readUInt8(0);if(1==(c>>3&1)){b.voltage=parseFloat((a/255*5.1).toFixed(1));b.voltage_raw=a;b.illumination=parseFloat((d/255*2048).toFixed(1));b.illumination_raw=d;c=c>>1&1;switch(c){case 0:b.state="on";break;case 1:b.state="off"}b.state_raw=c}}return b};var Ha=function(a){la.call(this,a);this._data="eltako_switch";this._vendor="eltako";this._eepAlias=
"f6-02-01"};Ha.COMMANDS=["on","off","toggle"];Ha.STATES=["state"];Ha.prototype=new la;Ha.prototype.constructor=Ha;Ha.prototype.getTeachinType=function(){return"4BS"};Ha.prototype.handleLearnTelegram=function(a,b){if(b&&246==b.rorg)require("x.hub.m.enocean.js")._deviceHandler.onLearnDevice({address:a._learnAddress,senderID:a._learnSenderID,data:a._learnProfile,vendor:a._learnVendor},{address:b.senderID,senderID:a._learnSenderID,data:this._data,vendor:this._vendor},function(c,d){a._learnFinish(c,0,
d)})};Ha.prototype.getTeachinTelegram=function(a,b,c){a=new Buffer([224,64,13,128]);return new x.hub.m.enocean.ESP3.Telegram.BS4(a,b,0)};Ha.prototype.evalTelegram=function(a){var b={};if(246==a.rorg)switch(a.userData){case 112:b.state="on";break;case 80:b.state="off"}return b};Ha.prototype.executeCommand=function(a,b,c){if(b&&b.value)switch((new Date).getTime(),b.value){case "on":this.switching(a,{TIM:0,LCK:0,DEL:0,SW:1},function(d){c&&c(d)});break;case "off":this.switching(a,{TIM:0,LCK:0,DEL:0,SW:0},
function(d){c&&c(d)});break;case "toggle":if(!this._states.state){c&&c(Error("unknow previous switch state"));break}"on"==this._states.state.value?this.executeCommand(a,{value:"off"},c):this.executeCommand(a,{value:"on"},c);break;default:c&&c(Error("unknow command"))}else c&&c(Error("command invalid"))};var bd=function(){var a=function(b){Ha.call(this,b);this.TEACH_IN_VARIATION=3;this._data="eltako_tf_switch"};a.prototype=new Ha;a.prototype.constructor=a;a.prototype.handleTeachinTelegram=function(b,
c){if(c&&165==c.rorg&&c.userData){var d=c.userData.toString("hex"),n=b._teachSenderID;if(d&&n&&n.substr(2)==d.substr(0,6))require("x.hub.m.enocean.js")._deviceHandler.onLearnDevice({address:b._teachID,senderID:b._teachSenderID,data:b._teachProfile,vendor:b._teachVendor},{address:c.senderID,senderID:b._teachSenderID,data:b._teachProfile,vendor:b._teachVendor},function(r,v){b._teachFinish(r,v)})}};return a}(),ja=function(a){la.call(this,a);this._data="eltako_dimmer";this._vendor="eltako";this._eepAlias=
"a5-38-08";this._lastOnLevel=-1};ja.COMMANDS="on off toggle dimTo dimUp dimDown toggleTo setRampTime".split(" ");ja.STATES=["state","level","ramp_time"];ja.prototype=new la;ja.prototype.constructor=ja;ja.prototype.setDefaultParams=function(){this._params||(this._params={});if("undefined"==typeof this._params.ramp_time||null==this._params.ramp_time)this._params.ramp_time=0};ja.prototype.handleLearnTelegram=function(a,b){if(b&&165==b.rorg)require("x.hub.m.enocean.js")._deviceHandler.onLearnDevice({address:a._learnAddress,
senderID:a._learnSenderID,data:a._learnProfile,vendor:a._learnVendor},{address:b.senderID,senderID:a._learnSenderID,data:this._data,vendor:this._vendor},function(c,d){a._learnFinish(c,0,d)})};ja.prototype.getTeachinTelegram=function(a,b,c){a=new Buffer([224,64,13,128]);return new x.hub.m.enocean.ESP3.Telegram.BS4(a,b,0)};ja.prototype.getStatesBuffer=function(){var a=JSON.parse(JSON.stringify(this._states));a.ramp_time={value:this._params.ramp_time,time:-1};return a};ja.prototype.getCurrentStates=
function(){var a={},b=this.getStatesBuffer();b.level&&0==b.level.value&&b.state&&(b.state.value="off");b.state&&"off"==b.state.value&&b.level&&(b.level.value=0);for(var c in b)b.hasOwnProperty(c)&&b[c]&&(a[c]=b[c].value);return a};ja.prototype.evalData=function(a,b,c){(a=this.evalTelegram(b))?(0==a.level&&(a.state="off"),"off"==a.state&&(a.level=0),(0==a.level||"off"==a.state)&&this._states.level&&this._states.level.value&&(this._lastOnLevel=this._states.level.value),a=this.checkStateChange(a),c&&
c(null,a)):c&&c(Error("data format invalid"))};ja.prototype.evalTelegram=function(a){var b={};if(165==a.rorg){var c=a.userData.readUInt8(3),d=a.userData.readUInt8(2),n=a.userData.readUInt8(1);a=a.userData.readUInt8(0);if(1==(c>>3&1))switch(a){case 2:b.level=n,b.ramp=d,b.dim_range=c>>2&1?"relative":"absolute",b.store_final_value=c>>1&1,b.state=c&1?"on":"off"}}return b};ja.prototype.executeCommand=function(a,b,c){if(b&&b.value){if("dimTo"==b.value.substr(0,5)&&5<b.value.length){var d=b.value.substr(5);
b={value:"dimTo",ext:d}}else"toggleTo"==b.value.substr(0,8)&&8<b.value.length?(d=b.value.substr(8),b={value:"toggleTo",ext:d}):"setRampTime"==b.value.substr(0,11)&&11<b.value.length&&(d=b.value.substr(11),b={value:"setRampTime",ext:d});(new Date).getTime();var n=this;switch(b.value){case "on":d=this._lastOnLevel;if(-1==d||0==d)d=100;this.dimming(a,{EDIM:d,RMP:this._params.ramp_time,EDIMR:0,STR:0,SW:1},function(r){r||n.activeStateChange({level:d,state:"on"});c&&c(r)});break;case "off":this._states.level&&
this._states.level.value&&(this._lastOnLevel=this._states.level.value);this.dimming(a,{EDIM:0,RMP:this._params.ramp_time,EDIMR:0,STR:0,SW:0},function(r){r||n.activeStateChange({level:0,state:"off"});c&&c(r)});break;case "toggle":if(!this._states.state){c&&c(Error("unknow previous dimmer state"));break}"on"==this._states.state.value?this.executeCommand(a,{value:"off"},c):this.executeCommand(a,{value:"on"},c);break;case "toggleTo":if(!this._states.state){c&&c(Error("unknow previous dimmer state"));
break}"on"==this._states.state.value?this.executeCommand(a,{value:"off"},c):this.executeCommand(a,{value:"dimTo",ext:b.ext},c);break;case "dimTo":if("undefined"==typeof b.ext||null==b.ext){c&&c(Error("dim to value invalid"));break}d=parseFloat(b.ext);0>d&&(d=0);100<d&&(d=100);if(0==d){this.executeCommand(a,{value:"off"},c);break}this.dimming(a,{EDIM:d,RMP:this._params.ramp_time,EDIMR:0,STR:0,SW:1},function(r){r||n.activeStateChange({level:d,state:"on"});c&&c(r)});break;case "dimUp":if(!this._states.level){c&&
c(Error("unknow previous dimmer level"));break}d=parseInt(this._states.level.value);d+=5;100<d&&(d=100);this.dimming(a,{EDIM:d,RMP:this._params.ramp_time,EDIMR:0,STR:0,SW:1},function(r){r||n.activeStateChange({level:d,state:"on"});c&&c(r)});break;case "dimDown":if(!this._states.level){c&&c(Error("unknow previous dimmer level"));break}d=parseInt(this._states.level.value);d-=5;0>d&&(d=0);if(0==d){this.executeCommand(a,{value:"off"},c);break}this.dimming(a,{EDIM:d,RMP:this._params.ramp_time,EDIMR:0,
STR:0,SW:1},function(r){r||n.activeStateChange({level:d,state:"on"});c&&c(r)});break;case "setRampTime":if(!b.ext){c&&c(Error("parameters is null"));break}d=parseInt(d);255<d&&(d=255);0>d&&(d=0);this._params.ramp_time=d;require("x.hub.m.enocean.js")._deviceHandler.deviceParamsUpdated(this,function(r){c&&c(r)});break;default:c&&c(Error("unknow command"))}}else c&&c(Error("command invalid"))};var dd=function(){var a=function(b){ja.call(this,b);this.TEACH_IN_VARIATION=3;this._data="eltako_tf_dimmer"};
a.prototype=new ja;a.prototype.constructor=a;a.prototype.handleTeachinTelegram=function(b,c){if(c&&165==c.rorg&&c.userData){var d=c.userData.toString("hex"),n=b._teachSenderID;if(d&&n&&n.substr(2)==d.substr(0,6))require("x.hub.m.enocean.js")._deviceHandler.onLearnDevice({address:b._teachID,senderID:b._teachSenderID,data:b._teachProfile,vendor:b._teachVendor},{address:c.senderID,senderID:b._teachSenderID,data:b._teachProfile,vendor:b._teachVendor},function(r,v){b._teachFinish(r,v)})}};return a}(),
vb=function(a){ja.call(this,a);this._data="eltako_dimmer2";this._vendor="eltako";this._eepAlias="f6-02-01"};vb.COMMANDS="on off toggle dimTo dimUp dimDown toggleTo setRampTime".split(" ");vb.STATES=["state","ramp_time"];vb.prototype=new ja;vb.prototype.constructor=ja;vb.prototype.handleLearnTelegram=function(a,b){if(b&&246==b.rorg)require("x.hub.m.enocean.js")._deviceHandler.onLearnDevice({address:a._learnAddress,senderID:a._learnSenderID,data:a._learnProfile,vendor:a._learnVendor},{address:b.senderID,
senderID:a._learnSenderID,data:this._data,vendor:this._vendor},function(c,d){a._learnFinish(c,0,d)})};vb.prototype.evalTelegram=function(a){var b={};if(246==a.rorg)switch(a.userData){case 112:b.state="on";break;case 80:b.state="off"}return b};var lc=function(a){ja.call(this,a);this._data="eltako_fsud"};lc.COMMANDS="on off toggle dimTo dimUp dimDown toggleTo setRampTime".split(" ");lc.STATES=["state","ramp_time"];lc.prototype=new ja;lc.prototype.constructor=ja;lc.prototype.getTeachinTelegram=function(a,
b,c){a=new Buffer([2,0,0,0]);return new x.hub.m.enocean.ESP3.Telegram.BS4(a,b,0)};var ua=function(a){Lc.call(this,a);this._data="eltako_blind";this._vendor="eltako";this._eepAlias="f6-02-01";this._syncRunning=!1;this._syncCB=this._syncTO=null};ua.COMMANDS="up down stop stepUp stepDown setRV setRunTime moveTo sync".split(" ");ua.STATES=["pos","sync"];ua.prototype=new Lc;ua.prototype.constructor=ua;ua.prototype.setDefaultParams=function(){this._params||(this._params={});if("undefined"==typeof this._params.rv||
null==this._params.rv)this._params.rv=200;if("undefined"==typeof this._params.rt||null==this._params.rt)this._params.rt=200};ua.prototype.handleLearnTelegram=function(a,b){if(b&&246==b.rorg)require("x.hub.m.enocean.js")._deviceHandler.onLearnDevice({address:a._learnAddress,senderID:a._learnSenderID,data:a._learnProfile,vendor:a._learnVendor},{address:b.senderID,senderID:a._learnSenderID,data:this._data,vendor:this._vendor},function(c,d){a._learnFinish(c,0,d)})};ua.prototype.getTeachinTelegram=function(a,
b,c){a=new Buffer([255,248,13,128]);return new x.hub.m.enocean.ESP3.Telegram.BS4(a,b,0)};ua.prototype.getStatesBuffer=function(){var a=JSON.parse(JSON.stringify(this._states));a.sync||(a.sync={value:!1,time:-1});a.rv={value:this._params.rv,time:-1};a.rt={value:this._params.rt,time:-1};return a};ua.prototype.evalData=function(a,b,c){(a=this.evalTelegram(b))?(b=this.checkStateChange(a),a.sync&&this._syncRunning&&(this._syncRunning=!1,this._syncTO&&(clearTimeout(this._syncTO),this._syncTO=null),this._syncCB&&
(this._syncCB(),this._syncCB=null)),c&&c(null,b)):c&&c(Error("data format invalid"))};ua.prototype.evalTelegram=function(a){var b={};if(246==a.rorg)switch(a.userData){case 112:b.sync=!0;b.pos=0;break;case 80:b.sync=!0,b.pos=100}else if(165==a.rorg){var c=a.userData.readUInt16BE(0);a=a.userData.readUInt8(2);var d=this._params.rt;d||(d=200);var n=this._states.pos?this._states.pos.value:null;n||(n=0);if("undefined"!=typeof n&&null!=n)switch(c=10*c/d,a){case 1:b.pos=Math.max(0,Math.round(n-c));break;
case 2:b.pos=Math.min(100,Math.round(n+c))}}return b};ua.prototype.executeCommand=function(a,b,c){if(b&&b.value){if("stepUp"==b.value.substr(0,6)&&6<b.value.length){var d=b.value.substr(6);b={value:"stepUp",ext:d}}else"stepDown"==b.value.substr(0,8)&&8<b.value.length?(d=b.value.substr(8),b={value:"stepDown",ext:d}):"setRV"==b.value.substr(0,5)&&5<b.value.length?(d=b.value.substr(5),b={value:"setRV",ext:d}):"setRunTime"==b.value.substr(0,10)&&10<b.value.length?(d=b.value.substr(10),b={value:"setRunTime",
ext:d}):"moveTo"==b.value.substr(0,6)&&6<b.value.length&&(d=b.value.substr(6),b={value:"moveTo",ext:d});(new Date).getTime();var n=this._params.rv;n||(n=200);var r=this._params.rt;r||(r=200);switch(b.value){case "up":this.doReq(a,{TIME:n,CMD:1,LCK:0,TYPE:0},function(z){c&&c(z)});break;case "down":this.doReq(a,{TIME:n,CMD:2,LCK:0,TYPE:0},function(z){c&&c(z)});break;case "stop":this.doReq(a,{TIME:0,CMD:0,LCK:0,TYPE:0},function(z){c&&c(z)});break;case "stepUp":r="undefined"==typeof b.ext||null==b.ext?
r/100:parseFloat(b.ext)/100*r;1>r&&(r=1);this.doReq(a,{TIME:r,CMD:1,LCK:0,TYPE:0},function(z){c&&c(z)});break;case "stepDown":r="undefined"==typeof b.ext||null==b.ext?r/100:parseFloat(b.ext)/100*r;1>r&&(r=1);this.doReq(a,{TIME:r,CMD:2,LCK:0,TYPE:0},function(z){c&&c(z)});break;case "moveTo":if("undefined"==typeof b.ext||null==b.ext){c&&c(Error("value invalid"));break}b=parseInt(b.ext);d=0;this._states&&this._states.pos&&"undefined"!=typeof this._states.pos.value&&null!=this._states.pos.value&&(d=this._states.pos.value);
r*=(b-d)/100;if(0<r)var v=2;else if(0>r)r=0-r,v=1;else if(0==r){c&&c();break}this.doReq(a,{TIME:r,CMD:v,LCK:0,TYPE:1},function(z){c&&c(z)});break;case "sync":this.snyc(a,function(z){c&&c(z)});break;case "setRV":if(!b.ext){c&&c(Error("parameters is null"));break}d=parseInt(d);200<d&&(d=200);0>d&&(d=0);this._params.rv=d;a=require("x.hub.m.enocean.js")._deviceHandler;a.deviceParamsUpdated(this,function(z){c&&c(z)});break;case "setRunTime":if(!b.ext){c&&c(Error("parameters is null"));break}d=parseInt(d);
200<d&&(d=200);0>d&&(d=0);this._params.rt=d;a=require("x.hub.m.enocean.js")._deviceHandler;a.deviceParamsUpdated(this,function(z){c&&c(z)});break;default:c&&c(Error("unknow command"))}}else c&&c(Error("command invalid"))};ua.prototype.snyc=function(a,b){if(this._syncRunning)b&&b(Error("sync running"));else{var c=this,d=this._params.rv;d||(d=200);this._syncRunning=!0;this._syncTO=setTimeout(function(){c._syncRunning=!1;c._syncTO=null;c._states.pos={value:0,time:(new Date).getTime()}},1E3*(d+2));this.doReq(a,
{TIME:d,CMD:1,LCK:0,TYPE:0},function(n){b&&b(n)})}};ua.prototype.doReq=function(a,b,c){var d=this._senderID;this._senderID||(d=x.hub.m.enocean.SENDER_ID);if(b.TYPE){var n=Math.round(10*b.TIME)>>8&255;var r=Math.round(10*b.TIME)&255}else n=0,r=Math.round(b.TIME)&255;b=new Buffer([n,r,b.CMD,8|(b.LCK&1)<<2|(b.TYPE&1)<<1]);d=new x.hub.m.enocean.ESP3.Telegram.BS4(b,d,0);d.setDstId(this._address);a.sendTelegram(d,!0,function(v){c&&c(v)})};var ed=function(){var a=function(b){ua.call(this,b);this.TEACH_IN_VARIATION=
3;this._data="eltako_tf_blind"};a.prototype=new ua;a.prototype.constructor=a;a.prototype.handleTeachinTelegram=function(b,c){if(c&&165==c.rorg&&c.userData){var d=c.userData.toString("hex"),n=b._teachSenderID;if(d&&n&&n.substr(2)==d.substr(0,6))require("x.hub.m.enocean.js")._deviceHandler.onLearnDevice({address:b._teachID,senderID:b._teachSenderID,data:b._teachProfile,vendor:b._teachVendor},{address:c.senderID,senderID:b._teachSenderID,data:b._teachProfile,vendor:b._teachVendor},function(r,v){b._teachFinish(r,
v)})}};return a}(),mc=function(a){mb.call(this,a);this._data="eltako_weather";this._vendor="eltako";this._eepAlias="a5-04-02";this._engMax=7.2;this._engMin=0};mc.STATES="energy energy_raw humidity humidity_raw temperature temperature_raw available".split(" ");mc.prototype=new mb;mc.prototype.constructor=mc;mc.prototype.evalTelegram=function(a){var b={};if(165==a.rorg){var c=a.userData.readUInt8(3),d=a.userData.readUInt8(2),n=a.userData.readUInt8(1);a=a.userData.readUInt8(0);1==(c>>3&1)&&(b.energy=
parseFloat((a/250*(this._engMax-this._engMin)+this._engMin).toFixed(1)),b.energy_raw=a,b.humidity=parseFloat((n/250*(this._humMax-this._humMin)+this._humMin).toFixed(1)),b.humidity_raw=n,b.temperature=parseFloat((d/250*(this._tempMax-this._tempMin)+this._tempMin).toFixed(1)),b.temperature_raw=d,b.available=c>>1&1?!0:!1)}return b};var jb=function(a){nb.call(this,a);this._data="eltako_lux";this._vendor="eltako";this._eepAlias="a5-06-01";this._ill1Max=3E4;this._ill1Min=300};jb.STATES="illumination2 illumination2_raw illumination1 illumination1_raw illumination illumination_raw".split(" ");
jb.prototype=new nb;jb.prototype.constructor=jb;jb.prototype.evalTelegram=function(a){var b={};if(165==a.rorg){var c=a.userData.readUInt8(3);a.userData.readUInt8(2);var d=a.userData.readUInt8(1);a=a.userData.readUInt8(0);1==(c>>3&1)&&(b.illumination2=a,b.illumination2_raw=a,b.illumination1=parseFloat((d/255*(this._ill1Max-this._ill1Min)+this._ill1Min).toFixed(1)),b.illumination1_raw=d,b.illumination=d?b.illumination1:b.illumination2,b.illumination_raw=d?b.illumination1_raw:b.illumination2_raw)}return b};
var Pc=function(a){db.call(this,a);this._data="eltako_lux2";this._vendor="eltako";this._eepAlias="a5-06-02";this._ill2Min=0;this._ill2Max=1024};Pc.STATES=db.STATES;Pc.prototype=new db;Pc.prototype.constructor=Pc;var ha=function(a){f.call(this,a);this._data="eltako_buttons";this._vendor="eltako";this._eepAlias="f6-02-01";this._longPressThreshold=1E3;this.BUTTONS=["button1","button2","button3","button4"]};ha.STATES=["button1","button2","button3","button4"];ha.EVENTS=["shortPress","longPress","press",
"release"];ha.prototype=new f;ha.prototype.constructor=ha;ha.prototype.evalTelegram=function(a){var b={};if(246==a.rorg)switch(a.userData){case 112:this.BUTTONS[0]&&(b[this.BUTTONS[0]]="pressed");break;case 80:this.BUTTONS[1]&&(b[this.BUTTONS[1]]="pressed");break;case 48:this.BUTTONS[2]&&(b[this.BUTTONS[2]]="pressed");break;case 16:this.BUTTONS[3]&&(b[this.BUTTONS[3]]="pressed");break;case 0:for(a=0;a<this.BUTTONS.length;a++)this.BUTTONS[a]&&(b[this.BUTTONS[a]]="released")}return b};ha.prototype.checkStateChange=
function(a){var b=this._states,c=[],d=(new Date).getTime(),n;for(n in a){var r={};r.key=n;r.value=a[n];r.changed=!1;var v=b[n]?b[n].value:null,z=b[n]?b[n].time:null,F=a[n];if(v!=F||"pressed"==F)r.oldvalue=v,r.changed=!0;this._states[n]={value:a[n],time:d};r.changed&&("pressed"==F||"released"==F&&"pressed"==v)&&c.push(r);"pressed"==v&&"released"==F&&(!z||d-z<this._longPressThreshold?(r={},r.key=n,r.value="shortPress"):(r={},r.key=n,r.value="longPress"),r.changed=!0,c.push(r))}return c};var Qc=function(a){ha.call(this,
a);this._data="eltako_button1";this.BUTTONS=[null,null,null,"button"]};Qc.STATES=["button"];Qc.prototype=new ha;Qc.prototype.constructor=Qc;var Rc=function(a){ha.call(this,a);this._data="eltako_sender2";this.BUTTONS=["A1","A3"]};Rc.STATES=["A1","A3"];Rc.prototype=new ha;Rc.prototype.constructor=Rc;var Sc=function(a){ha.call(this,a);this._data="eltako_sender4";this.BUTTONS=["E1","E2","E3","E4"]};Sc.STATES=["E1","E2","E3","E4"];Sc.prototype=new ha;Sc.prototype.constructor=Sc;var Tc=function(a){ha.call(this,
a);this._data="eltako_button2";this.BUTTONS=["buttonO","buttonI"]};Tc.STATES=["buttonO","buttonI"];Tc.prototype=new ha;Tc.prototype.constructor=Tc;var Uc=function(a){ha.call(this,a);this._data="eltako_button4";this.BUTTONS=["BO","BI","AO","AI"]};Uc.STATES=["BO","BI","AO","AI"];Uc.prototype=new ha;Uc.prototype.constructor=Uc;var nc=function(a){ha.call(this,a);this._data="eltako_fsm60b"};nc.STATES=["button"];nc.prototype=new ha;nc.prototype.constructor=nc;nc.prototype.evalTelegram=function(a){var b=
{};if(246==a.rorg)switch(a.userData){case 112:case 80:case 16:b.button="pressed";break;case 0:b.button="released"}return b};var oc=function(a){f.call(this,a);this._data="eltako_fkf";this._vendor="eltako";this._eepAlias="f6-04-01"};oc.STATES=["keycard"];oc.prototype=new f;oc.prototype.constructor=oc;oc.prototype.evalTelegram=function(a){var b={};if(246==a.rorg)switch(a.userData){case 16:b.keycard="inserted";case 0:b.keycard="takeout"}return b};var pc=function(a){f.call(this,a);this._data="eltako_fkc";
this._vendor="eltako";this._eepAlias="f6-04-01"};pc.STATES=["keycard"];pc.prototype=new f;pc.prototype.constructor=pc;pc.prototype.evalTelegram=function(a){var b={};if(246==a.rorg)switch(a.userData){case 48:b.keycard="guest_card";case 32:b.keycard="service_card";case 16:b.keycard="inserted";case 0:b.keycard="takeout"}return b};var Ia=function(a){Za.call(this,a);this._data="eltako_thermo";this._vendor="eltako";this._eepAlias="a5-10-06"};Ia.STATES="setpoint setpoint_raw temperature temperature_raw night_reduce night_reduce_raw".split(" ");
Ia.prototype=new Za;Ia.prototype.constructor=Ia;Ia.prototype.evalTelegram=function(a){var b={};if(165==a.rorg){var c=a.userData.readUInt8(3),d=a.userData.readUInt8(2),n=a.userData.readUInt8(1);a=a.userData.readUInt8(0);1==(c>>3&1)&&(b.night_reduce=6>=a?0:12>=a?1:19>=a?2:25>=a?3:31>=a?4:5,b.night_reduce_raw=a,b.setpoint=parseFloat((n/255*40).toFixed(1)),b.setpoint_raw=n,b.temperature=parseFloat(((255-d)/255*40).toFixed(1)),b.temperature_raw=d)}return b};var qc=function(a){Ia.call(this,a);this._data=
"eltako_ftr65hb";this._vendor="eltako";this._eepAlias="a5-10-06"};qc.STATES=["setpoint","setpoint_raw","temperature","temperature_raw"];qc.prototype=new Ia;qc.prototype.constructor=qc;qc.prototype.evalTelegram=function(a){var b={};if(165==a.rorg){var c=a.userData.readUInt8(3),d=a.userData.readUInt8(2);a=a.userData.readUInt8(1);1==(c>>3&1)&&(b.setpoint=parseFloat((a/255*40).toFixed(1)),b.setpoint_raw=a,b.temperature=parseFloat(((255-d)/255*40).toFixed(1)),b.temperature_raw=d)}return b};var Vc=function(a){Ia.call(this,
a);this._data="eltako_futh55d";this._vendor="eltako";this._eepAlias="a5-10-12"};Vc.STATES="setpoint setpoint_raw temperature temperature_raw night_reduce night_reduce_raw".split(" ");Vc.prototype=new Ia;Vc.prototype.constructor=Vc;var Wc=function(a){Ia.call(this,a);this._data="eltako_futh65d";this._vendor="eltako";this._eepAlias="a5-10-12"};Wc.STATES="setpoint setpoint_raw temperature temperature_raw night_reduce night_reduce_raw".split(" ");Wc.prototype=new Ia;Wc.prototype.constructor=Wc;var rc=
function(a){eb.call(this,a);this._data="eltako_ftr78s";this._vendor="eltako";this._eepAlias="a5-10-03"};rc.STATES=["setpoint","setpoint_raw","temperature","temperature_raw"];rc.prototype=new eb;rc.prototype.constructor=rc;rc.prototype.evalTelegram=function(a){var b={};if(165==a.rorg){var c=a.userData.readUInt8(3),d=a.userData.readUInt8(2);a=a.userData.readUInt8(1);1==(c>>3&1)&&(b.setpoint=parseFloat((a/255*22+8).toFixed(1)),b.setpoint_raw=a,b.temperature=parseFloat(((255-d)/255*40).toFixed(1)),b.temperature_raw=
d)}return b};var wb=function(a){La.call(this,a);this._data="eltako_powermeter";this._vendor="eltako";this._eepAlias="a5-12-01"};wb.STATES=["power","energy","tariff"];wb.prototype=new La;wb.prototype.constructor=wb;wb.prototype.evalTelegram=function(a){var b=La.prototype.evalTelegram.call(this,a);165==a.rorg&&143==a.userData.readUInt8(3)&&(b={});return b};var Xc=function(a){La.call(this,a);this._data="eltako_powermeter2";this._vendor="eltako";this._eepAlias="a5-12-01"};Xc.STATES=["power","tariff"];
Xc.prototype=new La;Xc.prototype.constructor=wb;Xc.prototype.evalTelegram=function(a){a=La.prototype.evalTelegram.call(this,a);delete a.energy;delete a.tariff;return a};var xb=function(a){ha.call(this,a);this._data="eltako_fzs"};xb.STATES=["button"];xb.prototype=new ha;xb.prototype.constructor=xb;xb.prototype.evalTelegram=function(a){var b={};if(246==a.rorg)switch(a.userData){case 48:b.button="pressed";break;case 0:b.button="released"}return b};xb.prototype.checkStateChange=function(a){var b=this._states,
c=[],d=(new Date).getTime(),n;for(n in a){var r={};r.key=n;r.value=a[n];r.changed=!1;var v=b[n]?b[n].value:null,z=b[n]?b[n].time:null,F=a[n];v!=F&&(r.oldvalue=v,r.changed=!0);this._states[n]={value:a[n],time:d};r.changed&&c.push(r);"pressed"==v&&"released"==F&&(!z||d-z<this._longPressThreshold?(r={},r.key=n,r.value="shortPress"):(r={},r.key=n,r.value="longPress"),r.changed=!0,c.push(r))}return c};var sc=function(a){p.call(this,a);this._data="eltako_relay2";this._vendor="eltako";this._eepAlias="f6-02-01"};
sc.STATES=["ch1","ch2"];sc.prototype=new p;sc.prototype.constructor=sc;sc.prototype.evalTelegram=function(a){var b={};if(246==a.rorg)switch(a.userData){case 112:b.ch1="on";break;case 80:b.ch1="off";break;case 48:b.ch2="on";break;case 16:b.ch2="off"}return b};var tc=function(a){p.call(this,a);this._data="eltako_relay";this._vendor="eltako";this._eepAlias="f6-02-01"};tc.STATES=["state"];tc.prototype=new p;tc.prototype.constructor=tc;tc.prototype.evalTelegram=function(a){var b={};if(246==a.rorg)switch(a.userData){case 112:b.state=
"on";break;case 80:b.state="off"}return b};var uc=function(a){wa.call(this,a);this._data="eltako_heat";this._vendor="eltako";this._eepAlias="a5-30-03"};uc.STATES=["temperature","temperature_raw","alarm","alarm_raw"];uc.prototype=new wa;uc.prototype.constructor=uc;uc.prototype.evalTelegram=function(a){var b={};if(165==a.rorg){var c=a.userData.readUInt8(3),d=a.userData.readUInt8(2),n=a.userData.readUInt8(1);a.userData.readUInt8(0);1==(c>>3&1)&&(b.temperature=parseFloat(((255-n)/255*40).toFixed(1)),
b.temperature_raw=n,b.alarm=15==d?"alarm":"ok",b.alarm_raw=d)}return b};var vc=function(a){wa.call(this,a);this._data="eltako_water_m3";this._vendor="eltako";this._eepAlias="a5-30-03"};vc.STATES=["water","water_raw"];vc.prototype=new wa;vc.prototype.constructor=vc;vc.prototype.evalTelegram=function(a){var b={};if(165==a.rorg){var c=a.userData.readUInt8(3);a=a.userData.readUInt8(2);1==(c>>3&1)&&(b.water=15==a,b.water_raw=a)}return b};var wc=function(a){hb.call(this,a);this._data="eltako_water_m4";
this._vendor="eltako";this._eepAlias="a5-30-01"};wc.STATES=["water","water_raw"];wc.prototype=new hb;wc.prototype.constructor=wc;wc.prototype.evalTelegram=function(a){var b={};if(165==a.rorg){var c=a.userData.readUInt8(3);a=a.userData.readUInt8(2);1==(c>>3&1)&&(b.water=0==a,b.water_raw=a)}return b};var Ta=function(a){la.call(this,a);this.TEACH_IN_VARIATION=3;this._data="peha_powerswitch";this._vendor="peha";this._eepAlias="a5-38-08"};Ta.COMMANDS=["on","off","toggle"];Ta.STATES="state state_raw level rgb power energy current voltage power_raw power_unit energy_unit current_unit voltage_unit power_unit_raw op_hour error error_raw service_mode op_hour_flag op_hour_flag_raw mode_raw".split(" ");
Ta.prototype=new la;Ta.prototype.constructor=Ta;Ta.prototype.getTeachinType=function(){return"4BS"};Ta.prototype.evalTelegram=function(a){return tb.prototype.evalTelegram.call(this,a)};Ta.prototype.executeCommand=function(a,b,c){if(b&&b.value){(new Date).getTime();var d=this;switch(b.value){case "on":this.switching(a,{TIM:0,LCK:0,DEL:0,SW:1},function(n){n||d.activeStateChange({state:"on"});c&&c(n)});break;case "off":this.switching(a,{TIM:0,LCK:0,DEL:0,SW:0},function(n){n||d.activeStateChange({state:"off"});
c&&c(n)});break;case "toggle":if(!this._states.state){c&&c(Error("unknow previous switch state"));break}"on"==this._states.state.value?this.executeCommand(a,{value:"off"},c):this.executeCommand(a,{value:"on"},c);break;default:c&&c(Error("unknow command"))}}else c&&c(Error("command invalid"))};var yb=function(a){Ta.call(this,a);this.TEACH_IN_VARIATION=3;this._data="peha_switch";this._vendor="peha";this._eepAlias="a5-38-08"};yb.COMMANDS=["on","off","toggle"];yb.STATES="state state_raw level rgb power energy current voltage power_raw power_unit energy_unit current_unit voltage_unit power_unit_raw op_hour error error_raw service_mode op_hour_flag op_hour_flag_raw mode_raw".split(" ");
yb.prototype=new Ta;yb.prototype.constructor=yb;yb.prototype.evalTelegram=function(a){a=tb.prototype.evalTelegram.call(this,a);delete a.power;delete a.energy;delete a.current;delete a.voltage;delete a.power_unit;delete a.energy_unit;delete a.current_unit;delete a.voltage_unit;return a};var Ua=function(a){la.call(this,a);this.TEACH_IN_VARIATION=3;this._data="peha_blind";this._vendor="peha";this._eepAlias="a5-38-08";this._initCount=0};Ua.COMMANDS="up down stop stepUp stepDown moveTo lamellaUp lamellaDown lamellaStepUp lamellaStepDown lamellaTo setRunTime setLamellaRuntime".split(" ");
Ua.STATES="position angle position_flag position_flag_raw angle_flag angle_flag_raw error error_raw end_position end_position_raw state state_raw service_mode position_mode".split(" ");Ua.prototype=new la;Ua.prototype.constructor=Ua;Ua.prototype.init=function(a){var b=require("x.hub.m.enocean.js")._esp3;this.blind(b,{P1:0,P2:0,FUNC:0,SSF:0,PAF:0,SMF:0},function(c){a&&a()})};Ua.prototype.getTeachinType=function(){return"4BS"};Ua.prototype.getStatesBuffer=function(){0==Object.keys(this._states).length?
(100>=this._initCount&&0==this._initCount%10?this.init():100<=this._initCount&&600>=this._initCount&&0==this._initCount%60?this.init():this._initCount=0,this._initCount++):this._initCount=0;return this._states};Ua.prototype.evalTelegram=function(a){return Vb.prototype.evalTelegram.call(this,a)};Ua.prototype.executeCommand=function(a,b,c){if(b&&b.value){(new Date).getTime();var d=this;if("stepUp"==b.value.substr(0,6)&&6<b.value.length){var n=b.value.substr(6);b={value:"stepUp",ext:n}}else"stepDown"==
b.value.substr(0,8)&&8<b.value.length?(n=b.value.substr(8),b={value:"stepDown",ext:n}):"setRunTime"==b.value.substr(0,10)&&10<b.value.length?(n=b.value.substr(10),b={value:"setRunTime",ext:n}):"moveTo"==b.value.substr(0,6)&&6<b.value.length&&(n=b.value.substr(6),b={value:"moveTo",ext:n});switch(b.value){case "up":this.blind(a,{P1:0,P2:0,FUNC:2,SSF:0,PAF:0,SMF:0},function(z){c&&c(z)});break;case "down":this.blind(a,{P1:0,P2:0,FUNC:3,SSF:0,PAF:0,SMF:0},function(z){c&&c(z)});break;case "stop":this.blind(a,
{P1:0,P2:0,FUNC:1,SSF:0,PAF:0,SMF:0},function(z){c&&c(z)});break;case "stepUp":n="undefined"==typeof b.ext||null==b.ext?5:parseInt(b.ext);var r=this._states.position?this._states.position.value:null;if("undefined"==typeof r||null==r){this.blind(a,{P1:0,P2:0,FUNC:0,SSF:0,PAF:0,SMF:0});c&&c(Error("unknown position"));break}this._states.position_mode&&this._states.position_mode.value?(n=r+n,100<n&&(n=100)):(n=r-n,0>n&&(n=0));this.blind(a,{P1:n,P2:0,FUNC:4,SSF:0,PAF:0,SMF:0},function(z){z||d.activeStateChange({position:n});
c&&c(z)});break;case "stepDown":n="undefined"==typeof b.ext||null==b.ext?5:parseInt(b.ext);r=this._states.position?this._states.position.value:null;if("undefined"==typeof r||null==r){this.blind(a,{P1:0,P2:0,FUNC:0,SSF:0,PAF:0,SMF:0});c&&c(Error("unknown position"));break}this._states.position_mode&&this._states.position_mode.value?(n=r-n,0>n&&(n=0)):(n=r+n,100<n&&(n=100));this.blind(a,{P1:n,P2:0,FUNC:4,SSF:0,PAF:0,SMF:0},function(z){z||d.activeStateChange({position:n});c&&c(z)});break;case "moveTo":if("undefined"==
typeof b.ext||null==b.ext){c&&c(Error("value invalid"));break}r=parseInt(b.ext);this.blind(a,{P1:r,P2:0,FUNC:4,SSF:0,PAF:0,SMF:0},function(z){z||d.activeStateChange({position:r});c&&c(z)});break;case "setRunTime":if(!b.ext||-1==b.ext.indexOf(":")){c&&c(Error("value invalid"));break}var v=b.ext.split(":");b=v[0];v=v[1];if(!b&&v)b=v;else if(b&&!v)v=b;else if(!b&&!v){c&&c(Error("value invalid"));break}b=parseInt(b);v=parseInt(v);this.blind(a,{P1:b,P2:v,FUNC:7,SSF:0,PAF:0,SMF:0},function(z){z||d.activeStateChange({position:n});
c&&c(z)});break;default:c&&c(Error("unknow command"))}}else c&&c(Error("command invalid"))};var Y=function(a){q.call(this,a);this._data="bb-aa-cc";this._vendor="rehau";this._eepAlias="d2-06-10";this._hopCount=0;this._saLearnMode=1;this._originalEEP="bb-aa-cc";this._reset_pre_alarm_new=this._reset_alarm_new=null;this._deviceTO=this._startTimeoutTimer();this._prealarmTO=this._alarmTO=null};Y.COMMANDS="alertOn alertOff alertToggle resetAlarm resetPreAlarm preAlarmOn preAlarmOff preAlarmToggle".split(" ");
Y.STATES="battery pre_alarm alarm window pre_alarm_enabled error pending alarm_enabled pre_alarm_enabled_device timeout".split(" ");Y.prototype=new q;Y.prototype.constructor=Y;Y.prototype.setDefaultParams=function(){var a=require("x.hub.m.enocean.js")._rehauHandler;if(a){var b=a.getSmartguardSetting(this._address),c=!0,d=!0;b&&(c=b.isAlarmActive(),d=b.isPreAlarmActive());this.activeStateChange({pending:!1,alarm_enabled:c,pre_alarm_enabled:d,timeout:!1,alarm_task_active:a.getAlarm(),pre_alarm_task_active:a.getAlarm()})}};
Y.prototype.getStatesBuffer=function(){return this._states};Y.prototype.evalData=function(a,b,c){var d=this.evalTelegram(b);if(d){d.timeout=!1;this._deviceTO&&(clearTimeout(this._deviceTO),this._deviceTO=this._startTimeoutTimer());if(208==b.rorg)b=this.checkStateChange(d);else{var n=!1;210==b.rorg&&2==b.userData.length&&(n=!0);b=this.getBufferedState("alarm_task_active");var r=this.getBufferedState("pre_alarm_task_active"),v=this.getBufferedState("alarm_enabled"),z=this.getBufferedState("pre_alarm_enabled");
d.pre_alarm?r?z?this._startPreAlarmTimer():d.pre_alarm=!1:d.pre_alarm=!1:this._clearPreAlarmTimer();d.alarm?b?v?this._startAlarmTimer():d.alarm=!1:d.alarm=!1:this._clearAlarmTimer();b=this.checkStateChange(d);var F=this;this._executePendingCommand(a,function(){F._reportStates(d)},n)}c&&c(null,b)}else c&&c(Error("data format invalid"))};Y.prototype.evalTelegram=function(a){var b={},c=!1;if(210==a.rorg){if(1==a.userData.length)c=a.userData.readUInt8(0);else{var d=a.userData.readUInt8(0);c=a.userData.readUInt8(1)}2==
a.userData.length&&(b.battery=d);b.pre_alarm=c>>7&1?!0:!1;b.alarm=c>>6&1?!0:!1;b.window=c>>5&1?"closed":"open";b.pre_alarm_enabled_device=c>>4&1?!0:!1;b.error=c&15;c=!0}else 208==a.rorg&&(c=a.userData.readUInt8(0),b.battery=Math.round(c/100*255),b.battery_raw=c,c=!0);return c?b:null};Y.prototype.executeCommand=function(a,b,c){if(b&&b.value){switch(b.value){case "alertOn":this._setAlarm(!0);break;case "alertOff":this._setAlarm(!1);break;case "alertToggle":this._states&&this._states.alarm_enabled?this._setAlarm(!this._states.alarm_enabled.value):
this._setAlarm(!0);break;case "resetAlarm":this._reset_alarm_new="on";this.activeStateChange({pending:!0});break;case "resetPreAlarm":this._reset_pre_alarm_new="on";this.activeStateChange({pending:!0});break;case "preAlarmOn":this._setPreAlarm(!0);break;case "preAlarmOff":this._setPreAlarm(!1);break;case "preAlarmToggle":this._states&&this._states.pre_alarm_enabled?this._setPreAlarm(!this._states.pre_alarm_enabled.value):this.pre_alarm_enabled(!0);break;case "alarmTaskOn":this._setAlarmTask(!0);break;
case "alarmTaskOff":this._setAlarmTask(!1);break;case "preAlarmTaskOn":this._setPreAlarmTask(!0);break;case "preAlarmTaskOff":this._setPreAlarmTask(!1);break;default:c&&c(Error("unknow command"));return}c&&c()}else c&&c(Error("command invalid"))};Y.prototype._executePendingCommand=function(a,b,c){var d={AL:1,RSA:0,RSP:0,PAE:1},n=this._isAlarmActive();d.AL=n?1:0;n=this._isPreAlarmActive();d.PAE=n?1:0;this._reset_alarm_new&&(d.RSA="on"==this._reset_alarm_new?1:0);this._reset_pre_alarm_new&&(d.RSP="on"==
this._reset_pre_alarm_new?1:0);var r={pending:!1};1==d.RSP&&(r.pre_alarm=!1);1==d.RSA&&(r.alarm=!1);this._reset_pre_alarm_new=this._reset_alarm_new=null;var v=this;this._sendVLD(a,d,function(z){v.activeStateChange(r);b&&b(z)},c)};Y.prototype._sendVLD=function(a,b,c,d){var n=this._senderID;this._senderID||(n=x.hub.m.enocean.SENDER_ID);b=(b.AL&1)<<7|(b.RSA&1)<<6|(b.RSP&1)<<5|(b.PAE&1)<<4;d=d?new Buffer([0,b]):new Buffer([b]);n=new x.hub.m.enocean.ESP3.Telegram.VLD(d,n,0);n.setDstId(this._address);a.sendTelegram(n,
!0,function(r){c&&c(r)})};Y.prototype._reportStates=function(a){if(a&&0<Object.keys(a).length){var b=require("x.hub.m.enocean.js").getRehauHandler();b&&(a.alarm_enabled=this.getBufferedState("alarm_enabled"),a.pre_alarm_enabled=this.getBufferedState("pre_alarm_enabled"),b.onReceiveWindowSensorStates(this,a))}};Y.prototype._setAlarm=function(a){this.activeStateChange({alarm_enabled:a});require("x.hub.m.enocean.js")._rehauHandler.setSmartGuardAlarm(this._address,a)};Y.prototype._setPreAlarm=function(a){this.activeStateChange({pre_alarm_enabled:a});
require("x.hub.m.enocean.js")._rehauHandler.setSmartGuardPreAlarm(this._address,a)};Y.prototype._setAlarmTask=function(a){this.activeStateChange({alarm_task_active:a})};Y.prototype._setPreAlarmTask=function(a){this.activeStateChange({pre_alarm_task_active:a})};Y.prototype._isAlarmActive=function(){var a=!0,b=!0;this._states&&this._states.alarm_enabled&&(b=this._states.alarm_enabled.value,"undefined"==typeof b||null==b)&&(b=!0);if(!b)return!1;this._states&&this._states.alarm_task_active&&(a=this._states.alarm_task_active.value,
"undefined"==typeof a||null==a)&&(a=!1);return a};Y.prototype._isPreAlarmActive=function(){var a=!0,b=!0;this._states&&this._states.pre_alarm_enabled&&(b=this._states.pre_alarm_enabled.value,"undefined"==typeof b||null==b)&&(b=!0);if(!b)return!1;this._states&&this._states.pre_alarm_task_active&&(a=this._states.pre_alarm_task_active.value,"undefined"==typeof a||null==a)&&(a=!1);return a};Y.prototype._startTimeoutTimer=function(){var a=this;return setTimeout(function(){a.activeStateChange({timeout:!0})},
36E5)};Y.prototype._startPreAlarmTimer=function(){this._prealarmTO&&clearTimeout(this._prealarmTO);var a=this;this._prealarmTO=setTimeout(function(){a.activeStateChange({pre_alarm:!1});var b=a.getCurrentStates();a._reportStates(b)},1E4)};Y.prototype._clearPreAlarmTimer=function(){this._prealarmTO&&(clearTimeout(this._prealarmTO),this._prealarmTO=null)};Y.prototype._startAlarmTimer=function(){this._alarmTO&&clearTimeout(this._alarmTO);var a=this;this._alarmTO=setTimeout(function(){a.activeStateChange({alarm:!1});
var b=a.getCurrentStates();a._reportStates(b)},12E4)};Y.prototype._clearAlarmTimer=function(){this._alarmTO&&(clearTimeout(this._alarmTO),this._alarmTO=null)};Y.prototype.toJSON=function(){return{type:"ENOCEAN",address:this._address,data:this._data,senderID:this._senderID,vendor:this._vendor,virtual:this._virtual,params:this._params,hopCount:this._hopCount,saLearnMode:this._saLearnMode,originalEEP:this._originalEEP}};Y.prototype.fromJSON=function(a){if(!a||!a.address||!a.data||a.data!=this._data)return null;
this._address=a.address;this._senderID=a.senderID;this._vendor=a.vendor?a.vendor:this._vendor;this._virtual=a.virtual?!0:!1;this._params=a.params;this._hopCount=a.hopCount;this._saLearnMode=a.saLearnMode;a.originalEEP&&(this._originalEEP=a.originalEEP);this.setDefaultParams();return this};Y.prototype.toDBJSON=function(){return{id:this._address,senderID:this._senderID,eep:this._data,vendor:this._vendor,params:this._params,virtual:this._virtual,hopCount:this._hopCount,saLearnMode:this._saLearnMode,
originalEEP:this._originalEEP}};Y.prototype.fromDBJSON=function(a){if(!a||!a.id||!a.eep||a.eep!=this._data)return null;this._address=a.id;this._senderID=a.senderID;this._vendor=a.vendor?a.vendor:this._vendor;this._virtual=a.virtual?!0:!1;this._params=a.params;this._hopCount=a.hopCount;this._saLearnMode=a.saLearnMode;a.originalEEP&&(this._originalEEP=a.originalEEP);this.setDefaultParams();return this};var ad=function(a){Y.call(this,a);this._data="d2-06-10"};ad.prototype=new Y;ad.prototype.constructor=
ad;var zb=function(a){Y.call(this,a);this._data="d2-06-ff"};zb.prototype=new Y;zb.prototype.constructor=zb;zb.prototype.evalTelegram=function(a){var b={},c=!1;if(210==a.rorg){if(1==a.userData.length)c=a.userData.readUInt8(0);else{var d=a.userData.readUInt8(0);c=a.userData.readUInt8(1)}2==a.userData.length&&(b.battery=d);a=c>>2&3;b.pre_alarm=c>>7&1?!0:!1;b.alarm=c>>6&1?!0:!1;b.window=a?"closed":"open";b.pre_alarm_enabled_device=c>>4&1?!0:!1;0==a?b.window="closed":1==a?b.window="tilted":3==a&&(b.window=
"open");c=!0}else 208==a.rorg&&(c=a.userData.readUInt8(0),b.battery=c,c=!0);return c?b:null};var Yc=function(a){zb.call(this,a);this._data="smartguard2";this._eepAlias="d2-06-11"};Yc.prototype=new zb;Yc.prototype.constructor=Yc;Yc.prototype.evalTelegram=function(a){var b={},c=!1;if(210==a.rorg){if(1==a.userData.length)c=a.userData.readUInt8(0);else{var d=a.userData.readUInt8(0);c=a.userData.readUInt8(1)}2==a.userData.length&&(b.battery=d);a=c>>5&1;b.pre_alarm=c>>7&1?!0:!1;b.alarm=c>>6&1?!0:!1;b.window=
a?"closed":"open";b.pre_alarm_enabled_device=c>>4&1?!0:!1;1==a?b.window="closed":0==a&&(b.window="open");1==(c>>3&3)&&(b.window="tilted");c=!0}else 208==a.rorg&&(c=a.userData.readUInt8(0),b.battery=c,c=!0);return c?b:null};var Zc=function(a){wa.call(this,a);this._data="afriso_water_con";this._vendor="afriso";this._eepAlias="a5-30-03"};Zc.prototype=new wa;Zc.prototype.constructor=Zc;Zc.prototype.evalTelegram=function(a){var b={};if(165==a.rorg){var c=a.userData.readUInt8(3),d=a.userData.readUInt8(2);
a=a.userData.readUInt8(1);1==(c>>3&1)&&(b.temperature=(255-a)/255*40,b.temperature_raw=a,b.water=0==(d>>4&1)?!0:!1)}return b};var xc=function(a){Q.call(this,a);this._data="afriso_water_eco";this._vendor="afriso";this._eepAlias="f6-05-01"};xc.prototype=new Q;xc.prototype.constructor=xc;xc.prototype.evalTelegram=function(a){var b={};246==a.rorg&&(a=a.nu,1==a?b.water="true":0==a&&(b.water="false"));return b};xc.prototype.onLearn=function(){this._states.water={value:!1,time:(new Date).getTime()}};var $c=
function(a){wa.call(this,a);this._data="afriso_asd_10";this._vendor="afriso";this._eepAlias="a5-30-03"};$c.prototype=new wa;$c.prototype.constructor=$c;$c.prototype.evalTelegram=function(a){var b={};if(165==a.rorg){var c=a.userData.readUInt8(3),d=a.userData.readUInt8(2);a=a.userData.readUInt8(1);1==(c>>3&1)&&(b.temperature=(255-a)/255*40,b.temperature_raw=a,b.smoke=0==(d>>4&1)?!0:!1)}return b};var yc=function(a){ca.call(this,a);this._data="hoppe_door";this._vendor="hoppe";this._eepAlias="f6-10-00"};
yc.STATES=["door"];yc.prototype=new ca;yc.prototype.constructor=yc;yc.prototype.evalTelegram=function(a){var b={};246==a.rorg&&(a=a.userData,0==(a&208^192)?b.door="open":0==(a&240^240)&&(b.door="closed"),b.handle_raw=a);return b};var cd=function(){var a=function(b){q.call(this,b);this._data="gp";this._gpInfo=null};a.prototype=new q;a.prototype.constructor=a;a.prototype.toJSON=function(){var b=q.prototype.toJSON.call(this);b.gpInfo=this._gpInfo;return b};a.prototype.fromJSON=function(b){if(!q.prototype.fromJSON.call(this,
b))return null;b&&b.gpInfo&&(this._gpInfo=b.gpInfo);return this};a.prototype.toDBJSON=function(){var b=q.prototype.toDBJSON.call(this);b.gpInfo=this._gpInfo;return b};a.prototype.fromDBJSON=function(b){if(!q.prototype.fromDBJSON.call(this,b))return null;b&&b.gpInfo&&(this._gpInfo=b.gpInfo);return this};return a}(),fd=function(){var a=function(b){cd.call(this,b);this._data="afriso_ais_10";this._vendor="afriso";this._eepAlias="gp"};a.prototype=new cd;a.prototype.constructor=a;a.prototype.isGPMatch=
function(b,c){return 45!=b?!1:8==c};a.prototype.evalTelegram=function(b){var c={};if(178==b.rorg){var d=b.data.readUInt8(0)>>7&1,n=b.data.readUInt8(0)>>6&1;b=b.data.readUInt8(0)>>5&1;c.alarm=1==d?"on":"off";c.active=1==n?"on":"off";c.powerAlarm=1==b?"alarm":"no_change"}return c};a.prototype.executeCommand=function(b,c,d){if(c&&c.value){switch(c.value){case "arming":this._setActive(b,!0,d);break;case "disarming":this._setActive(b,!1,d);break;case "toggleArming":this._states&&this._states.active?this._setActive(b,
"off"==this._states.active.value,d):this._setActive(b,!0,d);break;case "alarmOn":this._setAlarm(b,!0,d);break;case "alarmOff":this._setAlarm(b,!1,d);break;case "toggleAlarm":this._states&&this._states.alarm?this._setAlarm(b,"off"==this._states.alarm.value,d):this._setAlarm(b,!1,d);break;default:d&&d(Error("unknow command"));return}d&&d()}else d&&d(Error("command invalid"))};a.prototype._setActive=function(b,c,d){var n=!1;this._states&&this._states.alarm&&"on"==this._states.alarm.value&&(n=!0);this._sendGPCD(b,
n,c,d)};a.prototype._setAlarm=function(b,c,d){var n=!0;this._states&&this._states.active&&"off"==this._states.active.value&&(n=!1);this._sendGPCD(b,c,n,d)};a.prototype._sendGPCD=function(b,c,d,n){var r=this._senderID;this._senderID||(r=x.hub.m.enocean.SENDER_ID);var v=0;c&&(v|=128);d&&(v|=64);c=new Buffer(1);c.writeUInt8(v,0);r=new x.hub.m.enocean.ESP3.Telegram.GP_CD(c,r,0);r.setDstId(this._address);b.sendTelegram(r,!0,function(z){n&&n(z)})};return a}(),Va=function(){var a=function(B){Ca.call(this,
B);this._data="eltako_tf_ttb";this._vendor="eltako";this._eepAlias="a5-07-01";this._params={reset_timeout:300}};a.prototype=new Ca;a.prototype.constructor=a;a.prototype.evalTelegram=function(B){return 246==B.rorg?m.prototype.evalTelegram.call(this,B):165==B.rorg?Ca.prototype.evalTelegram.call(this,B):{}};a.prototype.checkStateChange=function(B){return B.button?m.prototype.checkStateChange.call(this,B):Ca.prototype.checkStateChange.call(this,B)};a.prototype.fromJSON=function(B){Ca.prototype.fromJSON.call(this,
B);this._params={reset_timeout:300};return this};var b=function(B){wa.call(this,B);this._data="eltako_tf_smoke";this._vendor="eltako";this._eepAlias="a5-30-03"};b.STATES=["temperature","temperature_raw","smoke","smoke_raw"];b.prototype=new wa;b.prototype.constructor=b;b.prototype.evalTelegram=function(B){var M={};if(165==B.rorg){var W=B.userData.readUInt8(3),aa=B.userData.readUInt8(2),cb=B.userData.readUInt8(1);B.userData.readUInt8(0);1==(W>>3&1)&&(M.temperature=parseFloat(((255-cb)/255*40).toFixed(1)),
M.temperature_raw=cb,M.smoke=15==aa?!0:!1,M.smoke_raw=aa)}return M};var c=function(B){ca.call(this,B);this._data="eltako_tf_contact";this._vendor="eltako";this._eepAlias="d5-00-01"};c.STATES=["contact","contact_raw","voltage","voltage_raw"];c.prototype=new da;c.prototype.constructor=c;c.prototype.evalTelegram=function(B){var M={};if(213==B.rorg){var W=B.userData;1==(W>>3&1)&&(W&=1,M.contact=W?"closed":"open",M.contact_raw=W)}else if(165==B.rorg){W=B.userData.readUInt8(3);B.userData.readUInt8(2);var aa=
B.userData.readUInt8(1);B=B.userData.readUInt8(0);1==(W>>3&1)&&(M.voltage=parseFloat(aa/255*5).toFixed(1),M.voltage_raw=aa,M.energy=parseFloat(B/255*5).toFixed(1),M.energy_raw=B)}return M};var d=function(B){ib.call(this,B);this._data="eltako_motion2";this._vendor="eltako";this._eepAlias="a5-08-01"};d.STATES="voltage voltage_raw illumination illumination_raw state state_raw".split(" ");d.prototype=new ib;d.prototype.constructor=d;d.prototype.evalTelegram=function(B){var M={};if(165==B.rorg){var W=
B.userData.readUInt8(3);B.userData.readUInt8(2);var aa=B.userData.readUInt8(1);B=B.userData.readUInt8(0);if(1==(W>>3&1)){M.voltage=parseFloat((B/255*5.1).toFixed(1));M.voltage_raw=B;M.illumination=parseFloat((aa/255*510).toFixed(1));M.illumination_raw=aa;switch(W){case 13:M.state="on";break;case 15:M.state="off"}M.motion_raw=W}}return M};var n=function(B){Ca.call(this,B);this._data="eltako_tf_motion";this._vendor="eltako";this._eepAlias="a5-07-01"};n.STATES=["motion","motion_raw"];n.prototype=new Ca;
n.prototype.constructor=n;n.prototype.evalTelegram=function(B){var M={};if(165==B.rorg){var W=B.userData.readUInt8(3);B=B.userData.readUInt8(2);1==(W>>3&1)&&(M.motion=200==B||255==B?!0:!1,M.motion_raw=B)}return M};var r=function(B){la.call(this,B);this._data="eltako_tf_input";this._vendor="eltako";this._eepAlias="a5-38-08"};r.STATES=["state","state_raw"];r.prototype=new la;r.prototype.constructor=r;r.prototype.evalTelegram=function(B){var M={};165==B.rorg&&(B=B.userData.readUInt8(3),1==(B>>3&1)&&
(M.input=8==B?!1:!0,M.input_raw=B));return M};var v=function(B){Za.call(this,B);this._data="eltako_tf_thermo";this._vendor="eltako";this._eepAlias="a5-10-06"};v.STATES="setpoint setpoint_raw temperature temperature_raw night_reduce night_reduce_raw".split(" ");v.prototype=new Ia;v.prototype.constructor=v;v.prototype.evalTelegram=function(B){var M={};if(165==B.rorg){var W=B.userData.readUInt8(3),aa=B.userData.readUInt8(2),cb=B.userData.readUInt8(1);B.userData.readUInt8(0);1==(W>>3&1)&&(M.setpoint=
parseFloat((cb/255*40).toFixed(1)),M.setpoint_raw=cb,M.temperature=parseFloat(((255-aa)/255*40).toFixed(1)),M.temperature_raw=aa)}return M};var z=function(B){jb.call(this,B);this._data="eltako_tf_lux"};z.prototype=new jb;z.prototype.constructor=z;var F=function(B){la.call(this,B);this._data="eltako_dimmer_knob";this._vendor="eltako";this._eepAlias="a5-38-08"};F.STATES=["state","dimmerLevel"];F.prototype=new la;F.prototype.constructor=F;F.prototype.evalTelegram=function(B){var M={};if(165==B.rorg){var W=
B.userData.readUInt8(3),aa=B.userData.readUInt8(2),cb=B.userData.readUInt8(1);B=B.userData.readUInt8(0);if(1==(W>>3&1))switch(B){case 2:M.dimmerLevel=cb,M.ramp=aa,M.dim_range=W>>2&1?"relative":"absolute",M.store_final_value=W>>1&1,M.state=W&1?"on":"off"}}return M};var P=function(B){bd.call(this,B);this.TEACH_IN_VARIATION=3;this._data="eltako_tf_alarm"};P.prototype=new bd;P.prototype.constructor=P;P.prototype.evalTelegram=function(B){var M={};if(246==B.rorg)switch(B.userData){case 48:M.active=!0;break;
case 16:M.active=!1}else 165==B.rorg&&(B=B.userData.readUInt8(3),8==B?M.alarm="ok":9==B&&(M.alarm="alarm"));return M};P.prototype.executeCommand=function(B,M,W){if(M&&M.value){var aa=null;switch(M.value){case "triggerAlarm":aa=new Buffer([1,0,0,9]);break;case "deactivate":aa=new Buffer([1,0,0,12]);break;case "activate":aa=new Buffer([1,0,0,8]);break;default:W&&W(Error("unknow command"))}M=this._senderID;this._senderID||(M=x.hub.m.enocean.SENDER_ID);aa=new x.hub.m.enocean.ESP3.Telegram.BS4(aa,M,0);
aa.setDstId(this._address);B.sendTelegram(aa,!0,function(cb){W&&W(cb)})}else W&&W(Error("command invalid"))};var U=function(B){ha.call(this,B);this._data="eltako_f6t";this._vendor="eltako";this.BUTTONS="buttonCO buttonCI buttonBO buttonBI buttonAO buttonAI".split(" ")};U.STATES="buttonCO buttonCI buttonBO buttonBI buttonAO buttonAI".split(" ");U.prototype=new ha;U.prototype.constructor=U;U.prototype.evalTelegram=function(B){var M={};if(246==B.rorg){var W=parseInt(this._address,16),aa=B.senderID?parseInt(B.senderID,
16):null;if(aa&&aa==W+1)switch(B.userData){case 112:M.buttonCI="pressed";break;case 80:M.buttonCO="pressed";break;case 0:for(B=0;B<this.BUTTONS.length;B++)this.BUTTONS[B]&&(M[this.BUTTONS[B]]="released")}else switch(B.userData){case 112:M.buttonAI="pressed";break;case 80:M.buttonAO="pressed";break;case 48:M.buttonBI="pressed";break;case 16:M.buttonBO="pressed";break;case 0:for(B=0;B<this.BUTTONS.length;B++)this.BUTTONS[B]&&(M[this.BUTTONS[B]]="released")}}return M};return{TF_TTB:a,TF_RWB:b,TF_FKB:c,
TF_BHSB:n,TF_BHSB_FBH:d,TF_Input:r,TF_Thermo:v,TF_Lux:z,Dimmer_Knob:F,TF_Alarm:P,Eltako_F6T:U}}();return{"f6-??-??":f,"f6-01-01":m,"f6-02-01":p,"f6-02-02":l,"f6-02-03":u,"f6-02-04":w,"f6-03-01":E,"f6-03-02":A,"f6-04-01":L,"f6-04-02":N,"f6-05-00":G,"f6-05-01":Q,"f6-05-02":J,"f6-10-00":ca,"f6-10-01":ia,"d5-xx-xx":e,"d5-??-??":ka,"d5-00-01":da,"f6-so-da":g,"a5-??-??":R,"a5-02-01":xa,"a5-02-02":ma,"a5-02-03":Na,"a5-02-04":pa,"a5-02-05":qa,"a5-02-06":Ba,"a5-02-07":ya,"a5-02-08":za,"a5-02-09":lb,"a5-02-0a":V,
"a5-02-0b":k,"a5-02-10":t,"a5-02-11":y,"a5-02-12":C,"a5-02-13":D,"a5-02-14":K,"a5-02-15":S,"a5-02-16":H,"a5-02-17":I,"a5-02-18":T,"a5-02-19":X,"a5-02-1a":Z,"a5-02-1b":na,"a5-02-20":Ja,"a5-02-30":kb,"a5-04-01":zc,"a5-04-02":mb,"a5-04-03":Ab,"a5-06-01":nb,"a5-06-02":db,"a5-06-03":Bb,"a5-06-04":Cb,"a5-06-05":Ac,"a5-07-01":Ca,"a5-07-02":ob,"a5-07-03":pb,"a5-08-01":qb,"a5-08-02":Bc,"a5-08-03":Cc,"a5-09-02":Db,"a5-09-04":Eb,"a5-09-05":Fb,"a5-09-06":Gb,"a5-09-07":Hb,"a5-09-08":Ib,"a5-09-09":Jb,"a5-09-0a":Kb,
"a5-09-0b":Lb,"a5-09-0c":Mb,"a5-10-01":ba,"a5-10-02":Ka,"a5-10-03":eb,"a5-10-04":Nb,"a5-10-05":Ob,"a5-10-06":Za,"a5-10-07":Pb,"a5-10-08":Oa,"a5-10-09":Pa,"a5-10-0a":$a,"a5-10-0b":fb,"a5-10-0c":Qb,"a5-10-0d":Rb,"a5-10-10":ra,"a5-10-11":ab,"a5-10-12":Sb,"a5-10-13":Tb,"a5-10-14":Ub,"a5-12-00":Wb,"a5-12-01":La,"a5-12-02":gb,"a5-12-03":Dc,"a5-13-01":Ec,"a5-13-02":Fc,"a5-13-03":Gc,"a5-13-04":Hc,"a5-13-05":Ic,"a5-13-06":Jc,"a5-14-01":Xb,"a5-14-02":Yb,"a5-14-03":Zb,"a5-14-04":$b,"a5-14-05":ac,"a5-14-06":bc,
"a5-14-07":cc,"a5-14-08":dc,"a5-14-09":ec,"a5-14-0a":fc,"a5-20-04":Ga,"a5-30-01":hb,"a5-30-02":gc,"a5-30-03":wa,"a5-30-04":hc,"a5-38-08":la,"d2-??-??":Ea,"d2-01-00":Ma,"d2-01-01":ic,"d2-01-03":jc,"d2-01-11":bb,"d2-01-13":Qa,"d2-01-14":Ra,"d2-05-00":ta,"d2-05-01":Sa,"d2-06-01":Xa,"d2-06-02":Ya,"d2-06-10":ad,"d2-06-ff":zb,smartguard2:Yc,"d2-06-50":h,"d2-20-00":Aa,eltako_dimmer:ja,eltako_dimmer2:vb,eltako_fsud:lc,eltako_motion:ib,eltako_contact:kc,eltako_weather:mc,eltako_lux:jb,eltako_lux2:Pc,eltako_sender2:Rc,
eltako_sender4:Sc,eltako_button1:Qc,eltako_button2:Tc,eltako_button4:Uc,eltako_blind:ua,eltako_fsm60b:nc,eltako_fkf:oc,eltako_fkc:pc,eltako_thermo:Ia,eltako_ftr65hb:qc,eltako_futh55d:Vc,eltako_futh65d:Wc,eltako_ftr78s:rc,eltako_powermeter:wb,eltako_powermeter2:Xc,eltako_fzs:xb,eltako_switch:Ha,eltako_relay:tc,eltako_relay2:sc,eltako_heat:uc,eltako_water_m3:vc,eltako_water_m4:wc,eltako_tf_switch:bd,eltako_tf_dimmer:dd,eltako_tf_blind:ed,peha_switch:yb,peha_powerswitch:Ta,peha_blind:Ua,"bb-aa-cc":Y,
afriso_water_con:Zc,afriso_water_eco:xc,afriso_asd_10:$c,hoppe_door:yc,gp:cd,afriso_ais_10:fd,eltako_tf_ttb:Va.TF_TTB,eltako_tf_smoke:Va.TF_RWB,eltako_tf_contact:Va.TF_FKB,eltako_tf_motion:Va.TF_BHSB,eltako_motion2:Va.TF_BHSB_FBH,eltako_tf_thermo:Va.TF_Thermo,eltako_tf_input:Va.TF_Input,eltako_tf_lux:Va.TF_Lux,eltako_dimmer_knob:Va.Dimmer_Knob,eltako_tf_alarm:Va.TF_Alarm,eltako_f6t:Va.Eltako_F6T,parseDBJson:function(a){if(!a||!a.eep)return null;var b=this[a.eep];if(!b)return null;b=new b;return b=
b.fromDBJSON(a)},parseJson:function(a){if(!a||!a.data)return null;var b=this[a.data];if(!b)return null;b=new b;return b=b.fromJSON(a)}}}();
x.hub.m.enocean.SiegeniaHandler=function(){var q=function(h){this._logger=require("x.logger.js").getLogger("x.hub.m.enocean.SiegeniaHandler");this._esp3=h;this._calibateListener=this._window=this._windowID=this._esp3Listener=null};q.prototype.startCalibateWindow=function(h,e){if(this._calibateListener)e&&e(Error("configuraion of window running"));else{this._calibateListener=e;this._windowID=h;this._window=new x.hub.m.enocean.profiles["d2-06-50"];var g=this;this._esp3Listener={_onEOTelegram:function(f){var m=
!1;g._windowID&&g._windowID==f.senderID?m=!0:g._windowID||210!=f.rorg||(m=!0);m&&g._calibateListener&&(m=g._window.evalTelegram(f))&&17==m.type&&g._calibateListener(null,f.senderID,m)}};this._esp3.addListener(this._esp3Listener)}};q.prototype.stopCalibateWindow=function(){this._esp3Listener&&this._esp3.removeListener(this._esp3Listener);this._window=this._windowID=this._calibateListener=this._esp3Listener=null};q.prototype.configWindow=function(h,e,g,f){e="FFFFFFFF";f||(f=x.hub.m.enocean.SENDER_ID);
this._logger.log("info","config siegenia window:"+JSON.stringify(h));this._logger.log("info","window id:"+e+" sender id:"+f);var m=parseInt(h.alive),p=parseInt(h.sync),l=parseInt(h.eep),u=parseInt(h.type),w=parseInt(h.alarm);h=parseInt(h.alarm_sens);var E=[128,2,127,240,1,140,57,45,245],A=[192,13,127,242,49,0,0,2,m>>8&255],L=[193,m&255,0,1,2,p>>8&255,p&255,0,2],N=[194,1,l,0,3,1,u,0,4],G=[195,1,w,0,5,1,h,0,0],Q=[128,2,127,240,2,140,57,45,245],J=this;this._logger.log("info","send config siegenia window (data1):"+
(new Buffer(E)).toString("hex"));this._esp3._recomm.sendRawSysEx(new Buffer(E),e,f,function(ca){if(ca&&(J._logger.log("warn","config siegenia window error (data1):"+ca.message+" ["+ca.code+"]"),100!=ca.code)){g&&g(ca);return}J._logger.log("info","send config siegenia window (data2):"+(new Buffer(A)).toString("hex"));J._esp3._recomm.sendRawSysEx(new Buffer(A),e,f,function(ia){if(ia&&(J._logger.log("warn","config siegenia window error (data2):"+ia.message+" ["+ia.code+"]"),100!=ia.code)){g&&g(ia);return}J._logger.log("info",
"send config siegenia window (data3):"+(new Buffer(L)).toString("hex"));J._esp3._recomm.sendRawSysEx(new Buffer(L),e,f,function(ka){if(ka&&(J._logger.log("warn","config siegenia window error (data3):"+ka.message+" ["+ka.code+"]"),100!=ka.code)){g&&g(ka);return}J._logger.log("info","send config siegenia window (data4):"+(new Buffer(N)).toString("hex"));J._esp3._recomm.sendRawSysEx(new Buffer(N),e,f,function(da){if(da&&(J._logger.log("warn","config siegenia window error (data4):"+da.message+" ["+da.code+
"]"),100!=da.code)){g&&g(da);return}J._logger.log("info","send config siegenia window (data5):"+(new Buffer(G)).toString("hex"));J._esp3._recomm.sendRawSysEx(new Buffer(G),e,f,function(R){if(R&&(J._logger.log("warn","config siegenia window error (data5):"+R.message+" ["+R.code+"]"),100!=R.code)){g&&g(R);return}J._logger.log("info","send config siegenia window (data6):"+(new Buffer(Q)).toString("hex"));J._esp3._recomm.sendRawSysEx(new Buffer(Q),e,f,function(O){O&&J._logger.log("warn","config siegenia window error (data5):"+
O.message+" ["+O.code+"]");O&&100!=O.code?g&&g(O):g&&g()})})})})})})};return q}();
x.hub.m.enocean.RehauHandler=function(){var q=function(f){this._logger=require("x.logger.js").getLogger("x.hub.m.enocean.RehauHandler.InoventAccessory");this._inoventID=f;this._co2SensorID=this._humiditySensorID=null;this._co2RegulationActive=this._humRegulationActive=!1;this._humidityState=null;this._humidityLevel=0;this._co2State=null;this._co2Level=0};q.prototype.getHumiditySensorID=function(){return this._humiditySensorID};q.prototype.setHumiditySensorID=function(f){this._humiditySensorID=f};
q.prototype.getCo2SensorID=function(){return this._co2SensorID};q.prototype.setCo2SensorID=function(f){this._co2SensorID=f};q.prototype.activateSensorRegulation=function(f){if(5==f)this._humRegulationActive=!0,this._co2RegulationActive=!1;else if(6==f)this._humRegulationActive=!1,this._co2RegulationActive=!0;else{this._co2RegulationActive=this._humRegulationActive=!1;return}this._co2Level=this._humidityLevel=0;this._humRegulationActive&&this._humiditySensorID&&null!=this._humidityState&&this.executeHumidityRegulation(this._humidityState);
this._co2RegulationActive&&this._co2SensorID&&null!=this._co2State&&this.executeCo2Regulation(this._co2State)};q.prototype.deactivateSensorRegulation=function(){this._co2RegulationActive=this._humRegulationActive=!1;this._co2Level=this._humidityLevel=0};q.prototype.executeHumidityRegulation=function(f){this._humidityState=f;this._logger.log("trace","["+this._inoventID+"] receive hum:"+f);if(this._humRegulationActive){var m=this._calculateHumidityLevel(f);this._logger.log("trace","["+this._inoventID+
"] target level:"+m);(!this._humidityLevel||m!=this._humidityLevel&&this._exceedHumidityHysteresis(this._humidityLevel,f))&&this._changeHumLevel(m)}};q.prototype._calculateHumidityLevel=function(f){return 50>=f?1:60>=f?2:70>=f?3:4};q.prototype._exceedHumidityHysteresis=function(f,m){switch(f){case 1:return 55<=m;case 2:return 45>=m||65<=m;case 3:return 55>=m||75<=m;case 4:return 65>=m}};q.prototype._changeHumLevel=function(f){var m=this;require("x.hub.m.enocean.js").executeCommand({address:this._inoventID},
{value:"setHumLevel"+f},function(p){p&&p.error||(m._humidityLevel=f)})};q.prototype.executeCo2Regulation=function(f){this._co2State=f;this._logger.log("trace","["+this._inoventID+"] receive co2:"+f);if(this._co2RegulationActive){var m=this._calculateCo2Level(f);this._logger.log("trace","["+this._inoventID+"] target level:"+m);(!this._co2Level||m!=this._co2Level&&this._exceedCo2Hysteresis(this._co2Level,f))&&this._changeCo2Level(m)}};q.prototype._calculateCo2Level=function(f){return 600>=f?1:1E3>=
f?2:1500>=f?3:4};q.prototype._exceedCo2Hysteresis=function(f,m){switch(f){case 1:return 700<=m;case 2:return 500>=m||1100<=m;case 3:return 900>=m||1600<=m;case 4:return 1400>=m}};q.prototype._changeCo2Level=function(f){var m=this;require("x.hub.m.enocean.js").executeCommand({address:this._inoventID},{value:"setCo2Level"+f},function(p){p&&p.error||(m._co2Level=f)})};q.prototype.toJSON=function(){return{humidity:this._humiditySensorID,co2:this._co2SensorID}};q.prototype.fromJSON=function(f){f&&(this._humiditySensorID=
f.humidity,this._co2SensorID=f.co2)};var h=function(f){this._logger=require("x.logger.js").getLogger("x.hub.m.enocean.RehauHandler.WindowAlarm");this._handler=f;this._active=!1;this._sensors={}};h.prototype.setAlarm=function(f){this._logger.log("trace","set alarm active:"+f);this._active=f};h.prototype.getAlarm=function(){return this._active};h.prototype.onReceiveWindowSensorStates=function(f,m){this._logger.log("trace","receive window:"+f.getAddress()+" states:"+JSON.stringify(m));if(this._active){var p=
f.getAddress(),l=this._sensors[p];l||(this._sensors[p]={lastEvent:"IDLE"},l=this._sensors[p]);this._logger.log("trace","last event for window:"+f.getAddress()+" is:"+l.lastEvent);m&&(m.pre_alarm&&"PRE_ALARM"!=l.lastEvent?(l.lastEvent="PRE_ALARM",this._logger.log("trace","window:"+f.getAddress()+" pre_alarm triggered"),this.triggerAlarm(!0)):m.alarm&&"ALARM"!=l.lastEvent?(l.lastEvent="ALARM",this._logger.log("trace","window:"+f.getAddress()+" alarm triggered"),this.triggerAlarm()):m.alarm||m.pre_alarm||
(this._logger.log("trace","new event for window:"+f.getAddress()+" is:IDLE and stop timer"),l.lastEvent="IDLE"))}};h.prototype.triggerAlarm=function(f){require("x.hub.taskman.js").getRehauAlarmTaskManager().onWindowSensorAlarmTriggered(f)};var e=function(f){this._logger=require("x.logger.js").getLogger("x.hub.m.enocean.RehauHandler.SmartguardSetting");this._smartguardID=f;this._prealarmActive=this._alarmActive=!0};e.prototype.isAlarmActive=function(){return this._alarmActive?!0:!1};e.prototype.isPreAlarmActive=
function(){return this._prealarmActive?!0:!1};e.prototype.setAlarm=function(f){this._alarmActive=f?!0:!1};e.prototype.setPreAlarm=function(f){this._prealarmActive=f?!0:!1};e.prototype.toJSON=function(){return{alarm:this._alarmActive,pre_alarm:this._prealarmActive}};e.prototype.fromJSON=function(f){f&&(this._alarmActive=f.alarm,this._prealarmActive=f.pre_alarm)};var g=function(){this._logger=require("x.logger.js").getLogger("x.hub.m.enocean.RehauHandler");this._mainHandler=null;this._windowAlarm=new h(this);
this._inoventAccessories={};this._smartguardSettings={}};g.prototype.REHAU_FILE="enocean_rehau.json";g.prototype.init=function(f,m){this._logger.log("trace","init");var p=this;if(this._mainHandler=f)if(f=f.getDeviceHandler())f.on("deleteDevice",function(l){p.onDeleteDevice(l)});this._loadInoventAccessories(function(l,u,w){l&&p._logger.log("warn","init error:"+l.message);u&&(p._inoventAccessories=u);w&&(p._smartguardSettings=w);m&&m()})};g.prototype.getInoventAccessory=function(f){return f?this._inoventAccessories[f]:
null};g.prototype.deleteInoventAccessory=function(f,m){f&&this._inoventAccessories[f]?(delete this._inoventAccessories[f],this._saveData(m)):m&&m()};g.prototype.getSmartguardSetting=function(f){return f?this._smartguardSettings[f]:null};g.prototype.deleteSmartguardSetting=function(f,m){f&&this._smartguardSettings[f]?(delete this._smartguardSettings[f],this._saveData(m)):m&&m()};g.prototype.setHumidityAccessory=function(f,m,p){if(f){var l=this.getInoventAccessory(f);l||(l=new q(f),this._inoventAccessories[f]=
l);if(m&&"string"==typeof m&&"{"==m.charAt(0))try{m=JSON.parse(m)}catch(u){p&&p(Error("invalid humiditySensorID json: "+u.message));return}l.setHumiditySensorID(m);this._saveData(p)}else p&&p(Error("inoventID is null"))};g.prototype.setCo2Accessory=function(f,m,p){if(f){var l=this.getInoventAccessory(f);l||(l=new q(f),this._inoventAccessories[f]=l);l.setCo2SensorID(m);this._saveData(p)}else p&&p(Error("inoventID is null"))};g.prototype.activateSensorRegulation=function(f,m){(f=this.getInoventAccessory(f))&&
f.activateSensorRegulation(m)};g.prototype.deactivateSensorRegulation=function(f){(f=this.getInoventAccessory(f))&&f.deactivateSensorRegulation()};g.prototype.isWindowOpen=function(){var f=this._mainHandler.getDeviceHandler(),m=f.findDeviceWithData("bb-aa-cc"),p=f.findDeviceWithData("d2-06-10"),l=f.findDeviceWithData("d2-06-ff");f=f.findDeviceWithData("smartguard2");p&&(m=m.concat(p));l&&(m=m.concat(l));f&&(m=m.concat(f));p=!1;for(l=0;l<m.length;l++)if((f=m[l])&&"open"==f.getBufferedState("window")){p=
!0;break}return p};g.prototype.setAlarm=function(f,m){this._windowAlarm.setAlarm(f);var p=this._mainHandler.getDeviceHandler(),l=p.findDeviceWithData("bb-aa-cc"),u=p.findDeviceWithData("d2-06-10"),w=p.findDeviceWithData("d2-06-ff");p=p.findDeviceWithData("smartguard2");u&&(l=l.concat(u));w&&(l=l.concat(w));p&&(l=l.concat(p));u=this._mainHandler.getESP3();for(w=0;w<l.length;w++)if(p=l[w])p.executeCommand(u,{value:f?"alarmTaskOn":"alarmTaskOff"}),p.executeCommand(u,{value:f?"preAlarmTaskOn":"preAlarmTaskOff"});
m&&m()};g.prototype.getAlarm=function(){return this._windowAlarm.getAlarm()};g.prototype.setSmartGuardAlarm=function(f,m,p){if(f){var l=this._smartguardSettings[f];l||(l=new e(f),this._smartguardSettings[f]=l);l.setAlarm(m);this._saveData(p)}else p&&p(Error("smartguardID invalid"))};g.prototype.setSmartGuardPreAlarm=function(f,m,p){if(f){var l=this._smartguardSettings[f];l||(l=new e(f),this._smartguardSettings[f]=l);l.setPreAlarm(m);this._saveData(p)}else p&&p(Error("smartguardID invalid"))};g.prototype.onReceiveWindowSensorStates=
function(f,m){this._windowAlarm.onReceiveWindowSensorStates(f,m)};g.prototype.onDeleteDevice=function(f){if(f&&(f=f.getAddress()))if(this.getInoventAccessory(f))this.deleteInoventAccessory(f);else if(this.getSmartguardSetting(f))this.deleteSmartguardSetting(f);else{var m=!1,p;for(p in this._inoventAccessories){var l=this._inoventAccessories[p];l&&(l.getHumiditySensorID()==f&&(l.setHumiditySensorID(null),m=!0),l.getCo2SensorID()==f&&(l.setCo2SensorID(null),m=!0))}m&&this._saveData()}};g.prototype.onDeviceEvent=
function(f,m){var p=function(A){for(var L=null,N=0;N<A.length;N++){var G=A[N];if(G&&"humidity"==G.key){L=G.value;break}}return L},l=function(A){for(var L=null,N=0;N<A.length;N++){var G=A[N];if(G&&"co2"==G.key){L=G.value;break}}return L};if(f){var u="ENOCEAN";f.getType&&(u=f.getType());u||(u="ENOCEAN");var w=f.getAddress();if(w)if("HM"==u){if(m){this._logger.log("trace","process homematic device ("+w+") events:"+JSON.stringify(m));for(var E in this._inoventAccessories)if(f=this._inoventAccessories[E])(p=
f.getHumiditySensorID())&&p.key&&p.address==w&&(u=m[p.key],void 0!=u&&null!=u&&f.executeHumidityRegulation(u)),(p=f.getHumiditySensorID())&&p.key&&p.address==w&&(u=m[p.key],void 0!=u&&null!=u&&f.executeCo2Regulation(u))}}else if("ENOCEAN"==u&&f.getData){this._logger.log("trace","process enocean device ("+w+") events:"+JSON.stringify(m));u=null;switch(f.getData()){case "a5-04-01":case "a5-04-03":case "a5-10-12":u=p(m);break;case "a5-09-08":case "a5-09-09":u=l(m);break;default:return}if(void 0!=u&&
null!=u)for(E in this._inoventAccessories)if(f=this._inoventAccessories[E])f.getHumiditySensorID()==w&&f.executeHumidityRegulation(u),f.getCo2SensorID()==w&&f.executeCo2Regulation(u)}}};g.prototype._loadInoventAccessories=function(f){var m=this;this._loadFile(function(p,l){p?f&&f(p):(p=m._jsonToAccessoriesMap(l),l=m._jsonToSmartGuardSettingsMap(l),f&&f(null,p,l))})};g.prototype._jsonToAccessoriesMap=function(f){if(!f||!f.inovent)return{};var m={},p;for(p in f.inovent){var l=f.inovent[p];if(l){var u=
new q(p);u.fromJSON(l);m[p]=u}}return m};g.prototype._jsonToSmartGuardSettingsMap=function(f){if(!f||!f.smartguard)return{};var m={},p;for(p in f.smartguard){var l=f.smartguard[p];if(l){var u=new e(p);u.fromJSON(l);m[p]=u}}return m};g.prototype._loadFile=function(f){var m=this._getFilePath();fs_extra.ensureFile(m,function(p){p?f&&f(p):fs_extra.readFile(m,"utf8",function(l,u){if(l)f&&f(l);else if(u)try{var w=JSON.parse(u);f&&f(null,w)}catch(E){f&&f(E)}else f&&f(null,{})})})};g.prototype._getFilePath=
function(){var f=require("x.hub.fileman.js").fileManager,m=require("path");require("fs");f=f.getUserRootDataPath();return m.resolve(f,this.REHAU_FILE)};g.prototype._saveData=function(f){var m=this._accessoriesMapToJson(this._inoventAccessories),p=this._settingsMapToJson(this._smartguardSettings);this._saveFile({inovent:m?m:{},smartguard:p?p:{}},function(l){f&&f(l)})};g.prototype._accessoriesMapToJson=function(f){if(!f)return{};var m={},p;for(p in f){var l=f[p];l&&(l=l.toJSON(),m[p]=l)}return m};g.prototype._settingsMapToJson=
function(f){if(!f)return{};var m={},p;for(p in f){var l=f[p];l&&(l=l.toJSON(),m[p]=l)}return m};g.prototype._saveFile=function(f,m){var p=this._getFilePath();fs_extra.writeFile(p,JSON.stringify(f,null,2),function(l){m&&m(l)})};return g}();
x.hub.m.enocean.SDK=function(){var q=function(h){this._handler=h};q.prototype.send_SA_RD_LEARNEDCLIENTS=function(h,e){h=new x.hub.m.enocean.ESP3.SA_COMMAND.SA_RD_LEARNEDCLIENTS;this._handler._esp3.sendSACommand(h,!0,function(g,f){e&&e(g,f)})};q.prototype.send_SA_WR_RESET=function(h,e){h&&h.saClientId?(h=new x.hub.m.enocean.ESP3.SA_COMMAND.SA_WR_RESET(h.saClientId),this._handler._esp3.sendSACommand(h,!0,function(g,f){e&&e(g,f)})):e&&e(Error("params invalid"))};q.prototype.send_SA_WR_POSTMASTER=function(h,
e){h?(h.mailboxCount||(h.mailboxCount=0),h=new x.hub.m.enocean.ESP3.SA_COMMAND.SA_WR_POSTMASTER(h.mailboxCount),this._handler._esp3.sendSACommand(h,!0,e)):e&&e(Error("params invalid"))};q.prototype.send_CO_WR_REPEATER=function(h,e){h?(h.enable||(h.enable=0),h.level||(h.level=0),h=new x.hub.m.enocean.ESP3.COMMAND_COMMAND.CO_WR_REPEATER(h.enable,h.level),this._handler._esp3.sendCommandCommand(h,!0,e)):e&&e(Error("params invalid"))};return q}();
x.hub.m.enocean.Util={esp2toesp3:function(q){if(!(q&&q instanceof x.hub.m.enocean.ESP2.Telegram))return null;q=q.toPayload();if(!q)return null;var h=q.getData(),e=q.getSenderID(),g=q.getStatus(),f=g&15;return q instanceof x.hub.m.enocean.ESP2.Payload.RPS?(h=h.readUInt8(0),q=new x.hub.m.enocean.ESP3.Telegram.RPS(h,e,g>>5&1,g>>4&1,f)):q instanceof x.hub.m.enocean.ESP2.Payload.BS1?(h=h.readUInt8(0),q=new x.hub.m.enocean.ESP3.Telegram.BS1(h,e,f)):q instanceof x.hub.m.enocean.ESP2.Payload.BS4?q=new x.hub.m.enocean.ESP3.Telegram.BS4(h,
e,f):null},esp3toesp2:function(q){if(!(q&&q instanceof x.hub.m.enocean.ESP3.Telegram))return null;var h=null,e=q.userData,g=q.senderID;q instanceof x.hub.m.enocean.ESP3.Telegram.RPS?(h=q.t21<<5|q.nu<<4||q.rc,h=new x.hub.m.enocean.ESP2.Payload.RPS(e,g,h)):q instanceof x.hub.m.enocean.ESP3.Telegram.BS1?(h=q.rc&15,h=new x.hub.m.enocean.ESP2.Payload.BS1(e,g,h)):q instanceof x.hub.m.enocean.ESP3.Telegram.BS4&&(h=q.rc&15,h=new x.hub.m.enocean.ESP2.Payload.BS4(e,g,h));return h?(e=new x.hub.m.enocean.ESP2.TRT,
e.fromPayload(h),e):null},buffer2esp3:function(q){if(85!=q[0]||6>=q.length)return null;var h=(q[1]<<8)+q[2],e=q[3],g=q[5];if(q.length<h+e+7||x.hub.m.enocean.CRC8(q.slice(1,5))!=g)return null;g=q[h+e+6];if(x.hub.m.enocean.CRC8(q.slice(6,6+h+e))!=g)return null;var f=q[4];g=q[6];var m=q.slice(6,6+h),p=q.slice(6+h,6+h+e);q.slice(0,6+h+e+1).toString("hex");q=new x.hub.m.enocean.ESP3.ESP3_Frame(f,m,p);166!=g&&210!=g&&165!=g&&246!=g&&213!=g||m.slice(h-5,h-1).toString("hex");return(h=q.toPacket())&&h instanceof
x.hub.m.enocean.ESP3.RADIO_ERP1_Packet?h.toRadioTelegram():null}};
x.hub.m.enocean.USBHandler=function(){var q=function(h){this._logger=require("x.logger.js").getLogger("x.hub.m.enocean.USBHandler");this._handler=h;this._usbDevices=[];this._connectedESP2=this._connectedESP3=null};q.prototype.attachSerial=function(h){this._logger.log("debug","attach usb port:"+h);var e=this._usbDevices.length;this._usbDevices.push({port:h});0==e&&this._attachNextDevice()};q.prototype.removeSerial=function(h){this._logger.log("debug","remove usb port:"+h);if(this._connectedESP3&&this._connectedESP3.port==
h){this._connectedESP3=null;var e=this._handler._esp3.getSerial();e&&e.getPort()==h&&this._handler._esp3.removeSerial(h)}this._connectedESP2&&this._connectedESP2.port==h&&(this._connectedESP2=null,(e=this._handler._esp2.getSerial())&&e.getPort()==h&&this._handler._esp2.removeSerial(h))};q.prototype._attachNextDevice=function(){if(0!=this._usbDevices.length){var h=this._usbDevices[0],e=this;this._logger.log("debug","connect usb port:"+h.port);this._testESP3(h.port,function(g){g?e._testESP2(h.port,
function(f){f||(e._connectedESP2=h);e._usbDevices.splice(0,1);e._attachNextDevice()}):(e._connectedESP3=h,e._usbDevices.splice(0,1),e._attachNextDevice())})}};q.prototype._testESP3=function(h,e){this._logger.log("debug","try esp3 on usb port:"+h);var g=this._handler._esp3;if(g.getSerial())this._logger.log("debug","enocean usb device already exist"),e(Error("enocean usb device already exist"));else{var f=this;g.attachSerial(h,function(m){m?f._logger.log("debug",h+" is not a enocean usb device, error:"+
m.message):f._logger.log("debug","success to connect to enocean usb device on port:"+h);e(m)})}};q.prototype._testESP2=function(h,e){this._logger.log("debug","try esp2 on usb port:"+h);var g=this._handler._esp2;if(g.getSerial())this._logger.log("debug","FGW14 device already exist"),e(Error("FGW14 device already exist"));else{var f=this;g.attachSerial(h,function(m){m?f._logger.log("debug",h+" is not a FGW14 gateway, error:"+m.message):f._logger.log("debug","connect to FGW14 on port "+h+" success");
e(m)})}};return q}();
x.hub.m.enocean.Handler=function(){var q=function(){this._logger=require("x.logger.js").getLogger("x.hub.m.enocean.Handler");this._secHandler=new this.SecurityHandler(this);this._deviceHandler=new this.DeviceHandler(this);this._esp3=new x.hub.m.enocean.ESP3(this);this._esp2=new x.hub.m.enocean.ESP2(this);this._learnHandler=new this.LearnHandler(this);this._siegeniaHandler=new x.hub.m.enocean.SiegeniaHandler(this._esp3);this._rehauHandler=new x.hub.m.enocean.RehauHandler;this._trackers=[];this._sdk=
new x.hub.m.enocean.SDK(this);this._usb=new x.hub.m.enocean.USBHandler(this)};util.inherits(q,EventEmitter);q.prototype.Serial=x.hub.m.enocean.Serial;q.prototype.SENSOR_FILE="enocean.json";q.prototype.SECURITY_FILE="enocean_sec.json";q.prototype.profiles=x.hub.m.enocean.profiles;q.prototype.ESP2=x.hub.m.enocean.ESP2;q.prototype.ESP3=x.hub.m.enocean.ESP3;q.prototype.SecurityHandler=x.hub.m.enocean.SecurityHandler;q.prototype.LearnHandler=x.hub.m.enocean.LearnHandler;q.prototype.DeviceHandler=x.hub.m.enocean.DeviceHandler;
q.prototype.getDeviceHandler=function(){return this._deviceHandler};q.prototype.getRehauHandler=function(){return this._rehauHandler};q.prototype.getESP3=function(){return this._esp3};q.prototype.init=function(h){localStorage&&localStorage.getItem("x.hub.m.enocean.SENDER_ID")&&(x.hub.m.enocean.SENDER_ID=localStorage.getItem("x.hub.m.enocean.SENDER_ID"));localStorage&&localStorage.getItem("x.hub.m.enocean.ESP2_BAUDRATE")&&(this._esp2._baudrate=parseInt(localStorage.getItem("x.hub.m.enocean.ESP2_BAUDRATE")));
var e=this,g=require("x.hub.eventbus.js");g.on("x.hub.peripheralman.ADD_ENOCEAN",function(f){console.log("ADD_ENOCEAN",f);e._usb.attachSerial(f.port)});g.on("x.hub.peripheralman.REMOVE_ENOCEAN",function(f){console.log("REMOVE_ENOCEAN",f);e._usb.removeSerial(f.port)});g.on("x.hub.peripheralman.ADD_SEIRAL",function(f){console.log("ADD_SEIRAL",f);f.type||e._usb.attachSerial(f.port)});g.on("x.hub.peripheralman.REMOVE_SEIRAL",function(f){console.log("REMOVE_SEIRAL",f);f.type||e._usb.removeSerial(f.port)});
global.ENOCEAN_PORT&&"A20"!=global.PLATFORM&&"PI2"!=global.PLATFORM&&e._usb.attachSerial(global.ENOCEAN_PORT);global.ENOCEAN_FGW14_PORT&&"A20"!=global.PLATFORM&&"PI2"!=global.PLATFORM&&e._usb.attachSerial(global.ENOCEAN_FGW14_PORT);g.on("gatewayevent",function(f,m,p){if(f&&m&&"ENOCEAN"!=m.address&&"STA"==p)e._rehauHandler.onDeviceEvent({_type:f.type,_adr:f.adr,getType:function(){return this._type},getAddress:function(){return this._adr}},f.state)});this._secHandler.init(function(){e._rehauHandler.init(e,
function(){e._deviceHandler.init(function(){h&&h({})})})})};q.prototype.getSystems=function(){return["enocean"]};q.prototype.addStateDevice=function(h,e){e&&e({})};q.prototype.getAllStates=function(){var h=[],e=this._deviceHandler.getAllDevices(),g;for(g in e)if(e.hasOwnProperty(g)){var f=e[g];f&&h.push({device:f.toJSON(),states:f.getStatesBuffer()})}return h};q.prototype.getStates=function(h){if(!h||!h.address)return null;var e=null;(h=this._deviceHandler.getDevice(h.address.toLowerCase()))&&(e=
h.getStatesBuffer());return e};q.prototype.getState=function(h,e,g){var f=this.getStates(h),m=null;f&&"undefined"!=typeof f[e]&&null!=f[e]?(m=f[e],g&&g({data:m})):g&&this.updateStates(h,function(p){p.error?g&&g(p):(p.data&&(m=f[e]),g({data:m}))});return m};q.prototype.executeCommand=function(h,e,g){this._esp3._baseID?this._esp3._baseID.toLowerCase()!=x.hub.m.enocean.SENDER_ID.toLowerCase()?g&&g({error:Error("enocean stick has a different baseID")}):h&&h.address?((h=h.address)&&(h=h.toLowerCase()),
(h=this._deviceHandler.getDevice(h))?h.executeCommand?h.executeCommand(this._esp3,e,function(f){g&&g({error:f})}):g&&g({error:Error("device dese not support command")}):g&&g({error:Error("no such device")})):g&&g({error:Error("device invalid")}):g&&g({error:Error("enocean stick not found")})};q.prototype.checkDeviceMatch=function(h,e){if(!(e&&e.device&&h&&h.device))return!1;(h=h.device.address)&&(h=h.toLowerCase());(e=e.device.address)&&(e=e.toLowerCase());return h==e};q.prototype.updateStates=function(h,
e){e&&e({error:Error("not supported yet")})};q.prototype.executeCommandLegacy=function(h,e,g,f){h?f&&f({error:Error("not supported yet")}):this._esp3?e?this.executeCommand({address:e},{value:g},function(m){f&&f({error:m?m.error:null})}):f&&f({error:Error("address invalid")}):f&&f({error:Error("not inited")})};q.prototype.getAllStatesLegacy=function(h,e){var g=[],f=this.getAllStates(),m=this._secHandler.getUnsyncDevice(),p=this;f.forEach(function(l){if(l&&l.device&&l.states){var u=l.device.address,
w={type:"ENOCEAN",adr:u,data:l.device.data,vendor:l.device.vendor,state:{}},E;for(E in l.states)w.state[E]=l.states[E].value;p._secHandler.isSecureDevice(u)?(w.deviceProtocol="secure",w.state.security_state=m[u]?"nok":"ok"):w.deviceProtocol="normal";e&&"1"==e.config&&(w.senderID=l.device.senderID,w.virtual=l.device.virtual,w.params=l.device.params,u&&m[u]&&(w.rlc_unsync=!0));g.push(w)}});h&&h({data:g})};q.prototype.getEnoceanInfo=function(){var h={baseID:x.hub.m.enocean.SENDER_ID,usb_connected:null!=
this._esp3._serial,usb_baseID:this._esp3._baseID,num_free_senderID:this._deviceHandler.getFreeSenderIdCount(),fgw14_connected:null!=this._esp2.getSerial(),fgw14_baudrate:this._esp2._baudrate};h.fgw14_connected&&(h.fgw14_port=this._esp2.getSerial().getPort(),h.fgw14_baseID=this._esp2._baseID);return h};q.prototype.learnDevice=function(h,e){var g=h?h.senderID:null,f=h?h.data:null,m=h?h.vendor:null,p=h?h.address:null;if(p){f=this._deviceHandler.findDevice(h);if(!f){e&&e({error:Error("device not found")});
return}var l=f.toJSON();f=l.data;m=l.vendor;g||(sednerID=l.senderID)}l={};l.saLearnMode=h?h.saLearnMode:null;this._learnHandler.learn(f,p,g,m,null,function(u,w,E){u?e&&e({error:u}):(u={},1==w?u.op=1:(u=E.toJSON(),u.op=0),e&&e({data:u}))},l)};q.prototype.learnSoda=function(h){if(this._esp3._serial){var e=this,g=setTimeout(function(){e._esp3.removeListener(f);h&&h({error:Error("learn timeout")})},2E4),f={_onEOTelegram:function(m){if(246==m.rorg&&(192==m.userData||208==m.userData||240==m.userData)){clearTimeout(g);
e._esp3.removeListener(f);var p={address:m.senderID,data:"f6-so-da",vendor:"soda"};e.addSensor(m.senderID,"f6-so-da","soda",null,function(l){l.error?h&&h(l):h&&h({data:p})})}}};this._esp3.addListener(f)}else h&&h({error:Error("port not opened")})};q.prototype.teachinDevice=function(h,e){if(h)if(h.data){h.adr&&!h.address&&(h.address=h.adr);var g=this._deviceHandler.findDevice(h);g=g?g.toJSON():h;h.data!=g.data?e&&e({error:Error("device of another type with the same address exists")}):h.vendor&&h.vendor!=
g.vendor?e&&e({error:Error("device of another vendor with the same address exists")}):this._learnHandler.teachin(g.data,g.address,g.senderID,g.vendor,function(f,m,p){f?e&&e({error:f}):(f={},m&&(f=m.toJSON()),p&&(f.op=p),e&&e({data:f}))})}else e&&e({error:Error("data is null")});else e&&e({error:Error("query is null")})};q.prototype.generateVirtualDevice=function(h,e){this._deviceHandler.generateVirtual(h,function(g,f){e&&e({error:g,data:f?f.toJSON():null})})};q.prototype.setFGW14Baudrate=function(h,
e){this._esp2?(localStorage.setItem("x.hub.m.enocean.ESP2_BAUDRATE",h),this._esp2._baudrate=h,e&&e({})):e&&e({error:{code:"01000",message:"no esp2 object"}})};q.prototype.sendToFGW14=function(h,e){this._logger.log("trace","stm -> fgw14, forward esp3 telegram:"+h.toString("hex"));if(this._esp2||this._esp2.getSerial())if(h=x.hub.m.enocean.Util.buffer2esp3(h))if(h=x.hub.m.enocean.Util.esp3toesp2(h)){this._logger.log("trace","stm -> fgw14, convert to esp2 telegram:"+h.toBuffer().toString("hex"));var g=
this;this._esp2.sendTelegram(h,null,function(p){g._logger.log("trace","stm -> fgw14, forward finish "+(p?"failed:"+p.messsage:"success"));f=new x.hub.m.enocean.ESP3.Response(0);m=f.toPacket().toFrame().toBuffer();e&&e(m)})}else{this._logger.log("trace","stm -> fgw14, failed to convert esp3 telegram to esp2 telegram");var f=new x.hub.m.enocean.ESP3.Response(3);var m=f.toPacket().toFrame().toBuffer();e&&e(m)}else this._logger.log("trace","stm -> fgw14, invalid esp3 telegram"),f=new x.hub.m.enocean.ESP3.Response(3),
m=f.toPacket().toFrame().toBuffer(),e&&e(m);else this._logger.log("trace","stm -> fgw14, fgw14 not connected"),f=new x.hub.m.enocean.ESP3.Response(1),m=f.toPacket().toFrame().toBuffer(),e&&e(m)};q.prototype._onESP2Telegram=function(h){if("CA"==global.HARDWARE_VERSION){var e=x.hub.m.enocean.Util.esp2toesp3(h);if(e){var g=this;h=e.toPacket().toFrame().toBuffer();this._logger.log("trace","convert to esp3 telegram:"+JSON.stringify(e.toJSON()));this._logger.log("trace","convert to esp3:"+h.toString("hex")+
" and forward to stm");(e=require("x.hub.v6.js").getSTM())&&e.sendCommand(144,h,function(f){g._logger.log("trace","forward to stm result:"+JSON.stringify(f))})}}};q.prototype._onEOFrame=function(h,e){this._trackers.forEach(function(g){g.onFrame(h,e)})};q.prototype._onEOTelegram=function(h){this._trackers.forEach(function(f){f.onTelegram(h)});var e=this._deviceHandler.getDevice(h.senderID);if(e){var g=this;e.evalData(this._esp3,h,function(f,m){f||0==m.length||g._onEOEvents(e,m)})}};q.prototype._onEOEvents=
function(h,e){var g=require("x.hub.eventbus.js");this._trackers.forEach(function(w){w.onResolveEvents(h._address,e)});this._rehauHandler.onDeviceEvent(h,e);var f=h.toJSON();f.sys="aio";f.type="ENOCEAN";for(var m=0,p=0;p<e.length;p++){var l=e[p];if(l)if("shortPress"==l.value||"longPress"==l.value||"pressed"==l.value||"released"==l.value){m++;var u={type:"ENOCEAN",adr:f.address,data:f.data,vendor:f.vendor,state:{}};u.state[l.key]=l.value;g.emit("gatewayevent",u,{address:"ENOCEAN"},"BTN")}else if("d2-06-50"==
f.data&&"burglary"==l.key){u={type:"ENOCEAN",adr:f.address,data:f.data,vendor:f.vendor,state:{}};u.state[l.key]=l.value;g.emit("gatewayevent",u,{address:"ENOCEAN"},"STA");return}}if(m==e.length)(f=h.getStatesLegacy())&&g.emit("udpevent",f,"STA");else if(f=h.getStatesLegacy())g.emit("gatewayevent",f,{address:"ENOCEAN"},"STA"),g.emit("udpevent",f,"STA")};q.prototype._saveEnoceanEvents=function(h,e){var g=require("x.hub.datastore.js").dataStore;g&&g.openDB(function(f,m){if(!f){f=h._address;for(var p=
[],l=(new Date).toISOString(),u=0;u<e.length;u++){var w=e[u];if(w&&w.changed){w=w.key+":"+w.value;var E=null;E=0==p.length?"SELECT '"+f+"' AS 'window', '"+w+"' AS 'state', '"+l+"' AS 'time'":"UNION ALL SELECT '"+f+"', '"+w+"', '"+l+"'";p.push(E)}}0<p.length&&(f=p.join(" "),m.run("INSERT INTO windowstate(window, state, time) "+f+";",function(A){m.close()}))}})};q.prototype.addSensor=function(h,e){h?h.data?"siegenia"!=h.vendor||h.params?this._deviceHandler.addDevice(h,function(g,f){e&&e({error:g,data:f?
f.toJSON():null})}):e&&e({error:Error("siegenia windows params is null")}):e&&e({error:Error("enocean profile is null")}):e&&e({error:Error("enocean device is null")})};q.prototype.updateSensor=function(h,e,g){h?e?this._deviceHandler.updateDevice(h,e,function(f,m){g&&g({error:f,data:m?m.toJSON():null})}):g&&g({error:Error("device info is null")}):g&&g({error:Error("device address is null")})};q.prototype.delSensor=function(h,e){h?this._deviceHandler.deleteDevice({address:h},function(g){e&&e({error:g})}):
e&&e({error:Error("enocean id is null")})};q.prototype.resetDefaultSenderID=function(h){x.hub.m.enocean.SENDER_ID=null;localStorage&&localStorage.setItem("x.hub.m.enocean.SENDER_ID","");h&&h({})};q.prototype.setRehauAlarm=function(h,e){this._rehauHandler.setAlarm(h,e)};q.prototype.isRehauWindowOpen=function(){return this._rehauHandler.isWindowOpen()};q.prototype.setInoventHumidityAccessory=function(h,e,g){this._rehauHandler.setHumidityAccessory(h,e,function(f){g&&g({error:f})})};q.prototype.setInoventCo2Accessory=
function(h,e,g){this._rehauHandler.setCo2Accessory(h,e,function(f){g&&g({error:f})})};q.prototype.getInoventAccessories=function(h,e){h=this._rehauHandler.getInoventAccessory(h);e&&e({data:h?h.toJSON():{}})};q.prototype.__addTelegramTracker=function(h){h&&h.onTelegram&&h.onResolveEvents&&-1==this._trackers.indexOf(h)&&this._trackers.push(h)};q.prototype.__removeTelegramTracker=function(h){h&&(h=this._trackers.indexOf(h),-1!=h&&this._trackers.splice(h,1))};q.prototype.__sendEspFrame=function(h,e,g,
f,m){e=e?new Buffer(e,"hex"):null;g=g?new Buffer(g,"hex"):null;f=f?!0:!1;h=new x.hub.m.enocean.ESP3.ESP3_Frame(h,e,g);this._esp3.sendFrame(h,f,function(p,l){m&&m({error:p,data:l?l.toJSON():null})})};q.prototype.__simulateRawEnoceanPacket=function(h,e){this._esp3.onSerialData(new Buffer(h,"hex"));e&&e()};q.prototype._doSDK=function(h,e){if(h&&h.method){var g="send_"+h.method;if(this._sdk[g])this._sdk[g](h.params,function(f){e&&e({error:f})});else e&&e({error:Error("no such method")})}else e&&e({error:Error("data invalid")})};
return q}();"undefined"!=typeof exports&&"undefined"!=typeof module&&module.exports&&(exports=module.exports=new x.hub.m.enocean.Handler);
