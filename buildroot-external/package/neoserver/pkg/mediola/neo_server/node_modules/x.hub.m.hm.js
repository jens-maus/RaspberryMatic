var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.findInternal=function(p,n,q){p instanceof String&&(p=String(p));for(var h=p.length,g=0;g<h;g++){var k=p[g];if(n.call(q,k,g,p))return{i:g,v:k}}return{i:-1,v:void 0}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;$jscomp.ISOLATE_POLYFILLS=!1;$jscomp.FORCE_POLYFILL_PROMISE=!1;$jscomp.FORCE_POLYFILL_PROMISE_WHEN_NO_UNHANDLED_REJECTION=!1;
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(p,n,q){if(p==Array.prototype||p==Object.prototype)return p;p[n]=q.value;return p};$jscomp.getGlobal=function(p){p=["object"==typeof globalThis&&globalThis,p,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global];for(var n=0;n<p.length;++n){var q=p[n];if(q&&q.Math==Math)return q}throw Error("Cannot find global object");};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.IS_SYMBOL_NATIVE="function"===typeof Symbol&&"symbol"===typeof Symbol("x");$jscomp.TRUST_ES6_POLYFILLS=!$jscomp.ISOLATE_POLYFILLS||$jscomp.IS_SYMBOL_NATIVE;$jscomp.polyfills={};$jscomp.propertyToPolyfillSymbol={};$jscomp.POLYFILL_PREFIX="$jscp$";var $jscomp$lookupPolyfilledValue=function(p,n){var q=$jscomp.propertyToPolyfillSymbol[n];if(null==q)return p[n];q=p[q];return void 0!==q?q:p[n]};
$jscomp.polyfill=function(p,n,q,h){n&&($jscomp.ISOLATE_POLYFILLS?$jscomp.polyfillIsolated(p,n,q,h):$jscomp.polyfillUnisolated(p,n,q,h))};$jscomp.polyfillUnisolated=function(p,n,q,h){q=$jscomp.global;p=p.split(".");for(h=0;h<p.length-1;h++){var g=p[h];if(!(g in q))return;q=q[g]}p=p[p.length-1];h=q[p];n=n(h);n!=h&&null!=n&&$jscomp.defineProperty(q,p,{configurable:!0,writable:!0,value:n})};
$jscomp.polyfillIsolated=function(p,n,q,h){var g=p.split(".");p=1===g.length;h=g[0];h=!p&&h in $jscomp.polyfills?$jscomp.polyfills:$jscomp.global;for(var k=0;k<g.length-1;k++){var r=g[k];if(!(r in h))return;h=h[r]}g=g[g.length-1];q=$jscomp.IS_SYMBOL_NATIVE&&"es6"===q?h[g]:null;n=n(q);null!=n&&(p?$jscomp.defineProperty($jscomp.polyfills,g,{configurable:!0,writable:!0,value:n}):n!==q&&(void 0===$jscomp.propertyToPolyfillSymbol[g]&&($jscomp.propertyToPolyfillSymbol[g]=$jscomp.IS_SYMBOL_NATIVE?$jscomp.global.Symbol(g):
$jscomp.POLYFILL_PREFIX+g),$jscomp.defineProperty(h,$jscomp.propertyToPolyfillSymbol[g],{configurable:!0,writable:!0,value:n})))};$jscomp.polyfill("Array.prototype.find",function(p){return p?p:function(n,q){return $jscomp.findInternal(this,n,q).v}},"es6","es3");$jscomp.arrayIteratorImpl=function(p){var n=0;return function(){return n<p.length?{done:!1,value:p[n++]}:{done:!0}}};$jscomp.arrayIterator=function(p){return{next:$jscomp.arrayIteratorImpl(p)}};$jscomp.initSymbol=function(){};
$jscomp.polyfill("Symbol",function(p){if(p)return p;var n=function(g,k){this.$jscomp$symbol$id_=g;$jscomp.defineProperty(this,"description",{configurable:!0,writable:!0,value:k})};n.prototype.toString=function(){return this.$jscomp$symbol$id_};var q=0,h=function(g){if(this instanceof h)throw new TypeError("Symbol is not a constructor");return new n("jscomp_symbol_"+(g||"")+"_"+q++,g)};return h},"es6","es3");
$jscomp.polyfill("Symbol.iterator",function(p){if(p)return p;p=Symbol("Symbol.iterator");for(var n="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),q=0;q<n.length;q++){var h=$jscomp.global[n[q]];"function"===typeof h&&"function"!=typeof h.prototype[p]&&$jscomp.defineProperty(h.prototype,p,{configurable:!0,writable:!0,value:function(){return $jscomp.iteratorPrototype($jscomp.arrayIteratorImpl(this))}})}return p},"es6",
"es3");$jscomp.iteratorPrototype=function(p){p={next:p};p[Symbol.iterator]=function(){return this};return p};$jscomp.iteratorFromArray=function(p,n){p instanceof String&&(p+="");var q=0,h=!1,g={next:function(){if(!h&&q<p.length){var k=q++;return{value:n(k,p[k]),done:!1}}h=!0;return{done:!0,value:void 0}}};g[Symbol.iterator]=function(){return g};return g};$jscomp.polyfill("Array.prototype.keys",function(p){return p?p:function(){return $jscomp.iteratorFromArray(this,function(n){return n})}},"es6","es3");
var util=require("util"),EventEmitter=require("events"),async=require("async"),x=x||{};x.hub=x.hub||{};x.hub.m=x.hub.m||{};x.hub.m.hm=x.hub.m.hm||{};x.hub.m.hm.CCU_INIT_STATE=!0;x.hub.m.hm.HM_MODULE=require("xnm.aio.hm.js");
x.hub.m.hm.RFDeviceTypes={"HM-PB-4Dis-WM":0,"ZEL STG RM DWT 10":0,"263 155":0,"HM-PB-4Dis-WM-2":0,ASH550I:1,ASH550:1,"HM-WDS10-TH-O":1,"263 158":1,"HM-WDS20-TH-O":1,"HM-WDS40-TH-I":1,"263 157":1,"IS-WDS-TH-OD-S-R3":1,"HM-WDS40-TH-I-2":1,"HM-LC-Bl1-SM":2,"HM-LC-Bl1-FM":2,"HM-LC-Bl1-PB-FM":2,"ZEL STG RM FEP 230V":2,"263 146":2,"HM-LC-BlX":2,"HM-LC-Bl1-SM-2":2,"HM-LC-Bl1-FM-2":2,"HM-LC-Bl1PBU-FM":2,"263 147":2,"HM-CC-RT-DN":3,"HM-CC-RT-DN-BoM":4,"HM-CC-TC":5,"ZEL STG RM FWT":5,"HM-CC-VD":6,"ZEL STG RM FSA":6,
CENTRAL:7,"HM-RCV-50":7,"HM-OU-CF-Pl":8,"HM-OU-CFM-Pl":9,"HM-OU-CFM-TW":9,"HM-OU-CM-PCB":10,"HM-LC-AO-SM":11,"HM-LC-Dim1L-Pl":11,"HM-LC-Dim1L-Pl-2":11,"HM-LC-Dim1L-CV":11,"263 132":11,"HM-LC-Dim2L-CV":11,"HM-LC-Dim2L-SM":11,"HSS-DX":11,"HM-LC-Dim1L-Pl-3":11,"HM-LC-Dim1L-CV-2":11,"HM-LC-Dim2L-SM-2":11,"HM-LC-Dim1PWM-CV":12,"HM-LC-Dim1PWM-CV-2":12,"HM-LC-Dim1TPBU-FM":13,"HM-LC-Dim1TPBU-FM-2":13,"263 133":13,"HM-LC-Dim1T-Pl":13,"HM-LC-Dim1T-CV":13,"HM-LC-Dim1T-FM":13,"HM-LC-Dim1T-Pl-3":13,"HM-LC-Dim1T-CV-2":13,
"HM-LC-Dim1T-FM-2":13,"HM-LC-Dim2T-SM":13,"HM-LC-Dim2T-SM-2":13,"HM-LC-Dim1T-Pl-2":13,"263 134":13,"HM-LC-Dim1T-DR":13,"HM-LC-Dim1T-FM-LF":13,"OLIGO.smart.iq.HM":11,"HM-Dis-WM55":14,"HM-MOD-EM-8":15,"HM-ES-PMSw1-Pl":16,"HM-ES-PMSw1-Pl-DN-R1":16,"HM-ES-PMSw1-Pl-DN-R2":16,"HM-ES-PMSw1-Pl-DN-R3":16,"HM-ES-PMSw1-Pl-DN-R4":16,"HM-ES-PMSw1-Pl-DN-R5":16,"HM-ES-PMSw1-DR":16,"HM-ES-PMSw1-SM":16,"HM-Dis-TD-T":17,"HM-Sec-Key":18,"HM-Sec-Key-S":18,"HM-Sec-Key-O":18,"HM-Sec-Key-Generic":18,KS550:19,KS888:19,KS550Tech:19,
KS550LC:19,"HM-WDS100-C6-O":19,"HM-WDS100-C6-O-2":19,"HM-OU-LED16":20,"HM-OU-X":20,"HM-PB-2-WM55-2":21,"HM-PB-2-WM55":21,"ZEL STG RM WT 2":21,"263 135":21,"HM-PB-2-FM":21,"HM-PBI-4-FM":21,"ZEL STG RM FST UP4":21,"263 145":21,"HM-PBI-X":21,"HM-RC-4-2":21,"HM-PB-6-WM55":21,"HM-RC-8":21,"HM-RC-4":21,"HM-RC-4-3":21,"HM-RC-4-B":21,"HM-RC-P1":21,"HM-RC-Sec3":21,"HM-RC-Sec3-B":21,"HM-RC-Key3":21,"HM-RC-Key3-B":21,"HM-PB-4-WM":21,"HM-PB-2-WM":21,"HM-RC-2-PBU-FM":21,"RC-H":21,atent:21,"ZEL STG RM HS 4":21,
"HM-RC-X":21,"BRC-H":21,"HM-RC-SB-X":21,"HM-RC-12":21,"HM-RC-12-B":21,"HM-RC-12-SW":21,"HM-RC-Key4-2":22,"HM-RC-Sec4-2":22,"HM-RC-Key4-3":22,"HM-RC-Sec4-3":22,"HM-RC-19":23,"HM-RC-19-B":23,"HM-RC-19-SW":23,"HM-Sen-RD-O":24,"HM-Sec-RHS":25,"HM-Sec-RHS-2":25,"ZEL STG RM FDK":25,"HM-Sec-xx":25,"HM-LC-Sw1-Pl":26,"HM-LC-Sw1-Pl-2":26,"HM-LC-Sw1-SM":26,"HM-LC-Sw2-SM":26,"HM-LC-Sw4-SM":26,"HM-LC-Sw4-PCB":26,"HM-LC-Sw4-WM":26,"HM-LC-Sw1-FM":26,"263 130":26,"HM-LC-Sw2-FM":26,"HM-LC-Sw1-PB-FM":26,"HM-LC-Sw2-PB-FM":26,
"HM-LC-Sw4-DR":26,"HM-LC-Sw2-DR":26,"ZEL STG RM FZS":26,"ZEL STG RM FZS-2":26,"HM-LC-Sw1PBU-FM":26,"HM-LC-Sw2PBU-FM":26,"263 131":26,"HM-MOD-Re-8":26,"HM-LC-Sw1-Ba-PCB":26,"HM-LC-Sw4-Ba-PCB":26,"HM-LC-Sw1-Pl-3":26,"HM-LC-Sw1-SM-2":26,"HM-LC-Sw4-SM-2":26,"HM-LC-Sw4-PCB-2":26,"HM-LC-Sw4-WM-2":26,"HM-LC-Sw1-FM-2":26,"HM-LC-Sw2-FM-2":26,"HM-LC-Sw4-DR-2":26,"HM-LC-Sw2-DR-2":26,"HM-LC-Sw1-Pl-DN-R1":26,"HM-LC-Sw1-Pl-DN-R2":26,"HM-LC-Sw1-Pl-DN-R3":26,"HM-LC-Sw1-Pl-DN-R4":26,"HM-LC-Sw1-Pl-DN-R5":26,"HM-LC-Sw1-DR":26,
"HM-LC-Sw1-Pl-CT-R1":26,"HM-LC-Sw1-Pl-CT-R2":26,"HM-LC-Sw1-Pl-CT-R3":26,"HM-LC-Sw1-Pl-CT-R4":26,"HM-LC-Sw1-Pl-CT-R5":26,"HM-LC-Sw1-PCB":26,"HM-LC-Sw1-Pl-OM54":26,"HM-LC-Sw1-SM-ATmega168":26,"HM-LC-Sw4-SM-ATmega168":26,S550IA:27,"HM-WDS30-T-O":27,"HM-Sec-SC":28,"ZEL STG RM FFK":28,"HM-Sec-SC-2":28,"HM-SCI-3-FM":29,"HM-CC-SCD":30,"263 160":30,"HM-Sec-MDIR-3":31,"HM-Sec-MDIR-2":31,"HM-Sec-MDIR":31,"263 162":31,"HM-Sec-MD":31,"HM-Sec-SD":32,"HM-Sec-SD-Generic":32,"HM-Sec-SD-2":32,"HM-Sec-SD-2-Generic":32,
"HM-Sec-SFA-SM":33,"HM-Sen-MDIR-SM":34,"HM-Sen-MDIR-O":34,"HM-MD":34,"HM-Sen-MDIR-O-2":34,"HM-Sen-MDIR-O-3":34,"HM-Sen-EP":35,"HM-Sen-X":35,"HM-Sen-Wa-Od":36,"HM-SwI-3-FM":37,"ZEL STG RM FSS UP3":37,"263 144":37,"HM-SwI-X":37,"HM-TC-IT-WM-W-EU":38,"HM-Sec-TiS":39,"HM-WDS30-OT2-SM":40,"HM-WDS30-OT2-SM-2":40,"HM-Sec-WDS":41,"HM-Sec-WDS-2":41,"HM-Sec-Win":42,"HM-Sec-Win-Generic":42,WS550:43,WS888:43,WS550Tech:43,WS550LCB:43,WS550LCW:43,"HM-WDC7000":43,"HMW-IO-12-Sw14-DR":44,"HMW-IO-12-Sw7-DR":45,"HMW-IO-12-FM":46,
"HMW-IO-4-FM":46,"HMW-LC-Bl1-DR":47,"HMW-LC-Dim1L-DR":48,"HMW-LC-Sw2-DR":49,"HMW-Sen-SC-12-DR":50,"HMW-Sen-SC-12-FM":50,"HM-CC-VG-1":51,"HM-ES-TX-WM":52,"HM-LC-RGBW-WM":53,"HM-Sec-SD-2-Team":54,"HM-Sen-LI-O":56,"HM-Sec-SCo":28,"HM-Sec-Sir-WM":57,"HM-LC-Ja1PBU-FM":58,"HM-MOD-EM-8Bit":59,"HM-Dis-EP-WM55":60,"HM-Sen-MDIR-WM55":61,"HM-LC-DW-WM":62,"HM-DW-WM":62};
x.hub.m.hm.RFDeviceCatagory=[{type:"button",channelNum:"*",channel:"KEY"},{type:"weather"},{type:"blind",channelNum:"*",channel:"BLIND"},{type:"heater2"},{type:"heater3"},{type:"wallthermo"},{type:"heater"},{type:"vbutton",channelNum:"*",channel:"VIRTUAL_KEY"},{type:"gong2"},{type:"gong"},{type:"gong"},{type:"dimmer",channelNum:"*",channel:"DIMMER"},{type:"dimmer",channelNum:"*",channel:"DIMMER"},{type:"dimmer",channelNum:"*",channel:"DIMMER"},{type:"button",channelNum:"*",channel:"KEY"},{type:"mod_em_8",
channelNum:"*",channel:"KEY"},{type:"powerswitch"},{type:"switch",channelNum:"*",channel:"SWITCH"},{type:"keymatic"},{type:"weatherstation"},{type:"ou_led16",channelNum:"*",channel:"KEY"},{type:"button",channelNum:"*",channel:"KEY"},{type:"button",channelNum:"*",channel:"KEY"},{type:"button",channelNum:"*",channel:"KEY"},{type:"rain"},{type:"window"},{type:"switch",channelNum:"*",channel:"SWITCH"},{type:"temp"},{type:"contact",channelNum:"*",channel:"SHUTTER_CONTACT"},{type:"contact",channelNum:"*",
channel:"SHUTTER_CONTACT"},{type:"co2"},{type:"motion",channelNum:"*",channel:"MOTION_DETECTOR"},{type:"smoke"},{type:"siren",channelNum:"*",channel:"ALARMACTUATOR"},{type:"motion",channelNum:"*",channel:"MOTION_DETECTOR"},{},{type:"capacity"},{type:"switch_interface",channelNum:"*",channel:"SWITCH_INTERFACE"},{type:"wallthermo2"},{type:"tilt",channelNum:"*",channel:"TILT_SENSOR"},{type:"temp2",channel:"WEATHER"},{type:"water",channelNum:"*",channel:"WATERDETECTIONSENSOR"},{},{type:"weather2"},{},
{},{},{},{},{},{},{},{type:"energymeter"},{type:"rgb"},{},{type:"switch",channelNum:"*",channel:"SWITCH"},{type:"lux"},{type:"siren2"},{type:"jalousie",channelNum:"*",channel:"JALOUSIE"},{type:"mod_em_8bit"},{type:"button",channelNum:"*",channel:"KEY"},{},{type:"dualwhite"}];
x.hub.m.hm.IPDeviceTypes={"HMIP-PS":0,"HmIP-PCBS":0,"HmIP-PCBS-BAT":0,"HMIP-SWDO":1,"HmIP-SWDO-I":1,"HmIP-SWDM":1,"HmIP-SWDM-B2":1,"Contact AA":1,"HMIP-WTH":2,"HmIP-WTH-2":2,"HmIP-STH":2,"HmIP-STHD":2,"HMIP-eTRV":3,"HMIP-eTRV-2":3,"HmIP-eTRV-2-UK":3,"HmIP-eTRV-B":3,"HmIP-eTRV-B1":3,"HmIP-eTRV-B-UK":3,"HmIP-eTRV-C":3,"HMIP-WRC2":4,"HmIP-SMI":5,"HmIP-SMO":5,"HmIP-SMO-A":5,"HmIP-SRH":6,"HmIP-SWSD":7,"HmIP-PSM":8,"Smart Plug AA":8,"HmIP-PSM-PE":8,"HmIP-PSM-UK":8,"HmIP-PSM-IT":8,"HmIP-PSM-CH":8,"HmIP-BSM":9,
"HmIP-BDT":10,"HmIP-ASIR":11,"HmIP-KRC4":12,"HmIP-KRCA":12,"HmIP-PDT":13,"HmIP-PDT-UK":13,"HmIP-FSM":14,"HmIP-FSM16":14,"HmIP-BROLL":15,"HmIP-FROLL":15,"HmIP-FBL":16,"HmIP-BBL":16,"HmIP-SPI":17,"HmIP-FDT":18,"HmIP-BWTH":19,"HmIP-BWTH24":19,"HmIP-FAL230-C6":20,"HmIP-FAL24-C6":20,"HmIP-FAL230-C10":20,"HmIP-FAL24-C10":20,"HmIP-WRC6":21,"HmIP-SWO-B":22,"HmIP-SWO-PL":23,"HmIP-SWO-PR":27,"HmIP-STHO":24,"HmIP-STHO-A":24,"HmIP-SPDR":25,"HmIP-SMI55":26,"HmIP-RC8":28,"HmIP-MIOB":0,"HmIP-SWD":31,"HmIP-SAM":32,
"HmIP-WGC":33,"HmIP-BSL":34,"HmIP-MOD-TM":35,"HmIP-DBB":36,"HmIP-FCI1":37,"HmIP-FCI6":37,"HmIP-SLO":38,"HmIP-BRC2":4,"HmIP-PMFS":39,"HmIP-MOD-RC8":37,"HmIP-MOD-OC8":1,"HmIP-WRCR":40};
x.hub.m.hm.IPDeviceCatagory=[{type:"ip_switch"},{type:"ip_contact"},{type:"ip_wallthermo"},{type:"ip_heater"},{type:"ip_button2"},{type:"ip_motion"},{type:"ip_window"},{type:"ip_smoke"},{type:"ip_powerswitch"},{type:"ip_energyactor"},{type:"ip_dimmer"},{type:"ip_siren"},{type:"ip_button4"},{type:"ip_dimmer2"},{type:"ip_energyactor2"},{type:"ip_blind"},{type:"ip_jalousie"},{type:"ip_presence"},{type:"ip_dimmer3"},{type:"ip_wallthermo2"},{type:"ip_floor_heater"},{type:"ip_button6"},{type:"ip_weather"},
{type:"ip_weather2"},{type:"ip_weather3"},{type:"ip_direction"},{type:"ip_motion2"},{type:"ip_weather4"},{type:"ip_button8"},{type:"ip_generic_input"},{type:"ip_analog_output"},{type:"ip_water"},{type:"ip_acce"},{type:"ip_garagedoor"},{type:"ip_bsl"},{type:"ip_tormatic"},{type:"ip_button"},{type:"ip_multi_input_bat"},{type:"ip_lux"},{type:"ip_pmfs"},{type:"ip_rotary"}];
x.hub.m.hm.Util={clearHttpOptionForLog:function(p){try{var n=JSON.parse(JSON.stringify(p));n.auth&&(n.auth="xxxxxx:xxxxxx");if(n.headers)for(var q in headers)if(q&&"authorization"==q.toLocaleLowerCase()){var h=headers[q];if(h){var g=h.indexOf(" ");headers[q]=-1==g?"xxxxxx":h.substr(0,g)+" xxxxxx"}}return n}catch(k){return p}}};
x.hub.m.hm.Client=function(){var p=function(n,q,h,g,k){this._logger=require("x.logger.js").getLogger("x.hub.m.hm.Client");this.ip=n;this.port=q;this.port||(this.port=2001);this.username=h;this.password=g;this.useHttps=k;this.timeout=2E4;this.xml2js=null};p.prototype._doRequest=function(n,q,h){var g=require("http");this.useHttps&&(g=require("https"));n={host:this.ip,port:this.port,path:"/",method:n,headers:{"User-Agent":"mediola",Connection:"keep-alive"}};this.username&&(n.auth=this.username+":"+(this.password?
this.password:""));q&&(n.headers["Content-Length"]=q.length);var k=h,r=this;this._logger.log("trace","send http request:"+x.hub.m.hm.Util.clearHttpOptionForLog(n));this._logger.log("trace","send http data:"+q);h=g.request(n,function(m){var v="";m.setEncoding("utf-8");m.on("data",function(w){v+=w});m.on("end",function(){r._logger.log("trace","http response status:"+m.statusCode);r._logger.log("trace","http response data:"+v);var w=null;200!=m.statusCode&&(w=Error("http response "+m.statusCode));k&&
k(w,v,m.statusCode)})});h.on("error",function(m){r._logger.log("trace","http request error:"+m.stack);k&&k(m);k=null});h.setTimeout(this.timeout,function(){r._logger.log("trace","http request timeout");k&&k(Error("http timeout"));k=null});q&&h.write(q);h.end()};p.prototype._doXMLRpcRequest=function(n,q,h){var g=require("x.xmlrpc.js");n='<?xml version="1.0" encoding="ISO-8859-1"?><methodCall><methodName>'+n+"</methodName><params>";for(var k=0;k<q.length;k++)n=q[k]&&q[k].type&&void 0!=q[k].value?n+
("<param>"+g.serializeValue(q[k].value,q[k].type)+"</param>"):n+("<param>"+g.serializeValue(q[k])+"</param>");this._doRequest("POST",n+"</params></methodCall>",function(r,m){if(r)h&&h(r);else if(m)try{var v=g.deserializeRsp(m);v.error?h&&h(Error("xml rcp return error:"+v.error.faultString+" @code:"+v.error.faultCode),v.error):h&&h(null,v.params)}catch(w){h&&h(w)}else h&&h(Error("xml rcp response format invalid"))})};p.prototype.convertHmIPKeyBase32ToBase16=function(n){n=n.replace(/-/g,"").toUpperCase();
var q="0123456789ABCEFGHJKLMNPQRSTUWXYZ".split(""),h=new ArrayBuffer(16);h=new Uint8Array(h);for(var g=0,k=n.length-1,r=0,m=h.length-1,v="";0<=k;){for(var w=0;w<q.length;w++)if(q[w]==n.charAt(k)){g|=w<<r;break}r+=5;for(k--;8<r&&0<=m;)h[m]=g&255,g>>=8,r-=8,m--}for(w=0;w<h.length;w++)16>h[w]&&(v+="0"),v+=h[w].toString(16);return v.toUpperCase()};p.prototype._getValue=function(n){var q=null;if(this.xml2js)if(n["boolean"]&&n["boolean"][0])q=parseInt(n["boolean"][0])?!0:!1;else if(n.i4&&n.i4[0])q=parseInt(n.i4[0]);
else if(n.double&&n.double[0])q=parseFloat(n.double[0]);else if(n.array&&n.array[0]&&n.array[0].data&&n.array[0].data[0]&&n.array[0].data[0].value){q=[];n=n.array[0].data[0].value;for(var h in n)q.push(n[h])}else q=n;else if(h=n,n=n.find("value"),0<n.length&&(h=$(n[0])),h&&(q=h.text(),!q&&h.children()&&0<h.children().length))if(n=$(h.children()[0]),"boolean"==n.prop("tagName"))q=parseInt(n.text())?!0:!1;else if("i4"==n.prop("tagName"))q=parseInt(n.text());else if("double"==n.prop("tagName"))q=parseFloat(n.text());
else if("array"==n.prop("tagName"))for(q=[],n=n.find("data value"),h=0;h<n.length;h++){var g=$(n[h]).text();g&&q.push(g)}else XC.debugf("unknown valuetype:"),XC.debugf(n.getXMLString());return q};p.prototype._getStructData=function(n){var q={};if(n.struct&&n.struct[0]&&n.struct[0].member){n=n.struct[0].member;for(var h in n)n[h].name&&n[h].name[0]&&n[h].value&&n[h].value[0]&&(q[n[h].name[0]]=this._getValue(n[h].value[0]))}return q};p.prototype._waitForNewDevices=function(n,q,h){var g=this;this.getDeviceList(function(k){if(0>=
q||Object.keys(k).length>Object.keys(n).length){for(var r in k)n[r]||XC.debugf("new device: "+r);h&&h(k)}else setTimeout(function(){g._waitForNewDevices(n,q-4,h)},4E3)})};p.prototype.init=function(n,q,h){this._doXMLRpcRequest("init",[n,q],function(g){h&&h(g)})};p.prototype.getIP=function(){return this.ip};p.prototype.getPort=function(){return this.port};p.prototype.setPort=function(n){this.port=n};p.prototype.getValue=function(n,q,h,g){n=[n,q];"undefined"!=typeof h&&null!=h&&n.push(h);this._doXMLRpcRequest("getValue",
n,function(k,r){var m=null;!k&&r?m=r[0]:k&&r&&(m=r);g&&g(k,m)})};p.prototype.setValue=function(n,q,h,g){this._doXMLRpcRequest("setValue",[n,q,h],function(k){g&&g(k)})};p.prototype.getParamset=function(n,q,h,g){this._doXMLRpcRequest("getParamset",[n,q,h],function(k,r){var m=null;!k&&r?m=r[0]:k&&r&&(m=r);g&&g(k,m)})};p.prototype.putParamset=function(n,q,h,g){this._doXMLRpcRequest("putParamset",[n,q,h],function(k,r){var m=null;!k&&r?m=r[0]:k&&r&&(m=r);g&&g(k,m)})};p.prototype.listDevices=function(n){this._doXMLRpcRequest("listDevices",
[],function(q,h){var g=[];!q&&h&&(g=h[0]);n&&n(q,g)})};p.prototype.deleteDevice=function(n,q,h){this._doXMLRpcRequest("deleteDevice",[n,q],function(g){h&&h(g)})};p.prototype.setInstallMode=function(n,q,h,g){var k=[];k.push(n);"undefined"!=typeof q&&null!=q&&k.push(q);"undefined"!=typeof h&&null!=h&&k.push(h);this._doXMLRpcRequest("setInstallMode",k,function(r){g&&g(r)})};p.prototype.setInstallModeWithWhitelist=function(n,q,h,g){var k=[];k.push(n);"undefined"!=typeof q&&null!=q&&k.push(q);"undefined"!=
typeof h&&null!=h&&k.push(h);this._doXMLRpcRequest("setInstallModeWithWhitelist",k,function(r){g&&g(r)})};p.prototype.addNewDevice=function(n){var q=this;this.getDeviceList(function(h){q._doRequest("setInstallMode",[!0,30,2],function(g){setTimeout(function(){q._waitForNewDevices(h,30,n)},4E3)})})};p.prototype.addNewDeviceWithSGTN=function(n,q,h){var g=this;this.getDeviceList(function(k){g._doRequest("setInstallModeWithWhitelist",[!0,30,[{ADDRESS:q,KEY_MODE:"LOCAL",KEY:h}]],function(r){setTimeout(function(){g._waitForNewDevices(k,
30,n)},4E3)})})};p.prototype.listBidcosInterfaces=function(n){this._doXMLRpcRequest("listBidcosInterfaces",[],function(q,h){var g=[];!q&&h&&(g=h[0]);n&&n(q,g)})};p.prototype.reportValueUsage=function(n,q,h,g){this._doXMLRpcRequest("reportValueUsage",[n,q,h],function(k,r){var m;!k&&r&&(m=r[0]);g&&g(k,m)})};p.prototype.ping=function(n,q){this._doXMLRpcRequest("ping",[n],function(h){q&&q(h)})};return p}();
x.hub.m.hm.Server=function(){var p=function(n){this._logger=require("x.logger.js").getLogger("x.hub.m.hm.Server");this._port=9099;n&&0<n&&(this._port=n);this._server=null;this._servlet={}};p.prototype.getPort=function(){return this._port};p.prototype.stop=function(n){this._server?this._server.close():n&&n()};p.prototype.start=function(n){if(this._server)n&&n();else{var q=n,h=this,g=require("http").createServer(function(k,r){h._logger.log("trace","receive request method:"+k.method);h._logger.log("trace",
"receive request path:"+k.url);h._logger.log("trace","receive request header:"+JSON.stringify(k.headers));var m="";k.on("data",function(v){m+=v.toString()});k.on("end",function(){h._logger.log("trace","receive request body:"+m);"POST"==k.method?h._handleRequest(m,k,r):(h._logger.log("trace","send 404 response"),r.writeHead(404,"Not found"),r.end())})});g.on("error",function(k){h._logger.log("trace","xmlrpc server err:"+k.stack);q&&q(k);q=null;h._server=null});g.listen(this._port,function(){h._logger.log("trace",
"xmlrpc server listening on port:"+h._port);h._server=g;q&&q();q=null})}};p.prototype.registServlet=function(n,q){n&&q&&(this._servlet[n]=q)};p.prototype.unregistServlet=function(n){n&&delete this._servlet[n]};p.prototype._handleRequest=function(n,q,h){var g=q.url,k=require("x.xmlrpc.js"),r=this;try{var m=k.deserializeReq(n);if("system.multicall"==m.methodName)this._handleMultiCall(m.params[0],q,h);else if(this._logger.log("debug","receive method call:"+m.methodName),this._logger.log("debug","params:"+
JSON.stringify(m.params)),"system.listMethods"==m.methodName)this._sendSuccessResponse(["event listDevices newDevices deleteDevices updateDevice replaceDevice readdedDevice".split(" ")],h);else if(this._servlet[g])this._servlet[g](m.methodName,m.params,function(v,w){v?r._sendErrorResponse(v,h):r._sendSuccessResponse([w],h)});else this._sendSuccessResponse([[]],h)}catch(v){this._sendErrorResponse(v,h)}};p.prototype._handleMultiCall=function(n,q,h){q=q.url;this._logger.log("trace","---------------------------------");
this._logger.log("trace","receive system.multicall");for(var g=0;g<n.length;g++){var k=n[g];this._logger.log("trace","receive method call:"+k.methodName);this._logger.log("trace","params:"+JSON.stringify(k.params));if(this._servlet[q])this._servlet[q](k.methodName,k.params)}this._logger.log("trace","---------------------------------");this._sendSuccessResponse([[]],h)};p.prototype._sendSuccessResponse=function(n,q){n=require("x.xmlrpc.js").serializeRsp(null,n);this._logger.log("trace","send xml success response:"+
n);q.writeHead(200,{"Content-Type":"text/xml","Content-Length":Buffer.byteLength(n)+""});q.write(n);q.end()};p.prototype._sendErrorResponse=function(n,q){var h=require("x.xmlrpc.js"),g=-1;n.errCode&&(g=n.errCode);n=h.serializeRsp({faultCode:g,faultString:n.message});this._logger.log("trace","send xml fault response:"+n);q.writeHead(200,{"Content-Type":"text/xml","Content-Length":Buffer.byteLength(n)+""});q.write(n);q.end()};return p}();
x.hub.m.hm._Controller=function(){var p=function(g,k,r,m,v,w){this._logger=require("x.logger.js").getLogger("x.hub.m.hm.Controller");this._client=new x.hub.m.hm.Client(g,k,r,m,v);this._initStates=w;this.interface=null;this._devices={};this._status={};this._learnDeviceCbs=[];this._learnDeviceTO=null;this._readValueCbs={}};util.inherits(p,EventEmitter);p.prototype.getIP=function(){return this._client.getIP()};p.prototype.getPort=function(){return this._client.getPort()};p.prototype.setPort=function(g){return this._client.setPort(g)};
p.prototype.getAllBufferedStates=function(){var g={},k;for(k in this._devices){var r=this._devices[k];!r.PARENT&&r.CHILDREN?g[k]={device:{type:r.TYPE,"interface":this.interface,address:r.ADDRESS,channels:{}},states:{}}:r.PARENT&&(g[r.PARENT].device.channels[r.ADDRESS]={type:r.TYPE,address:r.ADDRESS});if(r.CHILDREN)for(var m=0,v=r.CHILDREN.length;m<v;m++){var w=r.CHILDREN[m];if(this._status[w]){g[k].states[w]={};for(var z in this._status[w])g[k].states[w][z]=this._status[w][z]}}}return g};p.prototype.getBufferedState=
function(g){if(!g)return null;var k=g.indexOf(":");-1!=k&&(g=g.substr(0,k));g=this._devices[g];if(!g)return null;var r={};if(g.CHILDREN){var m=this;g.CHILDREN.forEach(function(v){if(m._status[v]){r[v]={};for(var w in m._status[v])r[v][w]=m._status[v][w]}})}return r};p.prototype.getBufferedDevices=function(){return this._getDeviceStructs(this._devices)};p.prototype.getState=function(g,k,r){var m=this.getBufferedState(g);if(m&&m[g]&&m[g][k]){m=m[g][k];var v=m.value;if("undefined"!=typeof v&&null!=v){r&&
r(null,m);return}}this.updateState(g,k,function(w,z){r&&r(w,z)})};p.prototype.updateState=function(g,k,r){var m=this;this.readValue(g,k,function(v,w){v?setTimeout(function(){var z,D=m.getBufferedState(g);D&&D[g]&&D[g][k]&&(z=D[g][k]);r&&r(null,z)},1E3):r&&r(null,{value:w,time:(new Date).getTime()})})};p.prototype.reset=function(g){var k=[];Object.keys(this._devices).forEach(function(w){w&&-1==w.indexOf(":")&&"BidCoS-RF"!=w&&k.push(w)});if(0==k.length)g&&g();else{var r=0,m=this,v=function(w){r++;r<
k.length?m.deleteDevice(k[r],v):g&&g()};this.deleteDevice(k[r],v)}};p.prototype.register=function(g,k,r){if(g){this._logger.log("debug","register:"+k+" to "+g);var m=this;this._client.init(g,k,function(v){m._logger.log("debug","registed:"+k+(v?" err:"+v.message:""));r&&r(v,v?null:k)})}else r&&r(Error("arguments invalid"))};p.prototype.unregister=function(g,k){g?this._client.init(g,"",function(r){k&&k(r)}):k&&k(Error("url invalid"))};p.prototype.getDevices=function(g){this._client.listDevices(function(k,
r){if(k)g&&g(k);else for(k=0;k<r.length;k++);})};p.prototype.learnNewDevice=function(g){var k=this._learnDeviceCbs.length;g&&-1==this._learnDeviceCbs.indexOf(g)&&this._learnDeviceCbs.push(g);if(0==k){var r=this;this._learnDeviceTO=setTimeout(function(){var m=r._learnDeviceCbs;r._learnDeviceCbs=[];for(var v=0;v<m.length;v++){var w=m[v];w&&w(Error("learn device timeout"))}},3E4);this._client.setInstallMode(!0,30,1,function(m){if(m){r._learnDeviceTO&&(clearTimeout(r._learnDeviceTO),r._learnDeviceTO=
null);var v=r._learnDeviceCbs;r._learnDeviceCbs=[];for(var w=0;w<v.length;w++){var z=v[w];z&&z(m)}}})}};p.prototype.learnNewDeviceSN=function(g,k){var r=this._learnDeviceCbs.length;k&&-1==this._learnDeviceCbs.indexOf(k)&&this._learnDeviceCbs.push(k);if(0==r){var m=this;this._learnDeviceTO=setTimeout(function(){var v=m._learnDeviceCbs;m._learnDeviceCbs=[];for(var w=0;w<v.length;w++){var z=v[w];z&&z(Error("learn device timeout"))}},3E4);this._client.setInstallMode(!0,30,g,function(v){if(v){m._learnDeviceTO&&
(clearTimeout(m._learnDeviceTO),m._learnDeviceTO=null);var w=m._learnDeviceCbs;m._learnDeviceCbs=[];for(var z=0;z<w.length;z++){var D=w[z];D&&D(v)}}})}};p.prototype.learnNewIPDevice=function(g,k,r){var m=this._learnDeviceCbs.length;r&&-1==this._learnDeviceCbs.indexOf(r)&&this._learnDeviceCbs.push(r);if(0==m){var v=this;this._learnDeviceTO=setTimeout(function(){var w=v._learnDeviceCbs;v._learnDeviceCbs=[];for(var z=0;z<w.length;z++){var D=w[z];D&&D(Error("learn device timeout"))}},6E4);g={ADDRESS:g.replace(/-/g,
"").toUpperCase(),KEY_MODE:"LOCAL",KEY:this._convertHmIPKeyBase32ToBase16(k)};this._client.setInstallModeWithWhitelist(!0,60,[g],function(w){if(w){v._learnDeviceTO&&(clearTimeout(v._learnDeviceTO),v._learnDeviceTO=null);var z=v._learnDeviceCbs;v._learnDeviceCbs=[];for(var D=0;D<z.length;D++){var E=z[D];E&&E(w)}}})}};p.prototype.learnNewIPDeviceQR=function(g,k){var r=this._learnDeviceCbs.length;k&&-1==this._learnDeviceCbs.indexOf(k)&&this._learnDeviceCbs.push(k);if(0==r){var m=this;this._learnDeviceTO=
setTimeout(function(){var v=m._learnDeviceCbs;m._learnDeviceCbs=[];for(var w=0;w<v.length;w++){var z=v[w];z&&z(Error("learn device timeout"))}},3E4);k=g.substr(6,24);g=g.substring(g.length-32,g.length);g={ADDRESS:k.replace(/-/g,"").toUpperCase(),KEY_MODE:"LOCAL",KEY:g.toUpperCase()};this._client.setInstallModeWithWhitelist(!0,30,[g],function(v){if(v){m._learnDeviceTO&&(clearTimeout(m._learnDeviceTO),m._learnDeviceTO=null);var w=m._learnDeviceCbs;m._learnDeviceCbs=[];for(var z=0;z<w.length;z++){var D=
w[z];D&&D(v)}}})}};p.prototype.deleteDevice=function(g,k){if(g){var r=g.indexOf(":");-1!=r&&(g=g.substr(0,r));this._client.deleteDevice(g,2,k)}else k&&k(Error("address is empty"))};p.prototype.readValue=function(g,k,r){var m=g+"."+k,v=this._readValueCbs[m];v||(v=[],this._readValueCbs[m]=v);var w=v.length;r&&-1==v.indexOf(r)&&v.push(r);if(0==w){var z=this;this._client.getValue(g,k,null,function(D,E){D||z._updateStatusBuffer(g,k,E);var J=z._readValueCbs[m];delete z._readValueCbs[m];J.forEach(function(M){M&&
M(D,E)})})}};p.prototype.writeValue=function(g,k,r,m){var v=this;this._client.setValue(g,k,r,function(w){w||v._updateStatusBuffer(g,k,r.type?r.value:r);m&&m(w)})};p.prototype.getValuesParamset=function(g,k){this._logger.log("trace","getValuesParamset:"+g);var r=this;this._client.getParamset(g,"VALUES",0,function(m,v){if(m)r._logger.log("trace","getValuesParamset error:"+m.message),k&&k(m);else{if(v){m=0;var w=g.indexOf(":");-1!=w&&(m=g.substr(w+1));for(var z in v)v.hasOwnProperty(z)&&(0==m?"INSTALL_MODE"!=
z&&r._updateStatusBuffer(g,z,v[z]):r._updateStatusBuffer(g,z,v[z]))}r._logger.log("trace","getValuesParamset finish:"+JSON.stringify(v));k&&k(null,v)}})};p.prototype.getParamset=function(g,k,r){this._client.getParamset(g,k,0,function(m,v){r&&r(m,v)})};p.prototype.setParamset=function(g,k,r,m){this._client.putParamset(g,k,r,function(v){m&&m(v)})};p.prototype.reportValueUsage=function(g,k,r,m){this._client.reportValueUsage(g,k,r,function(v,w){m&&m(v,w)})};p.prototype.getDevice=function(g){if(!g)return null;
var k=g,r=g.indexOf(":");-1!=r&&(k=g.substr(0,r));if(!this._devices[k])return null;var m=[];g=this._devices[k];m.push(g);if(g.CHILDREN){var v=this;g.CHILDREN.forEach(function(w){w&&v._devices[w]&&m.push(v._devices[w])})}return(g=this._getDeviceStructs(m))?g[k]:null};p.prototype._getDeviceStructs=function(g){if(!g)return null;var k={},r=this;g.forEach(function(m){if(m.ADDRESS&&m.TYPE)if(!m.PARENT&&m.CHILDREN)k[m.ADDRESS]={type:m.TYPE,"interface":r.interface,address:m.ADDRESS,channels:{}};else if(m.PARENT){var v=
k[m.PARENT];v&&(v.channels[m.ADDRESS]={type:m.TYPE,address:m.ADDRESS})}});return k};p.prototype._updateStatusBuffer=function(g,k,r,m){if("CENTRAL"!=g||"PONG"!=k){if("PRESS_SHORT"==k||"PRESS_LONG"==k||"PRESS_CONT"==k||"PRESS_LONG_RELEASE"==k){var v={};m={value:r,time:(new Date).getTime()};var w=!0}else{var z=this._status[g];z||(z={},this._status[g]=z);v=z[k];v||(v={},z[k]=v);m={value:r,time:m?m:(new Date).getTime()};v&&v.time&&m&&m.time&&v.time>m.time?w=!1:(z[k]=m,w=!0)}z=this.getDevice(g);w&&this.emit("event",
{device:z,"interface":this.interface,channel:g,datapoint:k,value:m,changed:v.value!=m.value,oldValue:v});v=g.indexOf(":");-1!=v&&(m=g.substr(0,v),"1"==g.substr(v+1)&&"STATE"==k&&0==r&&z&&z.channels&&z.channels[m+":2"]&&"POWERMETER"==z.channels[m+":2"].type&&(this._updateStatusBuffer(m+":2","POWER",0),this._updateStatusBuffer(m+":2","CURRENT",0)))}};p.prototype._initNewDeviceStates=function(g,k){if(this._initStates){var r=this,m=function(z,D){z.ADDRESS&&z.PARAMSETS&&-1!=z.PARAMSETS.indexOf("VALUES")?
r.getValuesParamset(z.ADDRESS,D):D()},v=0,w=function(){v++;v<g.length?m(g[v],w):k&&k()};m(g[v],w)}else k&&k()};p.prototype._convertHmIPKeyBase32ToBase16=function(g){g=g.replace(/-/g,"").toUpperCase();var k="0123456789ABCEFGHJKLMNPQRSTUWXYZ".split(""),r=new ArrayBuffer(16);r=new Uint8Array(r);for(var m=0,v=g.length-1,w=0,z=r.length-1,D="";0<=v;){for(var E=0;E<k.length;E++)if(k[E]==g.charAt(v)){m|=E<<w;break}w+=5;for(v--;8<w&&0<=z;)r[z]=m&255,m>>=8,w-=8,z--}for(E=0;E<r.length;E++)16>r[E]&&(D+="0"),
D+=r[E].toString(16);return D.toUpperCase()};p.prototype._xmlrpcCall=function(g,k,r){this._logger.log("trace","receive call:"+g);this._logger.log("trace","params:"+JSON.stringify(k));var m=[],v;switch(g){case "newDevices":if(k[1]){this._initNewDeviceStates(k[1],null);for(v=0;v<k[1].length;v++)(g=k[1][v])&&g.ADDRESS&&(this._devices[g.ADDRESS]=g);g=this._getDeviceStructs(k[1]);try{this.emit("newDevices",g)}catch(z){}if(!k[1]||!k[1][0]||"HM-RCV-50"!=k[1][0].TYPE)for(k=this._learnDeviceCbs,this._learnDeviceCbs=
[],this._learnDeviceTO&&(clearTimeout(this._learnDeviceTO),this._learnDeviceTO=null),0<k.length&&this._client.setInstallMode(!1,null,null,null),v=0;v<k.length;v++){var w=k[v];w&&w(null,g)}}break;case "readdedDevice":if(k[1]&&k[1][0])for(v=this.getDevice(k[1][0]),g={},g[k[1][0]]=v,k=this._learnDeviceCbs,this._learnDeviceCbs=[],this._learnDeviceTO&&(clearTimeout(this._learnDeviceTO),this._learnDeviceTO=null),0<k.length&&this._client.setInstallMode(!1,null,null,null),v=0;v<k.length;v++)(w=k[v])&&w(null,
g);break;case "listDevices":if(k[1]){k=[];for(v in this._devices)this._devices.hasOwnProperty(v)&&this._devices[v]&&k.push(this._devices[v]);m.push(k)}break;case "deleteDevices":if(k[1])for(v=0;v<k[1].length;v++)if(g=k[1][v])delete this._devices[g],delete this._status[g];break;case "event":this._logger.log("trace","get event:"+JSON.stringify(k)),this._updateStatusBuffer(k[1],k[2],k[3])}r&&r(null,m)};var n=function(g,k,r,m,v,w){x.hub.m.hm._Controller.call(this,g,k,r,m,v,w);this.interface="BidCos-RF";
this._logger=require("x.logger.js").getLogger("x.hub.m.hm.Controller.RF")};n.prototype=new p;n.prototype.constructor=n;n.prototype.listBidcosInterfaces=function(g){this._client.listBidcosInterfaces(function(k,r){g&&g(k,r)})};n.prototype.ping=function(g,k){this._client.ping(g,function(r){k&&k(r)})};var q=function(g,k,r,m,v,w){x.hub.m.hm._Controller.call(this,g,k,r,m,v,w);this.interface="BidCos-Wired";this._logger=require("x.logger.js").getLogger("x.hub.m.hm.Controller.Wired")};util.inherits(q,p);var h=
function(g,k,r,m,v,w){x.hub.m.hm._Controller.call(this,g,k,r,m,v,w);this.interface="HmIP-RF";this._logger=require("x.logger.js").getLogger("x.hub.m.hm.Controller.IP")};util.inherits(h,p);h.prototype.deleteDevice=function(g,k){var r=g.indexOf(":");-1!=r&&(g=g.substr(0,r));this._client.deleteDevice(g,2,k)};p.getController=function(g,k,r){switch(g){case "BidCos-RF":g=n;break;case "BidCos-Wired":g=q;break;case "HmIP-RF":g=h;break;default:return null}return new g(k.ip,k.port,k.username,k.password,r.useHttps,
r.initStates)};return p}();
x.hub.m.hm.Monitor=function(){var p=function(h,g,k){this._logger=require("x.logger.js").getLogger("x.hub.m.hm.Monitor.ControllerMonitor");this._type=k;this._monitor=h;this._controller=g;this._xmlrpcServer=null;this._retryWait=1E4;this._retryCount=0;this._retryTO=null;this._state=0;this._err=null};p.prototype.start=function(h,g){0==this._state&&(this._xmlrpcServer=h,this._connect(h));g&&g()};p.prototype.stop=function(h,g){var k=this._state;this._retryTO&&clearTimeout(this._retryTO);this._retryTO=null;
this._state=0;this._err=null;this._retryCount=0;0!=k?this._unregister(h,function(){g&&g()}):g&&g()};p.prototype.getMonitorState=function(){return{state:this._state,error:this._err?this._err.message:null}};p.prototype._connect=function(){this._logger.log("info","start regist "+this._type+" monitor at "+this._controller.getIP()+":"+this._controller.getPort());this._state=1;var h=this;this._register(this._xmlrpcServer,function(g){g?(h._logger.log("warn","regist "+h._type+" monitor at "+h._controller.getIP()+
":"+h._controller.getPort()+" error:"+g.message),h._state=3,h._err=g,h._retryCount++,h._retryTO=setTimeout(function(){h._logger.log("trace","retry timeout for regist "+h._type+" monitor at "+h._controller.getIP()+":"+h._controller.getPort()+" expired");h._connect()},Math.min(6E4,Math.ceil(h._retryCount/10)*h._retryWait))):(h._logger.log("info","regist "+h._type+" monitor at "+h._controller.getIP()+":"+h._controller.getPort()+" success"),h._state=2,h._err=null,h._retryCount=0,h._monitor._onControllerMonitorConnected(h._type))})};
p.prototype._register=function(h,g){var k=this._monitor.localMac.replace(/:/g,""),r="/"+this._monitor.serialNumber;h=h.getPort();this._controller.register("http://"+this._monitor.localIP+":"+(h?h:80)+r,this._monitor.serialNumber+"_"+this._controller.getPort()+"_"+k,g)};p.prototype._unregister=function(h,g){var k="/"+this._monitor.serialNumber;h=h.getPort();this._controller.unregister("http://"+this._monitor.localIP+":"+(h?h:80)+k,g)};var n=function(h){this._logger=require("x.logger.js").getLogger("x.hub.m.hm.Monitor.PinPongHandler");
this._monitor=h;this._pingWait=3E4;this._pingTO=null;this._pingMiss=0};n.prototype.start=function(){this._pingTO&&(clearTimeout(this._pingTO),this._pingTO=null);this._pingMiss=0;this._startPingTO()};n.prototype.stop=function(){this._pingTO&&(clearTimeout(this._pingTO),this._pingTO=null);this._pingMiss=0};n.prototype._startPingTO=function(){var h=this;this._pingTO&&(clearTimeout(this._pingTO),this._pingTO=null);this._pingTO=setTimeout(function(){h._pingMiss++;4>h._pingMiss?(h._ping(),h._startPingTO()):
h._pingFail()},this._pingWait)};n.prototype._ping=function(h){var g=this._monitor._rfController;g?(this._logger.log("trace","send PING"),g.ping(this._monitor.localMac,function(k){h&&h(k)})):h&&h(Error("no rf controller for ping"))};n.prototype._pingFail=function(){this._logger.log("warn","PING Fail");this._pingTO&&(clearTimeout(this._pingTO),this._pingTO=null);this._pingMiss=0;this._monitor._onPingFail()};n.prototype._onPong=function(){this._pingMiss=0};var q=function(h,g){this.ip=h.ip;this.serialNumber=
h.uuid;this.ccuType=h.type;this.ccuType||(this.ccuType=2);this.localIP=g?g.localIP:null;this.localMac=g?g.localMac:null;this.isChip=g?"chip"==g.localChip:!1;this.isCCU3=g?"ccu3"==g.localChip:!1;this.persistant=g?g.persistant:!1;this._logger=require("x.logger.js").getLogger("x.hub.m.hm.Monitor");h={ip:this.ip,port:null,username:h.username,password:h.password};g={useHttps:!1,initStates:this.isChip?!0:!1};h.port=this.isCCU3?32001:2001;this._rfController=x.hub.m.hm._Controller.getController("BidCos-RF",
h,g);this._rfController.on("event",this._onEvent.bind(this));this._rfController.on("newDevices",this._onNewDevices.bind(this));h.port=this.isCCU3?32010:2010;this._ipController=x.hub.m.hm._Controller.getController("HmIP-RF",h,g);this._ipController.on("event",this._onEvent.bind(this));this._ipController.on("newDevices",this._onNewDevices.bind(this));h.port=this.isCCU3?32E3:2E3;this._wiredController=x.hub.m.hm._Controller.getController("BidCos-Wired",h,g);this._wiredController.on("event",this._onEvent.bind(this));
this._wiredController.on("newDevices",this._onNewDevices.bind(this));this._wiredMonitor=this._ipMonitor=this._rfMonitor=null;this._pingpong=new n(this);this._pingTO=this._manager=this._xmlrpcServer=null;this._pingMiss=0;this._wiredRegisted=this._ipRegisted=this._rfRegisted=!1;this._reconnectTO=null;this._reconnectCount=0};util.inherits(q,EventEmitter);q.prototype.getMonitorState=function(h){var g={chip:this.isChip};if(this._rfMonitor){var k=this._rfMonitor.getMonitorState();g.bidcos=k}this._ipMonitor&&
(k=this._ipMonitor.getMonitorState(),g.hmip=k);this._wiredMonitor&&(k=this._wiredMonitor.getMonitorState(),g.bidcos_wired=k);g.bidcos&&2==g.bidcos.state?this._rfController.listBidcosInterfaces(function(r,m){m&&(g.info=m);h&&h(null,g)}):h&&h(null,g)};q.prototype.getAllBufferedStates=function(){var h={},g,k=this._rfController.getAllBufferedStates();if(k)for(g in k)k.hasOwnProperty(g)&&(h[g]=k[g]);if(k=this._wiredController.getAllBufferedStates())for(g in k)k.hasOwnProperty(g)&&(h[g]=k[g]);if(k=this._ipController.getAllBufferedStates())for(g in k)k.hasOwnProperty(g)&&
(h[g]=k[g]);return h};q.prototype.getBufferedDevice=function(h,g){switch(h){case "BidCos-RF":h=this._rfController;break;case "BidCos-Wired":h=this._wiredController;break;case "HmIP-RF":h=this._ipController;break;default:return null}return h.getDevice(g)};q.prototype.getState=function(h,g){if(!(h&&h.interface&&h.channel&&h.datapoint))return g&&g(Error("argument invalid")),null;switch(h.interface){case "BidCos-RF":var k=this._rfController;break;case "BidCos-Wired":k=this._wiredController;break;case "HmIP-RF":k=
this._ipController;break;default:return null}k.getState(h.channel,h.datapoint,g)};q.prototype.updateState=function(h,g){if(!(h&&h.interface&&h.channel&&h.datapoint))return g&&g(Error("argument invalid")),null;switch(h.interface){case "BidCos-RF":var k=this._rfController;break;case "BidCos-Wired":k=this._wiredController;break;case "HmIP-RF":k=this._ipController;break;default:return null}k.updateState(h.channel,h.datapoint,g)};q.prototype.init=function(h,g){this._logger.log("info","init monitor ("+
this.ip+")");this._xmlrpcServer=h;this._init(g)};q.prototype._init=function(h){var g=this;this.getSerialNumber(function(k){k?h&&h(k):g.register(g._xmlrpcServer,function(){h&&h()})})};q.prototype.update=function(h,g,k,r){k&&this.serialNumber!=k&&(this.serialNumber=k);var m=this;h&&this.ip!=h||g&&this.localIP!=g?this.unregister(this._xmlrpcServer,function(){m.ip=h;m.localIP=g;m.register(m._xmlrpcServer,r)}):r&&r()};q.prototype.finalize=function(h){this.removeAllListeners();this._manager&&this._manager.deleteMonitor(this.ip);
this._pingTO&&(clearTimeout(this._pingTO),this._pingTO=null);this._reconnectTO&&(clearTimeout(this._reconnectTO),this._reconnectTO=null);this.unregister(this._xmlrpcServer,function(){h&&h()})};q.prototype.getSerialNumber=function(h){var g=this;global&&"CCU3"==global.PLATFORM?(this._rfController.setPort(32001),g.getRFInterfaces(function(k,r){k?(g._rfController.setPort(2001),g.getRFInterfaces(function(m,v){m?h&&h():(g.serialNumber=v[0].ADDRESS,h&&h(null,g.serialNumber))})):(g._ipController.setPort(32010),
g._wiredController.setPort(32E3),g.serialNumber=r[0].ADDRESS,h&&h(null,g.serialNumber))})):this.getRFInterfaces(function(k,r){k?h&&h():(g.serialNumber=r[0].ADDRESS,h&&h(null,g.serialNumber))})};q.prototype.getRFInterfaces=function(h){this._rfController.listBidcosInterfaces(function(g,k){h&&h(g,k)})};q.prototype.register=function(h,g){var k=this;h.registServlet("/"+this.serialNumber,function(r,m,v){k._xmlrpcCall(r,m,v)});this._rfMonitor=new p(this,this._rfController,"rf");this._ipMonitor=new p(this,
this._ipController,"ip");this._wiredMonitor=new p(this,this._wiredController,"wired");this._rfMonitor.start(h);this._ipMonitor.start(h);this.isChip||this._wiredMonitor.start(h);g&&g()};q.prototype.unregister=function(h,g){h.unregistServlet("/"+this.serialNumber);this._rfMonitor.stop(h);this._ipMonitor.stop(h);this.isChip||this._wiredMonitor.stop(h);g&&g()};q.prototype._onControllerMonitorConnected=function(h){"rf"==h&&this._pingpong.start()};q.prototype._onPingFail=function(){var h=this;this.unregister(this._xmlrpcServer,
function(){h.register(h._xmlrpcServer,function(){})})};q.prototype._onPong=function(){this._pingpong._onPong()};q.prototype.reset=function(h){var g=this;this._rfController.reset(function(){g._ipController.reset(function(){g._wiredController.reset(function(){h&&h()})})})};q.prototype.learnRF=function(h){this._rfController.learnNewDevice(function(g,k){h&&h(g,k)})};q.prototype.learnRFSN=function(h,g){this._rfController.learnNewDeviceSN(h,function(k,r){g&&g(k,r)})};q.prototype.learnIP=function(h,g,k){this._ipController.learnNewIPDevice(h,
g,function(r,m){k&&k(r,m)})};q.prototype.learnIPQR=function(h,g){this._ipController.learnNewIPDeviceQR(h,function(k,r){g&&g(k,r)})};q.prototype.deleteDevice=function(h,g,k){if(!h||!g)return k&&k(Error("argument invalid")),null;switch(h){case "BidCos-RF":h=this._rfController;break;case "BidCos-Wired":h=this._wiredController;break;case "HmIP-RF":h=this._ipController;break;default:k&&k(Error("no such interface"));return}h.deleteDevice(g,k)};q.prototype.getDevices=function(h){var g=0;this._rfController&&
g++;this._ipController&&g++;this._wiredController&&g++;var k=[],r=function(v){g--;v?h&&h(v):0==g&&h&&h(null,k)},m=this;this._rfController&&this._rfController.getBufferedDevices(function(v,w){v?(r&&r(v),r=null):(k=k.concat(m._parseDevices(w,"BidCos-RF")),r&&r())});this._ipController&&this._ipController.getBufferedDevices(function(v,w){v?(r&&r(v),r=null):(k=k.concat(m._parseDevices(w,"HmIP-RF")),r&&r())});this._wiredController&&this._wiredController.getBufferedDevices(function(v,w){v?(r&&r(v),r=null):
(k=k.concat(m._parseDevices(w,"BidCos-Wired")),r&&r())})};q.prototype.getParamset=function(h,g,k,r){if(h&&g&&k){var m=null;switch(h){case "BidCos-RF":m=this._rfController;break;case "BidCos-Wired":m=this._wiredController;break;case "HmIP-RF":m=this._ipController;break;default:r&&r(Error("unknow interface"));return}m.getParamset(g,k,function(v,w){r&&r(v,w)})}else r&&r(Error("argument invalid"))};q.prototype.setParamset=function(h,g,k,r,m){if(h&&g&&k&&r){var v=null;switch(h){case "BidCos-RF":v=this._rfController;
break;case "BidCos-Wired":v=this._wiredController;break;case "HmIP-RF":v=this._ipController;break;default:m&&m(Error("unknow interface"));return}v.setParamset(g,k,r,function(w,z){m&&m(w,z)})}else m&&m(Error("argument invalid"))};q.prototype.readValue=function(h,g,k,r){if(h&&g&&k){var m=null;switch(h){case "BidCos-RF":m=this._rfController;break;case "BidCos-Wired":m=this._wiredController;break;case "HmIP-RF":m=this._ipController;break;default:r&&r(Error("unknow interface"));return}m.readValue(g,k,
function(v,w){r&&r(v,w)})}else r&&r(Error("argument invalid"))};q.prototype.writeValue=function(h,g,k,r,m){if(h&&g&&k){var v=null;switch(h){case "BidCos-RF":v=this._rfController;break;case "BidCos-Wired":v=this._wiredController;break;case "HmIP-RF":v=this._ipController;break;default:m&&m(Error("unknow interface"));return}v.writeValue(g,k,r,function(w){m&&m(w)})}else m&&m(Error("argument invalid"))};q.prototype.reportValueUsage=function(h,g,k,r){if(h&&g&&k){var m=null;switch(h){case "BidCos-RF":m=
this._rfController;break;case "BidCos-Wired":m=this._wiredController;break;case "HmIP-RF":m=this._ipController;break;default:r&&r(Error("unknow interface"));return}m.reportValueUsage(g,k,1,function(v,w){r&&r(v,w)})}else r&&r(Error("argument invalid"))};q.prototype.updateStatusBuffer=function(h,g,k,r,m){if(h&&g&&k){switch(h){case "BidCos-RF":h=this._rfController;break;case "BidCos-Wired":h=this._wiredController;break;case "HmIP-RF":h=this._ipController;break;default:return}h._updateStatusBuffer(g,
k,r,m)}};q.prototype._parseDevices=function(h,g){g||(g="BidCos-RF");var k=new (require("xnm.aio.hm.js").CCU),r={},m;for(m in h)if(h.hasOwnProperty(m)){var v=h[m],w={typename:"DEVICE",hsstype:v.TYPE,address:v.ADDRESS,interface:g,rfAddr:v.RF_ADDRESS,channels:{}};if(v.CHILDREN)for(var z=0,D=v.CHILDREN.length;z<D;z++){var E=v.CHILDREN[z];w.channels[E]={hsstype:h[E].TYPE,address:E}}r[m]=w}return k._parseDevices(r)};q.prototype._xmlrpcCall=function(h,g,k){this._logger.log("trace","receive call:"+h);this._logger.log("trace",
"params:"+JSON.stringify(g));if("event"==h&&"CENTRAL"==g[1]&&"PONG"==g[2])this._onPong(),k&&k(null,[]);else{var r=g[0].split("_");3<=r.length?(r=r[1],-1!=r.indexOf("2001")&&this._rfController?this._rfController._xmlrpcCall(h,g,k):-1!=r.indexOf("2010")&&this._ipController?this._ipController._xmlrpcCall(h,g,k):-1!=r.indexOf("2000")&&this._wiredController?this._wiredController._xmlrpcCall(h,g,k):k&&k(null,[])):k&&k(null,[])}};q.prototype._onNewDevices=function(h){this._logger.log("debug","find new devices");
this._logger.log("debug",JSON.stringify(h));this.emit("new_devices",h)};q.prototype._onEvent=function(h){this._logger.log("trace","receive event:"+JSON.stringify(h));this._logger.log("debug","EVENT:\t"+h.interface+"\t"+h.device.type+"\t"+h.channel+"\t"+h.datapoint+"\t"+h.value.value);h.ip=this.ip;h.serialNumber=this.serialNumber;this.emit("event",h,this)};return q}();
x.hub.m.hm.MonitorManager=function(){var p=function(){this._logger=require("x.logger.js").getLogger("x.hub.m.hm.MonitorManager");this._monitors=[];this._xmlrpcServer=null;this._tmpMonitors={};this._monitorEvtListener=this.onDeviceEvent.bind(this)};p.prototype.init=function(n,q){this._xmlrpcServer=n;q&&q()};p.prototype.startMonitorForIP=function(n,q,h){this.startMonitor({ip:n},{localIP:q},h)};p.prototype.startMonitor=function(n,q,h){if(this._xmlrpcServer)if(n&&n.ip){var g=this.getMonitor(n.ip,n.uuid);
if(g)h&&h();else if(q||(q={}),q.localIP||(q.localIP=x.hub.m.hm._Util.getLocalIP(null,n.ip)),q.localIP){q.localMac||(q.localMac=x.hub.m.hm._Util.getLocalMac(q.localIP));var k=n.ip;this._tmpMonitors[k]||(this._tmpMonitors[k]=[]);var r=this._tmpMonitors[k].length,m=this._tmpMonitors[k];h||(h=function(){});-1==m.indexOf(h)&&m.push(h);if(!(0<r)){var v=this;g=new x.hub.m.hm.Monitor(n,q);g._manager=this;g.init(this._xmlrpcServer,function(w){w||(v._monitors.push(g),g.on("event",v._monitorEvtListener));var z=
v._tmpMonitors[k];delete v._tmpMonitors[k];z.forEach(function(D){D&&D(w)})})}}else h&&h(Error("local ip address invalid"))}else h&&h(Error("gateway invalid"));else h&&h(Error("xml rpc server not started"))};p.prototype.getAllMonitor=function(){return this._monitors};p.prototype.getMonitor=function(n,q){var h=null,g=null;this._monitors.forEach(function(k){k&&k.ip==n&&(h=k);k&&k.serialNumber==q&&(g=k)});return g?g:h};p.prototype.getMonitorStates=function(n){if(0==this._monitors.length)n&&n(null,[]);
else{var q=this,h=0,g=[],k=function(r,m){!r&&m&&(m.ip=q._monitors[h].ip,m.serialNumber=q._monitors[h].serialNumber,g.push(m));h++;h<q._monitors.length?q._monitors[h].getMonitorState(k):n&&n(null,g)};this._monitors[h].getMonitorState(k)}};p.prototype.deleteMonitor=function(n){for(var q=-1,h=0,g=this._monitors.length;h<g;h++){var k=this._monitors[h];if(k&&k.ip==n){q=h;break}}-1!=h&&this._monitors.splice(q,1)};p.prototype.onFindHomeMatic=function(n,q,h){var g=this.getMonitor(null,h),k=this.getMonitor(n);
k?(k.update(n,q,h),g&&g!=k&&(g.finalize(),this.deleteMonitor(g.ip))):(g&&(g.finalize(),this.deleteMonitor(g.ip)),this.startMonitorForIP(n,q))};p.prototype.onDeviceEvent=function(n,q){require("x.hub.m.hm.js").onDeviceEvent(n,q.isChip)};return p}();
x.hub.m.hm._Channel=function(){var p=function(){var h=[];this.map.forEach(function(g){g&&g.dpt&&g.state&&0<g.state.length&&-1==h.indexOf(g.dpt)&&h.push(g.dpt)});return h},n=function(h){var g=null;this.map.forEach(function(k){k&&k.dpt&&k.state&&-1!=k.state.indexOf(h)&&(g=k.dpt)});return g},q=function(h){var g=null;this.map.forEach(function(k){k&&k.dpt&&k.command&&-1!=k.command.indexOf(h)&&(g=k.dpt)});return g};return{"HmIP-RF":{T_MAINTENANCE:{map:[{dpt:"UNREACH",state:["timeout"],event:["timeout"]},
{dpt:"LOW_BAT",state:["lowbat"],event:["lowbat"]},{dpt:"SABOTAGE",state:["sabotage"],event:["sabotage"]},{dpt:"OPERATING_VOLTAGE",state:["voltage"],event:["voltage"]},{dpt:"ERROR_CODE",state:["errorCode"],event:["errorCode"]},{dpt:"SENSOR_ERROR",state:["sensorError"],event:["sensorError"]},{dpt:"ACTUAL_TEMPERATURE",state:["maintainTemp"],event:["maintainTemp"]}],getReadableDpts:p,getDptFromState:n,parseDptState:function(h,g){switch(h){case "UNREACH":return{timeout:g};case "LOW_BAT":return{lowbat:g};
case "SABOTAGE":return{sabotage:g};case "OPERATING_VOLTAGE":return{voltage:parseFloat(g)};case "ERROR_CODE":return{errorCode:parseInt(g)};case "ACTUAL_TEMPERATURE":return{maintainTemp:parseFloat(g)}}return null}},MAINTENANCE:{map:[{dpt:"UNREACH",state:["timeout"],event:["timeout"]},{dpt:"LOW_BAT",state:["lowbat"],event:["lowbat"]},{dpt:"SABOTAGE",state:["sabotage"],event:["sabotage"]}],getReadableDpts:p,getDptFromState:n,parseDptState:function(h,g){switch(h){case "UNREACH":return{timeout:g};case "LOW_BAT":return{lowbat:g};
case "SABOTAGE":return{sabotage:g}}return null}},MAINTENANCE_BAT_EL:{map:[{dpt:"UNREACH",state:["timeout"],event:["timeout"]},{dpt:"LOW_BAT",state:["lowbat"],event:["lowbat"]},{dpt:"SABOTAGE",state:["sabotage"],event:["sabotage"]},{dpt:"OPERATING_VOLTAGE",state:["voltage"],event:["voltage"]},{dpt:"ERROR_CODE",state:["errorCode"],event:["errorCode"]},{dpt:"SENSOR_ERROR",state:["sensorError"],event:["sensorError"]}],getReadableDpts:p,getDptFromState:n,parseDptState:function(h,g){switch(h){case "UNREACH":return{timeout:g};
case "LOW_BAT":return{lowbat:g};case "SABOTAGE":return{sabotage:g};case "OPERATING_VOLTAGE":return{voltage:parseFloat(g)};case "ERROR_CODE":return{errorCode:parseInt(g)};case "SENSOR_ERROR":return{sensorError:g}}return null}},MAINTENANCE_BAT_CL:{map:[{dpt:"UNREACH",state:["timeout"],event:["timeout"]},{dpt:"LOW_BAT",state:["lowbat"],event:["lowbat"]},{dpt:"ERROR_NON_FLAT_POSITIONING",state:["sabotage"],event:["sabotage"]}],getReadableDpts:p,getDptFromState:n,parseDptState:function(h,g){switch(h){case "UNREACH":return{timeout:g};
case "LOW_BAT":return{lowbat:g};case "ERROR_NON_FLAT_POSITIONING":return{sabotage:g}}return null}},SWITCH_TRANSMITTER:{map:[{dpt:"STATE",state:["switchTState"],event:["switchTState"]}],getReadableDpts:p,getDptFromState:n,parseDptState:function(h,g){var k=null;switch(h){case "STATE":k=1==g?{switchTState:"on"}:0==g?{switchTState:"off"}:{switchTState:"?"}}return k}},SWITCH_VIRTUAL_RECEIVER:{map:[{dpt:"STATE",state:["switchState"],event:["switchState"],command:["on","off","toggle"]}],getReadableDpts:p,
getDptFromState:n,parseDptState:function(h,g){var k=null;switch(h){case "STATE":k=1==g?{switchState:"on"}:0==g?{switchState:"off"}:{switchState:"?"}}return k},executeCommand:function(h,g,k,r,m){var v=q.call(this,r);"onFor"==r.substr(0,5)&&(v="STATE");if(v)switch(r){case "on":h.writeValue(g,k,v,!0,m);break;case "off":h.writeValue(g,k,v,!1,m);break;case "toggle":h.getState({interface:g,channel:k,datapoint:v},function(w,z){w?m&&m(w):z?(w=!0,z.value&&(w=!1),h.writeValue(g,k,v,w,m)):m&&m(Error("get switch current value return invalid"))});
break;default:"onFor"==r.substr(0,5)?(r=parseFloat(r.substr(5)),isNaN(r)?m&&m(Error("onFor command invalid")):(v="ON_TIME",h.writeValue(g,k,v,{type:"double",value:r},function(w){w?m&&m(w):(v="STATE",h.writeValue(g,k,v,!0,m))}))):m&&m(Error("no such command"))}else m&&m(Error("can not find datapoint for command:"+r))}},ENERGIE_METER_TRANSMITTER:{map:[{dpt:"ENERGY_COUNTER",state:["meterEnergyCounter"],event:["meterEnergyCounter"]},{dpt:"POWER",state:["meterPower"],event:["meterPower"]},{dpt:"CURRENT",
state:["meterCurrent"],event:["meterCurrent"]},{dpt:"VOLTAGE",state:["meterVoltage"],event:["meterVoltage"]},{dpt:"FREQUENCY",state:["meterFrequency"],event:["meterFrequency"]}],getReadableDpts:p,getDptFromState:n,parseDptState:function(h,g){switch(h){case "ENERGY_COUNTER":return{meterEnergyCounter:parseFloat(g).toFixed(2)};case "POWER":return{meterPower:parseFloat(g).toFixed(2)};case "CURRENT":return{meterCurrent:parseFloat(g).toFixed(2)};case "VOLTAGE":return{meterVoltage:parseFloat(g).toFixed(2)};
case "FREQUENCY":return{meterFrequency:parseFloat(g).toFixed(2)}}return null}},DIMMER_TRANSMITTER:{map:[{dpt:"LEVEL",state:["dimmerTLevel"],event:["dimmerTLevel"]}],getReadableDpts:p,getDptFromState:n,parseDptState:function(h,g){var k=null;switch(h){case "LEVEL":k={dimmerTLevel:Math.round(100*parseFloat(g))};break;case "COLOR":k={dimmerTColor:"off blue green torqoise red purple yellow white".split(" ")[parseInt(g)]}}return k}},DIMMER_VIRTUAL_RECEIVER:{map:[{dpt:"LEVEL",state:["dimmerLevel"],event:["dimmerLevel"],
command:["dimOff","dimUp","dimDown","dimTo","toggleTo"]},{dpt:"COLOR",state:["dimmerColor"],event:["dimmerColor"],command:["colorTo"]}],getReadableDpts:p,getDptFromState:n,parseDptState:function(h,g){var k=null;switch(h){case "LEVEL":k={dimmerLevel:Math.round(100*parseFloat(g))}}return k},executeCommand:function(h,g,k,r,m){if(r){if("dimOff"==r.substr(0,6))var v="dimOff";else if("dimUp"==r.substr(0,5)){v="dimUp";var w=r.substr(5)}else if("dimDown"==r.substr(0,7))v="dimDown",w=r.substr(7);else if("dimTo"==
r.substr(0,5)){if(v="dimTo",w=r.substr(5),!w){m&&m(Error("dimTo has no value"));return}}else if("toggleTo"==r.substr(0,8)){if(v="toggleTo",w=r.substr(8),!w){m&&m(Error("toggleTo has no value"));return}}else if("colorTo"==r.substr(0,7)&&(v="colorTo",w=r.substr(7),!w)){m&&m(Error("colorTo has no value"));return}var z=q.call(this,v);if(z)switch(v){case "dimOff":h.writeValue(g,k,z,{type:"double",value:0},m);break;case "dimUp":w||(w=10);w=parseInt(w)/100;h.getState({interface:g,channel:k,datapoint:z},
function(D,E){D?m&&m(D):"undefined"==typeof E||null==E?m&&m(Error("get dimmer current value return invalid")):(w=E.value+w,1<w&&(w=1),h.writeValue(g,k,z,{type:"double",value:w},m))});break;case "dimDown":w||(w=10);w=parseInt(w)/100;h.getState({interface:g,channel:k,datapoint:z},function(D,E){D?m&&m(D):"undefined"==typeof E||null==E?m&&m(Error("get dimmer current value return invalid")):(w=E.value-w,0>w&&(w=0),h.writeValue(g,k,z,{type:"double",value:w},m))});break;case "toggleTo":w=parseInt(w)/100;
h.getState({interface:g,channel:k,datapoint:z},function(D,E){D?m&&m(D):E?(E.value&&(w=0),h.writeValue(g,k,z,{type:"double",value:w},m)):m&&m(Error("get switch current value return invalid"))});break;case "dimTo":w=parseInt(w)/100;h.writeValue(g,k,z,{type:"double",value:w},m);break;case "colorTo":w=w.toLowerCase();w="off blue green torqoise red purple yellow white".split(" ").indexOf(w);if(-1==w){m&&m(Error("unknown color"));break}h.writeValue(g,k,z,{type:"double",value:w},m);break;default:m&&m(Error("no such command"))}else m&&
m(Error("can not find datapoint for command:"+r))}else m&&m(Error("command in null"))}},MOTIONDETECTOR_TRANSCEIVER:{map:[{dpt:"RESET_MOTION",command:["reset"]},{dpt:"MOTION",state:["state"],event:["state"]},{dpt:"ILLUMINATION",state:["illumination"],event:["illumination"]},{dpt:"MOTION_DETECTION_ACTIVE",state:["active"],event:["active"],command:["activate","deactivate","toggleActivate"]}],getReadableDpts:p,getDptFromState:n,parseDptState:function(h,g){var k=null;switch(h){case "MOTION":k={state:g?
"on":"off"};break;case "ILLUMINATION":k={illumination:g};break;case "MOTION_DETECTION_ACTIVE":k={active:g}}return k},executeCommand:function(h,g,k,r,m){if(r){var v=q.call(this,r);if(v)switch(r){case "reset":h.writeValue(g,k,v,!0,m);break;case "activate":h.writeValue(g,k,v,!0,m);break;case "deactivate":h.writeValue(g,k,v,!1,m);break;case "toggleActivate":h.getState({interface:g,channel:k,datapoint:v},function(w,z){w?m&&m(w):z?(w=!0,z.value&&(w=!1),h.writeValue(g,k,v,w,m)):m&&m(Error("get switch current value return invalid"))});
break;default:m&&m(Error("no such command"))}else m&&m(Error("can not find datapoint for command:"+r))}else m&&m(Error("command in null"))}},KEY_TRANRECEIVER:{map:[{dpt:"PRESS_SHORT",event:["pressShort"]},{dpt:"PRESS_LONG",event:["pressLong"]}],getReadableDpts:p,getDptFromState:n,parseDptState:function(h,g){g=null;switch(h){case "PRESS_SHORT":g={pressShort:!0};break;case "PRESS_LONG":g={pressLong:!0}}return g}},ALARM_SWITCH_VIRTUAL_RECEIVER:{map:[{dpt:"ACOUSTIC_ALARM_SELECTION",command:["setAudio"]},
{dpt:"OPTICAL_ALARM_SELECTION",command:["setVisual"]},{dpt:"DURATION_UNIT",command:["setDuraionUnit"]},{dpt:"DURATION_VALUE",command:["setDuraion"]},{dpt:"STATE",state:["state"],event:["state"]}],getReadableDpts:p,getDptFromState:n,parseDptState:function(h,g){var k=null;switch(h){case "STATE":k=1==g?{state:"on"}:0==g?{state:"off"}:{state:"?"}}return k},executeCommand:function(h,g,k,r,m){if(r){var v=null;if("triggerAlarm"==r.substr(0,12)){v="triggerAlarm";var w=r.substr(12);if(!w){m&&m(Error("triggerAlarm format invalid"));
return}}if(q.call(this,v)||"triggerAlarm"==v)switch(v){case "triggerAlarm":var z=w.split(",");if(4>z.length){m&&m(Error("triggerAlarm format invalid"));break}h.writeValue(g,k,"ACOUSTIC_ALARM_SELECTION",{type:"double",value:parseInt(z[0])},function(D,E){D?m&&m(D):h.writeValue(g,k,"OPTICAL_ALARM_SELECTION",{type:"double",value:parseInt(z[1])},function(J,M){J?m&&m(J):h.writeValue(g,k,"DURATION_VALUE",{type:"double",value:parseInt(z[2])},function(O,W){O?m&&m(O):h.writeValue(g,k,"DURATION_UNIT",{type:"double",
value:parseInt(z[3])},m)})})});break;default:m&&m(Error("no such command"))}else m&&m(Error("can not find datapoint for command:"+r))}else m&&m(Error("command in null"))}},HEATING_CLIMATECONTROL_TRANSCEIVER:{map:[{dpt:"SET_POINT_TEMPERATURE",command:["tempTo","tempUp","tempDown"],state:["state"],event:["state"]},{dpt:"HUMIDITY",state:["hum"],event:["hum"]},{dpt:"CONTROL_MODE",command:["auto","manu"]},{dpt:"FROST_PROTECTION",state:["frost"],event:["frost"]},{dpt:"SET_POINT_MODE",state:["mode"],event:["mode"]},
{dpt:"ACTIVE_PROFILE",command:["setProfile"],state:["profile"],event:["profile"]},{dpt:"WINDOW_STATE",command:["winOpen","winClose"],state:["window"],event:["window"]},{dpt:"ACTUAL_TEMPERATURE",state:["temp"],event:["temp"]},{dpt:"BOOST_MODE",command:["boostOn","boostOff"],state:["boost"],event:["boost"]},{dpt:"LEVEL",command:["setValve","valveUp","valveDown"],state:["valve"],event:["valve"]}],getReadableDpts:p,getDptFromState:n,parseDptState:function(h,g){var k={};switch(h){case "ACTIVE_PROFILE":k.profile=
parseInt(g);break;case "ACTUAL_TEMPERATURE":k.temp=parseFloat(g);break;case "BOOST_MODE":k.boost=g;break;case "FROST_PROTECTION":k.frost=g;break;case "HUMIDITY":k.hum=parseInt(g);break;case "SET_POINT_MODE":0==g?k.mode="auto":1==g&&(k.mode="manu");break;case "SET_POINT_TEMPERATURE":k.state=parseFloat(g);break;case "LEVEL":k.valve=Math.round(100*parseFloat(g));break;case "WINDOW_STATE":switch(g){case 0:k.window="closed";break;case 1:k.window="open"}break;default:return null}return k},executeCommand:function(h,
g,k,r,m){if(r){var v=r;if("tempTo"==r.substr(0,6)){v="tempTo";var w=r.substr(6);if(!w){m&&m(Error("tempTo has no value"));return}}else if("tempUp"==r.substr(0,6))v="tempUp",w=r.substr(6);else if("tempDown"==r.substr(0,8))v="tempDown",w=r.substr(8);else if("setProfile"==r.substr(0,10)){if(v="setProfile",w=r.substr(10),!w){m&&m(Error("setProfile has no value"));return}}else if("setValve"==r.substr(0,8)){if(v="setValve",w=r.substr(8),!w){m&&m(Error("setValve has no value"));return}}else"valveUp"==r.substr(0,
7)?(v="valveUp",w=r.substr(7)):"valveDown"==r.substr(0,9)&&(v="valveDown",w=r.substr(9));var z=q.call(this,v);if(z)switch(v){case "tempTo":w=parseFloat(w);if(isNaN(w)){m&&m(Error("tempTo value invalid"));break}30.5<w&&(w=30.5);4.5>w&&(w=4.5);h.writeValue(g,k,z,{type:"double",value:w},m);break;case "tempUp":w||(w=1);w=parseFloat(w);if(isNaN(w)){m&&m(Error("tempUp value invalid"));break}h.getState({interface:g,channel:k,datapoint:z},function(D,E){D?m&&m(D):"undefined"==typeof E||null==E?m&&m(Error("get dimmer current value return invalid")):
(w=E.value+w,30.5<w&&(w=30.5),h.writeValue(g,k,z,{type:"double",value:w},m))});break;case "tempDown":w||(w=1);w=parseFloat(w);if(isNaN(w)){m&&m(Error("tempDown value invalid"));break}h.getState({interface:g,channel:k,datapoint:z},function(D,E){D?m&&m(D):"undefined"==typeof E||null==E?m&&m(Error("get dimmer current value return invalid")):(w=E.value-w,4.5>w&&(w=4.5),h.writeValue(g,k,z,{type:"double",value:w},m))});break;case "auto":h.writeValue(g,k,z,{type:"double",value:0},m);break;case "manu":h.writeValue(g,
k,z,{type:"double",value:1},m);break;case "setProfile":w=parseInt(w);if(isNaN(w)){m&&m(Error("setTemp value invalid"));break}h.writeValue(g,k,z,w,m);break;case "winOpen":h.writeValue(g,k,z,1,m);break;case "winClose":h.writeValue(g,k,z,0,m);break;case "boostOn":h.writeValue(g,k,z,!0,m);break;case "boostOff":h.writeValue(g,k,z,!1,m);break;case "setValve":w=parseInt(w);if(isNaN(w)){m&&m(Error("setValve value invalid"));break}w/=100;1<w&&(w=1);0>w&&(w=0);h.writeValue(g,k,z,{type:"double",value:w},m);
break;case "valveUp":w||(w=10);w=parseInt(w);if(isNaN(w)){m&&m(Error("tempUp value invalid"));break}w/=100;h.getState({interface:g,channel:k,datapoint:z},function(D,E){D?m&&m(D):"undefined"==typeof E||null==E?m&&m(Error("get dimmer current value return invalid")):(w=E.value+w,1<w&&(w=1),h.writeValue(g,k,z,{type:"double",value:w},m))});break;case "valveDown":w||(w=10);w=parseInt(w);if(isNaN(w)){m&&m(Error("tempUp value invalid"));break}w/=100;h.getState({interface:g,channel:k,datapoint:z},function(D,
E){D?m&&m(D):"undefined"==typeof E||null==E?m&&m(Error("get dimmer current value return invalid")):(w=E.value-w,0>w&&(w=0),h.writeValue(g,k,z,{type:"double",value:w},m))});break;default:m&&m(Error("no such command"))}else m&&m(Error("can not find datapoint for command:"+r))}else m&&m(Error("command in null"))}},SHUTTER_CONTACT_TRANSCEIVER:{map:[{dpt:"STATE",state:["state"],event:["state"]}],getReadableDpts:p,getDptFromState:n,parseDptState:function(h,g){var k=null;switch(h){case "STATE":k={state:0==
g?"closed":"open"}}return k}},SMOKE_DETECTOR:{map:[{dpt:"SMOKE_DETECTOR_COMMAND",command:"reservedAlarmOff intrusionAlarmOff intrusionAlarmOn smokeTest commTest commTestRepeated".split(" ")},{dpt:"SMOKE_DETECTOR_ALARM_STATUS",state:["state"],event:["state"]},{dpt:"SMOKE_DETECTOR_ALARM_STATUS",state:["alarmDetail"],event:["alarmDetail"]},{dpt:"SMOKE_DETECTOR_TEST_RESULT",state:["testResult"],event:["testResult"]},{dpt:"ERROR_CODE",state:["error"],event:["error"]}],getReadableDpts:p,getDptFromState:n,
parseDptState:function(h,g){var k=null;switch(h){case "SMOKE_DETECTOR_ALARM_STATUS":k={state:0==g?"ok":"smoke"};k.alarmDetail=g;break;case "SMOKE_DETECTOR_TEST_RESULT":switch(g){case 0:k={testResult:"none"};break;case 1:k={testResult:"smoke_ok"};break;case 2:k={testResult:"smoke_nok"};break;case 3:k={testResult:"comm_sent"};break;case 4:k={testResult:"comm_ok"}}break;case "ERROR_CODE":k={error:g}}return k},executeCommand:function(h,g,k,r,m){if(r){var v=q.call(this,r);if(v)switch(r){case "reservedAlarmOff":case "intrusionAlarmOff":case "intrusionAlarmOn":case "smokeTest":case "commTest":case "commTestRepeated":switch(r){case "reservedAlarmOff":var w=
0;break;case "intrusionAlarmOff":w=1;break;case "intrusionAlarmOn":w=2;break;case "smokeTest":w=3;break;case "commTest":w=4;break;case "commTestRepeated":w=5}h.writeValue(g,k,v,w,m);break;default:m&&m(Error("no such command"))}else m&&m(Error("can not find datapoint for command:"+r))}else m&&m(Error("command in null"))}},ROTARY_HANDLE_TRANSCEIVER:{map:[{dpt:"STATE",state:["state"],event:["state"]}],getReadableDpts:p,getDptFromState:n,parseDptState:function(h,g){var k=null;switch(h){case "STATE":switch(g){case 0:k=
{state:"closed"};break;case 1:k={state:"tilted"};break;case 2:k={state:"open"}}}return k}},SHUTTER_TRANSMITTER:{map:[{dpt:"LEVEL",state:["blindTLevel"],event:["blindTLevel"]}],getReadableDpts:p,getDptFromState:n,parseDptState:function(h,g){var k=null;switch(h){case "LEVEL":k={blindTLevel:Math.round(100*parseFloat(g))}}return k}},SHUTTER_VIRTUAL_RECEIVER:{map:[{dpt:"STOP",command:["stop"]},{dpt:"LEVEL",state:["blindLevel"],event:["blindLevel"],command:["moveUp","moveDown","stepUp","stepDown","moveTo"]}],
getReadableDpts:p,getDptFromState:n,parseDptState:function(h,g){var k=null;switch(h){case "LEVEL":k={blindLevel:Math.round(100*parseFloat(g))}}return k},executeCommand:function(h,g,k,r,m){if(r){if("moveUp"==r.substr(0,6))var v="moveUp";else if("moveDown"==r.substr(0,8)){v="moveDown";var w=r.substr(8)}else if("stepUp"==r.substr(0,6))v="stepUp",w=r.substr(6);else if("stepDown"==r.substr(0,8))v="stepDown",w=r.substr(8);else if("moveTo"==r.substr(0,6)){if(v="moveTo",w=r.substr(6),!w){m&&m(Error("moveTo has no value"));
return}}else"stop"==r.substr(0,4)&&(v="stop");var z=q.call(this,v);if(z)switch(v){case "moveUp":h.writeValue(g,k,z,{type:"double",value:1},m);break;case "moveDown":h.writeValue(g,k,z,{type:"double",value:0},m);break;case "stop":h.writeValue(g,k,z,!0,m);break;case "stepUp":w||(w=5);w=parseInt(w)/100;h.getState({interface:g,channel:k,datapoint:z},function(D,E){D?m&&m(D):"undefined"==typeof E||null==E?m&&m(Error("get dimmer current value return invalid")):(w=E.value+w,1<w&&(w=1),h.writeValue(g,k,z,{type:"double",
value:w},m))});break;case "stepDown":w||(w=5);w=parseInt(w)/100;h.getState({interface:g,channel:k,datapoint:z},function(D,E){D?m&&m(D):"undefined"==typeof E||null==E?m&&m(Error("get dimmer current value return invalid")):(w=E.value-w,0>w&&(w=0),h.writeValue(g,k,z,{type:"double",value:w},m))});break;case "moveTo":w=parseInt(w)/100;h.writeValue(g,k,z,{type:"double",value:w},m);break;default:m&&m(Error("no such command"))}else m&&m(Error("can not find datapoint for command:"+r))}else m&&m(Error("command in null"))}},
BLIND_TRANSMITTER:{map:[{dpt:"LEVEL",state:["blindTPos"],event:["blindTPos"]},{dpt:"LEVEL_2",state:["lamellaTPos"],event:["lamellaTPos"]}],getReadableDpts:p,getDptFromState:n,parseDptState:function(h,g){var k=null;switch(h){case "LEVEL":k={blindTPos:Math.round(100*parseFloat(g))};break;case "LEVEL_2":k={lamellaTPos:Math.round(100*parseFloat(g))}}return k}},BLIND_VIRTUAL_RECEIVER:{map:[{dpt:"STOP",command:["stop"]},{dpt:"LEVEL",state:["blindPos"],event:["blindPos"],command:["moveUp","moveDown","stepUp",
"stepDown","moveTo"]},{dpt:"LEVEL_2",state:["lamellaPos"],event:["lamellaPos"],command:["lamellaUp","lamellaDown","lamellaStepUp","lamellaStepDown","lamellaTo"]}],getReadableDpts:p,getDptFromState:n,parseDptState:function(h,g){var k=null;switch(h){case "LEVEL":k={blindPos:Math.round(100*parseFloat(g))};break;case "LEVEL_2":k={lamellaPos:Math.round(100*parseFloat(g))}}return k},executeCommand:function(h,g,k,r,m){if(r){var v=r;if("lamellaStepUp"==r.substr(0,13)){v="lamellaStepUp";var w=r.substr(13)}else if("lamellaStepDown"==
r.substr(0,15))v="lamellaStepDown",w=r.substr(15);else if("lamellaTo"==r.substr(0,9)){if(v="lamellaTo",w=r.substr(9),!w){m&&m(Error("lamellaTo has no value"));return}}else if("stepUp"==r.substr(0,6))v="stepUp",w=r.substr(6);else if("stepDown"==r.substr(0,8))v="stepDown",w=r.substr(8);else if("moveTo"==r.substr(0,6)){if(v="moveTo",w=r.substr(6),!w){m&&m(Error("moveTo has no value"));return}}else"stop"==r.substr(0,4)&&(v="stop");var z=q.call(this,v);if(z)switch(v){case "moveUp":case "moveDown":h.writeValue(g,
k,"LEVEL_2",{type:"double",value:"moveUp"==v?1:0},function(D){D?m&&m(D):h.writeValue(g,k,"LEVEL",{type:"double",value:"moveUp"==v?1:0},function(E){m&&m(E)})});break;case "stop":h.writeValue(g,k,z,!0,m);break;case "moveTo":w=parseInt(w)/100;h.writeValue(g,k,"LEVEL",{type:"double",value:w},m);break;case "lamellaUp":case "lamellaDown":h.getState({interface:g,channel:k,datapoint:"LEVEL"},function(D,E){D?m&&m(D):h.writeValue(g,k,"LEVEL",{type:"double",value:E.value},function(J){J?m&&m(J):h.writeValue(g,
k,"LEVEL_2",{type:"double",value:"lamellaUp"==v?1:0},function(M){m&&m(M)})})});break;case "stepUp":case "stepDown":w||(w=5);w=parseInt(w)/100;h.getState({interface:g,channel:k,datapoint:"LEVEL"},function(D,E){D?m&&m(D):"undefined"==typeof E||null==E?m&&m(Error("get jalousie current value return invalid")):(w="stepUp"==v?E.value+w:E.value-w,1<w&&(w=1),0>w&&(w=0),h.writeValue(g,k,"LEVEL",{type:"double",value:w},m))});break;case "lamellaStepUp":case "lamellaStepDown":w||(w=5);w=parseInt(w)/100;h.getState({interface:g,
channel:k,datapoint:"LEVEL"},function(D,E){if(D)m&&m(D);else if("undefined"==typeof E||null==E)m&&m(Error("get jalousie current value return invalid"));else{var J=E.value;h.getState({interface:g,channel:k,datapoint:"LEVEL_2"},function(M,O){M?m&&m(M):"undefined"==typeof O||null==O?m&&m(Error("get jalousie current value return invalid")):(w="lamellaStepUp"==v?O.value+w:O.value-w,1<w&&(w=1),0>w&&(w=0),h.writeValue(g,k,"LEVEL_2",{type:"double",value:w},function(W){W?m&&m(W):h.writeValue(g,k,"LEVEL",{type:"double",
value:J},m)}))})}});break;case "lamellaTo":w=parseInt(w)/100;h.writeValue(g,k,"LEVEL_2",{type:"double",value:w},m);break;default:m&&m(Error("no such command"))}else m&&m(Error("can not find datapoint for command:"+r))}else m&&m(Error("command in null"))}},PRESENCEDETECTOR_TRANSCEIVER:{map:[{dpt:"RESET_PRESENCE",command:["reset"]},{dpt:"PRESENCE_DETECTION_STATE",state:["state"],event:["state"]},{dpt:"ILLUMINATION",state:["illumination"],event:["illumination"]},{dpt:"CURRENT_ILLUMINATION",state:["current_illumination"],
event:["current_illumination"]},{dpt:"PRESENCE_DETECTION_ACTIVE",state:["active"],event:["active"],command:["activate","deactivate","toggleActivate"]}],getReadableDpts:p,getDptFromState:n,parseDptState:function(h,g){var k=null;switch(h){case "PRESENCE_DETECTION_STATE":k={state:g?"on":"off"};break;case "ILLUMINATION":k={illumination:g};break;case "CURRENT_ILLUMINATION":k={current_illumination:g};break;case "PRESENCE_DETECTION_ACTIVE":k={active:g}}return k},executeCommand:function(h,g,k,r,m){if(r){var v=
q.call(this,r);if(v)switch(r){case "reset":h.writeValue(g,k,v,!0,m);break;case "activate":h.writeValue(g,k,v,!0,m);break;case "deactivate":h.writeValue(g,k,v,!1,m);break;case "toggleActivate":h.getState({interface:g,channel:k,datapoint:v},function(w,z){w?m&&m(w):z?(w=!0,z.value&&(w=!1),h.writeValue(g,k,v,w,m)):m&&m(Error("get switch current value return invalid"))});break;default:m&&m(Error("no such command"))}else m&&m(Error("can not find datapoint for command:"+r))}else m&&m(Error("command in null"))}},
CLIMATECONTROL_FLOOR_DIRECT_TRANSMITTER:{map:[{dpt:"EMERGENCY_OPERATION",state:["cl_fd_emergencyOP"],event:["cl_fd_emergencyOP"]},{dpt:"FROST_PROTECTION",state:["cl_fd_frostProtection"],event:["cl_fd_frostProtection"]},{dpt:"STATE",state:["cl_fd_state"],event:["cl_fd_state"]},{dpt:"HUMIDITY_ALARM",state:["cl_fd_humidityAlarm"],event:["cl_fd_humidityAlarm"]}],getReadableDpts:p,getDptFromState:n,parseDptState:function(h,g){var k=null;switch(h){case "EMERGENCY_OPERATION":k={cl_fd_emergencyOP:g};break;
case "FROST_PROTECTION":k={cl_fd_frostProtection:g};break;case "STATE":k=1==g?{cl_fd_state:"on"}:0==g?{cl_fd_state:"off"}:{cl_fd_state:"?"};break;case "HUMIDITY_ALARM":k={cl_fd_humidityAlarm:g}}return k}},CLIMATECONTROL_FLOOR_PUMP_TRANSCEIVER:{map:[{dpt:"HUMIDITY_LIMITER",state:["cl_fp_humidityLimiter"],event:["cl_fp_humidityLimiter"]},{dpt:"EMERGENCY_OPERATION",state:["cl_fp_emergencyOP"],event:["cl_fp_emergencyOP"]},{dpt:"FROST_PROTECTION",state:["cl_fp_frostProtection"],event:["cl_fp_frostProtection"]},
{dpt:"STATE",state:["cl_fp_state"],event:["cl_fp_state"]},{dpt:"DEW_POINT_ALARM",state:["cl_fp_dewPointAlarm"],event:["cl_fp_dewPointAlarm"]},{dpt:"EXTERNAL_CLOCK",state:["cl_fp_externalClock"],event:["cl_fp_externalClock"]}],getReadableDpts:p,getDptFromState:n,parseDptState:function(h,g){var k=null;switch(h){case "HUMIDITY_LIMITER":k={cl_fp_humidityLimiter:g};break;case "EMERGENCY_OPERATION":k={cl_fp_emergencyOP:g};break;case "FROST_PROTECTION":k={cl_fp_frostProtection:g};break;case "STATE":k=1==
g?{cl_fp_state:"on"}:0==g?{cl_fp_state:"off"}:{cl_fp_state:"?"};break;case "DEW_POINT_ALARM":k={cl_fp_dewPointAlarm:g};break;case "EXTERNAL_CLOCK":k={cl_fp_externalClock:g}}return k}},CLIMATECONTROL_FLOOR_TRANSCEIVER:{map:[{dpt:"HUMIDITY_LIMITER",state:["cl_f_humidityLimiter"],event:["cl_f_humidityLimiter"]},{dpt:"EMERGENCY_OPERATION",state:["cl_f_emergencyOP"],event:["cl_f_emergencyOP"]},{dpt:"FROST_PROTECTION",state:["cl_f_frostProtection"],event:["cl_f_frostProtection"]},{dpt:"STATE",state:["cl_f_state"],
event:["cl_f_state"]},{dpt:"DEW_POINT_ALARM",state:["cl_f_dewPointAlarm"],event:["cl_f_dewPointAlarm"]},{dpt:"EXTERNAL_CLOCK",state:["cl_f_externalClock"],event:["cl_f_externalClock"]}],getReadableDpts:p,getDptFromState:n,parseDptState:function(h,g){var k=null;switch(h){case "HUMIDITY_LIMITER":k={cl_f_humidityLimiter:g};break;case "EMERGENCY_OPERATION":k={cl_f_emergencyOP:g};break;case "FROST_PROTECTION":k={cl_f_frostProtection:g};break;case "STATE":k=1==g?{cl_f_state:"on"}:0==g?{cl_f_state:"off"}:
{cl_f_state:"?"};break;case "DEW_POINT_ALARM":k={cl_f_dewPointAlarm:g};break;case "EXTERNAL_CLOCK":k={cl_f_externalClock:g}}return k}},WEATHER_TRANSMIT:{map:[{dpt:"ACTUAL_TEMPERATURE",state:["weatherActualTemp"],event:["weatherActualTemp"]},{dpt:"HUMIDITY",state:["weatherHum"],event:["weatherHum"]},{dpt:"ILLUMINATION",state:["weatherIllu"],event:["weatherIllu"]},{dpt:"SUNSHINEDURATION",state:["weatherSunD"],event:["weatherSunD"]},{dpt:"SUNSHINEDURATION_OVERFLOW",state:["weatherSunDOF"],event:["weatherSunDOF"]},
{dpt:"SUNSHINE_THRESHOLD_OVERRUN",state:["weatherSunTOR"],event:["weatherSunTOR"]},{dpt:"WIND_SPEED",state:["weatherWindS"],event:["weatherWindS"]},{dpt:"WIND_THRESHOLD_OVERRUN",state:["weatherWindTOR"],event:["weatherWindTOR"]},{dpt:"WIND_DIR",state:["weatherWindD"],event:["weatherWindD"]},{dpt:"WIND_DIR_RANGE",state:["weatherWindDR"],event:["weatherWindDR"]},{dpt:"RAINING",state:["weatherRain"],event:["weatherRain"]},{dpt:"RAIN_COUNTER",state:["weatherRainC"],event:["weatherRainC"]},{dpt:"RAIN_COUNTER_OVERFLOW",
state:["weatherRainCOF"],event:["weatherRainCOF"]}],getReadableDpts:p,getDptFromState:n,parseDptState:function(h,g){var k=null;switch(h){case "ACTUAL_TEMPERATURE":k={weatherActualTemp:g};break;case "HUMIDITY":k={weatherHum:g};break;case "ILLUMINATION":k={weatherIllu:g};break;case "SUNSHINEDURATION":k={weatherSunD:g};break;case "SUNSHINEDURATION_OVERFLOW":k={weatherSunDOF:g};break;case "SUNSHINE_THRESHOLD_OVERRUN":k={weatherSunTOR:g};break;case "WIND_SPEED":k={weatherWindS:g};break;case "WIND_THRESHOLD_OVERRUN":k=
{weatherWindTOR:g};break;case "RAINING":k={weatherRain:g};break;case "RAIN_COUNTER":k={weatherRainC:g};break;case "RAIN_COUNTER_OVERFLOW":k={weatherRainCOF:g};break;case "WIND_DIR":k={weatherWindD:g};break;case "WIND_DIR_RANGE":k={weatherWindDR:g}}return k}},CLIMATE_TRANSCEIVER:{map:[{dpt:"ACTUAL_TEMPERATURE",state:["temperature"],event:["temperature"]},{dpt:"HUMIDITY",state:["humidity"],event:["humidity"]}],getReadableDpts:p,getDptFromState:n,parseDptState:function(h,g){var k=null;switch(h){case "ACTUAL_TEMPERATURE":k=
{temperature:g};break;case "HUMIDITY":k={humidity:g}}return k}},PASSAGE_DETECTOR_DIRECTION_TRANSMITTER:{map:[{dpt:"CURRENT_PASSAGE_DIRECTION",state:["current_direction"],event:["current_direction"]},{dpt:"LAST_PASSAGE_DIRECTION",state:["last_direction"],event:["last_direction"]},{dpt:"PASSAGE_COUNTER_OVERFLOW",state:["passage_counter_overflow"],event:["passage_counter_overflow"]},{dpt:"PASSAGE_COUNTER_VALUE",state:["passage_counter"],event:["passage_counter"]}],getReadableDpts:p,getDptFromState:n,
parseDptState:function(h,g){var k=null;switch(h){case "CURRENT_PASSAGE_DIRECTION":k={current_direction:g};break;case "LAST_PASSAGE_DIRECTION":k={last_direction:g};break;case "PASSAGE_COUNTER_OVERFLOW":k={passage_counter_overflow:g};break;case "PASSAGE_COUNTER_VALUE":k={passage_counter:g}}return k}},GENERIC_INPUT_TRANSMITER:{map:[{dpt:"CHANGE_OVER",state:["genInputChangeOver"],event:["genInputChangeOver"]},{dpt:"EXTERNAL_CLOCK",state:["genInputExtClock"],event:["genInputExtClock"]},{dpt:"HUMIDITY_LIMITER",
state:["genInputHumidityLimiter"],event:["genInputHumidityLimiter"]},{dpt:"STATE",state:["genInputState"],event:["genInputState"]},{dpt:"TACTILE_SWITCH",state:["genInputTactileSwitch"],event:["genInputTactileSwitch"]},{dpt:"TEMPERATURE_LIMITER",state:["genInputTempLimiter"],event:["genInputTempLimiter"]}],getReadableDpts:p,getDptFromState:n,parseDptState:function(h,g){var k=null;switch(h){case "CHANGE_OVER":k={genInputChangeOver:g};break;case "EXTERNAL_CLOCK":k={genInputExtClock:g};break;case "HUMIDITY_LIMITER":k=
{genInputHumidityLimiter:g};break;case "STATE":k=1==g?{genInputState:"on"}:0==g?{genInputState:"off"}:{genInputState:"?"};break;case "TACTILE_SWITCH":k={genInputTactileSwitch:g};break;case "TEMPERATURE_LIMITER":k={genInputTempLimiter:g}}return k}},ANALOG_OUTPUT_TRANSCEIVER:{map:[{dpt:"LEVEL",state:["outputLevel"],event:["outputLevel"],command:["outputOff","outputUp","outputDown","outputTo","toggleTo"]}],getReadableDpts:p,getDptFromState:n,parseDptState:function(h,g){var k=null;switch(h){case "LEVEL":k=
{outputLevel:Math.round(100*parseFloat(g))}}return k},executeCommand:function(h,g,k,r,m){if(r){if("outputOff"==r.substr(0,9))var v="outputOff";else if("outputUp"==r.substr(0,8)){v="outputUp";var w=r.substr(8)}else if("outputDown"==r.substr(0,10))v="outputDown",w=r.substr(10);else if("outputTo"==r.substr(0,8)){if(v="outputTo",w=r.substr(8),!w){m&&m(Error("outputTo has no value"));return}}else if("toggleTo"==r.substr(0,8)){if(v="toggleTo",w=r.substr(8),!w){m&&m(Error("toggleTo has no value"));return}}else isNaN(parseInt(r))||
(v="outputTo",w=parseInt(r));var z=q.call(this,v);if(z)switch(v){case "outputOff":h.writeValue(g,k,z,{type:"double",value:0},m);break;case "outputUp":w||(w=10);w=parseInt(w)/100;h.getState({interface:g,channel:k,datapoint:z},function(D,E){D?m&&m(D):"undefined"==typeof E||null==E?m&&m(Error("get dimmer current value return invalid")):(w=E.value+w,1<w&&(w=1),h.writeValue(g,k,z,{type:"double",value:w},m))});break;case "outputDown":w||(w=10);w=parseInt(w)/100;h.getState({interface:g,channel:k,datapoint:z},
function(D,E){D?m&&m(D):"undefined"==typeof E||null==E?m&&m(Error("get dimmer current value return invalid")):(w=E.value-w,0>w&&(w=0),h.writeValue(g,k,z,{type:"double",value:w},m))});break;case "toggleTo":w=parseInt(w)/100;h.getState({interface:g,channel:k,datapoint:z},function(D,E){D?m&&m(D):E?(E.value&&(w=0),h.writeValue(g,k,z,{type:"double",value:w},m)):m&&m(Error("get switch current value return invalid"))});break;case "outputTo":w=parseInt(w)/100;h.writeValue(g,k,z,{type:"double",value:w},m);
break;default:m&&m(Error("no such command"))}else m&&m(Error("can not find datapoint for command:"+r))}else m&&m(Error("command in null"))}},WATER_DETECTION_TRANSMITTER:{map:[{dpt:"ALARMSTATE",state:["alarm"],event:["alarm"]},{dpt:"MOISTURE_DETECTED",state:["moisture"],event:["moisture"]},{dpt:"WATERLEVEL_DETECTED",state:["water"],event:["water"]}],getReadableDpts:p,getDptFromState:n,parseDptState:function(h,g){var k=null;switch(h){case "ALARMSTATE":k={alarm:g};break;case "MOISTURE_DETECTED":k={moisture:g};
break;case "WATERLEVEL_DETECTED":k={water:g}}return k}},ACCELERATION_TRANSCEIVER:{map:[{dpt:"MOTION",state:["motion"],event:["motion"]}],getReadableDpts:p,getDptFromState:n,parseDptState:function(h,g){var k=null;switch(h){case "MOTION":k={motion:g}}return k}},DOOR_RECEIVER:{map:[{dpt:"DOOR_STATE",state:["doorState"],event:["doorState"]},{dpt:"DOOR_COMMAND",command:["open","close","partialOpen","stop"]}],getReadableDpts:p,getDptFromState:n,parseDptState:function(h,g){var k=null;switch(h){case "DOOR_STATE":g=
parseInt(g),k=0==g?{doorState:"closed"}:1==g?{doorState:"open"}:2==g?{doorState:"ventilation"}:{doorState:"unknown"}}return k},executeCommand:function(h,g,k,r,m){if(r){var v=q.call(this,r);if(v)switch(r){case "open":h.writeValue(g,k,v,{type:"double",value:1},m);break;case "stop":h.writeValue(g,k,v,{type:"double",value:2},m);break;case "close":h.writeValue(g,k,v,{type:"double",value:3},m);break;case "partialOpen":h.writeValue(g,k,v,{type:"double",value:4},m);break;default:m&&m(Error("no such command"))}else m&&
m(Error("can not find datapoint for command:"+r))}else m&&m(Error("command in null"))}},SIMPLE_SWITCH_RECEIVER:{map:[{dpt:"STATE",state:["state"],event:["state"],command:["on","off","toggle"]}],getReadableDpts:p,getDptFromState:n,parseDptState:function(h,g){var k=null;switch(h){case "STATE":k=1==g?{state:"on"}:0==g?{state:"off"}:{state:"?"}}return k},executeCommand:function(h,g,k,r,m){var v=q.call(this,r);if(v)switch(r){case "on":h.writeValue(g,k,v,!0,m);break;case "off":h.writeValue(g,k,v,!1,m);
break;case "toggle":h.getState({interface:g,channel:k,datapoint:v},function(w,z){w?m&&m(w):z?(w=!0,z.value&&(w=!1),h.writeValue(g,k,v,w,m)):m&&m(Error("get switch current value return invalid"))});break;default:m&&m(Error("no such command"))}else m&&m(Error("can not find datapoint for command:"+r))}},MULTI_MODE_INPUT_TRANSMITTER:{map:[{dpt:"STATE",state:["state"],event:["state"]},{dpt:"PRESS_SHORT",event:["pressShort"]},{dpt:"PRESS_LONG",event:["pressLong"]}],getReadableDpts:p,getDptFromState:n,parseDptState:function(h,
g){var k=null;switch(h){case "STATE":k=1==g?{state:"on"}:0==g?{state:"off"}:{state:"?"};break;case "PRESS_SHORT":k={pressShort:!0};break;case "PRESS_LONG":k={pressLong:!0}}return k}},BRIGHTNESS_TRANSMITTER:{map:[{dpt:"AVERAGE_ILLUMINATION",state:["avgIllu"],event:["avgIllu"]},{dpt:"CURRENT_ILLUMINATION",state:["illu"],event:["illu"]},{dpt:"HIGHEST_ILLUMINATION",state:["maxIllu"],event:["maxIllu"]},{dpt:"LOWEST_ILLUMINATION",state:["minIllu"],event:["minIllu"]}],getReadableDpts:p,getDptFromState:n,
parseDptState:function(h,g){var k=null;switch(h){case "AVERAGE_ILLUMINATION":k={avgIllu:parseFloat(parseFloat(g).toFixed(2))};break;case "CURRENT_ILLUMINATION":k={illu:parseFloat(parseFloat(g).toFixed(2))};break;case "HIGHEST_ILLUMINATION":k={maxIllu:parseFloat(parseFloat(g).toFixed(2))};break;case "LOWEST_ILLUMINATION":k={minIllu:parseFloat(parseFloat(g).toFixed(2))}}return k}},POWER_MAINS_TRANSMITTER:{map:[{dpt:"POWER_MAINS_FAILURE",state:["powerMainsFailure"],event:["powerMainsFailure"]}],getReadableDpts:p,
getDptFromState:n,parseDptState:function(h,g){var k=null;switch(h){case "POWER_MAINS_FAILURE":k={powerMainsFailure:g}}return k}},ANALOG_INPUT_TRANSMITTER:{map:[{dpt:"VOLTAGE",state:["voltage"],event:["voltage"]}],getReadableDpts:p,getDptFromState:n,parseDptState:function(h,g){var k=null;switch(h){case "VOLTAGE":k={voltage:parseFloat(g)}}return k}}},"BidCos-RF":{MAINTENANCE:{device:"maintenance",map:[{dpt:"LOWBAT",state:["lowbat"],event:["lowbat"]},{dpt:"UNREACH",state:["timeout"],event:["timeout"]}],
getReadableDpts:p,getDptFromState:n,parseDptState:function(h,g){switch(h){case "LOWBAT":return{lowbat:g};case "UNREACH":return{timeout:g};default:return null}}},KEY:{device:"button",map:[{dpt:"PRESS_SHORT",event:["pressShort"],command:["pressShort"]},{dpt:"PRESS_LONG",event:["pressLong"],command:["pressLong"]},{dpt:"PRESS_LONG_RELEASE",event:["pressLongRel"]},{dpt:"PRESS_CONT",event:["pressCont"]}],getReadableDpts:p,getDptFromState:n,parseDptState:function(h,g){switch(h){case "PRESS_SHORT":return{pressShort:g};
case "PRESS_LONG":return{pressLong:g};case "PRESS_CONT":return{pressCont:g};case "PRESS_LONG_RELEASE":return{pressLongRel:g};default:return null}},executeCommand:function(h,g,k,r,m){var v=q.call(this,r);switch(r){case "pressShort":h.writeValue(g,k,v,!0,m);break;case "pressLong":h.writeValue(g,k,v,!0,m);break;default:m&&m(Error("no such command"))}}},SWITCH_INTERFACE:{device:"switch_interface",map:[{dpt:"PRESS",event:["press"],command:["press"]}],parseDptState:function(h,g){switch(h){case "PRESS":return{press:!0};
default:return null}},executeCommand:function(h,g,k,r,m){var v=q.call(this,r);switch(r){case "press":h.writeValue(g,k,v,!0,m);break;default:m&&m(Error("no such command"))}}},SHUTTER_CONTACT:{device:"contact",map:[{dpt:"STATE",state:["state"],event:["state"]},{dpt:"ERROR",state:["error"],event:["error"]},{dpt:"LOWBAT",state:["lowbat"],event:["lowbat"]}],getReadableDpts:p,getDptFromState:n,parseDptState:function(h,g){switch(h){case "STATE":return{state:g?"open":"closed"};case "ERROR":return{error:1==
g?"sabotage":"no_error"};case "LOWBAT":return{lowbat:g};default:return null}}},JALOUSIE:{device:"jalousie",map:[{dpt:"LEVEL",state:["jalState"],event:["jalState"],command:["moveUp","moveDown","stepUp","stepDown","%d"]},{dpt:"STOP",command:["stop"]},{dpt:"LEVEL_SLATS",state:["jalLmlState"],event:["jalLmlState"],command:["lamellaUp","lamellaDown","lamellaStepUp","lamellaStepDown","lamellaTo%d"]}],getReadableDpts:p,getDptFromState:n,parseDptState:function(h,g){var k=null;switch(h){case "LEVEL":g=Math.round(100*
parseFloat(g));k={jalState:g};break;case "LEVEL_SLATS":g=Math.round(100*parseFloat(g)),k={jalLmlState:g}}return k},executeCommand:function(h,g,k,r,m){var v=q.call(this,r);switch(r){case "moveUp":h.writeValue(g,k,v,{type:"double",value:1},m);break;case "moveDown":h.writeValue(g,k,v,{type:"double",value:0},m);break;case "stepUp":h.getState({interface:g,channel:k,datapoint:v},function(z,D){if(z)m&&m(z);else if(D){var E=D.value+.05;1<E&&(E=1);h.writeValue(g,k,v,{type:"double",value:E},function(J){J?m&&
m(J):(h.updateStatusBuffer(g,k,v,E,(new Date).getTime()+1E3),m&&m())})}else m&&m(Error("get current jalousie state result invalid"))});break;case "stepDown":h.getState({interface:g,channel:k,datapoint:v},function(z,D){if(z)m&&m(z);else if(D){var E=D.value-.05;0>E&&(E=0);h.writeValue(g,k,v,{type:"double",value:E},function(J){J?m&&m(J):(h.updateStatusBuffer(g,k,v,E,(new Date).getTime()+1E3),m&&m())})}else m&&m(Error("get current blind state result invalid"))});break;case "stop":h.writeValue(g,k,v,!0,
m);break;case "lamellaUp":h.writeValue(g,k,v,{type:"double",value:1},m);break;case "lamellaDown":h.writeValue(g,k,v,{type:"double",value:0},m);break;case "lamellaStepUp":h.getState({interface:g,channel:k,datapoint:v},function(z,D){if(z)m&&m(z);else if(D){var E=D.value+.05;1<E&&(E=1);h.writeValue(g,k,v,{type:"double",value:E},function(J){J?m&&m(J):(h.updateStatusBuffer(g,k,v,E,(new Date).getTime()+1E3),m&&m())})}else m&&m(Error("get current lamella state result invalid"))});break;case "lamellaStepDown":h.getState({interface:g,
channel:k,datapoint:v},function(z,D){if(z)m&&m(z);else if(D){var E=D.value-.05;0>E&&(E=0);h.writeValue(g,k,v,{type:"double",value:E},function(J){J?m&&m(J):(h.updateStatusBuffer(g,k,v,E,(new Date).getTime()+1E3),m&&m())})}else m&&m(Error("get current lamella state result invalid"))});break;default:if("lamellaTo"==r.substr(0,9)){r=r.substr(9);var w=parseInt(r);w/=100;v="LEVEL_SLATS";h.writeValue(g,k,v,{type:"double",value:w},function(z){z?m&&m(z):(h.updateStatusBuffer(g,k,v,w,(new Date).getTime()+1E3),
m&&m())})}else"moveTo"==r.substr(0,6)||r.match(/^[-+]?[0-9]+$/)?("moveTo"==r.substr(0,6)&&(r=r.substr(6)),w=parseInt(r),w/=100,v="LEVEL",h.writeValue(g,k,v,{type:"double",value:w},function(z){z?m&&m(z):(h.updateStatusBuffer(g,k,v,w,(new Date).getTime()+1E3),m&&m())})):m&&m(Error("no such command"))}}},MOD_EM8BIT_TRANSMITTER:{map:[{dpt:"STATE",state:["state8bit"],event:["state8bit"]},{dpt:"LOWBAT",state:["lowbat"],event:["lowbat"]}],getReadableDpts:p,getDptFromState:n,parseDptState:function(h,g){var k=
null;switch(h){case "STATE":g=parseInt(g);k={state8bit:g};break;case "LOWBAT":k={lowbat:g}}return k}},KEYMATIC:{device:"keymatic",map:[{dpt:"STATE",state:["state"],event:["state"],command:["open","close"]},{dpt:"OPEN",command:["openDoor"]},{dpt:"STATE_UNCERTAIN",state:["uncertain"],event:["uncertain"]},{dpt:"ERROR",state:["error"],event:["error"]}],getReadableDpts:p,getDptFromState:n,parseDptState:function(h,g){switch(h){case "STATE":return{state:g?"open":"closed"};case "STATE_UNCERTAIN":return{uncertain:g};
case "ERROR":switch(g){case 0:g="no_error";break;case 1:g="cluth_failure";break;case 2:g="motor_aborted"}return{error:g}}return null},executeCommand:function(h,g,k,r,m){var v=q.call(this,r);switch(r){case "open":h.writeValue(g,k,v,!0,m);break;case "close":h.writeValue(g,k,v,!1,m);break;case "openDoor":h.writeValue(g,k,v,!0,m);break;default:m&&m(Error("no such command"))}}},MOTION_DETECTOR:{device:"motion",map:[{dpt:"BRIGHTNESS",state:["bri"],event:["bri"]},{dpt:"MOTION",state:["state"],event:["state"]},
{dpt:"ERROR",state:["error"],event:["error"]}],getReadableDpts:p,getDptFromState:n,parseDptState:function(h,g){var k={};switch(h){case "BRIGHTNESS":k.bri=g;break;case "MOTION":k.state=g?"motion":"ok";break;case "ERROR":k.error=g?"sabotage":"no_error";break;default:return null}return k}},DUAL_WHITE_BRIGHTNESS:{device:"dualwhite",map:[{dpt:"DIRECTION",state:["direction"],event:["direction"]},{dpt:"ERROR_OVERHEAT",state:["error_overheat"],event:["error_overheat"]},{dpt:"ERROR_REDUCED",state:["error_reduced"],
event:["error_reduced"]},{dpt:"LEVEL",state:["bri"],event:["bri"],command:["off","dimUp","dimDown","toggle","dimTo%d"]},{dpt:"LEVEL_REAL",state:["bri_real"],event:["bri_real"]},{dpt:"OLD_LEVEL",command:["on"]}],getReadableDpts:p,getDptFromState:n,parseDptState:function(h,g){var k={};switch(h){case "DIRECTION":k.direction=g;break;case "ERROR_OVERHEAT":k.error_overheat=g?!0:!1;break;case "ERROR_REDUCED":k.error_reduced=g?!0:!1;break;case "LEVEL":k.bri=Math.round(100*parseFloat(g));break;case "LEVEL_REAL":k.bri_real=
Math.round(100*parseFloat(g));break;default:return null}return k},executeCommand:function(h,g,k,r,m){var v=q.call(this,r);switch(r){case "on":h.writeValue(g,k,v,!0,m);break;case "off":h.writeValue(g,k,v,{type:"double",value:0},m);break;case "dimUp":h.getState({interface:g,channel:k,datapoint:v},function(z,D){if(z)m&&m(z);else if(D){var E=D.value+.05;1<E&&(E=1);h.writeValue(g,k,v,{type:"double",value:E},function(J){J?m&&m(J):(h.updateStatusBuffer(g,k,v,E,(new Date).getTime()+1E3),m&&m())})}else m&&
m(Error("get current jalousie state result invalid"))});break;case "dimDown":h.getState({interface:g,channel:k,datapoint:v},function(z,D){if(z)m&&m(z);else if(D){var E=D.value-.05;0>E&&(E=0);h.writeValue(g,k,v,{type:"double",value:E},function(J){J?m&&m(J):(h.updateStatusBuffer(g,k,v,E,(new Date).getTime()+1E3),m&&m())})}else m&&m(Error("get current blind state result invalid"))});break;case "toggle":v="LEVEL";h.getState({interface:g,channel:k,datapoint:v},function(z,D){z?m&&m(z):D?0!=D.value?h.writeValue(g,
k,v,{type:"double",value:0},m):h.writeValue(g,k,"OLD_LEVEL",!0,m):m&&m(Error("get current dimmer state result invalid"))});break;default:if("dimTo"==r.substr(0,5)){r=r.substr(5);var w=parseInt(r);w/=100;v="LEVEL";h.writeValue(g,k,v,{type:"double",value:w},function(z){z?m&&m(z):(h.updateStatusBuffer(g,k,v,w,(new Date).getTime()+1E3),m&&m())})}else m&&m(Error("no such command"))}}},DUAL_WHITE_COLOR:{device:"dualwhite",map:[{dpt:"DIRECTION",state:["color_direction"],event:["color_direction"]},{dpt:"LEVEL",
state:["color"],event:["color"],command:["colorOff","colorUp","colorDown","colorToggle","colorTo%d"]},{dpt:"LEVEL_REAL",state:["color_real"],event:["color_real"]},{dpt:"OLD_LEVEL",command:["colorOn"]}],getReadableDpts:p,getDptFromState:n,parseDptState:function(h,g){var k={};switch(h){case "DIRECTION":k.direction=g;break;case "LEVEL":k.color=Math.round(100*parseFloat(g));break;case "LEVEL_REAL":k.color_real=Math.round(100*parseFloat(g));break;default:return null}return k},executeCommand:function(h,
g,k,r,m){var v=q.call(this,r);switch(r){case "colorOn":h.writeValue(g,k,v,!0,m);break;case "colorOff":h.writeValue(g,k,v,{type:"double",value:0},m);break;case "colorUp":h.getState({interface:g,channel:k,datapoint:v},function(z,D){if(z)m&&m(z);else if(D){var E=D.value+.05;1<E&&(E=1);h.writeValue(g,k,v,{type:"double",value:E},function(J){J?m&&m(J):(h.updateStatusBuffer(g,k,v,E,(new Date).getTime()+1E3),m&&m())})}else m&&m(Error("get current jalousie state result invalid"))});break;case "colorDown":h.getState({interface:g,
channel:k,datapoint:v},function(z,D){if(z)m&&m(z);else if(D){var E=D.value-.05;0>E&&(E=0);h.writeValue(g,k,v,{type:"double",value:E},function(J){J?m&&m(J):(h.updateStatusBuffer(g,k,v,E,(new Date).getTime()+1E3),m&&m())})}else m&&m(Error("get current blind state result invalid"))});break;case "colorToggle":v="LEVEL";h.getState({interface:g,channel:k,datapoint:v},function(z,D){z?m&&m(z):D?0!=D.value?h.writeValue(g,k,v,{type:"double",value:0},m):h.writeValue(g,k,"OLD_LEVEL",!0,m):m&&m(Error("get current dimmer state result invalid"))});
break;default:if("colorTo"==r.substr(0,7)){r=r.substr(7);var w=parseInt(r);w/=100;v="LEVEL";h.writeValue(g,k,v,{type:"double",value:w},function(z){z?m&&m(z):(h.updateStatusBuffer(g,k,v,w,(new Date).getTime()+1E3),m&&m())})}else m&&m(Error("no such command"))}}}}}}();
x.hub.m.hm._Device=function(){var p=function(e,c,a){this.deviceType=e;this.deviceIF=c;this.deviceAdr=a;this.legacyType=null};p.prototype.initStates=function(e,c){var a=this._getReadableDpts();this._initDptStates(e,a,c)};p.prototype._getReadableDpts=function(){return[]};p.prototype._getDptFromRef=function(e){return null};p.prototype._initDptStates=function(e,c,a){if(c&&0!=c.length){var b=0,f=this,l=function(t,u){b++;b==c.length?a&&a():e.readValue(f.deviceIF,c[b].channel,c[b].dpt,l)};e.readValue(this.deviceIF,
c[b].channel,c[b].dpt,l)}else a&&a()};p.prototype.parseDptState=function(e,c,a){return null};p.prototype.toLegacyAdr=function(){return this.deviceType+"."+this.deviceIF+"."+this.deviceAdr};p.prototype.toLegacyType=function(){return this.legacyType};p.prototype.getSerial=function(){var e=this.deviceAdr,c=this.deviceAdr.indexOf(":");-1!=c&&(e=e.substr(0,c));return e};p.prototype.parseChnState=function(e,c){var a={},b;for(b in c){var f=this.parseDptState(e,b,c[b].value);if(f){var l={},t=c[b].time,u;
for(u in f)l[u]={value:f[u],time:t};a=x.hub.m.hm._Util.mergeObj(a,l)}}return a};p.prototype.parseStates=function(e){var c={},a;for(a in e){var b=this.parseChnState(a,e[a]);b&&(c=x.hub.m.hm._Util.mergeObj(c,b))}return c};p.prototype.executeCommand=function(e,c,a){a&&a()};p.prototype.getState=function(e,c,a){switch(c){case "timeout":var b={channel:this.deviceAdr+":0",dataPoint:"UNREACH"};break;default:b=this._getDptFromRef(c)}if(b){var f=this;e.getState({interface:this.deviceIF,channel:b.channel,datapoint:b.dataPoint},
function(l,t){l?a&&a(l):t?(l=f.parseDptState(b.channel,b.dataPoint,t.value))?a&&a(null,{value:l[c],time:t.time}):a&&a(null,null):a&&a(null,null)})}else a&&a(Error("no such state"))};p.prototype.isButton=function(){return!1};var n=function(e,c,a){p.call(this,e,c,a);this.channel=0;this.legacyType="maintenance"};util.inherits(n,p);n.prototype._getReadableDpts=function(){var e=[],c=this,a=x.hub.m.hm._Channel["BidCos-RF"].MAINTENANCE.getReadableDpts();a&&a.forEach(function(b){e.push({channel:c.deviceAdr+
":0",dpt:b})});return e};n.prototype._getDptFromRef=function(e){var c={channel:this.deviceAdr+":"+this.channel,dataPoint:null};switch(e){case "lowbat":c.channel=0;c.dataPoint="LOWBAT";break;case "timeout":c.channel=0;c.dataPoint="UNREACH";break;default:return null}return c};n.prototype.parseDptState=function(e,c,a){var b=e.indexOf(":");if(-1==b)return null;var f=e.substr(0,b);e=e.substr(b+1);var l=this.deviceAdr;b=this.deviceAdr.indexOf(":");-1!=b&&(l=this.deviceAdr.substr(0,b));if(f!=l||e!=this.channel)return null;
b={};"UNREACH"==c?b.timeout=a:"LOWBAT"==c?b.lowbat=a:b["0_"+c.toLowerCase()]=a;return b};var q=function(e,c,a){p.call(this,e,c,a);this.channel=1;this.legacyType="button"};util.inherits(q,p);q.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":0",dpt:"LOWBAT"},{channel:this.deviceAdr+":0",dpt:"UNREACH"}]};q.prototype._getDptFromRef=function(e){var c=this.deviceAdr;-1==c.indexOf(":")&&this.channel&&(c+=":"+this.channel);c={channel:c,dataPoint:null};switch(e){case "lowbat":c.channel=
0;c.dataPoint="LOWBAT";break;case "timeout":c.channel=0;c.dataPoint="UNREACH";break;default:return null}return c};q.prototype.parseDptState=function(e,c,a){var b=e.indexOf(":");if(-1==b)return null;var f=e.substr(0,b);e=e.substr(b+1);var l=this.deviceAdr;b=this.deviceAdr.indexOf(":");-1!=b&&(l=this.deviceAdr.substr(0,b));if(f!=l||0!=e&&e!=this.channel)return null;if(0==e)return b={},"UNREACH"==c?b.timeout=a:"LOWBAT"==c?b.lowbat=a:b["0_"+c.toLowerCase()]=a,b;switch(c){case "PRESS_SHORT":return{pressShort:a};
case "PRESS_LONG":return{pressLong:a};case "PRESS_CONT":return{pressCont:a};case "PRESS_LONG_RELEASE":return{pressLongRel:a};default:return null}};q.prototype.isButton=function(){return!0};q.prototype.claimEvent=function(e,c){var a=this.deviceAdr;-1==a.indexOf(":")&&this.channel&&(a+=":"+this.channel);var b=this;e.reportValueUsage(this.deviceIF,a,"PRESS_SHORT",function(f,l){f&&console.error("button claim PRESS_SHORT event error:"+f.stack);e.reportValueUsage(b.deviceIF,a,"PRESS_LONG",function(t,u){t&&
console.error("button claim PRESS_LONG event error:"+t.stack);c&&c()})})};var h=function(e,c,a){p.call(this,e,c,a);this.channel=1;this.legacyType="button"};util.inherits(h,p);h.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":0",dpt:"LOWBAT"},{channel:this.deviceAdr+":0",dpt:"UNREACH"}]};h.prototype._getDptFromRef=function(e){var c=this.deviceAdr;-1==c.indexOf(":")&&this.channel&&(c+=":"+this.channel);c={channel:c,dataPoint:null};switch(e){case "lowbat":c.channel=0;c.dataPoint=
"LOWBAT";break;case "timeout":c.channel=0;c.dataPoint="UNREACH";break;default:return null}return c};h.prototype.parseDptState=function(e,c,a){var b=e.indexOf(":");if(-1==b)return null;var f=e.substr(0,b);e=e.substr(b+1);var l=this.deviceAdr;b=this.deviceAdr.indexOf(":");-1!=b&&(l=this.deviceAdr.substr(0,b));if(f!=l||0!=e&&e!=this.channel)return null;if(0==e)return b={},"UNREACH"==c?b.timeout=a:"LOWBAT"==c?b.lowbat=a:b["0_"+c.toLowerCase()]=a,b;switch(c){case "PRESS_SHORT":return{pressShort:a};case "PRESS_LONG":return{pressLong:a};
case "PRESS_CONT":return{pressCont:a};case "PRESS_LONG_RELEASE":return{pressLongRel:a};default:return null}};h.prototype.isButton=function(){return!1};h.prototype.claimEvent=function(e,c){var a=this.deviceAdr;-1==a.indexOf(":")&&this.channel&&(a+=":"+this.channel);var b=this;e.reportValueUsage(this.deviceIF,a,"PRESS_SHORT",function(f,l){f&&console.error("button claim PRESS_SHORT event error:"+f.stack);e.reportValueUsage(b.deviceIF,a,"PRESS_LONG",function(t,u){t&&console.error("button claim PRESS_LONG event error:"+
t.stack);c&&c()})})};var g=function(e,c,a){p.call(this,e,c,a);this.channel=1;this.legacyType="switch"};util.inherits(g,p);g.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":0",dpt:"LOWBAT"},{channel:this.deviceAdr+":0",dpt:"UNREACH"},{channel:this.deviceAdr+":"+this.channel,dpt:"STATE"},{channel:this.deviceAdr+":"+this.channel,dpt:"INHIBIT"},{channel:this.deviceAdr+":"+this.channel,dpt:"WORKING"}]};g.prototype._getDptFromRef=function(e){var c=this.deviceAdr;-1==c.indexOf(":")&&
this.channel&&(c+=":"+this.channel);c={channel:c,dataPoint:null};switch(e){case "lowbat":c.channel=0;c.dataPoint="LOWBAT";break;case "timeout":c.channel=0;c.dataPoint="UNREACH";break;case "state":c.dataPoint="STATE";break;case "inhibit":c.dataPoint="INHIBIT";break;case "working":c.dataPoint="WORKING";break;default:return null}return c};g.prototype.executeCommand=function(e,c,a){var b=this.deviceAdr;-1==b.indexOf(":")&&this.channel&&(b+=":"+this.channel);var f=this;switch(c){case "on":var l="STATE";
e.writeValue(this.deviceIF,b,l,!0,a);break;case "off":l="STATE";e.writeValue(this.deviceIF,b,l,!1,a);break;case "toggle":l="STATE";e.getState({interface:this.deviceIF,channel:b,datapoint:l},function(t,u){t?a&&a(t):u?(t=!0,u.value&&(t=!1),e.writeValue(f.deviceIF,b,l,t,a)):a&&a(Error("get switch current value return invalid"))});break;default:"onFor"==c.substr(0,5)?(c=parseFloat(c.substr(5)),isNaN(c)?a&&a(Error("onFor command invalid")):(l="ON_TIME",e.writeValue(this.deviceIF,b,l,{type:"double",value:c},
function(t){t?a&&a(t):(l="STATE",e.writeValue(f.deviceIF,b,l,!0,a))}))):a&&a(Error("no such command"))}};g.prototype.parseDptState=function(e,c,a){var b=e.indexOf(":");if(-1==b)return null;var f=e.substr(0,b);e=e.substr(b+1);var l=this.deviceAdr;b=this.deviceAdr.indexOf(":");-1!=b&&(l=this.deviceAdr.substr(0,b));if(f!=l||0!=e&&e!=this.channel)return null;if(0==e)return b={},"UNREACH"==c?b.timeout=a:"LOWBAT"==c?b.lowbat=a:b["0_"+c.toLowerCase()]=a,b;var t;switch(c){case "STATE":return 1==a?t="on":
0==a&&(t="off"),{state:t};case "INHIBIT":return{inhibit:a};case "WORKING":return{working:a};default:return null}};g.prototype.getConfig=function(e,c){var a=this.deviceAdr+":"+this.channel;e.getParamset(this.deviceIF,a,"MASTER",function(b,f){if(b)c&&c(b);else{var l={},t=null;f&&(t={AES_ACTIVE:f.AES_ACTIVE});l[a]=t;c&&c(b,l)}})};g.prototype.setConfig=function(e,c,a){if(c){var b=this.deviceAdr+":"+this.channel;if(c=c[b]){var f={};f.AES_ACTIVE=c.AES_ACTIVE;e.setParamset(this.deviceIF,b,"MASTER",f,function(l){a&&
a(l)})}else a&&a(Error("config data not complete"))}else a&&a(Error("config data invalid"))};var k=function(e,c,a){p.call(this,e,c,a);this.channel=1;this.legacyType="dimmer"};util.inherits(k,p);k.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":0",dpt:"UNREACH"},{channel:this.deviceAdr+":"+this.channel,dpt:"LEVEL"}]};k.prototype._getDptFromRef=function(e){var c=this.deviceAdr;-1==c.indexOf(":")&&this.channel&&(c+=":"+this.channel);c={channel:c,dataPoint:null};switch(e){case "timeout":c.channel=
0;c.dataPoint="UNREACH";break;case "state":c.dataPoint="LEVEL";break;case "levelReal":c.dataPoint="LEVEL_REAL";break;case "inhibit":c.dataPoint="INHIBIT";break;case "working":c.dataPoint="WORKING";break;case "direction":c.dataPoint="DIRECTION";break;default:return null}return c};k.prototype.executeCommand=function(e,c,a){var b=this.deviceAdr+":"+this.channel,f=this,l=null;switch(c){case "on":var t="OLD_LEVEL";e.writeValue(this.deviceIF,b,t,!0,a);break;case "off":t="LEVEL";e.writeValue(this.deviceIF,
b,t,{type:"double",value:0},a);break;case "dimUp":t="LEVEL";e.getState({interface:this.deviceIF,channel:b,datapoint:t},function(u,y){u?a&&a(u):y?(u=y.value+.05,1<u&&(u=1),e.writeValue(f.deviceIF,b,t,{type:"double",value:u},a)):a&&a(Error("get current dimmer state result invalid"))});break;case "dimDown":t="LEVEL";e.getState({interface:this.deviceIF,channel:b,datapoint:t},function(u,y){u?a&&a(u):y?(u=y.value-.05,0>u&&(u=0),e.writeValue(f.deviceIF,b,t,{type:"double",value:u},a)):a&&a(Error("get current dimmer state result invalid"))});
break;case "toggle":t="LEVEL";e.getState({interface:this.deviceIF,channel:b,datapoint:t},function(u,y){u?a&&a(u):y?0!=y.value?e.writeValue(f.deviceIF,b,t,{type:"double",value:0},a):e.writeValue(f.deviceIF,b,"OLD_LEVEL",!0,a):a&&a(Error("get current dimmer state result invalid"))});break;default:"toggleTo"==c.substr(0,8)?(l=parseInt(c.substr(8)),isNaN(l)?a&&a(Error("toggleTo command invalid")):(t="LEVEL",l/=100,e.getState({interface:this.deviceIF,channel:b,datapoint:t},function(u,y){u?a&&a(u):y?(u=
l,y.value&&(u=0),e.writeValue(f.deviceIF,b,t,{type:"double",value:u},a)):a&&a(Error("get current dimmer state result invalid"))}))):"onTo"==c.substr(0,4)||c.match(/^[-+]?[0-9]+$/)?("onTo"==c.substr(0,4)&&(c=c.substr(4)),l=parseInt(c),l/=100,t="LEVEL",e.writeValue(this.deviceIF,b,t,{type:"double",value:l},a)):a&&a(Error("no such command"))}};k.prototype.parseDptState=function(e,c,a){var b=e.indexOf(":");if(-1==b)return null;var f=e.substr(0,b);e=e.substr(b+1);var l=this.deviceAdr;b=this.deviceAdr.indexOf(":");
-1!=b&&(l=this.deviceAdr.substr(0,b));if(f!=l||0!=e&&e!=this.channel)return null;if(0==e)return b={},"UNREACH"==c?b.timeout=a:b["0_"+c.toLowerCase()]=a,b;switch(c){case "LEVEL":return c=Math.round(100*parseFloat(a)),{state:c};case "LEVEL_REAL":return c=Math.round(100*parseFloat(a)),{levelReal:c};case "INHIBIT":return{inhibit:a};case "WORKING":return{working:a};case "DIRECTION":return{direction:a};default:return null}};var r=function(e,c,a){p.call(this,e,c,a);this.channel=1;this.legacyType="blind"};
util.inherits(r,p);r.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":0",dpt:"UNREACH"},{channel:this.deviceAdr+":"+this.channel,dpt:"LEVEL"},{channel:this.deviceAdr+":"+this.channel,dpt:"INHIBIT"},{channel:this.deviceAdr+":"+this.channel,dpt:"WORKING"},{channel:this.deviceAdr+":"+this.channel,dpt:"DIRECTION"}]};r.prototype._getDptFromRef=function(e){var c=this.deviceAdr;-1==c.indexOf(":")&&this.channel&&(c+=":"+this.channel);c={channel:c,dataPoint:null};switch(e){case "timeout":c.channel=
0;c.dataPoint="UNREACH";break;case "state":c.dataPoint="LEVEL";break;case "inhibit":c.dataPoint="INHIBIT";break;case "working":c.dataPoint="WORKING";break;case "direction":c.dataPoint="DIRECTION";break;default:return null}return c};r.prototype.executeCommand=function(e,c,a){var b=this.deviceAdr+":"+this.channel,f=this,l=0;"stepUpFor"==c.substr(0,9)?((l=c.substr(9))||(l=1),l=parseFloat(l),c="stepUpFor"):"stepUp"==c.substr(0,6)?((l=c.substr(6))||(l=5),l=parseInt(l)/100,c="stepUp"):"stepDownFor"==c.substr(0,
11)?((l=c.substr(11))||(l=1),l=parseFloat(l),c="stepDownFor"):"stepDown"==c.substr(0,8)&&((l=c.substr(8))||(l=5),l=parseInt(l)/100,c="stepDown");switch(c){case "stepUp":var t="LEVEL";e.getState({interface:this.deviceIF,channel:b,datapoint:t},function(y,A){if(y)a&&a(y);else if(A){l||(l=.05);var B=A.value+l;1<B&&(B=1);e.writeValue(f.deviceIF,b,t,{type:"double",value:B},function(C){C?a&&a(C):(e.updateStatusBuffer(f.deviceIF,b,t,B,(new Date).getTime()+1E3),a&&a())})}else a&&a(Error("get current blind state result invalid"))});
break;case "stepDown":t="LEVEL";e.getState({interface:this.deviceIF,channel:b,datapoint:t},function(y,A){if(y)a&&a(y);else if(A){l||(l=.05);var B=A.value-l;0>B&&(B=0);e.writeValue(f.deviceIF,b,t,{type:"double",value:B},function(C){C?a&&a(C):(e.updateStatusBuffer(f.deviceIF,b,t,B,(new Date).getTime()+1E3),a&&a())})}else a&&a(Error("get current blind state result invalid"))});break;case "stepUpFor":t="LEVEL";e.writeValue(this.deviceIF,b,t,{type:"double",value:1},function(y){y?a&&a(y):setTimeout(function(){t=
"STOP";e.writeValue(f.deviceIF,b,t,!0,a)},1E3*l)});break;case "stepDownFor":t="LEVEL";e.writeValue(this.deviceIF,b,t,{type:"double",value:0},function(y){y?a&&a(y):setTimeout(function(){t="STOP";e.writeValue(f.deviceIF,b,t,!0,a)},1E3*l)});break;case "up":t="LEVEL";e.writeValue(this.deviceIF,b,t,{type:"double",value:1},a);break;case "down":t="LEVEL";e.writeValue(this.deviceIF,b,t,{type:"double",value:0},a);break;case "stop":t="STOP";e.writeValue(this.deviceIF,b,t,!0,a);break;default:if("moveTo"==c.substr(0,
6)||c.match(/^[-+]?[0-9]+$/)){"moveTo"==c.substr(0,6)&&(c=c.substr(6));var u=parseInt(c);u/=100;t="LEVEL";e.writeValue(this.deviceIF,b,t,{type:"double",value:u},function(y){y?a&&a(y):(e.updateStatusBuffer(f.deviceIF,b,t,u,(new Date).getTime()+1E3),a&&a())})}else a&&a(Error("no such command"))}};r.prototype.parseDptState=function(e,c,a){var b=e.indexOf(":");if(-1==b)return null;var f=e.substr(0,b);e=e.substr(b+1);var l=this.deviceAdr;b=this.deviceAdr.indexOf(":");-1!=b&&(l=this.deviceAdr.substr(0,
b));if(f!=l||0!=e&&e!=this.channel)return null;if(0==e)return b={},"UNREACH"==c?b.timeout=a:b["0_"+c.toLowerCase()]=a,b;switch(c){case "LEVEL":return c=Math.round(100*parseFloat(a)),{state:c};case "INHIBIT":return{inhibit:a};case "WORKING":return{working:a};case "DIRECTION":return{direction:a};default:return null}};r.prototype.getConfig=function(e,c){var a=this.deviceAdr+":"+this.channel;e.getParamset(this.deviceIF,a,"MASTER",function(b,f){if(b)c&&c(b);else{var l={},t=null;f&&(t={CHANGE_OVER_DELAY:f.CHANGE_OVER_DELAY,
REFERENCE_RUNNING_TIME_BOTTOM_TOP:f.REFERENCE_RUNNING_TIME_BOTTOM_TOP,REFERENCE_RUNNING_TIME_TOP_BOTTOM:f.REFERENCE_RUNNING_TIME_TOP_BOTTOM,REFERENCE_RUN_COUNTER:f.REFERENCE_RUN_COUNTER});l[a]=t;c&&c(b,l)}})};r.prototype.setConfig=function(e,c,a){if(c){var b=this.deviceAdr+":"+this.channel;if(c=c[b]){var f={};f.CHANGE_OVER_DELAY={__rpcValueType:"double",__rpcValue:c.CHANGE_OVER_DELAY};f.REFERENCE_RUNNING_TIME_BOTTOM_TOP={__rpcValueType:"double",__rpcValue:c.REFERENCE_RUNNING_TIME_BOTTOM_TOP};f.REFERENCE_RUNNING_TIME_TOP_BOTTOM=
{__rpcValueType:"double",__rpcValue:c.REFERENCE_RUNNING_TIME_TOP_BOTTOM};f.REFERENCE_RUN_COUNTER=c.REFERENCE_RUN_COUNTER;e.setParamset(this.deviceIF,b,"MASTER",f,function(l){a&&a(l)})}else a&&a(Error("config data not complete"))}else a&&a(Error("config data invalid"))};var m=function(e,c,a){g.call(this,e,c,a);this.legacyType="powerswitch";this.powChannel=2};util.inherits(m,g);m.prototype._getReadableDpts=function(){var e=g.prototype._getReadableDpts.call(this);e.push({channel:this.deviceAdr+":"+this.powChannel,
dpt:"BOOT"});e.push({channel:this.deviceAdr+":"+this.powChannel,dpt:"ENERGY_COUNTER"});e.push({channel:this.deviceAdr+":"+this.powChannel,dpt:"POWER"});e.push({channel:this.deviceAdr+":"+this.powChannel,dpt:"CURRENT"});e.push({channel:this.deviceAdr+":"+this.powChannel,dpt:"VOLTAGE"});e.push({channel:this.deviceAdr+":"+this.powChannel,dpt:"FREQUENCY"});return e};m.prototype._getDptFromRef=function(e){var c={channel:this.deviceAdr,dataPoint:null};switch(e){case "timeout":c.channel=0;c.dataPoint="UNREACH";
break;case "state":c.channel+=":1";c.dataPoint="STATE";break;case "inhibit":c.channel+=":1";c.dataPoint="INHIBIT";break;case "working":c.channel+=":1";c.dataPoint="WORKING";break;case "boot":c.channel+=":2";c.dataPoint="BOOT";break;case "energy_counter":c.channel+=":2";c.dataPoint="ENERGY_COUNTER";break;case "power":c.channel+=":2";c.dataPoint="POWER";break;case "current":c.channel+=":2";c.dataPoint="CURRENT";break;case "voltage":c.channel+=":2";c.dataPoint="VOLTAGE";break;case "frequency":c.channel+=
":2";c.dataPoint="FREQUENCY";break;default:return null}return c};m.prototype.parseDptState=function(e,c,a){var b=e.indexOf(":");if(-1==b)return null;var f=e.substr(0,b);b=e.substr(b+1);return f!=this.deviceAdr?null:0==b?(e={},"UNREACH"==c?e.timeout=a:e["0_"+c.toLowerCase()]=a,e):"1"==b?g.prototype.parseDptState.call(this,e,c,a):"2"==b?(e={},e[c.toLowerCase()]=a,e):null};m.prototype.getConfig=function(e,c){var a=this,b=null;g.prototype.getConfig.call(this,e,function(f,l){f?c&&c(f):(b=l,a._getCh2Config(e,
function(t,u){if(t)c&&c(t);else{for(var y in u)u.hasOwnProperty(y)&&(b[y]=u[y]);c&&c(null,b)}}))})};m.prototype.setConfig=function(e,c,a){if(c){var b=Object.keys(c);if(b&&0!=b.length){var f=this;async.eachSeries(b,function(l,t){var u=l.indexOf(":");-1==u&&t(Error("channel address is null"));u=l.substr(u+1);1==u?g.prototype.setConfig.call(f,e,c,t):2==u?f._setCh2Config(e,c[l],t):t(Error("unknow channel:"+u))},function(l){a&&a(l)})}else a&&a(Error("config data not complete"))}else a&&a(Error("config data invalid"))};
m.prototype._getCh2Config=function(e,c){var a=this.deviceAdr+":2";e.getParamset(this.deviceIF,a,"MASTER",function(b,f){if(b)c&&c(b);else{var l={},t=null;f&&(t={AES_ACTIVE:f.AES_ACTIVE});l[a]=t;c&&c(b,l)}})};m.prototype._setCh2Config=function(e,c,a){if(c){var b=this.deviceAdr+":2",f={};f.AES_ACTIVE=c.AES_ACTIVE;e.setParamset(this.deviceIF,b,"MASTER",f,function(l){a&&a(l)})}else a&&a(Error("config data invalid"))};var v=function(e,c,a){p.call(this,e,c,a);this.channel=1;this.legacyType="weather"};util.inherits(v,
p);v.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":0",dpt:"LOWBAT"},{channel:this.deviceAdr+":0",dpt:"UNREACH"},{channel:this.deviceAdr+":"+this.channel,dpt:"TEMPERATURE"},{channel:this.deviceAdr+":"+this.channel,dpt:"HUMIDITY"}]};v.prototype._getDptFromRef=function(e){var c={channel:this.deviceAdr+":"+this.channel,dataPoint:null};switch(e){case "lowbat":c.channel=0;c.dataPoint="LOWBAT";break;case "timeout":c.channel=0;c.dataPoint="UNREACH";break;case "temp":c.dataPoint="TEMPERATURE";
break;case "hum":c.dataPoint="HUMIDITY";break;default:return null}return c};v.prototype.parseDptState=function(e,c,a){var b=e.indexOf(":");if(-1==b)return null;var f=e.substr(0,b);e=e.substr(b+1);var l=this.deviceAdr;b=this.deviceAdr.indexOf(":");-1!=b&&(l=this.deviceAdr.substr(0,b));if(f!=l||0!=e&&e!=this.channel)return null;if(0==e)return b={},"UNREACH"==c?b.timeout=a:"LOWBAT"==c?b.lowbat=a:b["0_"+c.toLowerCase()]=a,b;switch(c){case "TEMPERATURE":return c=parseFloat(a),{temp:c};case "HUMIDITY":return c=
parseInt(a),{hum:c};default:return null}};var w=function(e,c,a){p.call(this,e,c,a);this.channel=1;this.legacyType="weather2"};util.inherits(w,v);w.prototype._getReadableDpts=function(){var e=v.prototype._getReadableDpts.call(this);e.push({channel:this.deviceAdr+":"+this.channel,dpt:"AIR_PRESSURE"});return e};w.prototype._getDptFromRef=function(e){var c={channel:this.deviceAdr+":"+this.channel,dataPoint:null};switch(e){case "air":c.dataPoint="AIR_PRESSURE";break;default:return v.prototype._getDptFromRef.call(this,
e)}return c};w.prototype.parseDptState=function(e,c,a){var b=e.indexOf(":");if(-1==b)return null;var f=e.substr(0,b),l=e.substr(b+1),t=this.deviceAdr;b=this.deviceAdr.indexOf(":");-1!=b&&(t=this.deviceAdr.substr(0,b));if(f!=t||0!=l&&l!=this.channel)return null;if(0==l)return e={},"UNREACH"==c?e.timeout=a:"LOWBAT"==c?e.lowbat=a:e["0_"+c.toLowerCase()]=a,e;e=v.prototype.parseDptState.call(this,e,c,a);switch(c){case "AIR_PRESSURE":e||(e={}),e.air=parseInt(a)}return e};var z=function(e,c,a){p.call(this,
e,c,a);this.channel=1;this.legacyType="weatherstation"};util.inherits(z,p);z.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":0",dpt:"LOWBAT"},{channel:this.deviceAdr+":0",dpt:"UNREACH"},{channel:this.deviceAdr+":"+this.channel,dpt:"TEMPERATURE"},{channel:this.deviceAdr+":"+this.channel,dpt:"HUMIDITY"},{channel:this.deviceAdr+":"+this.channel,dpt:"RAINING"},{channel:this.deviceAdr+":"+this.channel,dpt:"RAIN_COUNTER"},{channel:this.deviceAdr+":"+this.channel,dpt:"WIND_SPEED"},
{channel:this.deviceAdr+":"+this.channel,dpt:"WIND_DIRECTION"},{channel:this.deviceAdr+":"+this.channel,dpt:"WIND_DIRECTION_RANGE"},{channel:this.deviceAdr+":"+this.channel,dpt:"SUNSHINEDURATION"},{channel:this.deviceAdr+":"+this.channel,dpt:"BRIGHTNESS"}]};z.prototype._getDptFromRef=function(e){var c={channel:this.deviceAdr+":"+this.channel,dataPoint:null};switch(e){case "lowbat":c.channel=0;c.dataPoint="LOWBAT";break;case "timeout":c.channel=0;c.dataPoint="UNREACH";break;case "temp":c.dataPoint=
"TEMPERATURE";break;case "hum":c.dataPoint="HUMIDITY";break;case "rain":c.dataPoint="RAINING";break;case "rainC":c.dataPoint="RAIN_COUNTER";break;case "windS":c.dataPoint="WIND_SPEED";break;case "windD":c.dataPoint="WIND_DIRECTION";break;case "windDR":c.dataPoint="WIND_DIRECTION_RANGE";break;case "sunD":c.dataPoint="SUNSHINEDURATION";break;case "bri":c.dataPoint="BRIGHTNESS";break;default:return null}return c};z.prototype.parseDptState=function(e,c,a){var b=e.indexOf(":");if(-1==b)return null;var f=
e.substr(0,b);e=e.substr(b+1);var l=this.deviceAdr;b=this.deviceAdr.indexOf(":");-1!=b&&(l=this.deviceAdr.substr(0,b));if(f!=l||0!=e&&e!=this.channel)return null;b={};if(0==e)return"UNREACH"==c?b.timeout=a:"LOWBAT"==c?b.lowbat=a:b["0_"+c.toLowerCase()]=a,b;switch(c){case "TEMPERATURE":b.temp=parseFloat(a);break;case "HUMIDITY":b.hum=parseInt(a);break;case "RAINING":b.rain=a;break;case "RAIN_COUNTER":b.rainC=parseFloat(a);break;case "WIND_SPEED":b.windS=parseFloat(a);break;case "WIND_DIRECTION":b.windD=
a;break;case "WIND_DIRECTION_RANGE":b.windDR=a;break;case "SUNSHINEDURATION":b.sunD=a;break;case "BRIGHTNESS":b.bri=a;break;default:return null}return b};var D=function(e,c,a){p.call(this,e,c,a);this.channel=1;this.legacyType="heater"};util.inherits(D,p);D.prototype._getReadableDpts=function(){var e=[];e.push({channel:this.deviceAdr+":0",dpt:"UNREACH"});e.push({channel:this.deviceAdr+":"+this.channel,dpt:"VALVE_STATE"});e.push({channel:this.deviceAdr+":"+this.channel,dpt:"ERROR"});return e};D.prototype._getDptFromRef=
function(e){var c={channel:this.deviceAdr+":"+this.channel,dataPoint:null};switch(e){case "timeout":c.channel=0;c.dataPoint="UNREACH";break;case "error":c.dataPoint="ERROR";break;case "state":c.dataPoint="VALVE_STATE";break;default:return null}return c};D.prototype.parseDptState=function(e,c,a){var b=e.indexOf(":");if(-1==b)return null;var f=e.substr(0,b);e=e.substr(b+1);var l=this.deviceAdr;b=this.deviceAdr.indexOf(":");-1!=b&&(l=this.deviceAdr.substr(0,b));if(f!=l)return null;b={};if(0==e)return"UNREACH"==
c?b.timeout=a:b["0_"+c.toLowerCase()]=a,b;if(e==this.channel){switch(c){case "ERROR":switch(a){case 0:b.error="no_error";break;case 1:b.error="VALVE_DRIVE_BLOCKED";break;case 2:b.error="VALVE_DRIVE_LOOSE";break;case 3:b.error="ADJUSTING_RANGE_TO_SMALL";break;case 4:b.error="lowbat"}break;case "VALVE_STATE":b.state=a}return b}return null};var E=function(e,c,a){p.call(this,e,c,a);this.channel=4;this.legacyType="thermostat"};util.inherits(E,p);E.prototype._getReadableDpts=function(){var e=[];e.push({channel:this.deviceAdr+
":"+this.channel,dpt:"CONTROL_MODE"});e.push({channel:this.deviceAdr+":"+this.channel,dpt:"FAULT_REPORTING"});e.push({channel:this.deviceAdr+":"+this.channel,dpt:"BATTERY_STATE"});e.push({channel:this.deviceAdr+":"+this.channel,dpt:"BOOST_STATE"});e.push({channel:this.deviceAdr+":"+this.channel,dpt:"ACTUAL_TEMPERATURE"});e.push({channel:this.deviceAdr+":"+this.channel,dpt:"SET_TEMPERATURE"});return e};E.prototype._getDptFromRef=function(e){var c={channel:this.deviceAdr+":"+this.channel,dataPoint:null};
switch(e){case "mode":c.dataPoint="CONTROL_MODE";break;case "error":c.dataPoint="FAULT_REPORTING";break;case "batLvl":c.dataPoint="BATTERY_STATE";break;case "valveLvl":c.dataPoint="VALVE_STATE";break;case "boostTime":c.dataPoint="BOOST_STATE";break;case "act_temp":c.dataPoint="ACTUAL_TEMPERATURE";break;case "state":c.dataPoint="SET_TEMPERATURE";break;default:return null}return c};E.prototype.executeCommand=function(e,c,a){var b=this.deviceAdr+":"+this.channel,f=this;switch(c){case "setAuto":var l=
"AUTO_MODE";e.writeValue(this.deviceIF,b,l,!0,function(t){t||e.updateStatusBuffer(f.deviceIF,b,"CONTROL_MODE",0);a&&a(t)});break;case "setManu":l="SET_TEMPERATURE";e.getState({interface:this.deviceIF,channel:b,datapoint:l},function(t,u){t?a&&a(t):(l="MANU_MODE",e.writeValue(f.deviceIF,b,l,{type:"double",value:u.value},function(y){y||e.updateStatusBuffer(f.deviceIF,b,"CONTROL_MODE",1);a&&a(y)}))});break;case "setBoost":l="BOOST_MODE";e.writeValue(this.deviceIF,b,l,!0,function(t){t||e.updateStatusBuffer(f.deviceIF,
b,"CONTROL_MODE",3);a&&a(t)});break;case "tempUp":l="SET_TEMPERATURE";e.getState({interface:this.deviceIF,channel:b,datapoint:l},function(t,u){t?a&&a(t):u?(t=u.value+.5,30.5<t&&(t=30.5),e.writeValue(f.deviceIF,b,l,{type:"double",value:t},a)):a&&a(Error("get current temp state result invalid"))});break;case "tempDown":l="SET_TEMPERATURE";e.getState({interface:this.deviceIF,channel:b,datapoint:l},function(t,u){t?a&&a(t):u?(t=u.value-.5,4.5>t&&(t=4.5),e.writeValue(f.deviceIF,b,l,{type:"double",value:t},
a)):a&&a(Error("get current temp state result invalid"))});break;default:"tempTo"==c.substr(0,6)||c.match(/^[-+]?[0-9]*\.?[0-9]+$/)?("tempTo"==c.substr(0,6)&&(c=c.substr(6)),c=parseFloat(c),l="SET_TEMPERATURE",e.writeValue(this.deviceIF,b,l,{type:"double",value:c},a)):a&&a(Error("no such command"))}};E.prototype.parseDptState=function(e,c,a){var b=e.indexOf(":");if(-1==b)return null;var f=e.substr(0,b);e=e.substr(b+1);var l=this.deviceAdr;b=this.deviceAdr.indexOf(":");-1!=b&&(l=this.deviceAdr.substr(0,
b));if(f!=l)return null;b={};if(0==e)return b["0_"+c.toLowerCase()]=a,b;if(e==this.channel){switch(c){case "CONTROL_MODE":switch(a){case 0:b.mode="auto";break;case 1:b.mode="manu";break;case 2:b.mode="party";break;case 3:b.mode="boost"}break;case "FAULT_REPORTING":switch(a){case 0:b.error="no_error";break;case 1:b.error="valve_tight";break;case 2:b.error="ADJUSTING_RANGE_TOO_LARGE";break;case 3:b.error="ADJUSTING_RANGE_TOO_SMALL";break;case 4:b.error="comm_error";break;case 5:b.error="";break;case 6:b.error=
"lowbat";break;case 7:b.error="VALVE_ERROR_POSITION"}break;case "BATTERY_STATE":b.batLvl=a;break;case "VALVE_STATE":b.valveLvl=a;break;case "BOOST_STATE":b.boostTime=a;break;case "ACTUAL_TEMPERATURE":b.act_temp=a;break;case "SET_TEMPERATURE":b.state=a;break;default:return null}return b}return null};var J=function(e,c,a){p.call(this,e,c,a);this.channel=4;this.legacyType="thermostat"};util.inherits(J,E);J.prototype._getReadableDpts=function(){var e=E.prototype._getReadableDpts.callback(this);e.push({channel:this.deviceAdr+
":"+this.channel,dpt:"WINDOW_STATE"});return e};J.prototype._getDptFromRef=function(e){var c={channel:this.deviceAdr+":"+this.channel,dataPoint:null};switch(e){case "window":c.dataPoint="WINDOW_STATE";break;default:return E.prototype._getDptFromRef.call(this,e)}return c};J.prototype.parseDptState=function(e,c,a){var b=e.indexOf(":");if(-1==b)return null;var f=e.substr(0,b),l=e.substr(b+1),t=this.deviceAdr;b=this.deviceAdr.indexOf(":");-1!=b&&(t=this.deviceAdr.substr(0,b));if(f!=t)return null;b={};
if(0==l)return b["0_"+c.toLowerCase()]=a,b;if(l==this.channel)switch(c){case "WINDOW_STATE":return b.window=a?"closed":"open",b;default:return E.prototype.parseDptState.call(this,e,c,a)}else return null};var M=function(e,c,a){p.call(this,e,c,a);this.weatherChannel=1;this.thermoChannel=2;this.legacyType="wallthermo"};util.inherits(M,p);M.prototype._getReadableDpts=function(){var e=[];e.push({channel:this.deviceAdr+":0",dpt:"UNREACH"});e.push({channel:this.deviceAdr+":0",dpt:"LOWBAT"});e.push({channel:this.deviceAdr+
":"+this.weatherChannel,dpt:"TEMPERATURE"});e.push({channel:this.deviceAdr+":"+this.weatherChannel,dpt:"HUMIDITY"});e.push({channel:this.deviceAdr+":"+this.thermoChannel,dpt:"SETPOINT"});e.push({channel:this.deviceAdr+":"+this.thermoChannel,dpt:"ADJUSTING_COMMAND"});e.push({channel:this.deviceAdr+":"+this.thermoChannel,dpt:"ADJUSTING_DATA"});return e};M.prototype._getDptFromRef=function(e){var c=this.deviceAdr,a={channel:c,dataPoint:null};switch(e){case "timeout":a.channel=c+":0";a.dataPoint="UNREACH";
break;case "lowbat":a.channel=c+":0";a.dataPoint="LOWBAT";break;case "temp":a.channel=c+":1";a.dataPoint="TEMPERATURE";break;case "hum":a.channel=c+":1";a.dataPoint="HUMIDITY";break;case "state":a.channel=c+":2";a.dataPoint="SETPOINT";break;case "adjusting_command":a.channel=c+":2";a.dataPoint="ADJUSTING_COMMAND";break;case "adjusting_data":a.channel=c+":2";a.dataPoint="ADJUSTING_DATA";break;default:return null}return a};M.prototype.executeCommand=function(e,c,a){var b=this.deviceAdr+":"+this.thermoChannel;
switch(c){case "tempUp":var f="SETPOINT";e.getState({interface:this.deviceIF,channel:b,datapoint:f},function(l,t){l?a&&a(l):t?(l=t.value+.5,30<l&&(l=30),e.writeValue(self.deviceIF,b,f,{type:"double",value:l},a)):a&&a(Error("get current temp state result invalid"))});break;case "tempDown":f="SETPOINT";e.getState({interface:this.deviceIF,channel:b,datapoint:f},function(l,t){l?a&&a(l):t?(l=t.value-.5,6>l&&(l=6),e.writeValue(self.deviceIF,b,f,{type:"double",value:l},a)):a&&a(Error("get current temp state result invalid"))});
break;default:"tempTo"==c.substr(0,6)||c.match(/^[-+]?[0-9]*\.?[0-9]+$/)?("tempTo"==c.substr(0,6)&&(c=c.substr(6)),c=parseFloat(c),f="SETPOINT",e.writeValue(this.deviceIF,b,f,{type:"double",value:c},a)):a&&a(Error("no such command"))}};M.prototype.parseDptState=function(e,c,a){var b=e.indexOf(":");if(-1==b)return null;var f=e.substr(0,b);e=e.substr(b+1);if(f!=this.deviceAdr)return null;f={};if(0==e)return"UNREACH"==c?f.timeout=a:"LOWBAT"==c?f.lowbat=a:f["0_"+c.toLowerCase()]=a,f;if("1"==e){switch(c){case "TEMPERATURE":f.temp=
a;break;case "HUMIDITY":f.hum=a}return f}if("2"==e){switch(c){case "SETPOINT":f.state=a;break;case "ADJUSTING_COMMAND":f.adjusting_command=a;break;case "ADJUSTING_DATA":f.adjusting_data=a}return f}return null};var O=function(e,c,a){p.call(this,e,c,a);this.thermoChannel=2;this.legacyType="wallthermostat"};util.inherits(O,p);O.prototype._getReadableDpts=function(){var e=[];e.push({channel:this.deviceAdr+":"+this.thermoChannel,dpt:"CONTROL_MODE"});e.push({channel:this.deviceAdr+":"+this.thermoChannel,
dpt:"LOWBAT_REPORTING"});e.push({channel:this.deviceAdr+":"+this.thermoChannel,dpt:"COMMUNICATION_REPORTING"});e.push({channel:this.deviceAdr+":"+this.thermoChannel,dpt:"WINDOW_OPEN_REPORTING"});e.push({channel:this.deviceAdr+":"+this.thermoChannel,dpt:"BATTERY_STATE"});e.push({channel:this.deviceAdr+":"+this.thermoChannel,dpt:"BOOST_STATE"});e.push({channel:this.deviceAdr+":"+this.thermoChannel,dpt:"ACTUAL_TEMPERATURE"});e.push({channel:this.deviceAdr+":"+this.thermoChannel,dpt:"ACTUAL_HUMIDITY"});
e.push({channel:this.deviceAdr+":"+this.thermoChannel,dpt:"SET_TEMPERATURE"});return e};O.prototype._getDptFromRef=function(e){var c={channel:this.deviceAdr+":"+this.thermoChannel,dataPoint:null};switch(e){case "mode":c.dataPoint="CONTROL_MODE";break;case "lowbat":c.dataPoint="LOWBAT_REPORTING";break;case "comm":c.dataPoint="COMMUNICATION_REPORTING";break;case "window":c.dataPoint="WINDOW_OPEN_REPORTING";break;case "batLvl":c.dataPoint="BATTERY_STATE";break;case "boostTime":c.dataPoint="BOOST_STATE";
break;case "temp":c.dataPoint="ACTUAL_TEMPERATURE";break;case "hum":c.dataPoint="ACTUAL_HUMIDITY";break;case "state":c.dataPoint="SET_TEMPERATURE";break;default:return null}return c};O.prototype.executeCommand=function(e,c,a){var b=this.deviceAdr+":"+this.thermoChannel,f=this;switch(c){case "setAuto":var l="AUTO_MODE";e.writeValue(this.deviceIF,b,l,!0,function(t){t||e.updateStatusBuffer(f.deviceIF,b,"CONTROL_MODE",0);a&&a(t)});break;case "setManu":l="SET_TEMPERATURE";e.getState({interface:this.deviceIF,
channel:b,datapoint:l},function(t,u){t?a&&a(t):(l="MANU_MODE",e.writeValue(f.deviceIF,b,l,{type:"double",value:u.value},function(y){y||e.updateStatusBuffer(f.deviceIF,b,"CONTROL_MODE",1);a&&a(y)}))});break;case "setBoost":l="BOOST_MODE";e.writeValue(this.deviceIF,b,l,!0,function(t){t||e.updateStatusBuffer(f.deviceIF,b,"CONTROL_MODE",3);a&&a(t)});break;case "tempUp":l="SET_TEMPERATURE";e.getState({interface:this.deviceIF,channel:b,datapoint:l},function(t,u){t?a&&a(t):u?(t=u.value+.5,30.5<t&&(t=30.5),
e.writeValue(f.deviceIF,b,l,{type:"double",value:t},a)):a&&a(Error("get current temp state result invalid"))});break;case "tempDown":l="SET_TEMPERATURE";e.getState({interface:this.deviceIF,channel:b,datapoint:l},function(t,u){t?a&&a(t):u?(t=u.value-.5,4.5>t&&(t=4.5),e.writeValue(f.deviceIF,b,l,{type:"double",value:t},a)):a&&a(Error("get current temp state result invalid"))});break;default:"tempTo"==c.substr(0,6)||c.match(/^[-+]?[0-9]*\.?[0-9]+$/)?("tempTo"==c.substr(0,6)&&(c=c.substr(6)),c=parseFloat(c),
l="SET_TEMPERATURE",e.writeValue(this.deviceIF,b,l,{type:"double",value:c},a)):"setWeekProfile"==c.substr(0,14)?(c=parseInt(c.substr(14)),e.setParamset(this.deviceIF,this.deviceAdr,"MASTER",{WEEK_PROGRAM_POINTER:c-1},function(t){a&&a(t)})):a&&a(Error("no such command"))}};O.prototype.parseDptState=function(e,c,a){var b=e.indexOf(":");if(-1==b)return null;var f=e.substr(0,b);e=e.substr(b+1);if(f!=this.deviceAdr)return null;f={};if(0==e)return f["0_"+c.toLowerCase()]=a,f;if("2"==e){switch(c){case "CONTROL_MODE":switch(a){case 0:f.mode=
"auto";break;case 1:f.mode="manu";break;case 2:f.mode="party";break;case 3:f.mode="boost"}break;case "LOWBAT_REPORTING":f.lowbat=a;break;case "COMMUNICATION_REPORTING":f.comm=a;break;case "WINDOW_OPEN_REPORTING":f.window=a;break;case "BATTERY_STATE":f.batLvl=a;break;case "BOOST_STATE":f.boostTime=a;break;case "ACTUAL_TEMPERATURE":f.temp=a;break;case "ACTUAL_HUMIDITY":f.hum=a;break;case "SET_TEMPERATURE":f.state=a}return f}return null};var W=function(e,c,a){p.call(this,e,c,a);this.channel=1;this.legacyType=
"contact"};util.inherits(W,p);W.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":0",dpt:"UNREACH"},{channel:this.deviceAdr+":"+this.channel,dpt:"STATE"},{channel:this.deviceAdr+":"+this.channel,dpt:"LOWBAT"},{channel:this.deviceAdr+":"+this.channel,dpt:"ERROR"}]};W.prototype._getDptFromRef=function(e){var c=this.deviceAdr;-1==c.indexOf(":")&&this.channel&&(c+=":"+this.channel);c={channel:c,dataPoint:null};switch(e){case "timeout":c.channel=0;c.dataPoint="UNREACH";break;case "state":c.dataPoint=
"STATE";break;case "error":c.dataPoint="ERROR";break;case "lowbat":c.dataPoint="LOWBAT";break;default:return null}return c};W.prototype.parseDptState=function(e,c,a){var b=e.indexOf(":");if(-1==b)return null;var f=e.substr(0,b);e=e.substr(b+1);var l=this.deviceAdr;b=this.deviceAdr.indexOf(":");-1!=b&&(l=this.deviceAdr.substr(0,b));if(f!=l||0!=e&&e!=this.channel)return null;if(0==e)return b={},"UNREACH"==c?b.timeout=a:b["0_"+c.toLowerCase()]=a,b;switch(c){case "STATE":return{state:a?"open":"closed"};
case "ERROR":return{error:1==a?"sabotage":"no_error"};case "LOWBAT":return{lowbat:a};default:return null}};var sa=function(e,c,a){p.call(this,e,c,a);this.rainChannel=1;this.heatChannel=2;this.legacyType="rain"};util.inherits(sa,p);sa.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":0",dpt:"UNREACH"},{channel:this.deviceAdr+":"+this.rainChannel,dpt:"STATE"},{channel:this.deviceAdr+":"+this.heatChannel,dpt:"STATE"},{channel:this.deviceAdr+":"+this.heatChannel,dpt:"INHIBIT"},{channel:this.deviceAdr+
":"+this.heatChannel,dpt:"WORKING"}]};sa.prototype._getDptFromRef=function(e){var c=this.deviceAdr,a={channel:c,dataPoint:null};switch(e){case "timeout":a.channel=0;a.dataPoint="UNREACH";break;case "rain":a.channel=c+":"+this.rainChannel;a.dataPoint="STATE";break;case "heat":a.channel=c+":"+this.heatChannel;a.dataPoint="STATE";break;case "inhibit":a.channel=c+":"+this.heatChannel;a.dataPoint="INHIBIT";break;case "working":a.channel=c+":"+this.heatChannel;a.dataPoint="WORKING";break;default:return null}return a};
sa.prototype.executeCommand=function(e,c,a){var b=this.deviceAdr;-1==b.indexOf(":")&&this.heatChannel&&(b+=":"+this.heatChannel);var f=this;switch(c){case "heaterOn":var l="STATE";e.writeValue(this.deviceIF,b,l,!0,a);break;case "heaterOff":l="STATE";e.writeValue(this.deviceIF,b,l,!1,a);break;case "heaterToggle":l="STATE";e.getState({interface:this.deviceIF,channel:b,datapoint:l},function(t,u){t?a&&a(t):u?(t=!0,u.value&&(t=!1),e.writeValue(f.deviceIF,b,l,t,a)):a&&a(Error("get switch current value return invalid"))});
break;default:a&&a(Error("no such command"))}};sa.prototype.parseDptState=function(e,c,a){var b=e.indexOf(":");if(-1==b)return null;var f=e.substr(0,b);e=e.substr(b+1);var l=this.deviceAdr;b=this.deviceAdr.indexOf(":");-1!=b&&(l=this.deviceAdr.substr(0,b));if(f!=l)return null;b={};if(0==e)return"UNREACH"==c?b.timeout=a:b["0_"+c.toLowerCase()]=a,b;if(1==e){switch(c){case "STATE":b.rain=1==a?"rain":"dry";break;default:return null}return b}if(2==e){switch(c){case "STATE":b.heat=a?"on":"off";break;case "INHIBIT":b.inhibit=
a;break;case "WORKING":b.working=a;break;default:return null}return b}};var ba=function(e,c,a){p.call(this,e,c,a);this.ledChannel=1;this.chimeChannel=2;this.legacyType="gong2"};util.inherits(ba,p);ba.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":0",dpt:"UNREACH"},{channel:this.deviceAdr+":"+this.ledChannel,dpt:"STATE"},{channel:this.deviceAdr+":"+this.ledChannel,dpt:"INHIBIT"},{channel:this.deviceAdr+":"+this.ledChannel,dpt:"WORKING"},{channel:this.deviceAdr+":"+this.chimeChannel,
dpt:"STATE"},{channel:this.deviceAdr+":"+this.chimeChannel,dpt:"INHIBIT"},{channel:this.deviceAdr+":"+this.chimeChannel,dpt:"WORKING"}]};ba.prototype._getDptFromRef=function(e){var c=this.deviceAdr,a={channel:c,dataPoint:null};switch(e){case "timeout":a.channel=0;a.dataPoint="UNREACH";break;case "led":a.channel=c+":"+this.ledChannel;a.dataPoint="STATE";break;case "led_inhibit":a.channel=c+":"+this.ledChannel;a.dataPoint="INHIBIT";break;case "led_working":a.channel=c+":"+this.ledChannel;a.dataPoint=
"WORKING";break;case "chime":a.channel=c+":"+this.chimeChannel;a.dataPoint="STATE";break;case "chime_inhibit":a.channel=c+":"+this.chimeChannel;a.dataPoint="INHIBIT";break;case "chime_working":a.channel=c+":"+this.chimeChannel;a.dataPoint="WORKING";break;default:return null}return a};ba.prototype.executeCommand=function(e,c,a){switch(c){case "ledOn":c=this.deviceAdr+":"+this.ledChannel;e.writeValue(this.deviceIF,c,"STATE",!0,a);break;case "ledOff":c=this.deviceAdr+":"+this.ledChannel;e.writeValue(this.deviceIF,
c,"STATE",!1,a);break;case "chimeOn":c=this.deviceAdr+":"+this.chimeChannel;e.writeValue(this.deviceIF,c,"STATE",!0,a);break;case "chimeOff":c=this.deviceAdr+":"+this.chimeChannel;e.writeValue(this.deviceIF,c,"STATE",!1,a);break;default:a&&a(Error("no such command"))}};ba.prototype.parseDptState=function(e,c,a){var b=e.indexOf(":");if(-1==b)return null;var f=e.substr(0,b);e=e.substr(b+1);var l=this.deviceAdr;b=this.deviceAdr.indexOf(":");-1!=b&&(l=this.deviceAdr.substr(0,b));if(f!=l)return null;b=
{};if(0==e)return"UNREACH"==c?b.timeout=a:b["0_"+c.toLowerCase()]=a,b;if(1==e){switch(c){case "STATE":b.led=a?"on":"off";break;case "INHIBIT":b.led_inhibit=a;break;case "WORKING":b.led_working=a;break;default:return null}return b}if(2==e){switch(c){case "STATE":b.chime=a?"on":"off";break;case "INHIBIT":b.chime_inhibit=a;break;case "WORKING":b.chime_working=a;break;default:return null}return b}};var gb=function(e,c,a){p.call(this,e,c,a);this.ledChannel=1;this.chimeChannel=2;this.legacyType="gong"};
util.inherits(gb,ba);gb.prototype.executeCommand=function(e,c,a){if(0==c.indexOf("vChannel")){var b=c.substr(8);b=parseInt(b);c=this.deviceAdr+":"+this.chimeChannel;e.writeValue(this.deviceIF,c,"SUBMIT","0.8,1,5,"+b,a)}else if(0==c.indexOf("setChime")){var f=c.substr(8);parseInt(b);c=this.deviceAdr+":"+this.chimeChannel;e.writeValue(this.deviceIF,c,"SUBMIT",f,a)}else 0==c.indexOf("ledGreen")?((b=c.substr(8))||(b=10),c=this.deviceAdr+":"+this.ledChannel,e.writeValue(this.deviceIF,c,"SUBMIT","1,10,"+
b+",34",a)):0==c.indexOf("ledRed")?((b=c.substr(6))||(b=10),c=this.deviceAdr+":"+this.ledChannel,e.writeValue(this.deviceIF,c,"SUBMIT","1,10,"+b+",18",a)):ba.prototype.executeCommand.call(this,e,c,a)};var Ka=function(e,c,a){p.call(this,e,c,a);this.channel=1;this.legacyType="window"};util.inherits(Ka,p);Ka.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":0",dpt:"UNREACH"},{channel:this.deviceAdr+":"+this.channel,dpt:"STATE"},{channel:this.deviceAdr+":"+this.channel,dpt:"ERROR"},
{channel:this.deviceAdr+":"+this.channel,dpt:"LOWBAT"}]};Ka.prototype._getDptFromRef=function(e){var c={channel:this.deviceAdr+":"+this.channel,dataPoint:null};switch(e){case "timeout":c.channel=0;c.dataPoint="UNREACH";break;case "state":c.dataPoint="STATE";break;case "error":c.dataPoint="ERROR";break;case "lowbat":c.dataPoint="LOWBAT";break;default:return null}return c};Ka.prototype.parseDptState=function(e,c,a){var b=e.indexOf(":");if(-1==b)return null;var f=e.substr(0,b);e=e.substr(b+1);var l=
this.deviceAdr;b=this.deviceAdr.indexOf(":");-1!=b&&(l=this.deviceAdr.substr(0,b));if(f!=l)return null;b={};if(0==e)return"UNREACH"==c?b.timeout=a:b["0_"+c.toLowerCase()]=a,b;switch(c){case "STATE":switch(a){case 0:b.state="closed";break;case 1:b.state="tilted";break;case 2:b.state="open"}break;case "ERROR":switch(a){case 0:b.error="no_error";break;case 1:case 7:b.error="sabotage"}break;case "LOWBAT":b.lowbat=a;break;default:return null}return b};var La=function(e,c,a){p.call(this,e,c,a);this.channel=
1;this.legacyType="temp"};util.inherits(La,p);La.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":0",dpt:"LOWBAT"},{channel:this.deviceAdr+":0",dpt:"UNREACH"},{channel:this.deviceAdr+":"+this.channel,dpt:"TEMPERATURE"}]};La.prototype._getDptFromRef=function(e){var c={channel:this.deviceAdr+":"+this.channel,dataPoint:null};switch(e){case "lowbat":c.channel=0;c.dataPoint="LOWBAT";break;case "timeout":c.channel=0;c.dataPoint="UNREACH";break;case "temp":c.dataPoint="TEMPERATURE";
break;default:return null}return c};La.prototype.parseDptState=function(e,c,a){var b=e.indexOf(":");if(-1==b)return null;var f=e.substr(0,b);e=e.substr(b+1);var l=this.deviceAdr;b=this.deviceAdr.indexOf(":");-1!=b&&(l=this.deviceAdr.substr(0,b));if(f!=l||0!=e&&e!=this.channel)return null;if(0==e)return b={},"UNREACH"==c?b.timeout=a:"LOWBAT"==c?b.lowbat=a:b["0_"+c.toLowerCase()]=a,b;switch(c){case "TEMPERATURE":return{temp:parseFloat(a)};default:return null}};var Ma=function(e,c,a){p.call(this,e,c,
a);this.temp1=1;this.temp2=2;this.tempDiff12=3;this.tempDiff21=4;this.legacyType="temp2"};util.inherits(Ma,p);Ma.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":0",dpt:"UNREACH"},{channel:this.deviceAdr+":"+this.temp1,dpt:"TEMPERATURE"},{channel:this.deviceAdr+":"+this.temp1,dpt:"LOWBAT"},{channel:this.deviceAdr+":"+this.temp2,dpt:"TEMPERATURE"},{channel:this.deviceAdr+":"+this.tempDiff12,dpt:"TEMPERATURE"},{channel:this.deviceAdr+":"+this.tempDiff21,dpt:"TEMPERATURE"}]};Ma.prototype._getDptFromRef=
function(e){var c={channel:this.deviceAdr+":"+this.channel,dataPoint:null};switch(e){case "timeout":c.channel=0;c.dataPoint="UNREACH";break;case "lowbat":c.channel=this.temp1;c.dataPoint="LOWBAT";break;case "temp1":c.channel=this.temp1;c.dataPoint="TEMPERATURE";break;case "temp2":c.channel=this.temp2;c.dataPoint="TEMPERATURE";break;case "tempDiff12":c.channel=this.tempDiff12;c.dataPoint="TEMPERATURE";break;case "tempDiff21":c.channel=this.tempDiff21;c.dataPoint="TEMPERATURE";break;default:return null}return c};
Ma.prototype.parseDptState=function(e,c,a){var b=e.indexOf(":");if(-1==b)return null;var f=e.substr(0,b);e=e.substr(b+1);var l=this.deviceAdr;b=this.deviceAdr.indexOf(":");-1!=b&&(l=this.deviceAdr.substr(0,b));if(f!=l)return null;b={};if(0==e)return"UNREACH"==c?b.timeout=a:b["0_"+c.toLowerCase()]=a,b;switch(c){case "LOWBAT":return{lowbat:a};case "TEMPERATURE":return 1==e?{temp1:parseFloat(a)}:2==e?{temp2:parseFloat(a)}:3==e?{tempDiff12:parseFloat(a)}:4==e?{tempDiff21:parseFloat(a)}:null;default:return null}};
var Na=function(e,c,a){p.call(this,e,c,a);this.channel=1;this.legacyType="co2"};util.inherits(Na,p);Na.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":0",dpt:"UNREACH"},{channel:this.deviceAdr+":"+this.channel,dpt:"STATE"}]};Na.prototype._getDptFromRef=function(e){var c={channel:this.deviceAdr+":"+this.channel,dataPoint:null};switch(e){case "timeout":c.channel=0;c.dataPoint="UNREACH";break;case "state":c.dataPoint="STATE";break;default:return null}return c};Na.prototype.parseDptState=
function(e,c,a){var b=e.indexOf(":");if(-1==b)return null;var f=e.substr(0,b);e=e.substr(b+1);var l=this.deviceAdr;b=this.deviceAdr.indexOf(":");-1!=b&&(l=this.deviceAdr.substr(0,b));if(f!=l||0!=e&&e!=this.channel)return null;b={};if(0==e)return"UNREACH"==c?b.timeout=a:b["0_"+c.toLowerCase()]=a,b;switch(c){case "STATE":switch(a){case 0:b.state="normal";break;case 1:b.state="medium";break;case 2:b.state="high"}break;default:return null}return b};var Oa=function(e,c,a){p.call(this,e,c,a);this.channel=
1;this.legacyType="motion"};util.inherits(Oa,p);Oa.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":0",dpt:"LOWBAT"},{channel:this.deviceAdr+":0",dpt:"UNREACH"},{channel:this.deviceAdr+":"+this.channel,dpt:"BRIGHTNESS"},{channel:this.deviceAdr+":"+this.channel,dpt:"MOTION"},{channel:this.deviceAdr+":"+this.channel,dpt:"ERROR"}]};Oa.prototype._getDptFromRef=function(e){var c={channel:this.deviceAdr+":"+this.channel,dataPoint:null};switch(e){case "lowbat":c.channel=0;c.dataPoint=
"LOWBAT";break;case "timeout":c.channel=0;c.dataPoint="UNREACH";break;case "bri":c.dataPoint="BRIGHTNESS";break;case "state":c.dataPoint="MOTION";break;case "error":c.dataPoint="ERROR";break;default:return null}return c};Oa.prototype.parseDptState=function(e,c,a){var b=e.indexOf(":");if(-1==b)return null;var f=e.substr(0,b);e=e.substr(b+1);var l=this.deviceAdr;b=this.deviceAdr.indexOf(":");-1!=b&&(l=this.deviceAdr.substr(0,b));if(f!=l||0!=e&&e!=this.channel)return null;b={};if(0==e)return"UNREACH"==
c?b.timeout=a:"LOWBAT"==c?b.lowbat=a:b["0_"+c.toLowerCase()]=a,b;switch(c){case "BRIGHTNESS":b.bri=a;break;case "MOTION":b.state=a?"motion":"ok";break;case "ERROR":b.error=a?"sabotage":"no_error";break;default:return null}return b};var Pa=function(e,c,a){p.call(this,e,c,a);this.channel=1;this.legacyType="smoke"};util.inherits(Pa,p);Pa.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":0",dpt:"LOWBAT"},{channel:this.deviceAdr+":0",dpt:"UNREACH"},{channel:this.deviceAdr+":"+this.channel,
dpt:"STATE"}]};Pa.prototype._getDptFromRef=function(e){var c={channel:this.deviceAdr+":"+this.channel,dataPoint:null};switch(e){case "lowbat":c.channel=0;c.dataPoint="LOWBAT";break;case "timeout":c.channel=0;c.dataPoint="UNREACH";break;case "state":c.dataPoint="STATE";break;default:return null}return c};Pa.prototype.parseDptState=function(e,c,a){var b=e.indexOf(":");if(-1==b)return null;var f=e.substr(0,b);e=e.substr(b+1);var l=this.deviceAdr;b=this.deviceAdr.indexOf(":");-1!=b&&(l=this.deviceAdr.substr(0,
b));if(f!=l||0!=e&&e!=this.channel)return null;b={};if(0==e)return"UNREACH"==c?b.timeout=a:"LOWBAT"==c?b.lowbat=a:b["0_"+c.toLowerCase()]=a,b;switch(c){case "STATE":b.state=a?"smoke":"ok";break;default:return null}return b};var ta=function(e,c,a){p.call(this,e,c,a);this.channel=1;this.legacyType="siren"};util.inherits(ta,p);ta.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":0",dpt:"UNREACH"},{channel:this.deviceAdr+":"+this.channel,dpt:"STATE"},{channel:this.deviceAdr+":"+this.channel,
dpt:"ERROR_POWER"},{channel:this.deviceAdr+":"+this.channel,dpt:"ERROR_SABOTAGE"},{channel:this.deviceAdr+":"+this.channel,dpt:"ERROR_BATTERY"},{channel:this.deviceAdr+":"+this.channel,dpt:"INHIBIT"},{channel:this.deviceAdr+":"+this.channel,dpt:"WORKING"},{channel:this.deviceAdr+":"+this.channel,dpt:"LOWBAT"}]};ta.prototype._getDptFromRef=function(e){var c={channel:this.deviceAdr+":"+this.channel,dataPoint:null};switch(e){case "timeout":c.channel=0;c.dataPoint="UNREACH";break;case "state":c.dataPoint=
"STATE";break;case "error_power":c.dataPoint="ERROR_POWER";break;case "error_sabotage":c.dataPoint="ERROR_SABOTAGE";break;case "error_battery":c.dataPoint="ERROR_BATTERY";break;case "inhibit":c.dataPoint="INHIBIT";break;case "working":c.dataPoint="WORKING";break;default:return null}return c};ta.prototype.executeCommand=function(e,c,a){var b=this.deviceAdr+":"+this.channel,f=this;switch(c){case "on":var l="STATE";e.writeValue(this.deviceIF,b,l,!0,a);break;case "off":l="STATE";e.writeValue(this.deviceIF,
b,l,!1,a);break;case "toggle":l="STATE";e.getState({interface:this.deviceIF,channel:b,datapoint:l},function(t,u){t?a&&a(t):(t=!0,u.value&&(t=!1),e.writeValue(f.deviceIF,b,l,t,a))});break;default:a&&a(Error("no such command"))}};ta.prototype.parseDptState=function(e,c,a){var b=e.indexOf(":");if(-1==b)return null;var f=e.substr(0,b);e=e.substr(b+1);var l=this.deviceAdr;b=this.deviceAdr.indexOf(":");-1!=b&&(l=this.deviceAdr.substr(0,b));if(f!=l||0!=e&&e!=this.channel)return null;b={};if(0==e)return"UNREACH"==
c?b.timeout=a:b["0_"+c.toLowerCase()]=a,b;switch(c){case "STATE":b.state=a?"on":"off";break;case "ERROR_POWER":b.error_power=a?"power_failure":"no_error";break;case "ERROR_SABOTAGE":b.error_sabotage=a?"sabotage":"no_error";break;case "ERROR_BATTERY":b.error_battery=a?"battery_defect":"no_error";break;case "INHIBIT":b.inhibit=a;break;case "WORKING":b.working=a;break;default:return null}return b};var Qa=function(e,c,a){p.call(this,e,c,a);this.channel=1;this.legacyType="capacity"};util.inherits(Qa,p);
Qa.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":0",dpt:"LOWBAT"},{channel:this.deviceAdr+":0",dpt:"UNREACH"},{channel:this.deviceAdr+":"+this.channel,dpt:"FILLING_LEVEL"}]};Qa.prototype._getDptFromRef=function(e){var c={channel:this.deviceAdr+":"+this.channel,dataPoint:null};switch(e){case "lowbat":c.channel=0;c.dataPoint="LOWBAT";break;case "timeout":c.channel=0;c.dataPoint="UNREACH";break;case "state":c.dataPoint="FILLING_LEVEL";break;default:return null}return c};Qa.prototype.parseDptState=
function(e,c,a){var b=e.indexOf(":");if(-1==b)return null;var f=e.substr(0,b);e=e.substr(b+1);var l=this.deviceAdr;b=this.deviceAdr.indexOf(":");-1!=b&&(l=this.deviceAdr.substr(0,b));if(f!=l||0!=e&&e!=this.channel)return null;b={};if(0==e)return"UNREACH"==c?b.timeout=a:"LOWBAT"==c?b.lowbat=a:b["0_"+c.toLowerCase()]=a,b;switch(c){case "FILLING_LEVEL":b.state=a;break;default:return null}return b};var ma=function(e,c,a){p.call(this,e,c,a);this.channel=1;this.legacyType="switch_interface"};util.inherits(ma,
p);ma.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":0",dpt:"LOWBAT"},{channel:this.deviceAdr+":0",dpt:"UNREACH"}]};ma.prototype._getDptFromRef=function(e){var c=this.deviceAdr;-1==c.indexOf(":")&&this.channel&&(c+=":"+this.channel);c={channel:c,dataPoint:null};switch(e){case "lowbat":c.channel=0;c.dataPoint="LOWBAT";break;case "timeout":c.channel=0;c.dataPoint="UNREACH";break;default:return null}return c};ma.prototype.parseDptState=function(e,c,a){var b=e.indexOf(":");if(-1==
b)return null;var f=e.substr(0,b);e=e.substr(b+1);var l=this.deviceAdr;b=this.deviceAdr.indexOf(":");-1!=b&&(l=this.deviceAdr.substr(0,b));if(f!=l||0!=e&&e!=this.channel)return null;if(0==e)return b={},"UNREACH"==c?b.timeout=a:"LOWBAT"==c?b.lowbat=a:b["0_"+c.toLowerCase()]=a,b;switch(c){case "PRESS":return{press:a};default:return null}};ma.prototype.isButton=function(){return!0};ma.prototype.claimEvent=function(e,c){var a=this.deviceAdr;-1==a.indexOf(":")&&this.channel&&(a+=":"+this.channel);e.reportValueUsage(this.deviceIF,
a,"PRESS",function(b,f){b&&console.error("switch interface claim PRESS event error:"+b.stack);c&&c()})};var Ra=function(e,c,a){p.call(this,e,c,a);this.channel=1;this.legacyType="tilt"};util.inherits(Ra,p);Ra.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":0",dpt:"UNREACH"},{channel:this.deviceAdr+":"+this.channel,dpt:"STATE"},{channel:this.deviceAdr+":"+this.channel,dpt:"LOWBAT"}]};Ra.prototype._getDptFromRef=function(e){var c={channel:this.deviceAdr+":"+this.channel,dataPoint:null};
switch(e){case "timeout":c.channel=0;c.dataPoint="UNREACH";break;case "state":c.dataPoint="STATE";break;case "lowbat":c.dataPoint="LOWBAT";break;default:return null}return c};Ra.prototype.parseDptState=function(e,c,a){var b=e.indexOf(":");if(-1==b)return null;var f=e.substr(0,b);e=e.substr(b+1);var l=this.deviceAdr;b=this.deviceAdr.indexOf(":");-1!=b&&(l=this.deviceAdr.substr(0,b));if(f!=l||0!=e&&e!=this.channel)return null;b={};if(0==e)return"UNREACH"==c?b.timeout=a:b["0_"+c.toLowerCase()]=a,b;switch(c){case "STATE":b.state=
a?"open":"closed";break;case "LOWBAT":b.lowbat=a;break;default:return null}return b};var Sa=function(e,c,a){p.call(this,e,c,a);this.channel=1;this.legacyType="water"};util.inherits(Sa,p);Sa.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":0",dpt:"UNREACH"},{channel:this.deviceAdr+":"+this.channel,dpt:"STATE"},{channel:this.deviceAdr+":"+this.channel,dpt:"LOWBAT"}]};Sa.prototype._getDptFromRef=function(e){var c={channel:this.deviceAdr+":"+this.channel,dataPoint:null};switch(e){case "timeout":c.channel=
0;c.dataPoint="UNREACH";break;case "state":c.dataPoint="STATE";break;case "lowbat":c.dataPoint="LOWBAT";break;default:return null}return c};Sa.prototype.parseDptState=function(e,c,a){var b=e.indexOf(":");if(-1==b)return null;var f=e.substr(0,b);e=e.substr(b+1);var l=this.deviceAdr;b=this.deviceAdr.indexOf(":");-1!=b&&(l=this.deviceAdr.substr(0,b));if(f!=l||0!=e&&e!=this.channel)return null;b={};if(0==e)return"UNREACH"==c?b.timeout=a:b["0_"+c.toLowerCase()]=a,b;switch(c){case "STATE":switch(a){case 0:b.state=
"ok";break;case 1:b.state="moist";break;case 2:b.state="water"}break;case "LOWBAT":b.lowbat=a;break;default:return null}return b};var Ta=function(e,c,a){p.call(this,e,c,a);this.channel=1;this.legacyType="energymeter"};util.inherits(Ta,p);Ta.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":0",dpt:"LOWBAT"},{channel:this.deviceAdr+":0",dpt:"UNREACH"},{channel:this.deviceAdr+":"+this.channel,dpt:"BOOT"},{channel:this.deviceAdr+":"+this.channel,dpt:"GAS_ENERGY_COUNTER"},{channel:this.deviceAdr+
":"+this.channel,dpt:"GAS_POWER"},{channel:this.deviceAdr+":"+this.channel,dpt:"ENERGY_COUNTER"},{channel:this.deviceAdr+":"+this.channel,dpt:"POWER"}]};Ta.prototype._getDptFromRef=function(e){var c={channel:this.deviceAdr+":"+this.channel,dataPoint:null};switch(e){case "lowbat":c.channel=0;c.dataPoint="LOWBAT";break;case "timeout":c.channel=0;c.dataPoint="UNREACH";break;case "boot":c.dataPoint="BOOT";break;case "gas_energy":c.dataPoint="GAS_ENERGY_COUNTER";break;case "gas_power":c.dataPoint="GAS_POWER";
break;case "energy":c.dataPoint="ENERGY_COUNTER";break;case "power":c.dataPoint="POWER";break;default:return null}return c};Ta.prototype.parseDptState=function(e,c,a){var b=e.indexOf(":");if(-1==b)return null;var f=e.substr(0,b);e=e.substr(b+1);var l=this.deviceAdr;b=this.deviceAdr.indexOf(":");-1!=b&&(l=this.deviceAdr.substr(0,b));if(f!=l||0!=e&&e!=this.channel)return null;b={};if(0==e)return"UNREACH"==c?b.timeout=a:"LOWBAT"==c?b.lowbat=a:b["0_"+c.toLowerCase()]=a,b;switch(c){case "BOOT":b.boot=
a;break;case "GAS_ENERGY_COUNTER":b.gas_energy=a;break;case "GAS_POWER":b.gas_power=a;break;case "ENERGY_COUNTER":b.energy=a;break;case "POWER":b.power=a;break;default:return null}return b};var na=function(e,c,a){p.call(this,e,c,a);this.dimChannel=1;this.rgbChannel=2;this.autoChannel=3;this.legacyType="rgb"};util.inherits(na,p);na.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":0",dpt:"UNREACH"},{channel:this.deviceAdr+":"+this.dimChannel,dpt:"LEVEL"},{channel:this.deviceAdr+
":"+this.rgbChannel,dpt:"COLOR"},{channel:this.deviceAdr+":"+this.autoChannel,dpt:"PROGRAM"}]};na.prototype._getDptFromRef=function(e){var c=this.deviceAdr,a={channel:c,dataPoint:null};switch(e){case "timeout":a.channel=0;a.dataPoint="UNREACH";break;case "state":a.channel=c+":"+this.dimChannel;a.dataPoint="LEVEL";break;case "color":a.channel=c+":"+this.rgbChannel;a.dataPoint="COLOR";break;case "program":a.channel=c+":"+this.autoChannel;a.dataPoint="PROGRAM";break;case "inhibit":a.channel=c+":"+this.dimChannel;
a.dataPoint="INHIBIT";break;case "working":a.channel=c+":"+this.dimChannel;a.dataPoint="WORKING";break;case "direction":a.channel=c+":"+this.dimChannel;a.dataPoint="DIRECTION";break;default:return null}return a};na.prototype.executeCommand=function(e,c,a){var b=this;switch(c){case "on":var f=this.deviceAdr+":"+this.dimChannel;var l="OLD_LEVEL";e.writeValue(this.deviceIF,f,l,!0,a);break;case "off":f=this.deviceAdr+":"+this.dimChannel;l="LEVEL";e.writeValue(this.deviceIF,f,l,{type:"double",value:0},
a);break;case "white":f=this.deviceAdr+":"+this.rgbChannel;l="COLOR";e.writeValue(this.deviceIF,f,l,200,a);break;case "dimUp":f=this.deviceAdr+":"+this.dimChannel;l="LEVEL";e.getState({interface:this.deviceIF,channel:f,datapoint:l},function(A,B){A?a&&a(A):B?(A=B.value+.05,1<A&&(A=1),e.writeValue(b.deviceIF,f,l,{type:"double",value:A},a)):a&&a(Error("get current dimmer state result invalid"))});break;case "dimDown":f=this.deviceAdr+":"+this.dimChannel;l="LEVEL";e.getState({interface:this.deviceIF,
channel:f,datapoint:l},function(A,B){A?a&&a(A):B?(A=B.value-.05,0>A&&(A=0),e.writeValue(b.deviceIF,f,l,{type:"double",value:A},a)):a&&a(Error("get current dimmer state result invalid"))});break;default:if("onTo"==c.substr(0,4)||c.match(/^[-+]?[0-9]+$/)){"onTo"==c.substr(0,4)&&(c=c.substr(4));var t=parseInt(c);f=this.deviceAdr+":"+this.dimChannel;l="LEVEL";e.writeValue(this.deviceIF,f,l,{type:"double",value:t/100},a)}else if("setProg"==c.substr(0,7))c=c.substr(7),t=parseInt(c),f=this.deviceAdr+":"+
this.autoChannel,l="PROGRAM",e.writeValue(this.deviceIF,f,l,t,a);else if("setRampTime"==c.substr(0,11))c=c.substr(11),t=parseFloat(c),f=this.deviceAdr+":"+this.dimChannel,l="RAMP_TIME",e.writeValue(this.deviceIF,f,l,{type:"double",value:t},a);else if(c.toLowerCase().match(/^([0-9a-f]{6})$/i)){t=parseInt(c.substr(0,2),16);var u=parseInt(c.substr(2,2),16);c=parseInt(c.substr(4,2),16);var y=0;t=this._RGBToHSV(t,u,c);y=.1>t[1]?200:Math.round(t[0]/1.8);f=this.deviceAdr+":"+this.rgbChannel;l="COLOR";e.writeValue(this.deviceIF,
f,l,y,a)}else a&&a(Error("no such command"))}};na.prototype.parseDptState=function(e,c,a){var b=e.indexOf(":");if(-1==b)return null;var f=e.substr(0,b);e=e.substr(b+1);var l=this.deviceAdr;b=this.deviceAdr.indexOf(":");-1!=b&&(l=this.deviceAdr.substr(0,b));if(f!=l||0!=e&&e!=this.dimChannel&&e!=this.rgbChannel&&e!=this.autoChannel)return null;b={};if(0==e)return"UNREACH"==c?b.timeout=a:b["0_"+c.toLowerCase()]=a,b;switch(c){case "LEVEL":b.state=100*parseFloat(a);break;case "COLOR":b.color=a;break;case "PROGRAM":b.program=
a;break;case "INHIBIT":b.inhibit=a;break;case "WORKING":b.working=a;break;case "DIRECTION":b.direction=a;break;default:return null}return b};na.prototype._RGBToHSV=function(e,c,a){e/=255;c/=255;a/=255;var b=Math.min(e,Math.min(c,a)),f=Math.max(e,Math.max(c,a));return b==f?[0,0,b]:[60*((e==b?3:a==b?1:5)-(e==b?c-a:a==b?e-c:a-e)/(f-b)),(f-b)/f,f]};var Ua=function(e,c,a){p.call(this,e,c,a);this.channel=1;this.legacyType="lux"};util.inherits(Ua,p);Ua.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+
":0",dpt:"LOWBAT"},{channel:this.deviceAdr+":0",dpt:"UNREACH"},{channel:this.deviceAdr+":"+this.channel,dpt:"LUX"}]};Ua.prototype._getDptFromRef=function(e){var c={channel:this.deviceAdr+":"+this.channel,dataPoint:null};switch(e){case "lowbat":c.channel=0;c.dataPoint="LOWBAT";break;case "timeout":c.channel=0;c.dataPoint="UNREACH";break;case "state":c.dataPoint="LUX";break;default:return null}return c};Ua.prototype.parseDptState=function(e,c,a){var b=e.indexOf(":");if(-1==b)return null;var f=e.substr(0,
b);e=e.substr(b+1);var l=this.deviceAdr;b=this.deviceAdr.indexOf(":");-1!=b&&(l=this.deviceAdr.substr(0,b));if(f!=l||0!=e&&e!=this.channel)return null;b={};if(0==e)return"UNREACH"==c?b.timeout=a:"LOWBAT"==c?b.lowbat=a:b["0_"+c.toLowerCase()]=a,b;switch(c){case "LUX":b.state=a;break;default:return null}return b};var ua=function(e,c,a){p.call(this,e,c,a);this.swChannel1=1;this.swChannel2=2;this.panicChannel=3;this.armingChannel=4;this.legacyType="siren2"};util.inherits(ua,p);ua.prototype._getReadableDpts=
function(){return[{channel:this.deviceAdr+":0",dpt:"UNREACH"},{channel:this.deviceAdr+":"+this.swChannel1,dpt:"STATE"},{channel:this.deviceAdr+":"+this.swChannel2,dpt:"STATE"},{channel:this.deviceAdr+":"+this.panicChannel,dpt:"STATE"},{channel:this.deviceAdr+":"+this.armingChannel,dpt:"ARMSTATE"},{channel:this.deviceAdr+":"+this.armingChannel,dpt:"INHIBIT"},{channel:this.deviceAdr+":"+this.armingChannel,dpt:"WORKING"},{channel:this.deviceAdr+":"+this.armingChannel,dpt:"ERROR_SABOTAGE"},{channel:this.deviceAdr+
":"+this.armingChannel,dpt:"LOWBAT"}]};ua.prototype._getDptFromRef=function(e){var c=this.deviceAdr,a={channel:c,dataPoint:null};switch(e){case "timeout":a.channel=0;a.dataPoint="UNREACH";break;case "switchSensorInState":a.channel=c+":"+this.swChannel1;a.dataPoint="STATE";break;case "switchSensorExState":a.channel=c+":"+this.swChannel2;a.dataPoint="STATE";break;case "switchPanicState":a.channel=c+":"+this.panicChannel;a.dataPoint="STATE";break;case "arming":a.channel=c+":"+this.armingChannel;a.dataPoint=
"ARMSTATE";break;case "inhibit":a.channel=c+":"+this.armingChannel;a.dataPoint="INHIBIT";break;case "working":a.channel=c+":"+this.armingChannel;a.dataPoint="WORKING";break;case "sabotage":a.channel=c+":"+this.armingChannel;a.dataPoint="ERROR_SABOTAGE";break;case "lowbat":a.channel=c+":"+this.armingChannel;a.dataPoint="LOWBAT";break;default:return null}return a};ua.prototype.parseDptState=function(e,c,a){var b=e.indexOf(":");if(-1==b)return null;var f=e.substr(0,b);e=e.substr(b+1);var l=this.deviceAdr;
b=this.deviceAdr.indexOf(":");-1!=b&&(l=this.deviceAdr.substr(0,b));if(f!=l)return null;b={};if(0==e)return"UNREACH"==c?b.timeout=a:b["0_"+c.toLowerCase()]=a,b;if(1==e){switch(c){case "STATE":b.switchSensorInState=a?"on":"off";break;default:return null}return b}if(2==e){switch(c){case "STATE":b.switchSensorExState=a?"on":"off";break;default:return null}return b}if(3==e){switch(c){case "STATE":b.switchPanicState=a?"on":"off";break;default:return null}return b}if(4==e){switch(c){case "ARMSTATE":switch(a){case 0:b.arming=
"disarmed";break;case 1:b.arming="ex_armed";break;case 2:b.arming="all_armed";break;case 3:b.arming="blocked"}break;case "INHIBIT":b.inhibit=a;break;case "WORKING":b.working=a;break;case "ERROR_SABOTAGE":switch(a){case 0:b.sabotage="no_error";break;case 1:b.sabotage="ex_armed"}break;case "LOWBAT":b.lowbat=a;break;default:return null}return b}};ua.prototype.executeCommand=function(e,c,a){var b=this;switch(c){case "switchSensorInOn":var f="STATE";var l=this.deviceAdr+":"+this.swChannel1;e.writeValue(this.deviceIF,
l,f,!0,a);break;case "switchSensorInOff":f="STATE";l=this.deviceAdr+":"+this.swChannel1;e.writeValue(this.deviceIF,l,f,!1,a);break;case "switchSensorInToggle":f="STATE";l=this.deviceAdr+":"+this.swChannel1;e.getState({interface:this.deviceIF,channel:l,datapoint:f},function(t,u){t?a&&a(t):(t=!0,u.value&&(t=!1),e.writeValue(b.deviceIF,l,f,t,a))});break;case "switchSensorExOn":f="STATE";l=this.deviceAdr+":"+this.swChannel2;e.writeValue(this.deviceIF,l,f,!0,a);break;case "switchSensorExOff":f="STATE";
l=this.deviceAdr+":"+this.swChannel2;e.writeValue(this.deviceIF,l,f,!1,a);break;case "switchSensorExToggle":f="STATE";l=this.deviceAdr+":"+this.swChannel2;e.getState({interface:this.deviceIF,channel:l,datapoint:f},function(t,u){t?a&&a(t):(t=!0,u.value&&(t=!1),e.writeValue(b.deviceIF,l,f,t,a))});break;case "switchPanicOn":f="STATE";l=this.deviceAdr+":"+this.panicChannel;e.writeValue(this.deviceIF,l,f,!0,a);break;case "switchPanicOff":f="STATE";l=this.deviceAdr+":"+this.panicChannel;e.writeValue(this.deviceIF,
l,f,!1,a);break;case "switchPanicToggle":f="STATE";l=this.deviceAdr+":"+this.panicChannel;e.getState({interface:this.deviceIF,channel:l,datapoint:f},function(t,u){t?a&&a(t):(t=!0,u.value&&(t=!1),e.writeValue(b.deviceIF,l,f,t,a))});break;case "armingDisarm":f="ARMSTATE";l=this.deviceAdr+":"+this.armingChannel;e.writeValue(this.deviceIF,l,f,0,a);break;case "armingIntern":f="ARMSTATE";l=this.deviceAdr+":"+this.armingChannel;e.writeValue(this.deviceIF,l,f,1,a);break;case "armingAll":f="ARMSTATE";l=this.deviceAdr+
":"+this.armingChannel;e.writeValue(this.deviceIF,l,f,2,a);break;default:a&&a(Error("no such command"))}};var va=function(e,c,a){p.call(this,e,c,a);this.channel=1;this.legacyType="jalousie"};util.inherits(va,p);va.prototype._getReadableDpts=function(){var e=[],c=this,a=x.hub.m.hm._Channel["BidCos-RF"];e.push({channel:this.deviceAdr+":0",dpt:"UNREACH"});(a=a.JALOUSIE.getReadableDpts())&&a.forEach(function(b){e.push({channel:c.deviceAdr+":3",dpt:b})});return e};va.prototype._getDptFromRef=function(e){var c=
this.deviceAdr,a={channel:c+":"+this.channel,dataPoint:null},b=x.hub.m.hm._Channel["BidCos-RF"];switch(e){case "timeout":a.channel=c+":0";a.dataPoint="UNREACH";break;default:if(a.channel=c+":"+this.channel,a.dataPoint=b.JALOUSIE.getDptFromState(e),!a.dataPoint)return null}return a};va.prototype.executeCommand=function(e,c,a){x.hub.m.hm._Channel["BidCos-RF"].JALOUSIE.executeCommand(e,this.deviceIF,this.deviceAdr+":"+this.channel,c,a)};va.prototype.parseDptState=function(e,c,a){var b=e.indexOf(":");
if(-1==b)return null;var f=e.substr(0,b);e=e.substr(b+1);var l=this.deviceAdr;b=this.deviceAdr.indexOf(":");-1!=b&&(l=this.deviceAdr.substr(0,b));if(f!=l)return null;b=x.hub.m.hm._Channel["BidCos-RF"];if(0==e){if("UNREACH"==c)return{timeout:a};b={};b["0_"+c.toLowerCase()]=a;return b}return e==this.channel?b.JALOUSIE.parseDptState(c,a):null};var ca=function(e,c,a){p.call(this,e,c,a);this.keyChannel1=1;this.keyChannel2=2;this.em8bitChannel=3;this.legacyType="mod_em_8bit"};util.inherits(ca,p);ca.prototype._getReadableDpts=
function(){var e=[],c=this,a=x.hub.m.hm._Channel["BidCos-RF"];e.push({channel:this.deviceAdr+":0",dpt:"UNREACH"});var b=a.KEY.getReadableDpts();b&&b.forEach(function(f){e.push({channel:c.deviceAdr+":1",dpt:f});e.push({channel:c.deviceAdr+":2",dpt:f})});(b=a.MOD_EM8BIT_TRANSMITTER.getReadableDpts())&&b.forEach(function(f){e.push({channel:c.deviceAdr+":3",dpt:f})});return e};ca.prototype._getDptFromRef=function(e){var c=this.deviceAdr,a={channel:c+":"+this.channel,dataPoint:null};switch(e){case "timeout":a.channel=
c+":0";a.dataPoint="UNREACH";break;case "lowbat":a.channel=c+":3";a.dataPoint="LOWBAT";break;case "state8bit":a.channel=c+":3";a.dataPoint="STATE";break;default:return null}return a};ca.prototype.executeCommand=function(e,c,a){var b=x.hub.m.hm._Channel["BidCos-RF"];switch(c){case "ch1pressShort":c=this.deviceAdr+":"+this.keyChannel1;b.KEY.executeCommand(e,this.deviceIF,c,"pressShort",a);break;case "ch1pressLong":c=this.deviceAdr+":"+this.keyChannel1;b.KEY.executeCommand(e,this.deviceIF,c,"pressLong",
a);break;case "ch2pressShort":c=this.deviceAdr+":"+this.keyChannel2;b.KEY.executeCommand(e,this.deviceIF,c,"pressShort",a);break;case "ch2pressLong":c=this.deviceAdr+":"+this.keyChannel2;b.KEY.executeCommand(e,this.deviceIF,c,"pressLong",a);break;default:a&&a(Error("no such command"))}};ca.prototype.parseDptState=function(e,c,a){var b=e.indexOf(":");if(-1==b)return null;var f=e.substr(0,b);e=e.substr(b+1);var l=this.deviceAdr;b=this.deviceAdr.indexOf(":");-1!=b&&(l=this.deviceAdr.substr(0,b));if(f!=
l)return null;f=x.hub.m.hm._Channel["BidCos-RF"];b=null;if(0==e){if("UNREACH"==c)return{timeout:a};b={};b["0_"+c.toLowerCase()]=a;return b}if(e==this.keyChannel1){if(c=f.KEY.parseDptState(c,a))b={},c.pressShort&&(b.ch1pressShort=!0),c.pressLong&&(b.ch1pressLong=!0),"undefined"!=typeof c.pressCont&&null!=c.pressCont&&(b.ch1pressCont=!0),c.pressLongRel&&(b.ch1pressLongRel=!0);return b}if(e==this.keyChannel2){if(c=f.KEY.parseDptState(c,a))b={},c.pressShort&&(b.ch2pressShort=!0),c.pressLong&&(b.ch2pressLong=
!0),"undefined"!=typeof c.pressCont&&null!=c.pressCont&&(b.ch2pressCont=!0),c.pressLongRel&&(b.ch2pressLongRel=!0);return b}return e==this.em8bitChannel?f.MOD_EM8BIT_TRANSMITTER.parseDptState(c,a):null};ca.prototype.isButton=function(){return!0};ca.prototype.claimEvent=function(e,c){var a=this.deviceAdr;-1==a.indexOf(":")&&this.channel&&(a+=":"+this.channel);var b=this;e.reportValueUsage(this.deviceIF,a+":1","PRESS_SHORT",function(f,l){f&&console.error("button claim PRESS_SHORT event error:"+f.stack);
e.reportValueUsage(b.deviceIF,a+":1","PRESS_LONG",function(t,u){t&&console.error("button claim PRESS_LONG event error:"+t.stack);e.reportValueUsage(b.deviceIF,a+":2","PRESS_SHORT",function(y,A){y&&console.error("button claim PRESS_SHORT event error:"+y.stack);e.reportValueUsage(b.deviceIF,a+":2","PRESS_LONG",function(B,C){c&&c()})})})})};var da=function(e,c,a){p.call(this,e,c,a);this.channel=1;this.legacyType="mod_em_8"};util.inherits(da,p);da.prototype._getReadableDpts=function(){var e=[],c=this,
a=x.hub.m.hm._Channel["BidCos-RF"],b=a.KEY.getReadableDpts();b&&b.forEach(function(f){e.push({channel:c.deviceAdr+":"+c.channel,dpt:f})});(b=a.SWITCH_INTERFACE.getReadableDpts())&&b.forEach(function(f){e.push({channel:c.deviceAdr+":"+c.channel,dpt:f})});(b=a.SHUTTER_CONTACT.getReadableDpts())&&b.forEach(function(f){"ERROR"!=f&&e.push({channel:c.deviceAdr+":"+c.channel,dpt:f})});return e};da.prototype._getDptFromRef=function(e){var c={channel:this.deviceAdr+":"+this.channel,dataPoint:null};switch(e){case "state":c.dataPoint=
"STATE";break;case "lowbat":c.dataPoint="LOWBAT";break;default:return null}return c};da.prototype.executeCommand=function(e,c,a){var b=x.hub.m.hm._Channel["BidCos-RF"],f=this.deviceAdr+":"+this.channel;switch(c){case "pressShort":b.KEY.executeCommand(e,this.deviceIF,f,"pressShort",a);break;case "pressLong":b.KEY.executeCommand(e,this.deviceIF,f,"pressLong",a);break;case "press":b.SWITCH_INTERFACE.executeCommand(e,this.deviceIF,f,"press",a);break;default:a&&a(Error("no such command"))}};da.prototype.parseDptState=
function(e,c,a){var b=e.indexOf(":");if(-1==b)return null;var f=e.substr(0,b);e=e.substr(b+1);var l=this.deviceAdr;b=this.deviceAdr.indexOf(":");-1!=b&&(l=this.deviceAdr.substr(0,b));if(f!=l)return null;b=x.hub.m.hm._Channel["BidCos-RF"];f=null;if(e==this.channel){f={};if(e=b.KEY.parseDptState(c,a))e.pressShort&&(f.pressShort=!0),e.pressLong&&(f.pressLong=!0),"undefined"!=typeof e.pressCont&&null!=e.pressCont&&(f.pressCont=!0),e.pressLongRel&&(f.pressCont=!0);(e=b.SWITCH_INTERFACE.parseDptState(c,
a))&&e.press&&(f.press=!0);if(e=b.SHUTTER_CONTACT.parseDptState(c,a))e.state&&(f.state=e.state),"undefined"!=typeof e.lowbat&&null!=e.lowbat&&(f.lowbat=e.lowbat)}return f};da.prototype.isButton=function(){return!0};da.prototype.claimEvent=function(e,c){var a=this.deviceAdr;-1==a.indexOf(":")&&this.channel&&(a+=":"+this.channel);var b=this;e.reportValueUsage(this.deviceIF,a,"PRESS_SHORT",function(f,l){f&&console.error("button claim PRESS_SHORT event error:"+f.stack);e.reportValueUsage(b.deviceIF,a,
"PRESS_LONG",function(t,u){t&&console.error("button claim PRESS_LONG event error:"+t.stack);e.reportValueUsage(b.deviceIF,a,"PRESS",function(y,A){y&&console.error("button claim PRESS_SHORT event error:"+y.stack);c&&c()})})})};var wa=function(e,c,a){p.call(this,e,c,a);this.channel=1;this.legacyType="keymatic"};util.inherits(wa,p);wa.prototype._getReadableDpts=function(){var e=[],c=this,a=x.hub.m.hm._Channel["BidCos-RF"],b=a.MAINTENANCE.getReadableDpts();b&&b.forEach(function(f){e.push({channel:c.deviceAdr+
":0",dpt:f})});(b=a.KEYMATIC.getReadableDpts())&&b.forEach(function(f){e.push({channel:c.deviceAdr+":1",dpt:f})});return e};wa.prototype._getDptFromRef=function(e){var c=this.deviceAdr,a={channel:c+":"+this.channel,dataPoint:null};switch(e){case "timeout":a.channel=c+":0";a.dataPoint="UNREACH";break;case "lowbat":a.channel=c+":0";a.dataPoint="LOWBAT";break;case "state":a.channel=c+":1";a.dataPoint="STATE";break;case "uncertain":a.channel=c+":1";a.dataPoint="STATE_UNCERTAIN";break;case "error":a.channel=
c+":1";a.dataPoint="ERROR";break;default:return null}return a};wa.prototype.executeCommand=function(e,c,a){var b=x.hub.m.hm._Channel["BidCos-RF"];switch(c){case "open":c=this.deviceAdr+":"+this.channel;b.KEYMATIC.executeCommand(e,this.deviceIF,c,"open",a);break;case "close":c=this.deviceAdr+":"+this.channel;b.KEYMATIC.executeCommand(e,this.deviceIF,c,"close",a);break;case "openDoor":c=this.deviceAdr+":"+this.channel;b.KEYMATIC.executeCommand(e,this.deviceIF,c,"openDoor",a);break;default:a&&a(Error("no such command"))}};
wa.prototype.parseDptState=function(e,c,a){var b=e.indexOf(":");if(-1==b)return null;var f=e.substr(0,b);e=e.substr(b+1);var l=this.deviceAdr;b=this.deviceAdr.indexOf(":");-1!=b&&(l=this.deviceAdr.substr(0,b));if(f!=l)return null;b=x.hub.m.hm._Channel["BidCos-RF"];if(0==e){if("UNREACH"==c||"LOWBAT"==c)return b.MAINTENANCE.parseDptState(c,a);b={};b["0_"+c.toLowerCase()]=a;return b}return e==this.channel?c=b.KEYMATIC.parseDptState(c,a):null};var ea=function(e,c,a){p.call(this,e,c,a);this.channel=1;
this.legacyType="ou_led16"};util.inherits(ea,p);ea.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":"+this.channel,dpt:"LED_STATUS"}]};ea.prototype._getDptFromRef=function(e){var c=this.deviceAdr;-1==c.indexOf(":")&&this.channel&&(c+=":"+this.channel);c={channel:c,dataPoint:null};switch(e){case "led":c.dataPoint="LED_STATUS";break;default:return null}return c};ea.prototype.parseDptState=function(e,c,a){var b=e.indexOf(":");if(-1==b)return null;var f=e.substr(0,b);e=e.substr(b+
1);var l=this.deviceAdr;b=this.deviceAdr.indexOf(":");-1!=b&&(l=this.deviceAdr.substr(0,b));if(f!=l||0!=e&&e!=this.channel)return null;if(0==e)return b={},"UNREACH"==c?b.timeout=a:"LOWBAT"==c?b.lowbat=a:b["0_"+c.toLowerCase()]=a,b;switch(c){case "LED_STATUS":switch(a){case 0:return{led:"off"};case 1:return{led:"red"};case 2:return{led:"green"};case 3:return{led:"orange"};default:return null}default:return null}};ea.prototype.executeCommand=function(e,c,a){var b=this.deviceAdr;-1==b.indexOf(":")&&
this.channel&&(b+=":"+this.channel);switch(c){case "pressShort":e.writeValue(this.deviceIF,b,"PRESS_SHORT",!0,a);break;case "ledOff":e.writeValue(this.deviceIF,b,"LED_STATUS",0,a);break;case "ledRed":e.writeValue(this.deviceIF,b,"LED_STATUS",1,a);break;case "ledGreen":e.writeValue(this.deviceIF,b,"LED_STATUS",2,a);break;case "ledOrange":e.writeValue(this.deviceIF,b,"LED_STATUS",3,a);break;case "ledSleepOff":e.writeValue(this.deviceIF,b,"LED_SLEEP_MODE",0,a);break;case "ledSleepOn":e.writeValue(this.deviceIF,
b,"LED_SLEEP_MODE",1,a);break;default:a&&a(Error("no such command"))}};ea.prototype.isButton=function(){return!0};ea.prototype.claimEvent=function(e,c){var a=this.deviceAdr;-1==a.indexOf(":")&&this.channel&&(a+=":"+this.channel);e.reportValueUsage(this.deviceIF,a,"PRESS_SHORT",function(b,f){b&&console.error("button claim PRESS_SHORT event error:"+b.stack);c&&c()})};var hb=function(e,c,a){p.call(this,e,c,a);this.channel=3;this.legacyType="hm_dis_ep_wm55"};util.inherits(hb,p);hb.prototype.executeCommand=
function(e,c,a){if("submit"==c.substr(0,6)){var b=c.substr(6);c=this.deviceAdr+":"+this.channel;e.writeValue(this.deviceIF,c,"SUBMIT",b,a)}else a&&a(Error("no such command"))};var xa=function(e,c,a){p.call(this,e,c,a);this.channel=1;this.legacyType="dualwhite"};util.inherits(xa,p);xa.prototype._getReadableDpts=function(){var e=[],c=this,a=x.hub.m.hm._Channel["BidCos-RF"],b=a.MAINTENANCE.getReadableDpts();b&&b.forEach(function(f){"UNREACH"==f&&e.push({channel:c.deviceAdr+":0",dpt:f})});(b=a.DUAL_WHITE_BRIGHTNESS.getReadableDpts())&&
b.forEach(function(f){e.push({channel:c.deviceAdr+":1",dpt:f})});(b=a.DUAL_WHITE_COLOR.getReadableDpts())&&b.forEach(function(f){e.push({channel:c.deviceAdr+":2",dpt:f})});return e};xa.prototype._getDptFromRef=function(e){var c=this.deviceAdr,a={channel:c+":"+this.channel,dataPoint:null},b=x.hub.m.hm._Channel["BidCos-RF"];switch(e){case "timeout":a.channel=c+":0";a.dataPoint=b.MAINTENANCE.getDptFromState(e);break;case "bri":case "bri_real":case "error_overheat":case "error_reduced":case "direction":a.channel=
c+":1";a.dataPoint=b.DUAL_WHITE_BRIGHTNESS.getDptFromState(e);break;case "color":case "color_real":case "color_direction":a.channel=c+":2";a.dataPoint=b.DIMMER_VIRTUAL_RECEIVER.getDptFromState(e);break;default:return null}return a};xa.prototype.executeCommand=function(e,c,a){var b=x.hub.m.hm._Channel["BidCos-RF"];switch(c){case "off":case "on":case "toggle":case "dimUp":case "dimDown":b.DUAL_WHITE_BRIGHTNESS.executeCommand(e,this.deviceIF,this.deviceAdr+":1",c,a);break;case "colorOff":case "colorOn":case "colorToggle":case "colorUp":case "colorDown":b.DUAL_WHITE_COLOR.executeCommand(e,
this.deviceIF,this.deviceAdr+":2",c,a);break;default:"dimTo"==c.substr(0,5)?b.DUAL_WHITE_BRIGHTNESS.executeCommand(e,this.deviceIF,this.deviceAdr+":1",c,a):"colorTo"==c.substr(0,7)?b.DUAL_WHITE_COLOR.executeCommand(e,this.deviceIF,this.deviceAdr+":2",c,a):a&&a(Error("no such command"))}};xa.prototype.parseDptState=function(e,c,a){var b=e.indexOf(":");if(-1==b)return null;var f=e.substr(0,b);e=e.substr(b+1);var l=this.deviceAdr;b=this.deviceAdr.indexOf(":");-1!=b&&(l=this.deviceAdr.substr(0,b));if(f!=
l)return null;b=x.hub.m.hm._Channel["BidCos-RF"];if(0==e){if("UNREACH"==c)return b.MAINTENANCE.parseDptState(c,a);b={};b["0_"+c.toLowerCase()]=a;return b}return 1==e?b.DUAL_WHITE_BRIGHTNESS.parseDptState(c,a):2==e?b.DUAL_WHITE_COLOR.parseDptState(c,a):null};var jb=function(e,c,a){g.call(this,e,c,a);this.channel=3;this.legacyType="ip_switch"};util.inherits(jb,g);var Va=function(e,c,a){p.call(this,e,c,a);this.channel=1;this.legacyType="ip_contact"};util.inherits(Va,p);Va.prototype._getReadableDpts=
function(){var e=[],c=this,a=x.hub.m.hm._Channel["HmIP-RF"],b=a.MAINTENANCE_BAT_EL.getReadableDpts();b&&b.forEach(function(f){e.push({channel:c.deviceAdr+":0",dpt:f})});(b=a.SHUTTER_CONTACT_TRANSCEIVER.getReadableDpts())&&b.forEach(function(f){e.push({channel:c.deviceAdr+":1",dpt:f})});return e};Va.prototype._getDptFromRef=function(e){var c=this.deviceAdr,a={channel:c+":"+this.channel,dataPoint:null},b=x.hub.m.hm._Channel["HmIP-RF"];switch(e){case "timeout":case "lowbat":case "sabotage":a.channel=
c+":0";a.dataPoint=b.MAINTENANCE_BAT_EL.getDptFromState(e);break;case "state":a.channel=c+":1";a.dataPoint=b.SHUTTER_CONTACT_TRANSCEIVER.getDptFromState(e);break;default:return null}return a};Va.prototype.parseDptState=function(e,c,a){var b=e.indexOf(":");if(-1==b)return null;var f=e.substr(0,b);e=e.substr(b+1);var l=this.deviceAdr;b=this.deviceAdr.indexOf(":");-1!=b&&(l=this.deviceAdr.substr(0,b));if(f!=l)return null;b=x.hub.m.hm._Channel["HmIP-RF"];if(0==e){if("UNREACH"==c||"LOW_BAT"==c||"SABOTAGE"==
c)return b.MAINTENANCE_BAT_EL.parseDptState(c,a);b={};b["0_"+c.toLowerCase()]=a;return b}return 1==e?b.SHUTTER_CONTACT_TRANSCEIVER.parseDptState(c,a):null};var ya=function(e,c,a){p.call(this,e,c,a);this.channel=1;this.legacyType="ip_heater"};util.inherits(ya,p);ya.prototype._getReadableDpts=function(){var e=[],c=this,a=x.hub.m.hm._Channel["HmIP-RF"],b=a.MAINTENANCE_BAT_EL.getReadableDpts();b&&b.forEach(function(f){"SABOTAGE"!=f&&e.push({channel:c.deviceAdr+":0",dpt:f})});(b=a.HEATING_CLIMATECONTROL_TRANSCEIVER.getReadableDpts())&&
b.forEach(function(f){"HUMIDITY"!=f&&e.push({channel:c.deviceAdr+":1",dpt:f})});return e};ya.prototype._getDptFromRef=function(e){var c=this.deviceAdr,a={channel:c+":"+this.channel,dataPoint:null},b=x.hub.m.hm._Channel["HmIP-RF"];switch(e){case "timeout":case "lowbat":a.channel=c+":0";a.dataPoint=b.MAINTENANCE_BAT_EL.getDptFromState(e);break;case "profile":case "temp":case "boost":case "frost":case "mode":case "state":case "window":a.channel=c+":1";a.dataPoint=b.HEATING_CLIMATECONTROL_TRANSCEIVER.getDptFromState(e);
break;default:return null}return a};ya.prototype.executeCommand=function(e,c,a){x.hub.m.hm._Channel["HmIP-RF"].HEATING_CLIMATECONTROL_TRANSCEIVER.executeCommand(e,this.deviceIF,this.deviceAdr+":"+this.channel,c,a)};ya.prototype.parseDptState=function(e,c,a){var b=e.indexOf(":");if(-1==b)return null;var f=e.substr(0,b);e=e.substr(b+1);var l=this.deviceAdr;b=this.deviceAdr.indexOf(":");-1!=b&&(l=this.deviceAdr.substr(0,b));if(f!=l)return null;b=x.hub.m.hm._Channel["HmIP-RF"];f=null;if(0==e){if("UNREACH"==
c||"LOW_BAT"==c)return b.MAINTENANCE.parseDptState(c,a);f={};f["0_"+c.toLowerCase()]=a;return f}return 1==e?b.HEATING_CLIMATECONTROL_TRANSCEIVER.parseDptState(c,a):f};var za=function(e,c,a){p.call(this,e,c,a);this.channel=1;this.legacyType="ip_powerswitch"};util.inherits(za,p);za.prototype._getReadableDpts=function(){var e=[],c=this,a=x.hub.m.hm._Channel["HmIP-RF"],b=a.MAINTENANCE.getReadableDpts();b&&b.forEach(function(f){"UNREACH"==f&&e.push({channel:c.deviceAdr+":0",dpt:f})});(b=a.SWITCH_VIRTUAL_RECEIVER.getReadableDpts())&&
b.forEach(function(f){e.push({channel:c.deviceAdr+":3",dpt:f})});(b=a.ENERGIE_METER_TRANSMITTER.getReadableDpts())&&b.forEach(function(f){e.push({channel:c.deviceAdr+":6",dpt:f})});return e};za.prototype._getDptFromRef=function(e){var c=this.deviceAdr,a={channel:c+":"+this.channel,dataPoint:null},b=x.hub.m.hm._Channel["HmIP-RF"];switch(e){case "timeout":a.channel=c+":0";a.dataPoint=b.MAINTENANCE.getDptFromState(e);break;case "switchState":a.channel=c+":3";a.dataPoint=b.SWITCH_VIRTUAL_RECEIVER.getDptFromState("switchState");
break;case "meterVoltage":case "meterEnergyCounter":case "meterFrequency":case "meterPower":case "meterCurrent":a.channel=c+":6";a.dataPoint=b.ENERGIE_METER_TRANSMITTER.getDptFromState(e);break;default:return null}return a};za.prototype.executeCommand=function(e,c,a){var b=x.hub.m.hm._Channel["HmIP-RF"];switch(c){case "on":var f=this.deviceAdr+":3";b.SWITCH_VIRTUAL_RECEIVER.executeCommand(e,this.deviceIF,f,"on",a);break;case "off":f=this.deviceAdr+":3";b.SWITCH_VIRTUAL_RECEIVER.executeCommand(e,this.deviceIF,
f,"off",a);break;case "toggle":f=this.deviceAdr+":3";b.SWITCH_VIRTUAL_RECEIVER.executeCommand(e,this.deviceIF,f,"toggle",a);break;default:"onFor"==c.substr(0,5)?(f=this.deviceAdr+":3",b.SWITCH_VIRTUAL_RECEIVER.executeCommand(e,this.deviceIF,f,c,a)):a&&a(Error("no such command"))}};za.prototype.parseDptState=function(e,c,a){var b=e.indexOf(":");if(-1==b)return null;var f=e.substr(0,b);e=e.substr(b+1);var l=this.deviceAdr;b=this.deviceAdr.indexOf(":");-1!=b&&(l=this.deviceAdr.substr(0,b));if(f!=l)return null;
b=x.hub.m.hm._Channel["HmIP-RF"];if(0==e){if("UNREACH"==c)return b.MAINTENANCE.parseDptState(c,a);b={};b["0_"+c.toLowerCase()]=a;return b}return 3==e?b.SWITCH_VIRTUAL_RECEIVER.parseDptState(c,a):6==e?b.ENERGIE_METER_TRANSMITTER.parseDptState(c,a):null};var X=function(e,c,a){p.call(this,e,c,a);this.channel=1;this._chKeyTransceivers=[];"HmIP-BSM"==e&&(this._chKeyTransceivers=[1,2]);this.legacyType="ip_energyactor"};util.inherits(X,p);X.prototype._getReadableDpts=function(){var e=[],c=this,a=x.hub.m.hm._Channel["HmIP-RF"],
b=a.MAINTENANCE.getReadableDpts();b&&b.forEach(function(f){"UNREACH"==f&&e.push({channel:c.deviceAdr+":0",dpt:f})});(b=a.SWITCH_TRANSMITTER.getReadableDpts())&&b.forEach(function(f){e.push({channel:c.deviceAdr+":3",dpt:f})});(b=a.SWITCH_VIRTUAL_RECEIVER.getReadableDpts())&&b.forEach(function(f){e.push({channel:c.deviceAdr+":4",dpt:f});e.push({channel:c.deviceAdr+":5",dpt:f});e.push({channel:c.deviceAdr+":6",dpt:f})});(b=a.ENERGIE_METER_TRANSMITTER.getReadableDpts())&&b.forEach(function(f){e.push({channel:c.deviceAdr+
":7",dpt:f})});return e};X.prototype._getDptFromRef=function(e){var c=this.deviceAdr,a={channel:c+":"+this.channel,dataPoint:null},b=x.hub.m.hm._Channel["HmIP-RF"];switch(e){case "timeout":a.channel=c+":0";a.dataPoint=b.MAINTENANCE.getDptFromState(e);break;case "switchState":a.channel=c+":3";a.dataPoint=b.SWITCH_TRANSMITTER.getDptFromState("switchTState");break;case "ch4State":a.channel=c+":4";a.dataPoint=b.SWITCH_VIRTUAL_RECEIVER.getDptFromState("switchState");break;case "ch5State":a.channel=c+":5";
a.dataPoint=b.SWITCH_VIRTUAL_RECEIVER.getDptFromState("switchState");break;case "ch6State":a.channel=c+":6";a.dataPoint=b.SWITCH_VIRTUAL_RECEIVER.getDptFromState("switchState");break;case "meterVoltage":case "meterEnergyCounter":case "meterFrequency":case "meterPower":case "meterCurrent":a.channel=c+":7";a.dataPoint=b.ENERGIE_METER_TRANSMITTER.getDptFromState(e);break;default:return null}return a};X.prototype.executeCommand=function(e,c,a){var b=null,f=x.hub.m.hm._Channel["HmIP-RF"];switch(c){case "on":case "ch4on":case "ch5on":case "ch6on":switch(c){case "on":case "ch4on":b=
this.deviceAdr+":4";break;case "ch5on":b=this.deviceAdr+":5";break;case "ch6on":b=this.deviceAdr+":6"}f.SWITCH_VIRTUAL_RECEIVER.executeCommand(e,this.deviceIF,b,"on",a);break;case "off":case "ch4off":case "ch5off":case "ch6off":switch(c){case "off":case "ch4off":b=this.deviceAdr+":4";break;case "ch5off":b=this.deviceAdr+":5";break;case "ch6off":b=this.deviceAdr+":6"}f.SWITCH_VIRTUAL_RECEIVER.executeCommand(e,this.deviceIF,b,"off",a);break;case "toggle":case "ch4toggle":case "ch5toggle":case "ch6toggle":switch(c){case "toggle":case "ch4toggle":b=
this.deviceAdr+":4";break;case "ch5toggle":b=this.deviceAdr+":5";break;case "ch6toggle":b=this.deviceAdr+":6"}f.SWITCH_VIRTUAL_RECEIVER.executeCommand(e,this.deviceIF,b,"toggle",a);break;default:a&&a(Error("no such command"))}};X.prototype.parseDptState=function(e,c,a){var b=e.indexOf(":");if(-1==b)return null;var f=e.substr(0,b);e=e.substr(b+1);var l=this.deviceAdr;b=this.deviceAdr.indexOf(":");-1!=b&&(l=this.deviceAdr.substr(0,b));if(f!=l)return null;f=x.hub.m.hm._Channel["HmIP-RF"];b=null;if(0==
e){if("UNREACH"==c)return f.MAINTENANCE.parseDptState(c,a);b={};b["0_"+c.toLowerCase()]=a;return b}if(3==e){if(c=f.SWITCH_TRANSMITTER.parseDptState(c,a))b={},b.switchState=c.switchTState;return b}if(4==e||5==e||6==e){if(c=f.SWITCH_VIRTUAL_RECEIVER.parseDptState(c,a))switch(b={},parseInt(e)){case 4:b.ch4State=c.switchState;break;case 5:b.ch5State=c.switchState;break;case 6:b.ch6State=c.switchState}return b}return 7==e?f.ENERGIE_METER_TRANSMITTER.parseDptState(c,a):null};X.prototype.isButton=function(){return 0<
this._chKeyTransceivers.length};X.prototype.claimEvent=function(e,c){var a=0,b=this,f=function(){a++;a<b._chKeyTransceivers.length?b._claimButtonEvent(b._chKeyTransceivers[a],e,f):c&&c()};this._claimButtonEvent(this._chKeyTransceivers[a],e,f)};X.prototype._claimButtonEvent=function(e,c,a){var b=this;c.reportValueUsage(this.deviceIF,this.deviceAdr+":"+e,"PRESS_SHORT",function(f,l){f&&console.error("button:"+e+" claim PRESS_SHORT event error:"+f.stack);c.reportValueUsage(b.deviceIF,b.deviceAdr+":"+
e,"PRESS_LONG",function(t,u){t&&console.error("button:"+e+" claim PRESS_LONG event error:"+t.stack);a&&a()})})};var Aa=function(e,c,a){p.call(this,e,c,a);this.channel=1;this.legacyType="ip_energyactor2"};util.inherits(Aa,p);Aa.prototype._getReadableDpts=function(){var e=[],c=this,a=x.hub.m.hm._Channel["HmIP-RF"],b=a.MAINTENANCE.getReadableDpts();b&&b.forEach(function(f){"UNREACH"==f&&e.push({channel:c.deviceAdr+":0",dpt:f})});(b=a.SWITCH_TRANSMITTER.getReadableDpts())&&b.forEach(function(f){e.push({channel:c.deviceAdr+
":1",dpt:f})});(b=a.SWITCH_VIRTUAL_RECEIVER.getReadableDpts())&&b.forEach(function(f){e.push({channel:c.deviceAdr+":2",dpt:f});e.push({channel:c.deviceAdr+":3",dpt:f});e.push({channel:c.deviceAdr+":4",dpt:f})});(b=a.ENERGIE_METER_TRANSMITTER.getReadableDpts())&&b.forEach(function(f){e.push({channel:c.deviceAdr+":5",dpt:f})});return e};Aa.prototype._getDptFromRef=function(e){var c=this.deviceAdr,a={channel:c+":"+this.channel,dataPoint:null},b=x.hub.m.hm._Channel["HmIP-RF"];switch(e){case "timeout":a.channel=
c+":0";a.dataPoint=b.MAINTENANCE.getDptFromState(e);break;case "switchState":a.channel=c+":1";a.dataPoint=b.SWITCH_TRANSMITTER.getDptFromState("switchTState");break;case "ch2State":a.channel=c+":2";a.dataPoint=b.SWITCH_VIRTUAL_RECEIVER.getDptFromState("switchState");break;case "ch3State":a.channel=c+":3";a.dataPoint=b.SWITCH_VIRTUAL_RECEIVER.getDptFromState("switchState");break;case "ch4State":a.channel=c+":4";a.dataPoint=b.SWITCH_VIRTUAL_RECEIVER.getDptFromState("switchState");break;case "meterVoltage":case "meterEnergyCounter":case "meterFrequency":case "meterPower":case "meterCurrent":a.channel=
c+":5";a.dataPoint=b.ENERGIE_METER_TRANSMITTER.getDptFromState(e);break;default:return null}return a};Aa.prototype.executeCommand=function(e,c,a){var b=null,f=x.hub.m.hm._Channel["HmIP-RF"];switch(c){case "on":case "ch2on":case "ch3on":case "ch4on":switch(c){case "on":case "ch2on":b=this.deviceAdr+":2";break;case "ch3on":b=this.deviceAdr+":3";break;case "ch4on":b=this.deviceAdr+":4"}f.SWITCH_VIRTUAL_RECEIVER.executeCommand(e,this.deviceIF,b,"on",a);break;case "off":case "ch2off":case "ch3off":case "ch4off":switch(c){case "off":case "ch2off":b=
this.deviceAdr+":2";break;case "ch3off":b=this.deviceAdr+":3";break;case "ch4off":b=this.deviceAdr+":4"}f.SWITCH_VIRTUAL_RECEIVER.executeCommand(e,this.deviceIF,b,"off",a);break;case "toggle":case "ch2toggle":case "ch3toggle":case "ch4toggle":switch(c){case "toggle":case "ch2toggle":b=this.deviceAdr+":2";break;case "ch3toggle":b=this.deviceAdr+":3";break;case "ch4toggle":b=this.deviceAdr+":4"}f.SWITCH_VIRTUAL_RECEIVER.executeCommand(e,this.deviceIF,b,"toggle",a);break;default:a&&a(Error("no such command"))}};
Aa.prototype.parseDptState=function(e,c,a){var b=e.indexOf(":");if(-1==b)return null;var f=e.substr(0,b);e=e.substr(b+1);var l=this.deviceAdr;b=this.deviceAdr.indexOf(":");-1!=b&&(l=this.deviceAdr.substr(0,b));if(f!=l)return null;f=x.hub.m.hm._Channel["HmIP-RF"];b=null;if(0==e){if("UNREACH"==c)return f.MAINTENANCE.parseDptState(c,a);b={};b["0_"+c.toLowerCase()]=a;return b}if(1==e){if(c=f.SWITCH_TRANSMITTER.parseDptState(c,a))b={},b.switchState=c.switchTState;return b}if(2==e||3==e||4==e){if(c=f.SWITCH_VIRTUAL_RECEIVER.parseDptState(c,
a))switch(b={},parseInt(e)){case 2:b.ch2State=c.switchState;break;case 3:b.ch3State=c.switchState;break;case 4:b.ch4State=c.switchState}return b}return 5==e?f.ENERGIE_METER_TRANSMITTER.parseDptState(c,a):null};var Ba=function(e,c,a){p.call(this,e,c,a);this.channel=1;this.legacyType="ip_dimmer"};util.inherits(Ba,p);Ba.prototype._getReadableDpts=function(){var e=[],c=this,a=x.hub.m.hm._Channel["HmIP-RF"],b=a.MAINTENANCE.getReadableDpts();b&&b.forEach(function(f){"UNREACH"==f&&e.push({channel:c.deviceAdr+
":0",dpt:f})});(b=a.DIMMER_TRANSMITTER.getReadableDpts())&&b.forEach(function(f){e.push({channel:c.deviceAdr+":3",dpt:f})});(b=a.DIMMER_VIRTUAL_RECEIVER.getReadableDpts())&&b.forEach(function(f){e.push({channel:c.deviceAdr+":4",dpt:f});e.push({channel:c.deviceAdr+":5",dpt:f});e.push({channel:c.deviceAdr+":6",dpt:f})});return e};Ba.prototype._getDptFromRef=function(e){var c=this.deviceAdr,a={channel:c+":"+this.channel,dataPoint:null},b=x.hub.m.hm._Channel["HmIP-RF"];switch(e){case "timeout":a.channel=
c+":0";a.dataPoint=b.MAINTENANCE.getDptFromState(e);break;case "dimmerLevel":a.channel=c+":3";a.dataPoint=b.DIMMER_TRANSMITTER.getDptFromState("dimmerTLevel");break;case "ch4Level":a.channel=c+":4";a.dataPoint=b.DIMMER_VIRTUAL_RECEIVER.getDptFromState("dimmerLevel");break;case "ch5Level":a.channel=c+":5";a.dataPoint=b.DIMMER_VIRTUAL_RECEIVER.getDptFromState("dimmerLevel");break;case "ch6Level":a.channel=c+":6";a.dataPoint=b.DIMMER_VIRTUAL_RECEIVER.getDptFromState("dimmerLevel");break;default:return null}return a};
Ba.prototype.executeCommand=function(e,c,a){var b=null,f=x.hub.m.hm._Channel["HmIP-RF"],l=c;if(-1!=c.indexOf("dimUp")){var t=c.indexOf("dimUp");l=c.substr(0,t+5);var u=c.substr(t+5)}else-1!=c.indexOf("dimDown")?(t=c.indexOf("dimDown"),l=c.substr(0,t+7),u=c.substr(t+7)):-1!=c.indexOf("dimTo")?(t=c.indexOf("dimTo"),l=c.substr(0,t+5),u=c.substr(t+5)):-1!=c.indexOf("toggleTo")&&(t=c.indexOf("toggleTo"),l=c.substr(0,t+8),u=c.substr(t+8));var y=this;switch(l){case "dimOff":f.DIMMER_VIRTUAL_RECEIVER.executeCommand(e,
this.deviceIF,this.deviceAdr+":4","dimOff",function(A,B){A?a&&a(A,B):f.DIMMER_VIRTUAL_RECEIVER.executeCommand(e,y.deviceIF,y.deviceAdr+":5","dimOff",function(C,G){C?a&&a(C,G):f.DIMMER_VIRTUAL_RECEIVER.executeCommand(e,y.deviceIF,y.deviceAdr+":6","dimOff",a)})});break;case "dimUp":u=u?parseInt(u)/100:.1;e.getState({interface:this.deviceIF,channel:this.deviceAdr+":3",datapoint:"LEVEL"},function(A,B){A?a&&a(A):"undefined"==typeof B||null==B?a&&a(Error("get dimmer current value return invalid")):(u=B.value+
u,1<u&&(u=1),u=Math.round(100*u),f.DIMMER_VIRTUAL_RECEIVER.executeCommand(e,y.deviceIF,y.deviceAdr+":4","dimTo"+u,function(C,G){C?a&&a(C,G):f.DIMMER_VIRTUAL_RECEIVER.executeCommand(e,y.deviceIF,y.deviceAdr+":5","dimTo"+u,function(H,F){H?a&&a(H,F):f.DIMMER_VIRTUAL_RECEIVER.executeCommand(e,y.deviceIF,y.deviceAdr+":6","dimTo"+u,a)})}))});break;case "dimDown":u=u?parseInt(u)/100:.1;e.getState({interface:this.deviceIF,channel:this.deviceAdr+":3",datapoint:"LEVEL"},function(A,B){A?a&&a(A):"undefined"==
typeof B||null==B?a&&a(Error("get dimmer current value return invalid")):(u=B.value-u,0>u&&(u=0),u=Math.round(100*u),f.DIMMER_VIRTUAL_RECEIVER.executeCommand(e,y.deviceIF,y.deviceAdr+":4","dimTo"+u,function(C,G){C?a&&a(C,G):f.DIMMER_VIRTUAL_RECEIVER.executeCommand(e,y.deviceIF,y.deviceAdr+":5","dimTo"+u,function(H,F){H?a&&a(H,F):f.DIMMER_VIRTUAL_RECEIVER.executeCommand(e,y.deviceIF,y.deviceAdr+":6","dimTo"+u,a)})}))});break;case "dimTo":if(!u){a&&a(Error("dimTo has no value"));break}f.DIMMER_VIRTUAL_RECEIVER.executeCommand(e,
this.deviceIF,this.deviceAdr+":4","dimTo"+u,function(A,B){A?a&&a(A,B):f.DIMMER_VIRTUAL_RECEIVER.executeCommand(e,y.deviceIF,y.deviceAdr+":5","dimTo"+u,function(C,G){C?a&&a(C,G):f.DIMMER_VIRTUAL_RECEIVER.executeCommand(e,y.deviceIF,y.deviceAdr+":6","dimTo"+u,function(H,F){H?a&&a(H,F):(F=u/100,1<F&&(F=1),0>F&&(F=0),e.updateStatusBuffer(y.deviceIF,y.deviceAdr+":3","LEVEL",F,(new Date).getTime()+1E3),a&&a(H))})})});break;case "toggleTo":if(!u){a&&a(Error("toggle has no value"));break}e.getState({interface:this.deviceIF,
channel:this.deviceAdr+":3",datapoint:"LEVEL"},function(A,B){A?a&&a(A):"undefined"==typeof B||null==B?a&&a(Error("get dimmer current value return invalid")):(B.value&&(u=0),f.DIMMER_VIRTUAL_RECEIVER.executeCommand(e,y.deviceIF,y.deviceAdr+":4","dimTo"+u,function(C,G){C?a&&a(C,G):f.DIMMER_VIRTUAL_RECEIVER.executeCommand(e,y.deviceIF,y.deviceAdr+":5","dimTo"+u,function(H,F){H?a&&a(H,F):f.DIMMER_VIRTUAL_RECEIVER.executeCommand(e,y.deviceIF,y.deviceAdr+":6","dimTo"+u,a)})}))});break;case "ch4dimOff":case "ch5dimOff":case "ch6dimOff":switch(l){case "ch4dimOff":b=
this.deviceAdr+":4";break;case "ch5dimOff":b=this.deviceAdr+":5";break;case "ch6dimOff":b=this.deviceAdr+":6"}f.DIMMER_VIRTUAL_RECEIVER.executeCommand(e,this.deviceIF,b,"dimOff",a);break;case "ch4dimUp":case "ch5dimUp":case "ch6dimUp":switch(l){case "ch4dimUp":b=this.deviceAdr+":4";break;case "ch5dimUp":b=this.deviceAdr+":5";break;case "ch6dimUp":b=this.deviceAdr+":6"}f.DIMMER_VIRTUAL_RECEIVER.executeCommand(e,this.deviceIF,b,"dimUp"+u,a);break;case "ch4dimDown":case "ch5dimDown":case "ch6dimDown":switch(l){case "ch4dimDown":b=
this.deviceAdr+":4";break;case "ch5dimDown":b=this.deviceAdr+":5";break;case "ch6dimDown":b=this.deviceAdr+":6"}f.DIMMER_VIRTUAL_RECEIVER.executeCommand(e,this.deviceIF,b,"dimDown"+u,a);break;case "ch4dimTo":case "ch5dimTo":case "ch6dimTo":switch(l){case "ch4dimTo":b=this.deviceAdr+":4";break;case "ch5dimTo":b=this.deviceAdr+":5";break;case "ch6dimTo":b=this.deviceAdr+":6"}f.DIMMER_VIRTUAL_RECEIVER.executeCommand(e,this.deviceIF,b,"dimTo"+u,a);break;case "ch4toggleTo":case "ch5toggleTo":case "ch6toggleTo":switch(l){case "ch4toggleTo":b=
this.deviceAdr+":4";break;case "ch5toggleTo":b=this.deviceAdr+":5";break;case "ch6toggleTo":b=this.deviceAdr+":6"}f.DIMMER_VIRTUAL_RECEIVER.executeCommand(e,this.deviceIF,b,"toggleTo"+u,a);break;default:a&&a(Error("no such command"))}};Ba.prototype.parseDptState=function(e,c,a){var b=e.indexOf(":");if(-1==b)return null;var f=e.substr(0,b);e=e.substr(b+1);var l=this.deviceAdr;b=this.deviceAdr.indexOf(":");-1!=b&&(l=this.deviceAdr.substr(0,b));if(f!=l)return null;f=x.hub.m.hm._Channel["HmIP-RF"];b=
null;if(0==e){if("UNREACH"==c)return f.MAINTENANCE.parseDptState(c,a);b={};b["0_"+c.toLowerCase()]=a;return b}if(3==e){if(c=f.DIMMER_TRANSMITTER.parseDptState(c,a))b={},b.dimmerLevel=c.dimmerTLevel;return b}if(4==e||5==e||6==e){if(c=f.DIMMER_VIRTUAL_RECEIVER.parseDptState(c,a))switch(b={},parseInt(e)){case 4:b.ch4Level=c.dimmerLevel;break;case 5:b.ch5Level=c.dimmerLevel;break;case 6:b.ch6Level=c.dimmerLevel}return b}return null};var Ca=function(e,c,a){p.call(this,e,c,a);this.channel=1;this.legacyType=
"ip_dimmer2"};util.inherits(Ca,p);Ca.prototype._getReadableDpts=function(){var e=[],c=this,a=x.hub.m.hm._Channel["HmIP-RF"],b=a.MAINTENANCE.getReadableDpts();b&&b.forEach(function(f){"UNREACH"==f&&e.push({channel:c.deviceAdr+":0",dpt:f})});(b=a.DIMMER_TRANSMITTER.getReadableDpts())&&b.forEach(function(f){e.push({channel:c.deviceAdr+":2",dpt:f})});(b=a.DIMMER_VIRTUAL_RECEIVER.getReadableDpts())&&b.forEach(function(f){e.push({channel:c.deviceAdr+":3",dpt:f});e.push({channel:c.deviceAdr+":4",dpt:f});
e.push({channel:c.deviceAdr+":5",dpt:f})});return e};Ca.prototype._getDptFromRef=function(e){var c=this.deviceAdr,a={channel:c+":"+this.channel,dataPoint:null},b=x.hub.m.hm._Channel["HmIP-RF"];switch(e){case "timeout":a.channel=c+":0";a.dataPoint=b.MAINTENANCE.getDptFromState(e);break;case "dimmerLevel":a.channel=c+":2";a.dataPoint=b.DIMMER_TRANSMITTER.getDptFromState("dimmerTLevel");break;case "ch4Level":a.channel=c+":3";a.dataPoint=b.DIMMER_VIRTUAL_RECEIVER.getDptFromState("dimmerLevel");break;
case "ch5Level":a.channel=c+":4";a.dataPoint=b.DIMMER_VIRTUAL_RECEIVER.getDptFromState("dimmerLevel");break;case "ch6Level":a.channel=c+":5";a.dataPoint=b.DIMMER_VIRTUAL_RECEIVER.getDptFromState("dimmerLevel");break;default:return null}return a};Ca.prototype.executeCommand=function(e,c,a){var b=null,f=x.hub.m.hm._Channel["HmIP-RF"],l=c;if(-1!=c.indexOf("dimUp")){var t=c.indexOf("dimUp");l=c.substr(0,t+5);var u=c.substr(t+5)}else-1!=c.indexOf("dimDown")?(t=c.indexOf("dimDown"),l=c.substr(0,t+7),u=
c.substr(t+7)):-1!=c.indexOf("dimTo")?(t=c.indexOf("dimTo"),l=c.substr(0,t+5),u=c.substr(t+5)):-1!=c.indexOf("toggleTo")&&(t=c.indexOf("toggleTo"),l=c.substr(0,t+8),u=c.substr(t+8));var y=this;switch(l){case "dimOff":f.DIMMER_VIRTUAL_RECEIVER.executeCommand(e,this.deviceIF,this.deviceAdr+":3","dimOff",function(A,B){A?a&&a(A,B):f.DIMMER_VIRTUAL_RECEIVER.executeCommand(e,y.deviceIF,y.deviceAdr+":4","dimOff",function(C,G){C?a&&a(C,G):f.DIMMER_VIRTUAL_RECEIVER.executeCommand(e,y.deviceIF,y.deviceAdr+
":5","dimOff",a)})});break;case "dimUp":u=u?parseInt(u)/100:.1;e.getState({interface:this.deviceIF,channel:this.deviceAdr+":2",datapoint:"LEVEL"},function(A,B){A?a&&a(A):"undefined"==typeof B||null==B?a&&a(Error("get dimmer current value return invalid")):(u=B.value+u,1<u&&(u=1),u=Math.round(100*u),f.DIMMER_VIRTUAL_RECEIVER.executeCommand(e,y.deviceIF,y.deviceAdr+":3","dimTo"+u,function(C,G){C?a&&a(C,G):f.DIMMER_VIRTUAL_RECEIVER.executeCommand(e,y.deviceIF,y.deviceAdr+":4","dimTo"+u,function(H,F){H?
a&&a(H,F):f.DIMMER_VIRTUAL_RECEIVER.executeCommand(e,y.deviceIF,y.deviceAdr+":5","dimTo"+u,a)})}))});break;case "dimDown":u=u?parseInt(u)/100:.1;e.getState({interface:this.deviceIF,channel:this.deviceAdr+":2",datapoint:"LEVEL"},function(A,B){A?a&&a(A):"undefined"==typeof B||null==B?a&&a(Error("get dimmer current value return invalid")):(u=B.value-u,0>u&&(u=0),u=Math.round(100*u),f.DIMMER_VIRTUAL_RECEIVER.executeCommand(e,y.deviceIF,y.deviceAdr+":3","dimTo"+u,function(C,G){C?a&&a(C,G):f.DIMMER_VIRTUAL_RECEIVER.executeCommand(e,
y.deviceIF,y.deviceAdr+":4","dimTo"+u,function(H,F){H?a&&a(H,F):f.DIMMER_VIRTUAL_RECEIVER.executeCommand(e,y.deviceIF,y.deviceAdr+":5","dimTo"+u,a)})}))});break;case "dimTo":if(!u){a&&a(Error("dimTo has no value"));break}f.DIMMER_VIRTUAL_RECEIVER.executeCommand(e,this.deviceIF,this.deviceAdr+":3","dimTo"+u,function(A,B){A?a&&a(A,B):f.DIMMER_VIRTUAL_RECEIVER.executeCommand(e,y.deviceIF,y.deviceAdr+":4","dimTo"+u,function(C,G){C?a&&a(C,G):f.DIMMER_VIRTUAL_RECEIVER.executeCommand(e,y.deviceIF,y.deviceAdr+
":5","dimTo"+u,function(H,F){H?a&&a(H,F):(F=u/100,1<F&&(F=1),0>F&&(F=0),e.updateStatusBuffer(y.deviceIF,y.deviceAdr+":2","LEVEL",F,(new Date).getTime()+1E3),a&&a(H))})})});break;case "toggleTo":if(!u){a&&a(Error("toggle has no value"));break}e.getState({interface:this.deviceIF,channel:this.deviceAdr+":2",datapoint:"LEVEL"},function(A,B){A?a&&a(A):"undefined"==typeof B||null==B?a&&a(Error("get dimmer current value return invalid")):(B.value&&(u=0),f.DIMMER_VIRTUAL_RECEIVER.executeCommand(e,y.deviceIF,
y.deviceAdr+":3","dimTo"+u,function(C,G){C?a&&a(C,G):f.DIMMER_VIRTUAL_RECEIVER.executeCommand(e,y.deviceIF,y.deviceAdr+":4","dimTo"+u,function(H,F){H?a&&a(H,F):f.DIMMER_VIRTUAL_RECEIVER.executeCommand(e,y.deviceIF,y.deviceAdr+":5","dimTo"+u,a)})}))});break;case "ch3dimOff":case "ch4dimOff":case "ch5dimOff":switch(l){case "ch3dimOff":b=this.deviceAdr+":3";break;case "ch4dimOff":b=this.deviceAdr+":4";break;case "ch5dimOff":b=this.deviceAdr+":5"}f.DIMMER_VIRTUAL_RECEIVER.executeCommand(e,this.deviceIF,
b,"dimOff",a);break;case "ch3dimUp":case "ch4dimUp":case "ch5dimUp":switch(l){case "ch3dimUp":b=this.deviceAdr+":3";break;case "ch4dimUp":b=this.deviceAdr+":4";break;case "ch5dimUp":b=this.deviceAdr+":5"}f.DIMMER_VIRTUAL_RECEIVER.executeCommand(e,this.deviceIF,b,"dimUp"+u,a);break;case "ch3dimDown":case "ch4dimDown":case "ch5dimDown":switch(l){case "ch3dimDown":b=this.deviceAdr+":3";break;case "ch4dimDown":b=this.deviceAdr+":4";break;case "ch5dimDown":b=this.deviceAdr+":5"}f.DIMMER_VIRTUAL_RECEIVER.executeCommand(e,
this.deviceIF,b,"dimDown"+u,a);break;case "ch3dimTo":case "ch4dimTo":case "ch5dimTo":switch(l){case "ch3dimTo":b=this.deviceAdr+":3";break;case "ch4dimTo":b=this.deviceAdr+":4";break;case "ch5dimTo":b=this.deviceAdr+":5"}f.DIMMER_VIRTUAL_RECEIVER.executeCommand(e,this.deviceIF,b,"dimTo"+u,a);break;case "ch3toggleTo":case "ch4toggleTo":case "ch5toggleTo":switch(l){case "ch3toggleTo":b=this.deviceAdr+":3";break;case "ch4toggleTo":b=this.deviceAdr+":4";break;case "ch5toggleTo":b=this.deviceAdr+":5"}f.DIMMER_VIRTUAL_RECEIVER.executeCommand(e,
this.deviceIF,b,"toggleTo"+u,a);break;default:a&&a(Error("no such command"))}};Ca.prototype.parseDptState=function(e,c,a){var b=e.indexOf(":");if(-1==b)return null;var f=e.substr(0,b);e=e.substr(b+1);var l=this.deviceAdr;b=this.deviceAdr.indexOf(":");-1!=b&&(l=this.deviceAdr.substr(0,b));if(f!=l)return null;f=x.hub.m.hm._Channel["HmIP-RF"];b=null;if(0==e){if("UNREACH"==c)return f.MAINTENANCE.parseDptState(c,a);b={};b["0_"+c.toLowerCase()]=a;return b}if(2==e){if(c=f.DIMMER_TRANSMITTER.parseDptState(c,
a))b={},b.dimmerLevel=c.dimmerTLevel;return b}if(3==e||4==e||5==e){if(c=f.DIMMER_VIRTUAL_RECEIVER.parseDptState(c,a))switch(b={},parseInt(e)){case 3:b.ch3Level=c.dimmerLevel;break;case 4:b.ch4Level=c.dimmerLevel;break;case 5:b.ch5Level=c.dimmerLevel}return b}return null};var Da=function(e,c,a){p.call(this,e,c,a);this.channel=1;this.legacyType="ip_dimmer3"};util.inherits(Da,p);Da.prototype._getReadableDpts=function(){var e=[],c=this,a=x.hub.m.hm._Channel["HmIP-RF"],b=a.MAINTENANCE.getReadableDpts();
b&&b.forEach(function(f){"UNREACH"==f&&e.push({channel:c.deviceAdr+":0",dpt:f})});(b=a.DIMMER_TRANSMITTER.getReadableDpts())&&b.forEach(function(f){e.push({channel:c.deviceAdr+":1",dpt:f})});(b=a.DIMMER_VIRTUAL_RECEIVER.getReadableDpts())&&b.forEach(function(f){e.push({channel:c.deviceAdr+":2",dpt:f});e.push({channel:c.deviceAdr+":3",dpt:f});e.push({channel:c.deviceAdr+":4",dpt:f})});return e};Da.prototype._getDptFromRef=function(e){var c=this.deviceAdr,a={channel:c+":"+this.channel,dataPoint:null},
b=x.hub.m.hm._Channel["HmIP-RF"];switch(e){case "timeout":a.channel=c+":0";a.dataPoint=b.MAINTENANCE.getDptFromState(e);break;case "dimmerLevel":a.channel=c+":1";a.dataPoint=b.DIMMER_TRANSMITTER.getDptFromState("dimmerTLevel");break;case "ch2Level":a.channel=c+":2";a.dataPoint=b.DIMMER_VIRTUAL_RECEIVER.getDptFromState("dimmerLevel");break;case "ch3Level":a.channel=c+":3";a.dataPoint=b.DIMMER_VIRTUAL_RECEIVER.getDptFromState("dimmerLevel");break;case "ch4Level":a.channel=c+":4";a.dataPoint=b.DIMMER_VIRTUAL_RECEIVER.getDptFromState("dimmerLevel");
break;default:return null}return a};Da.prototype.executeCommand=function(e,c,a){var b=null,f=x.hub.m.hm._Channel["HmIP-RF"],l=c;if(-1!=c.indexOf("dimUp")){var t=c.indexOf("dimUp");l=c.substr(0,t+5);var u=c.substr(t+5)}else-1!=c.indexOf("dimDown")?(t=c.indexOf("dimDown"),l=c.substr(0,t+7),u=c.substr(t+7)):-1!=c.indexOf("dimTo")?(t=c.indexOf("dimTo"),l=c.substr(0,t+5),u=c.substr(t+5)):-1!=c.indexOf("toggleTo")&&(t=c.indexOf("toggleTo"),l=c.substr(0,t+8),u=c.substr(t+8));var y=this;switch(l){case "dimOff":f.DIMMER_VIRTUAL_RECEIVER.executeCommand(e,
this.deviceIF,this.deviceAdr+":2","dimOff",function(A,B){A?a&&a(A,B):f.DIMMER_VIRTUAL_RECEIVER.executeCommand(e,y.deviceIF,y.deviceAdr+":3","dimOff",function(C,G){C?a&&a(C,G):f.DIMMER_VIRTUAL_RECEIVER.executeCommand(e,y.deviceIF,y.deviceAdr+":4","dimOff",a)})});break;case "dimUp":u=u?parseInt(u)/100:.1;e.getState({interface:this.deviceIF,channel:this.deviceAdr+":1",datapoint:"LEVEL"},function(A,B){A?a&&a(A):"undefined"==typeof B||null==B?a&&a(Error("get dimmer current value return invalid")):(u=B.value+
u,1<u&&(u=1),u=Math.round(100*u),f.DIMMER_VIRTUAL_RECEIVER.executeCommand(e,y.deviceIF,y.deviceAdr+":2","dimTo"+u,function(C,G){C?a&&a(C,G):f.DIMMER_VIRTUAL_RECEIVER.executeCommand(e,y.deviceIF,y.deviceAdr+":3","dimTo"+u,function(H,F){H?a&&a(H,F):f.DIMMER_VIRTUAL_RECEIVER.executeCommand(e,y.deviceIF,y.deviceAdr+":4","dimTo"+u,a)})}))});break;case "dimDown":u=u?parseInt(u)/100:.1;e.getState({interface:this.deviceIF,channel:this.deviceAdr+":1",datapoint:"LEVEL"},function(A,B){A?a&&a(A):"undefined"==
typeof B||null==B?a&&a(Error("get dimmer current value return invalid")):(u=B.value-u,0>u&&(u=0),u=Math.round(100*u),f.DIMMER_VIRTUAL_RECEIVER.executeCommand(e,y.deviceIF,y.deviceAdr+":2","dimTo"+u,function(C,G){C?a&&a(C,G):f.DIMMER_VIRTUAL_RECEIVER.executeCommand(e,y.deviceIF,y.deviceAdr+":3","dimTo"+u,function(H,F){H?a&&a(H,F):f.DIMMER_VIRTUAL_RECEIVER.executeCommand(e,y.deviceIF,y.deviceAdr+":4","dimTo"+u,a)})}))});break;case "dimTo":if(!u){a&&a(Error("dimTo has no value"));break}f.DIMMER_VIRTUAL_RECEIVER.executeCommand(e,
this.deviceIF,this.deviceAdr+":2","dimTo"+u,function(A,B){A?a&&a(A,B):f.DIMMER_VIRTUAL_RECEIVER.executeCommand(e,y.deviceIF,y.deviceAdr+":3","dimTo"+u,function(C,G){C?a&&a(C,G):f.DIMMER_VIRTUAL_RECEIVER.executeCommand(e,y.deviceIF,y.deviceAdr+":4","dimTo"+u,function(H,F){H?a&&a(H,F):(F=u/100,1<F&&(F=1),0>F&&(F=0),e.updateStatusBuffer(y.deviceIF,y.deviceAdr+":1","LEVEL",F,(new Date).getTime()+1E3),a&&a(H))})})});break;case "toggleTo":if(!u){a&&a(Error("toggle has no value"));break}e.getState({interface:this.deviceIF,
channel:this.deviceAdr+":1",datapoint:"LEVEL"},function(A,B){A?a&&a(A):"undefined"==typeof B||null==B?a&&a(Error("get dimmer current value return invalid")):(B.value&&(u=0),f.DIMMER_VIRTUAL_RECEIVER.executeCommand(e,y.deviceIF,y.deviceAdr+":2","dimTo"+u,function(C,G){C?a&&a(C,G):f.DIMMER_VIRTUAL_RECEIVER.executeCommand(e,y.deviceIF,y.deviceAdr+":3","dimTo"+u,function(H,F){H?a&&a(H,F):f.DIMMER_VIRTUAL_RECEIVER.executeCommand(e,y.deviceIF,y.deviceAdr+":4","dimTo"+u,a)})}))});break;case "ch2dimOff":case "ch3dimOff":case "ch4dimOff":switch(l){case "ch2dimOff":b=
this.deviceAdr+":2";break;case "ch3dimOff":b=this.deviceAdr+":3";break;case "ch4dimOff":b=this.deviceAdr+":4"}f.DIMMER_VIRTUAL_RECEIVER.executeCommand(e,this.deviceIF,b,"dimOff",a);break;case "ch2dimUp":case "ch3dimUp":case "ch4dimUp":switch(l){case "ch2dimUp":b=this.deviceAdr+":2";break;case "ch3dimUp":b=this.deviceAdr+":3";break;case "ch4dimUp":b=this.deviceAdr+":4"}f.DIMMER_VIRTUAL_RECEIVER.executeCommand(e,this.deviceIF,b,"dimUp"+u,a);break;case "ch2dimDown":case "ch3dimDown":case "ch4dimDown":switch(l){case "ch2dimDown":b=
this.deviceAdr+":2";break;case "ch3dimDown":b=this.deviceAdr+":3";break;case "ch4dimDown":b=this.deviceAdr+":4"}f.DIMMER_VIRTUAL_RECEIVER.executeCommand(e,this.deviceIF,b,"dimDown"+u,a);break;case "ch2dimTo":case "ch3dimTo":case "ch4dimTo":switch(l){case "ch2dimTo":b=this.deviceAdr+":2";break;case "ch3dimTo":b=this.deviceAdr+":3";break;case "ch4dimTo":b=this.deviceAdr+":4"}f.DIMMER_VIRTUAL_RECEIVER.executeCommand(e,this.deviceIF,b,"dimTo"+u,a);break;case "ch2toggleTo":case "ch3toggleTo":case "ch4toggleTo":switch(l){case "ch2toggleTo":b=
this.deviceAdr+":2";break;case "ch3toggleTo":b=this.deviceAdr+":3";break;case "ch4toggleTo":b=this.deviceAdr+":4"}f.DIMMER_VIRTUAL_RECEIVER.executeCommand(e,this.deviceIF,b,"toggleTo"+u,a);break;default:a&&a(Error("no such command"))}};Da.prototype.parseDptState=function(e,c,a){var b=e.indexOf(":");if(-1==b)return null;var f=e.substr(0,b);e=e.substr(b+1);var l=this.deviceAdr;b=this.deviceAdr.indexOf(":");-1!=b&&(l=this.deviceAdr.substr(0,b));if(f!=l)return null;f=x.hub.m.hm._Channel["HmIP-RF"];b=
null;if(0==e){if("UNREACH"==c)return f.MAINTENANCE.parseDptState(c,a);b={};b["0_"+c.toLowerCase()]=a;return b}if(1==e){if(c=f.DIMMER_TRANSMITTER.parseDptState(c,a))b={},b.dimmerLevel=c.dimmerTLevel;return b}if(2==e||3==e||4==e){if(c=f.DIMMER_VIRTUAL_RECEIVER.parseDptState(c,a))switch(b={},parseInt(e)){case 2:b.ch2Level=c.dimmerLevel;break;case 3:b.ch3Level=c.dimmerLevel;break;case 4:b.ch4Level=c.dimmerLevel}return b}return null};var Ea=function(e,c,a){p.call(this,e,c,a);this.channel=1;this.legacyType=
"ip_motion"};util.inherits(Ea,p);Ea.prototype._getReadableDpts=function(){var e=[],c=this,a=x.hub.m.hm._Channel["HmIP-RF"],b=a.MAINTENANCE_BAT_EL.getReadableDpts();b&&b.forEach(function(f){e.push({channel:c.deviceAdr+":0",dpt:f})});(b=a.MOTIONDETECTOR_TRANSCEIVER.getReadableDpts())&&b.forEach(function(f){e.push({channel:c.deviceAdr+":1",dpt:f})});return e};Ea.prototype._getDptFromRef=function(e){var c=this.deviceAdr,a={channel:c+":"+this.channel,dataPoint:null},b=x.hub.m.hm._Channel["HmIP-RF"];switch(e){case "timeout":case "lowbat":case "sabotage":a.channel=
c+":0";a.dataPoint=b.MAINTENANCE_BAT_EL.getDptFromState(e);break;case "state":case "illumination":case "active":a.channel=c+":1";a.dataPoint=b.MOTIONDETECTOR_TRANSCEIVER.getDptFromState(e);break;default:return null}return a};Ea.prototype.executeCommand=function(e,c,a){var b=x.hub.m.hm._Channel["HmIP-RF"];switch(c){case "reset":case "activate":case "deactivate":case "toggleActivate":b.MOTIONDETECTOR_TRANSCEIVER.executeCommand(e,this.deviceIF,this.deviceAdr+":1",c,a);break;default:a&&a(Error("no such command"))}};
Ea.prototype.parseDptState=function(e,c,a){var b=e.indexOf(":");if(-1==b)return null;var f=e.substr(0,b);e=e.substr(b+1);var l=this.deviceAdr;b=this.deviceAdr.indexOf(":");-1!=b&&(l=this.deviceAdr.substr(0,b));if(f!=l)return null;b=x.hub.m.hm._Channel["HmIP-RF"];if(0==e){if("UNREACH"==c||"LOW_BAT"==c||"SABOTAGE"==c)return b.MAINTENANCE_BAT_EL.parseDptState(c,a);b={};b["0_"+c.toLowerCase()]=a;return b}return 1==e?b.MOTIONDETECTOR_TRANSCEIVER.parseDptState(c,a):null};var fa=function(e,c,a){p.call(this,
e,c,a);this.channel=3;this.legacyType="ip_motion2"};util.inherits(fa,p);fa.prototype._getReadableDpts=function(){var e=[],c=this,a=x.hub.m.hm._Channel["HmIP-RF"],b=a.MAINTENANCE_BAT_EL.getReadableDpts();b&&b.forEach(function(f){"SABOTAGE"!=f&&e.push({channel:c.deviceAdr+":0",dpt:f})});(b=a.MOTIONDETECTOR_TRANSCEIVER.getReadableDpts())&&b.forEach(function(f){e.push({channel:c.deviceAdr+":3",dpt:f})});return e};fa.prototype._getDptFromRef=function(e){var c=this.deviceAdr,a={channel:c+":"+this.channel,
dataPoint:null},b=x.hub.m.hm._Channel["HmIP-RF"];switch(e){case "timeout":case "lowbat":a.channel=c+":0";a.dataPoint=b.MAINTENANCE_BAT_EL.getDptFromState(e);break;case "state":case "illumination":case "active":a.channel=c+":3";a.dataPoint=b.MOTIONDETECTOR_TRANSCEIVER.getDptFromState(e);break;default:return null}return a};fa.prototype.executeCommand=function(e,c,a){switch(c){case "reset":case "activate":case "deactivate":case "toggleActivate":break;default:a&&a(Error("no such command"))}};fa.prototype.parseDptState=
function(e,c,a){var b=e.indexOf(":");if(-1==b)return null;var f=e.substr(0,b);e=e.substr(b+1);var l=this.deviceAdr;b=this.deviceAdr.indexOf(":");-1!=b&&(l=this.deviceAdr.substr(0,b));if(f!=l)return null;b=x.hub.m.hm._Channel["HmIP-RF"];f=null;if(0==e){if("UNREACH"==c||"LOW_BAT"==c)return b.MAINTENANCE_BAT_EL.parseDptState(c,a);f={};f["0_"+c.toLowerCase()]=a;return f}1==e&&(l=b.KEY_TRANRECEIVER.parseDptState(c,a))&&(l.pressShort&&(f={btn1pressShort:!0}),l.pressLong&&(f={btn1pressLong:!0}));2==e&&(l=
b.KEY_TRANRECEIVER.parseDptState(c,a))&&(l.pressShort&&(f={btn2pressShort:!0}),l.pressLong&&(f={btn2pressLong:!0}));return 3==e?b.MOTIONDETECTOR_TRANSCEIVER.parseDptState(c,a):f};fa.prototype.isButton=function(){return!0};fa.prototype.claimEvent=function(e,c){var a=this.deviceAdr;-1==a.indexOf(":")&&this.channel&&(a+=":"+this.channel);var b=this;e.reportValueUsage(this.deviceIF,this.deviceAdr+":1","PRESS_SHORT",function(f,l){f&&console.error("button:1 claim PRESS_SHORT event error:"+f.stack);e.reportValueUsage(b.deviceIF,
b.deviceAdr+":1","PRESS_LONG",function(t,u){t&&console.error("button:1 claim PRESS_LONG event error:"+t.stack);e.reportValueUsage(b.deviceIF,b.deviceAdr+":2","PRESS_SHORT",function(y,A){y&&console.error("button:2 claim PRESS_SHORT event error:"+y.stack);e.reportValueUsage(b.deviceIF,b.deviceAdr+":2","PRESS_LONG",function(B,C){B&&console.error("button:2 claim PRESS_LONG event error:"+B.stack);c&&c()})})})})};var oa=function(e,c,a){p.call(this,e,c,a);this.channel=1;this.legacyType="ip_button"};util.inherits(oa,
p);oa.prototype._getReadableDpts=function(){var e=[],c=this,a=x.hub.m.hm._Channel["HmIP-RF"].MAINTENANCE_BAT_EL.getReadableDpts();a&&a.forEach(function(b){"SABOTAGE"!=b&&e.push({channel:c.deviceAdr+":0",dpt:b})});return e};oa.prototype._getDptFromRef=function(e){var c=this.deviceAdr,a={channel:c+":"+this.channel,dataPoint:null},b=x.hub.m.hm._Channel["HmIP-RF"];switch(e){case "timeout":case "lowbat":a.channel=c+":0";a.dataPoint=b.MAINTENANCE_BAT_EL.getDptFromState(e);break;default:return null}return a};
oa.prototype.parseDptState=function(e,c,a){var b=e.indexOf(":");if(-1==b)return null;var f=e.substr(0,b);e=e.substr(b+1);var l=this.deviceAdr;b=this.deviceAdr.indexOf(":");-1!=b&&(l=this.deviceAdr.substr(0,b));if(f!=l)return null;f=x.hub.m.hm._Channel["HmIP-RF"];b=null;if(0==e){if("UNREACH"==c||"LOW_BAT"==c)return f.MAINTENANCE_BAT_EL.parseDptState(c,a);b={};b["0_"+c.toLowerCase()]=a;return b}e==this.channel&&(c=f.KEY_TRANRECEIVER.parseDptState(c,a))&&(c.pressShort&&(b={pressShort:!0}),c.pressLong&&
(b={pressLong:!0}));return b};oa.prototype.isButton=function(){return!0};oa.prototype.claimEvent=function(e,c){var a=this.deviceAdr;-1==a.indexOf(":")&&this.channel&&(a+=":"+this.channel);var b=this;e.reportValueUsage(this.deviceIF,this.deviceAdr+":1","PRESS_SHORT",function(f,l){f&&console.error("button:1 claim PRESS_SHORT event error:"+f.stack);e.reportValueUsage(b.deviceIF,b.deviceAdr+":1","PRESS_LONG",function(t,u){t&&console.error("button:1 claim PRESS_LONG event error:"+t.stack);c&&c()})})};
var pa=function(e,c,a){p.call(this,e,c,a);this.channel=1;this.legacyType="ip_button2"};util.inherits(pa,p);pa.prototype._getReadableDpts=function(){var e=[],c=this,a=x.hub.m.hm._Channel["HmIP-RF"].MAINTENANCE_BAT_EL.getReadableDpts();a&&a.forEach(function(b){"SABOTAGE"!=b&&e.push({channel:c.deviceAdr+":0",dpt:b})});return e};pa.prototype._getDptFromRef=function(e){var c=this.deviceAdr,a={channel:c+":"+this.channel,dataPoint:null},b=x.hub.m.hm._Channel["HmIP-RF"];switch(e){case "timeout":case "lowbat":a.channel=
c+":0";a.dataPoint=b.MAINTENANCE_BAT_EL.getDptFromState(e);break;default:return null}return a};pa.prototype.parseDptState=function(e,c,a){var b=e.indexOf(":");if(-1==b)return null;var f=e.substr(0,b);e=e.substr(b+1);var l=this.deviceAdr;b=this.deviceAdr.indexOf(":");-1!=b&&(l=this.deviceAdr.substr(0,b));if(f!=l)return null;b=x.hub.m.hm._Channel["HmIP-RF"];f=null;if(0==e){if("UNREACH"==c||"LOW_BAT"==c)return b.MAINTENANCE_BAT_EL.parseDptState(c,a);f={};f["0_"+c.toLowerCase()]=a;return f}1==e&&(l=b.KEY_TRANRECEIVER.parseDptState(c,
a))&&(l.pressShort&&(f={btn1pressShort:!0}),l.pressLong&&(f={btn1pressLong:!0}));2==e&&(l=b.KEY_TRANRECEIVER.parseDptState(c,a))&&(l.pressShort&&(f={btn2pressShort:!0}),l.pressLong&&(f={btn2pressLong:!0}));return f};pa.prototype.isButton=function(){return!0};pa.prototype.claimEvent=function(e,c){var a=this.deviceAdr;-1==a.indexOf(":")&&this.channel&&(a+=":"+this.channel);var b=this;e.reportValueUsage(this.deviceIF,this.deviceAdr+":1","PRESS_SHORT",function(f,l){f&&console.error("button:1 claim PRESS_SHORT event error:"+
f.stack);e.reportValueUsage(b.deviceIF,b.deviceAdr+":1","PRESS_LONG",function(t,u){t&&console.error("button:1 claim PRESS_LONG event error:"+t.stack);e.reportValueUsage(b.deviceIF,b.deviceAdr+":2","PRESS_SHORT",function(y,A){y&&console.error("button:2 claim PRESS_SHORT event error:"+y.stack);e.reportValueUsage(b.deviceIF,b.deviceAdr+":2","PRESS_LONG",function(B,C){B&&console.error("button:2 claim PRESS_LONG event error:"+B.stack);c&&c()})})})})};var ha=function(e,c,a){p.call(this,e,c,a);this.channel=
1;this.legacyType="ip_button4"};util.inherits(ha,p);ha.prototype._getReadableDpts=function(){var e=[],c=this,a=x.hub.m.hm._Channel["HmIP-RF"].MAINTENANCE_BAT_EL.getReadableDpts();a&&a.forEach(function(b){"SABOTAGE"!=b&&e.push({channel:c.deviceAdr+":0",dpt:b})});return e};ha.prototype._getDptFromRef=function(e){var c=this.deviceAdr,a={channel:c+":"+this.channel,dataPoint:null},b=x.hub.m.hm._Channel["HmIP-RF"];switch(e){case "timeout":case "lowbat":a.channel=c+":0";a.dataPoint=b.MAINTENANCE_BAT_EL.getDptFromState(e);
break;default:return null}return a};ha.prototype.parseDptState=function(e,c,a){var b=e.indexOf(":");if(-1==b)return null;var f=e.substr(0,b);e=e.substr(b+1);var l=this.deviceAdr;b=this.deviceAdr.indexOf(":");-1!=b&&(l=this.deviceAdr.substr(0,b));if(f!=l)return null;f=x.hub.m.hm._Channel["HmIP-RF"];b=null;if(0==e){if("UNREACH"==c||"LOW_BAT"==c)return f.MAINTENANCE_BAT_EL.parseDptState(c,a);b={};b["0_"+c.toLowerCase()]=a;return b}if(1==e||2==e||3==e||4==e)if(c=f.KEY_TRANRECEIVER.parseDptState(c,a))b||
(b={}),c.pressShort&&(b["btn"+e+"pressShort"]=!0),c.pressLong&&(b["btn"+e+"pressLong"]=!0);return b};ha.prototype.isButton=function(){return!0};ha.prototype.claimEvent=function(e,c){var a=this.deviceAdr;-1==a.indexOf(":")&&this.channel&&(a+=":"+this.channel);var b=this;this._claimButtonEvent(1,e,function(){b._claimButtonEvent(2,e,function(){b._claimButtonEvent(3,e,function(){b._claimButtonEvent(4,e,function(){c&&c()})})})})};ha.prototype._claimButtonEvent=function(e,c,a){var b=this;c.reportValueUsage(this.deviceIF,
this.deviceAdr+":"+e,"PRESS_SHORT",function(f,l){f&&console.error("button:"+e+" claim PRESS_SHORT event error:"+f.stack);c.reportValueUsage(b.deviceIF,b.deviceAdr+":"+e,"PRESS_LONG",function(t,u){t&&console.error("button:"+e+" claim PRESS_LONG event error:"+t.stack);a&&a()})})};var ia=function(e,c,a){p.call(this,e,c,a);this.channel=1;this.legacyType="ip_button6"};util.inherits(ia,p);ia.prototype._getReadableDpts=function(){var e=[],c=this,a=x.hub.m.hm._Channel["HmIP-RF"].MAINTENANCE_BAT_EL.getReadableDpts();
a&&a.forEach(function(b){"SABOTAGE"!=b&&e.push({channel:c.deviceAdr+":0",dpt:b})});return e};ia.prototype._getDptFromRef=function(e){var c=this.deviceAdr,a={channel:c+":"+this.channel,dataPoint:null},b=x.hub.m.hm._Channel["HmIP-RF"];switch(e){case "timeout":case "lowbat":a.channel=c+":0";a.dataPoint=b.MAINTENANCE_BAT_EL.getDptFromState(e);break;default:return null}return a};ia.prototype.parseDptState=function(e,c,a){var b=e.indexOf(":");if(-1==b)return null;var f=e.substr(0,b);e=e.substr(b+1);var l=
this.deviceAdr;b=this.deviceAdr.indexOf(":");-1!=b&&(l=this.deviceAdr.substr(0,b));if(f!=l)return null;f=x.hub.m.hm._Channel["HmIP-RF"];b=null;if(0==e){if("UNREACH"==c||"LOW_BAT"==c)return f.MAINTENANCE_BAT_EL.parseDptState(c,a);b={};b["0_"+c.toLowerCase()]=a;return b}if(1==e||2==e||3==e||4==e||5==e||6==e)if(c=f.KEY_TRANRECEIVER.parseDptState(c,a))b||(b={}),c.pressShort&&(b["btn"+e+"pressShort"]=!0),c.pressLong&&(b["btn"+e+"pressLong"]=!0);return b};ia.prototype.isButton=function(){return!0};ia.prototype.claimEvent=
function(e,c){var a=this.deviceAdr;-1==a.indexOf(":")&&this.channel&&(a+=":"+this.channel);var b=this;this._claimButtonEvent(1,e,function(){b._claimButtonEvent(2,e,function(){b._claimButtonEvent(3,e,function(){b._claimButtonEvent(4,e,function(){b._claimButtonEvent(5,e,function(){b._claimButtonEvent(6,e,function(){c&&c()})})})})})})};ia.prototype._claimButtonEvent=function(e,c,a){var b=this;c.reportValueUsage(this.deviceIF,this.deviceAdr+":"+e,"PRESS_SHORT",function(f,l){f&&console.error("button:"+
e+" claim PRESS_SHORT event error:"+f.stack);c.reportValueUsage(b.deviceIF,b.deviceAdr+":"+e,"PRESS_LONG",function(t,u){t&&console.error("button:"+e+" claim PRESS_LONG event error:"+t.stack);a&&a()})})};var Fa=function(e,c,a){p.call(this,e,c,a);this.channel=3;this.legacyType="ip_siren"};util.inherits(Fa,p);Fa.prototype._getReadableDpts=function(){var e=[],c=this,a=x.hub.m.hm._Channel["HmIP-RF"],b=a.MAINTENANCE_BAT_EL.getReadableDpts();b&&b.forEach(function(f){e.push({channel:c.deviceAdr+":0",dpt:f})});
(b=a.ALARM_SWITCH_VIRTUAL_RECEIVER.getReadableDpts())&&b.forEach(function(f){e.push({channel:c.deviceAdr+":3",dpt:f})});return e};Fa.prototype._getDptFromRef=function(e){var c=this.deviceAdr,a={channel:c+":"+this.channel,dataPoint:null},b=x.hub.m.hm._Channel["HmIP-RF"];switch(e){case "timeout":case "lowbat":case "sabotage":a.channel=c+":0";a.dataPoint=b.MAINTENANCE_BAT_EL.getDptFromState(e);break;case "state":a.channel=c+":3";a.dataPoint=b.ALARM_SWITCH_VIRTUAL_RECEIVER.getDptFromState(e);break;default:return null}return a};
Fa.prototype.executeCommand=function(e,c,a){x.hub.m.hm._Channel["HmIP-RF"].ALARM_SWITCH_VIRTUAL_RECEIVER.executeCommand(e,this.deviceIF,this.deviceAdr+":3",c,a)};Fa.prototype.parseDptState=function(e,c,a){var b=e.indexOf(":");if(-1==b)return null;var f=e.substr(0,b);e=e.substr(b+1);var l=this.deviceAdr;b=this.deviceAdr.indexOf(":");-1!=b&&(l=this.deviceAdr.substr(0,b));if(f!=l)return null;b=x.hub.m.hm._Channel["HmIP-RF"];if(0==e){if("UNREACH"==c||"LOW_BAT"==c||"SABOTAGE"==c)return b.MAINTENANCE_BAT_EL.parseDptState(c,
a);b={};b["0_"+c.toLowerCase()]=a;return b}return 3==e?b.ALARM_SWITCH_VIRTUAL_RECEIVER.parseDptState(c,a):null};var Y=function(e,c,a){p.call(this,e,c,a);this.channel=1;this.legacyType="ip_wallthermo"};util.inherits(Y,p);Y.prototype._getReadableDpts=function(){var e=[],c=this,a=x.hub.m.hm._Channel["HmIP-RF"],b=a.MAINTENANCE_BAT_EL.getReadableDpts();b&&b.forEach(function(f){"SABOTAGE"!=f&&e.push({channel:c.deviceAdr+":0",dpt:f})});(b=a.HEATING_CLIMATECONTROL_TRANSCEIVER.getReadableDpts())&&b.forEach(function(f){"LEVEL"!=
f&&e.push({channel:c.deviceAdr+":1",dpt:f})});return e};Y.prototype._getDptFromRef=function(e){var c=this.deviceAdr,a={channel:c+":"+this.channel,dataPoint:null},b=x.hub.m.hm._Channel["HmIP-RF"];switch(e){case "timeout":case "lowbat":a.channel=c+":0";a.dataPoint=b.MAINTENANCE_BAT_EL.getDptFromState(e);break;case "profile":case "temp":case "boost":case "frost":case "hum":case "mode":case "state":case "window":a.channel=c+":1";a.dataPoint=b.HEATING_CLIMATECONTROL_TRANSCEIVER.getDptFromState(e);break;
default:return null}return a};Y.prototype.executeCommand=function(e,c,a){x.hub.m.hm._Channel["HmIP-RF"].HEATING_CLIMATECONTROL_TRANSCEIVER.executeCommand(e,this.deviceIF,this.deviceAdr+":"+this.channel,c,a)};Y.prototype.parseDptState=function(e,c,a){var b=e.indexOf(":");if(-1==b)return null;var f=e.substr(0,b);e=e.substr(b+1);var l=this.deviceAdr;b=this.deviceAdr.indexOf(":");-1!=b&&(l=this.deviceAdr.substr(0,b));if(f!=l)return null;b=x.hub.m.hm._Channel["HmIP-RF"];f=null;if(0==e){if("UNREACH"==c||
"LOW_BAT"==c)return b.MAINTENANCE_BAT_EL.parseDptState(c,a);f={};f["0_"+c.toLowerCase()]=a;return f}return 1==e?b.HEATING_CLIMATECONTROL_TRANSCEIVER.parseDptState(c,a):f};var Wa=function(e,c,a){p.call(this,e,c,a);this.channel=1;this.legacyType="ip_wallthermo2"};util.inherits(Wa,Y);Wa.prototype._getReadableDpts=function(){var e=Y.prototype._getReadableDpts.call(this);e||(e=[]);var c=this,a=x.hub.m.hm._Channel["HmIP-RF"],b=a.CLIMATECONTROL_FLOOR_DIRECT_TRANSMITTER.getReadableDpts();b&&b.forEach(function(f){e.push({channel:c.deviceAdr+
":8",dpt:f})});(b=a.SWITCH_VIRTUAL_RECEIVER.getReadableDpts())&&b.forEach(function(f){e.push({channel:c.deviceAdr+":10",dpt:f})});return e};Wa.prototype._getDptFromRef=function(e){var c=this.deviceAdr,a={channel:c+":"+this.channel,dataPoint:null},b=x.hub.m.hm._Channel["HmIP-RF"];switch(e){case "valveState":a.channel=c+":10";a.dataPoint=b.SWITCH_VIRTUAL_RECEIVER.getDptFromState("switchState");break;case "cl_fd_emergencyOP":case "cl_fd_frostProtection":case "cl_fd_state":case "cl_fd_humidityAlarm":a.channel=
c+":8";a.dataPoint=b.CLIMATECONTROL_FLOOR_DIRECT_TRANSMITTER.getDptFromState(e);break;default:return Y.prototype._getDptFromRef.call(this,e)}return a};Wa.prototype.parseDptState=function(e,c,a){var b=e.indexOf(":");if(-1==b)return null;var f=e.substr(0,b);e=e.substr(b+1);var l=this.deviceAdr;b=this.deviceAdr.indexOf(":");-1!=b&&(l=this.deviceAdr.substr(0,b));if(f!=l)return null;f=x.hub.m.hm._Channel["HmIP-RF"];b=null;if(0==e){if("UNREACH"==c||"LOW_BAT"==c)return f.MAINTENANCE_BAT_EL.parseDptState(c,
a);b={};b["0_"+c.toLowerCase()]=a;return b}if(1==e)return f.HEATING_CLIMATECONTROL_TRANSCEIVER.parseDptState(c,a);if(8==e)return f.CLIMATECONTROL_FLOOR_DIRECT_TRANSMITTER.parseDptState(c,a);10==e&&(b={},c=f.SWITCH_VIRTUAL_RECEIVER.parseDptState(c,a),b.valveState=c?c.switchState:"?");return b};var Ga=function(e,c,a){p.call(this,e,c,a);this.channel=1;this.legacyType="ip_smoke"};util.inherits(Ga,p);Ga.prototype._getReadableDpts=function(){var e=[],c=this,a=x.hub.m.hm._Channel["HmIP-RF"],b=a.MAINTENANCE.getReadableDpts();
b&&b.forEach(function(f){"SABOTAGE"!=f&&e.push({channel:c.deviceAdr+":0",dpt:f})});(b=a.SMOKE_DETECTOR.getReadableDpts())&&b.forEach(function(f){e.push({channel:c.deviceAdr+":1",dpt:f})});return e};Ga.prototype._getDptFromRef=function(e){var c=this.deviceAdr,a={channel:c+":"+this.channel,dataPoint:null},b=x.hub.m.hm._Channel["HmIP-RF"];switch(e){case "timeout":case "lowbat":a.channel=c+":0";a.dataPoint=b.MAINTENANCE.getDptFromState(e);break;case "profile":case "temp":case "boost":case "frost":case "hum":case "mode":case "state":case "window":a.channel=
c+":1";a.dataPoint=b.SMOKE_DETECTOR.getDptFromState(e);break;default:return null}return a};Ga.prototype.executeCommand=function(e,c,a){x.hub.m.hm._Channel["HmIP-RF"].SMOKE_DETECTOR.executeCommand(e,this.deviceIF,this.deviceAdr+":"+this.channel,c,a)};Ga.prototype.parseDptState=function(e,c,a){var b=e.indexOf(":");if(-1==b)return null;var f=e.substr(0,b);e=e.substr(b+1);var l=this.deviceAdr;b=this.deviceAdr.indexOf(":");-1!=b&&(l=this.deviceAdr.substr(0,b));if(f!=l)return null;b=x.hub.m.hm._Channel["HmIP-RF"];
f=null;if(0==e){if("UNREACH"==c||"LOW_BAT"==c)return b.MAINTENANCE.parseDptState(c,a);f={};f["0_"+c.toLowerCase()]=a;return f}return 1==e?b.SMOKE_DETECTOR.parseDptState(c,a):f};var Xa=function(e,c,a){p.call(this,e,c,a);this.channel=1;this.legacyType="ip_window"};util.inherits(Xa,p);Xa.prototype._getReadableDpts=function(){var e=[],c=this,a=x.hub.m.hm._Channel["HmIP-RF"],b=a.MAINTENANCE_BAT_EL.getReadableDpts();b&&b.forEach(function(f){e.push({channel:c.deviceAdr+":0",dpt:f})});(b=a.ROTARY_HANDLE_TRANSCEIVER.getReadableDpts())&&
b.forEach(function(f){e.push({channel:c.deviceAdr+":1",dpt:f})});return e};Xa.prototype._getDptFromRef=function(e){var c=this.deviceAdr,a={channel:c+":"+this.channel,dataPoint:null},b=x.hub.m.hm._Channel["HmIP-RF"];switch(e){case "timeout":case "lowbat":case "sabotage":a.channel=c+":0";a.dataPoint=b.MAINTENANCE_BAT_EL.getDptFromState(e);break;case "state":a.channel=c+":1";a.dataPoint=b.ROTARY_HANDLE_TRANSCEIVER.getDptFromState(e);break;default:return null}return a};Xa.prototype.parseDptState=function(e,
c,a){var b=e.indexOf(":");if(-1==b)return null;var f=e.substr(0,b);e=e.substr(b+1);var l=this.deviceAdr;b=this.deviceAdr.indexOf(":");-1!=b&&(l=this.deviceAdr.substr(0,b));if(f!=l)return null;b=x.hub.m.hm._Channel["HmIP-RF"];f=null;if(0==e){if("UNREACH"==c||"LOW_BAT"==c||"SABOTAGE"==c)return b.MAINTENANCE_BAT_EL.parseDptState(c,a);f={};f["0_"+c.toLowerCase()]=a;return f}return 1==e?b.ROTARY_HANDLE_TRANSCEIVER.parseDptState(c,a):f};var Q=function(e,c,a){p.call(this,e,c,a);this.channel=1;this.legacyType=
"ip_blind"};util.inherits(Q,p);Q.prototype._getReadableDpts=function(){var e=[],c=this,a=x.hub.m.hm._Channel["HmIP-RF"],b=a.MAINTENANCE.getReadableDpts();b&&b.forEach(function(f){"UNREACH"==f&&e.push({channel:c.deviceAdr+":0",dpt:f})});(b=a.SHUTTER_TRANSMITTER.getReadableDpts())&&b.forEach(function(f){e.push({channel:c.deviceAdr+":3",dpt:f})});(b=a.SHUTTER_VIRTUAL_RECEIVER.getReadableDpts())&&b.forEach(function(f){e.push({channel:c.deviceAdr+":4",dpt:f});e.push({channel:c.deviceAdr+":5",dpt:f});e.push({channel:c.deviceAdr+
":6",dpt:f})});return e};Q.prototype._getDptFromRef=function(e){var c=this.deviceAdr,a={channel:c+":"+this.channel,dataPoint:null},b=x.hub.m.hm._Channel["HmIP-RF"];switch(e){case "timeout":a.channel=c+":0";a.dataPoint=b.MAINTENANCE.getDptFromState(e);break;case "blindLevel":a.channel=c+":3";a.dataPoint=b.SHUTTER_TRANSMITTER.getDptFromState("blindTLevel");break;case "ch4Level":a.channel=c+":4";a.dataPoint=b.SHUTTER_VIRTUAL_RECEIVER.getDptFromState("blindLevel");break;case "ch5Level":a.channel=c+":5";
a.dataPoint=b.SHUTTER_VIRTUAL_RECEIVER.getDptFromState("blindLevel");break;case "ch6Level":a.channel=c+":6";a.dataPoint=b.SHUTTER_VIRTUAL_RECEIVER.getDptFromState("blindLevel");break;default:return null}return a};Q.prototype.executeCommand=function(e,c,a){var b=null,f=x.hub.m.hm._Channel["HmIP-RF"],l=c;if(-1!=c.indexOf("stepUp")){var t=c.indexOf("stepUp");l=c.substr(0,t+6);var u=c.substr(t+6)}else-1!=c.indexOf("stepDown")?(t=c.indexOf("stepDown"),l=c.substr(0,t+8),u=c.substr(t+8)):-1!=c.indexOf("moveTo")?
(t=c.indexOf("moveTo"),l=c.substr(0,t+6),u=c.substr(t+6)):-1!=c.indexOf("stop")&&(t=c.indexOf("stop"),l=c.substr(0,t+4),u=c.substr(t+4));var y=this;switch(l){case "stop":f.SHUTTER_VIRTUAL_RECEIVER.executeCommand(e,this.deviceIF,this.deviceAdr+":4","stop",function(A,B){A?a&&a(A,B):f.SHUTTER_VIRTUAL_RECEIVER.executeCommand(e,y.deviceIF,y.deviceAdr+":5","stop",function(C,G){C?a&&a(C,G):f.SHUTTER_VIRTUAL_RECEIVER.executeCommand(e,y.deviceIF,y.deviceAdr+":6","stop",a)})});break;case "moveUp":f.SHUTTER_VIRTUAL_RECEIVER.executeCommand(e,
this.deviceIF,this.deviceAdr+":4","moveUp",function(A,B){A?a&&a(A,B):f.SHUTTER_VIRTUAL_RECEIVER.executeCommand(e,y.deviceIF,y.deviceAdr+":5","moveTo0",function(C,G){C?a&&a(C,G):f.SHUTTER_VIRTUAL_RECEIVER.executeCommand(e,y.deviceIF,y.deviceAdr+":6","moveTo0",a)})});break;case "moveDown":f.SHUTTER_VIRTUAL_RECEIVER.executeCommand(e,this.deviceIF,this.deviceAdr+":4","moveDown",function(A,B){A?a&&a(A,B):f.SHUTTER_VIRTUAL_RECEIVER.executeCommand(e,y.deviceIF,y.deviceAdr+":5","moveTo0",function(C,G){C?
a&&a(C,G):f.SHUTTER_VIRTUAL_RECEIVER.executeCommand(e,y.deviceIF,y.deviceAdr+":6","moveTo0",a)})});break;case "stepUp":u=u?parseInt(u)/100:.05;e.getState({interface:this.deviceIF,channel:this.deviceAdr+":3",datapoint:"LEVEL"},function(A,B){A?a&&a(A):"undefined"==typeof B||null==B?a&&a(Error("get blind current value return invalid")):(u=B.value+u,1<u&&(u=1),u=Math.round(100*u),f.SHUTTER_VIRTUAL_RECEIVER.executeCommand(e,y.deviceIF,y.deviceAdr+":4","moveTo"+u,function(C,G){C?a&&a(C,G):f.SHUTTER_VIRTUAL_RECEIVER.executeCommand(e,
y.deviceIF,y.deviceAdr+":5","moveTo0",function(H,F){H?a&&a(H,F):f.SHUTTER_VIRTUAL_RECEIVER.executeCommand(e,y.deviceIF,y.deviceAdr+":6","moveTo0",function(K,I){K?a&&a(K,I):(I=u/100,1<I&&(I=1),0>I&&(I=0),e.updateStatusBuffer(y.deviceIF,y.deviceAdr+":3","LEVEL",I,(new Date).getTime()+1E3),a&&a(K))})})}))});break;case "stepDown":u=u?parseInt(u)/100:.05;e.getState({interface:this.deviceIF,channel:this.deviceAdr+":3",datapoint:"LEVEL"},function(A,B){A?a&&a(A):"undefined"==typeof B||null==B?a&&a(Error("get blind current value return invalid")):
(u=B.value-u,0>u&&(u=0),u=Math.round(100*u),f.SHUTTER_VIRTUAL_RECEIVER.executeCommand(e,y.deviceIF,y.deviceAdr+":4","moveTo"+u,function(C,G){C?a&&a(C,G):f.SHUTTER_VIRTUAL_RECEIVER.executeCommand(e,y.deviceIF,y.deviceAdr+":5","moveTo0",function(H,F){H?a&&a(H,F):f.SHUTTER_VIRTUAL_RECEIVER.executeCommand(e,y.deviceIF,y.deviceAdr+":6","moveTo0",function(K,I){K?a&&a(K,I):(I=u/100,1<I&&(I=1),0>I&&(I=0),e.updateStatusBuffer(y.deviceIF,y.deviceAdr+":3","LEVEL",I,(new Date).getTime()+1E3),a&&a(K))})})}))});
break;case "moveTo":if(!u){a&&a(Error("moveTo has no value"));break}f.SHUTTER_VIRTUAL_RECEIVER.executeCommand(e,this.deviceIF,this.deviceAdr+":4","moveTo"+u,function(A,B){A?a&&a(A,B):f.SHUTTER_VIRTUAL_RECEIVER.executeCommand(e,y.deviceIF,y.deviceAdr+":5","moveTo0",function(C,G){C?a&&a(C,G):f.SHUTTER_VIRTUAL_RECEIVER.executeCommand(e,y.deviceIF,y.deviceAdr+":6","moveTo0",function(H,F){H?a&&a(H,F):(F=u/100,1<F&&(F=1),0>F&&(F=0),e.updateStatusBuffer(y.deviceIF,y.deviceAdr+":3","LEVEL",F,(new Date).getTime()+
1E3),a&&a(H))})})});break;case "ch4stop":case "ch5stop":case "ch6stop":switch(l){case "ch4stop":b=this.deviceAdr+":4";break;case "ch5stop":b=this.deviceAdr+":5";break;case "ch6stop":b=this.deviceAdr+":6"}f.SHUTTER_VIRTUAL_RECEIVER.executeCommand(e,this.deviceIF,b,"stop",a);break;case "ch4moveUp":case "ch5moveUp":case "ch6moveUp":switch(l){case "ch4moveUp":b=this.deviceAdr+":4";break;case "ch5moveUp":b=this.deviceAdr+":5";break;case "ch6moveUp":b=this.deviceAdr+":6"}f.SHUTTER_VIRTUAL_RECEIVER.executeCommand(e,
this.deviceIF,b,"moveUp",a);break;case "ch4moveDown":case "ch5moveDown":case "ch6moveDown":switch(l){case "ch4moveDown":b=this.deviceAdr+":4";break;case "ch5moveDown":b=this.deviceAdr+":5";break;case "ch6moveDown":b=this.deviceAdr+":6"}f.SHUTTER_VIRTUAL_RECEIVER.executeCommand(e,this.deviceIF,b,"moveDown",a);break;case "ch4stepUp":case "ch5stepUp":case "ch6stepUp":switch(l){case "ch4stepUp":b=this.deviceAdr+":4";break;case "ch5stepUp":b=this.deviceAdr+":5";break;case "ch6stepUp":b=this.deviceAdr+
":6"}f.SHUTTER_VIRTUAL_RECEIVER.executeCommand(e,this.deviceIF,b,"stepUp"+u,a);break;case "ch4stepDown":case "ch5stepDown":case "ch6stepDown":switch(l){case "ch4stepDown":b=this.deviceAdr+":4";break;case "ch5stepDown":b=this.deviceAdr+":5";break;case "ch6stepDown":b=this.deviceAdr+":6"}f.SHUTTER_VIRTUAL_RECEIVER.executeCommand(e,this.deviceIF,b,"stepDown"+u,a);break;case "ch4moveTo":case "ch5moveTo":case "ch6moveTo":switch(l){case "ch4moveTo":b=this.deviceAdr+":4";break;case "ch5moveTo":b=this.deviceAdr+
":5";break;case "ch6moveTo":b=this.deviceAdr+":6"}f.SHUTTER_VIRTUAL_RECEIVER.executeCommand(e,this.deviceIF,b,"moveTo"+u,a);break;default:a&&a(Error("no such command"))}};Q.prototype.parseDptState=function(e,c,a){var b=e.indexOf(":");if(-1==b)return null;var f=e.substr(0,b);e=e.substr(b+1);var l=this.deviceAdr;b=this.deviceAdr.indexOf(":");-1!=b&&(l=this.deviceAdr.substr(0,b));if(f!=l)return null;f=x.hub.m.hm._Channel["HmIP-RF"];b=null;if(0==e){if("UNREACH"==c)return f.MAINTENANCE.parseDptState(c,
a);b={};b["0_"+c.toLowerCase()]=a;return b}if(3==e){if(c=f.SHUTTER_TRANSMITTER.parseDptState(c,a))b={},b.blindLevel=c.blindTLevel;return b}if(4==e||5==e||6==e){if(c=f.SHUTTER_VIRTUAL_RECEIVER.parseDptState(c,a))switch(b={},parseInt(e)){case 4:b.ch4Level=c.blindLevel;break;case 5:b.ch5Level=c.blindLevel;break;case 6:b.ch6Level=c.blindLevel}return b}return null};Q.prototype.getConfig=function(e,c){var a=this.deviceAdr+":3";e.getParamset(this.deviceIF,a,"MASTER",function(b,f){if(b)c&&c(b);else{var l=
{},t=null;f&&(t={CHANGE_OVER_DELAY:f.CHANGE_OVER_DELAY,REFERENCE_RUNNING_TIME_BOTTOM_TOP_UNIT:f.REFERENCE_RUNNING_TIME_BOTTOM_TOP_UNIT,REFERENCE_RUNNING_TIME_BOTTOM_TOP_VALUE:f.REFERENCE_RUNNING_TIME_BOTTOM_TOP_VALUE,REFERENCE_RUNNING_TIME_TOP_BOTTOM_UNIT:f.REFERENCE_RUNNING_TIME_TOP_BOTTOM_UNIT,REFERENCE_RUNNING_TIME_TOP_BOTTOM_VALUE:f.REFERENCE_RUNNING_TIME_TOP_BOTTOM_VALUE,REFERENCE_RUN_COUNTER:f.REFERENCE_RUN_COUNTER});l[a]=t;c&&c(b,l)}})};Q.prototype.setConfig=function(e,c,a){if(c){var b=this.deviceAdr+
":3";if(c=c[b]){var f={};f.CHANGE_OVER_DELAY={__rpcValueType:"double",__rpcValue:c.CHANGE_OVER_DELAY};f.REFERENCE_RUN_COUNTER=c.REFERENCE_RUN_COUNTER;f.REFERENCE_RUNNING_TIME_BOTTOM_TOP_UNIT={__rpcValueType:"double",__rpcValue:c.REFERENCE_RUNNING_TIME_BOTTOM_TOP_UNIT};f.REFERENCE_RUNNING_TIME_BOTTOM_TOP_VALUE={__rpcValueType:"double",__rpcValue:c.REFERENCE_RUNNING_TIME_BOTTOM_TOP_VALUE};f.REFERENCE_RUNNING_TIME_TOP_BOTTOM_UNIT={__rpcValueType:"double",__rpcValue:c.REFERENCE_RUNNING_TIME_TOP_BOTTOM_UNIT};
f.REFERENCE_RUNNING_TIME_TOP_BOTTOM_VALUE={__rpcValueType:"double",__rpcValue:c.REFERENCE_RUNNING_TIME_TOP_BOTTOM_VALUE};e.setParamset(this.deviceIF,b,"MASTER",f,function(l){a&&a(l)})}else a&&a(Error("config data not complete"))}else a&&a(Error("config data invalid"))};Q.prototype.isButton=function(){return!0};Q.prototype.claimEvent=function(e,c){var a=this.deviceAdr;-1==a.indexOf(":")&&this.channel&&(a+=":"+this.channel);var b=this;this._claimButtonEvent(1,e,function(){b._claimButtonEvent(2,e,function(){c&&
c()})})};Q.prototype._claimButtonEvent=function(e,c,a){var b=this;c.reportValueUsage(this.deviceIF,this.deviceAdr+":"+e,"PRESS_SHORT",function(f,l){f&&console.error("button:"+e+" claim PRESS_SHORT event error:"+f.stack);c.reportValueUsage(b.deviceIF,b.deviceAdr+":"+e,"PRESS_LONG",function(t,u){t&&console.error("button:"+e+" claim PRESS_LONG event error:"+t.stack);a&&a()})})};var R=function(e,c,a){p.call(this,e,c,a);this.channel=1;this.legacyType="ip_jalousie"};util.inherits(R,p);R.prototype._getReadableDpts=
function(){var e=[],c=this,a=x.hub.m.hm._Channel["HmIP-RF"],b=a.MAINTENANCE.getReadableDpts();b&&b.forEach(function(f){"UNREACH"==f&&e.push({channel:c.deviceAdr+":0",dpt:f})});(b=a.BLIND_TRANSMITTER.getReadableDpts())&&b.forEach(function(f){e.push({channel:c.deviceAdr+":3",dpt:f})});(b=a.BLIND_VIRTUAL_RECEIVER.getReadableDpts())&&b.forEach(function(f){e.push({channel:c.deviceAdr+":4",dpt:f});e.push({channel:c.deviceAdr+":5",dpt:f});e.push({channel:c.deviceAdr+":6",dpt:f})});return e};R.prototype._getDptFromRef=
function(e){var c=this.deviceAdr,a={channel:c+":"+this.channel,dataPoint:null},b=x.hub.m.hm._Channel["HmIP-RF"];switch(e){case "timeout":a.channel=c+":0";a.dataPoint=b.MAINTENANCE.getDptFromState(e);break;case "blindLevel":a.channel=c+":3";a.dataPoint=b.BLIND_TRANSMITTER.getDptFromState("blindTPos");break;case "lamellaLevel":a.channel=c+":3";a.dataPoint=b.BLIND_TRANSMITTER.getDptFromState("lamellaTPos");break;case "ch4blindLevel":a.channel=c+":4";a.dataPoint=b.BLIND_VIRTUAL_RECEIVER.getDptFromState("blindPos");
break;case "ch4lamellaLevel":a.channel=c+":4";a.dataPoint=b.BLIND_VIRTUAL_RECEIVER.getDptFromState("lamellaPos");break;case "ch5blindLevel":a.channel=c+":5";a.dataPoint=b.BLIND_VIRTUAL_RECEIVER.getDptFromState("blindPos");break;case "ch5lamellaLevel":a.channel=c+":5";a.dataPoint=b.BLIND_VIRTUAL_RECEIVER.getDptFromState("lamellaPos");break;case "ch6blindLevel":a.channel=c+":6";a.dataPoint=b.BLIND_VIRTUAL_RECEIVER.getDptFromState("blindPos");break;case "ch6lamellaLevel":a.channel=c+":6";a.dataPoint=
b.BLIND_VIRTUAL_RECEIVER.getDptFromState("lamellaPos");break;default:return null}return a};R.prototype.executeCommand=function(e,c,a){var b=null,f=x.hub.m.hm._Channel["HmIP-RF"],l=c;if(-1!=c.indexOf("stepUp")){var t=c.indexOf("stepUp");l=c.substr(0,t+6);var u=c.substr(t+6)}else-1!=c.indexOf("stepDown")?(t=c.indexOf("stepDown"),l=c.substr(0,t+8),u=c.substr(t+8)):-1!=c.indexOf("moveTo")?(t=c.indexOf("moveTo"),l=c.substr(0,t+6),u=c.substr(t+6)):-1!=c.indexOf("stop")?(t=c.indexOf("stop"),l=c.substr(0,
t+4),u=c.substr(t+4)):-1!=c.indexOf("lamellaStepUp")?(t=c.indexOf("lamellaStepUp"),l=c.substr(0,t+13),u=c.substr(t+13)):-1!=c.indexOf("lamellaStepDown")?(t=c.indexOf("lamellaStepDown"),l=c.substr(0,t+15),u=c.substr(t+15)):-1!=c.indexOf("lamellaTo")&&(t=c.indexOf("lamellaTo"),l=c.substr(0,t+9),u=c.substr(t+9));var y=this;switch(l){case "stop":case "moveUp":case "moveDown":f.BLIND_VIRTUAL_RECEIVER.executeCommand(e,this.deviceIF,this.deviceAdr+":4",l,function(A,B){A?a&&a(A,B):f.BLIND_VIRTUAL_RECEIVER.executeCommand(e,
y.deviceIF,y.deviceAdr+":5",l,function(C,G){C?a&&a(C,G):f.BLIND_VIRTUAL_RECEIVER.executeCommand(e,y.deviceIF,y.deviceAdr+":6",l,a)})});break;case "lamellaUp":case "lamellaDown":e.getState({interface:this.deviceIF,channel:this.deviceAdr+":3",datapoint:"LEVEL"},function(A,B){A?a&&a(A):"undefined"==typeof B||null==B?a&&a(Error("get blind current value return invalid")):(u=B.value,u=Math.round(100*u),f.BLIND_VIRTUAL_RECEIVER.executeCommand(e,y.deviceIF,y.deviceAdr+":4",l,function(C,G){C?a&&a(C,G):f.BLIND_VIRTUAL_RECEIVER.executeCommand(e,
y.deviceIF,y.deviceAdr+":4","moveTo"+u,function(H,F){H?a&&a(H,F):f.BLIND_VIRTUAL_RECEIVER.executeCommand(e,y.deviceIF,y.deviceAdr+":5",l,function(K,I){K?a&&a(K,I):f.BLIND_VIRTUAL_RECEIVER.executeCommand(e,y.deviceIF,y.deviceAdr+":5","moveTo"+u,function(ja,U){ja?a&&a(ja,U):f.BLIND_VIRTUAL_RECEIVER.executeCommand(e,y.deviceIF,y.deviceAdr+":6",l,function(ka,V){ka?a&&a(ka,V):f.BLIND_VIRTUAL_RECEIVER.executeCommand(e,y.deviceIF,y.deviceAdr+":6","moveTo"+u,function(qa,S){a&&a(qa,S)})})})})})}))});break;
case "stepUp":u=u?parseInt(u)/100:.05;e.getState({interface:this.deviceIF,channel:this.deviceAdr+":3",datapoint:"LEVEL"},function(A,B){A?a&&a(A):"undefined"==typeof B||null==B?a&&a(Error("get blind current value return invalid")):(u=B.value+u,1<u&&(u=1),u=Math.round(100*u),f.BLIND_VIRTUAL_RECEIVER.executeCommand(e,y.deviceIF,y.deviceAdr+":4","moveTo"+u,function(C,G){C?a&&a(C,G):f.BLIND_VIRTUAL_RECEIVER.executeCommand(e,y.deviceIF,y.deviceAdr+":5","moveTo"+u,function(H,F){H?a&&a(H,F):f.BLIND_VIRTUAL_RECEIVER.executeCommand(e,
y.deviceIF,y.deviceAdr+":6","moveTo"+u,function(K,I){K?a&&a(K,I):(I=u/100,1<I&&(I=1),0>I&&(I=0),e.updateStatusBuffer(y.deviceIF,y.deviceAdr+":3","LEVEL",I,(new Date).getTime()+1E3),a&&a(K))})})}))});break;case "stepDown":u=u?parseInt(u)/100:.05;e.getState({interface:this.deviceIF,channel:this.deviceAdr+":3",datapoint:"LEVEL"},function(A,B){A?a&&a(A):"undefined"==typeof B||null==B?a&&a(Error("get blind current value return invalid")):(u=B.value-u,0>u&&(u=0),u=Math.round(100*u),f.BLIND_VIRTUAL_RECEIVER.executeCommand(e,
y.deviceIF,y.deviceAdr+":4","moveTo"+u,function(C,G){C?a&&a(C,G):f.BLIND_VIRTUAL_RECEIVER.executeCommand(e,y.deviceIF,y.deviceAdr+":5","moveTo"+u,function(H,F){H?a&&a(H,F):f.BLIND_VIRTUAL_RECEIVER.executeCommand(e,y.deviceIF,y.deviceAdr+":6","moveTo"+u,function(K,I){K?a&&a(K,I):(I=u/100,1<I&&(I=1),0>I&&(I=0),e.updateStatusBuffer(y.deviceIF,y.deviceAdr+":3","LEVEL",I,(new Date).getTime()+1E3),a&&a(K))})})}))});break;case "moveTo":if(!u){a&&a(Error("moveTo has no value"));break}f.BLIND_VIRTUAL_RECEIVER.executeCommand(e,
this.deviceIF,this.deviceAdr+":4","moveTo"+u,function(A,B){A?a&&a(A,B):f.BLIND_VIRTUAL_RECEIVER.executeCommand(e,y.deviceIF,y.deviceAdr+":5","moveTo"+u,function(C,G){C?a&&a(C,G):f.BLIND_VIRTUAL_RECEIVER.executeCommand(e,y.deviceIF,y.deviceAdr+":6","moveTo"+u,function(H,F){H?a&&a(H,F):(F=u/100,1<F&&(F=1),0>F&&(F=0),e.updateStatusBuffer(y.deviceIF,y.deviceAdr+":3","LEVEL",F,(new Date).getTime()+1E3),a&&a(H))})})});break;case "lamellaStepUp":u=u?parseInt(u)/100:.05;e.getState({interface:this.deviceIF,
channel:this.deviceAdr+":3",datapoint:"LEVEL"},function(A,B){if(A)a&&a(A);else if("undefined"==typeof B||null==B)a&&a(Error("get blind current value return invalid"));else{var C=B.value;C=Math.round(100*C);e.getState({interface:y.deviceIF,channel:y.deviceAdr+":3",datapoint:"LEVEL_2"},function(G,H){G?a&&a(G):"undefined"==typeof H||null==H?a&&a(Error("get lamella current value return invalid")):(u=H.value+u,1<u&&(u=1),u=Math.round(100*u),f.BLIND_VIRTUAL_RECEIVER.executeCommand(e,y.deviceIF,y.deviceAdr+
":4","lamellaTo"+u,function(F,K){F?a&&a(F,K):f.BLIND_VIRTUAL_RECEIVER.executeCommand(e,y.deviceIF,y.deviceAdr+":4","moveTo"+C,function(I,ja){I?a&&a(I,ja):f.BLIND_VIRTUAL_RECEIVER.executeCommand(e,y.deviceIF,y.deviceAdr+":5","lamellaTo"+u,function(U,ka){U?a&&a(U,ka):f.BLIND_VIRTUAL_RECEIVER.executeCommand(e,y.deviceIF,y.deviceAdr+":5","moveTo"+C,function(V,qa){V?a&&a(V,qa):f.BLIND_VIRTUAL_RECEIVER.executeCommand(e,y.deviceIF,y.deviceAdr+":6","lamellaTo"+u,function(S,T){S?a&&a(S,T):f.BLIND_VIRTUAL_RECEIVER.executeCommand(e,
y.deviceIF,y.deviceAdr+":6","moveTo"+C,function(ra,N){ra?a&&a(ra,N):(N=u/100,1<N&&(N=1),0>N&&(N=0),e.updateStatusBuffer(y.deviceIF,y.deviceAdr+":3","LEVEL_2",N,(new Date).getTime()+1E3),a&&a(ra))})})})})})}))})}});break;case "lamellaStepDown":u=u?parseInt(u)/100:.05;e.getState({interface:this.deviceIF,channel:this.deviceAdr+":3",datapoint:"LEVEL"},function(A,B){if(A)a&&a(A);else if("undefined"==typeof B||null==B)a&&a(Error("get blind current value return invalid"));else{var C=B.value;C=Math.round(100*
C);e.getState({interface:y.deviceIF,channel:y.deviceAdr+":3",datapoint:"LEVEL_2"},function(G,H){G?a&&a(G):"undefined"==typeof H||null==H?a&&a(Error("get lamella current value return invalid")):(u=H.value-u,0>u&&(u=0),u=Math.round(100*u),f.BLIND_VIRTUAL_RECEIVER.executeCommand(e,y.deviceIF,y.deviceAdr+":4","lamellaTo"+u,function(F,K){F?a&&a(F,K):f.BLIND_VIRTUAL_RECEIVER.executeCommand(e,y.deviceIF,y.deviceAdr+":4","moveTo"+C,function(I,ja){I?a&&a(I,ja):f.BLIND_VIRTUAL_RECEIVER.executeCommand(e,y.deviceIF,
y.deviceAdr+":5","lamellaTo"+u,function(U,ka){U?a&&a(U,ka):f.BLIND_VIRTUAL_RECEIVER.executeCommand(e,y.deviceIF,y.deviceAdr+":5","moveTo"+C,function(V,qa){V?a&&a(V,qa):f.BLIND_VIRTUAL_RECEIVER.executeCommand(e,y.deviceIF,y.deviceAdr+":6","lamellaTo"+u,function(S,T){S?a&&a(S,T):f.BLIND_VIRTUAL_RECEIVER.executeCommand(e,y.deviceIF,y.deviceAdr+":6","moveTo"+C,function(ra,N){ra?a&&a(ra,N):(N=u/100,1<N&&(N=1),0>N&&(N=0),e.updateStatusBuffer(y.deviceIF,y.deviceAdr+":3","LEVEL_2",N,(new Date).getTime()+
1E3),a&&a(ra))})})})})})}))})}});break;case "lamellaTo":if(!u){a&&a(Error("lamellaTo has no value"));break}e.getState({interface:this.deviceIF,channel:this.deviceAdr+":3",datapoint:"LEVEL"},function(A,B){if(A)a&&a(A);else if("undefined"==typeof B||null==B)a&&a(Error("get blind current value return invalid"));else{var C=B.value;C=Math.round(100*C);f.BLIND_VIRTUAL_RECEIVER.executeCommand(e,y.deviceIF,y.deviceAdr+":4","lamellaTo"+u,function(G,H){G?a&&a(G,H):f.BLIND_VIRTUAL_RECEIVER.executeCommand(e,
y.deviceIF,y.deviceAdr+":4","moveTo"+C,function(F,K){F?a&&a(F,K):f.BLIND_VIRTUAL_RECEIVER.executeCommand(e,y.deviceIF,y.deviceAdr+":5","lamellaTo"+u,function(I,ja){I?a&&a(I,ja):f.BLIND_VIRTUAL_RECEIVER.executeCommand(e,y.deviceIF,y.deviceAdr+":5","moveTo"+C,function(U,ka){U?a&&a(U,ka):f.BLIND_VIRTUAL_RECEIVER.executeCommand(e,y.deviceIF,y.deviceAdr+":6","lamellaTo"+u,function(V,qa){V?a&&a(V,qa):f.BLIND_VIRTUAL_RECEIVER.executeCommand(e,y.deviceIF,y.deviceAdr+":6","moveTo"+C,function(S,T){S?a&&a(S,
T):(T=u/100,1<T&&(T=1),0>T&&(T=0),e.updateStatusBuffer(y.deviceIF,y.deviceAdr+":3","LEVEL_2",T,(new Date).getTime()+1E3),a&&a(S))})})})})})})}});break;case "ch4stop":case "ch5stop":case "ch6stop":switch(l){case "ch4stop":b=this.deviceAdr+":4";break;case "ch5stop":b=this.deviceAdr+":5";break;case "ch6stop":b=this.deviceAdr+":6"}f.BLIND_VIRTUAL_RECEIVER.executeCommand(e,this.deviceIF,b,"stop",a);break;case "ch4moveUp":case "ch5moveUp":case "ch6moveUp":switch(l){case "ch4moveUp":b=this.deviceAdr+":4";
break;case "ch5moveUp":b=this.deviceAdr+":5";break;case "ch6moveUp":b=this.deviceAdr+":6"}f.BLIND_VIRTUAL_RECEIVER.executeCommand(e,this.deviceIF,b,"moveUp",a);break;case "ch4moveDown":case "ch5moveDown":case "ch6moveDown":switch(l){case "ch4moveDown":b=this.deviceAdr+":4";break;case "ch5moveDown":b=this.deviceAdr+":5";break;case "ch6moveDown":b=this.deviceAdr+":6"}f.BLIND_VIRTUAL_RECEIVER.executeCommand(e,this.deviceIF,b,"moveDown",a);break;case "ch4lamellaUp":case "ch5lamellaUp":case "ch6lamellaUp":switch(l){case "ch4lamellaUp":b=
this.deviceAdr+":4";break;case "ch5lamellaUp":b=this.deviceAdr+":5";break;case "ch6lamellaUp":b=this.deviceAdr+":6"}e.getState({interface:this.deviceIF,channel:b,datapoint:"LEVEL"},function(A,B){if(A)a&&a(A);else if("undefined"==typeof B||null==B)a&&a(Error("get blind current value return invalid"));else{var C=B.value;C=Math.round(100*C);f.BLIND_VIRTUAL_RECEIVER.executeCommand(e,y.deviceIF,b,"lamellaUp",function(G,H){G?a&&a(G):f.BLIND_VIRTUAL_RECEIVER.executeCommand(e,y.deviceIF,b,"moveTo"+C,function(F,
K){a&&a(F,K)})})}});break;case "ch4lamellaDown":case "ch5lamellaDown":case "ch6lamellaDown":switch(l){case "ch4lamellaDown":b=this.deviceAdr+":4";break;case "ch5lamellaDown":b=this.deviceAdr+":5";break;case "ch6lamellaDown":b=this.deviceAdr+":6"}e.getState({interface:this.deviceIF,channel:b,datapoint:"LEVEL"},function(A,B){if(A)a&&a(A);else if("undefined"==typeof B||null==B)a&&a(Error("get blind current value return invalid"));else{var C=B.value;C=Math.round(100*C);f.BLIND_VIRTUAL_RECEIVER.executeCommand(e,
y.deviceIF,b,"lamellaDown",function(G,H){G?a&&a(G):f.BLIND_VIRTUAL_RECEIVER.executeCommand(e,y.deviceIF,b,"moveTo"+C,function(F,K){a&&a(F,K)})})}});break;case "ch4stepUp":case "ch5stepUp":case "ch6stepUp":switch(l){case "ch4stepUp":b=this.deviceAdr+":4";break;case "ch5stepUp":b=this.deviceAdr+":5";break;case "ch6stepUp":b=this.deviceAdr+":6"}f.SHUTTER_VIRTUAL_RECEIVER.executeCommand(e,this.deviceIF,b,"stepUp"+u,a);break;case "ch4stepDown":case "ch5stepDown":case "ch6stepDown":switch(l){case "ch4stepDown":b=
this.deviceAdr+":4";break;case "ch5stepDown":b=this.deviceAdr+":5";break;case "ch6stepDown":b=this.deviceAdr+":6"}f.SHUTTER_VIRTUAL_RECEIVER.executeCommand(e,this.deviceIF,b,"stepDown"+u,a);break;case "ch4lamellaStepUp":case "ch5lamellaStepUp":case "ch6lamellaStepUp":switch(l){case "ch4lamellaStepUp":b=this.deviceAdr+":4";break;case "ch5lamellaStepUp":b=this.deviceAdr+":5";break;case "ch6lamellaStepUp":b=this.deviceAdr+":6"}e.getState({interface:this.deviceIF,channel:b,datapoint:"LEVEL"},function(A,
B){if(A)a&&a(A);else if("undefined"==typeof B||null==B)a&&a(Error("get blind current value return invalid"));else{var C=B.value;C=Math.round(100*C);f.BLIND_VIRTUAL_RECEIVER.executeCommand(e,y.deviceIF,b,"lamellaStepUp"+u,function(G,H){G?a&&a(G):f.BLIND_VIRTUAL_RECEIVER.executeCommand(e,y.deviceIF,b,"moveTo"+C,function(F,K){a&&a(F,K)})})}});break;case "ch4lamellaStepDown":case "ch5lamellaStepDown":case "ch6lamellaStepDown":switch(l){case "ch4lamellaStepDown":b=this.deviceAdr+":4";break;case "ch5lamellaStepDown":b=
this.deviceAdr+":5";break;case "ch6lamellaStepDown":b=this.deviceAdr+":6"}e.getState({interface:this.deviceIF,channel:b,datapoint:"LEVEL"},function(A,B){if(A)a&&a(A);else if("undefined"==typeof B||null==B)a&&a(Error("get blind current value return invalid"));else{var C=B.value;C=Math.round(100*C);f.BLIND_VIRTUAL_RECEIVER.executeCommand(e,y.deviceIF,b,"lamellaStepDown"+u,function(G,H){G?a&&a(G):f.BLIND_VIRTUAL_RECEIVER.executeCommand(e,y.deviceIF,b,"moveTo"+C,function(F,K){a&&a(F,K)})})}});break;case "ch4moveTo":case "ch5moveTo":case "ch6moveTo":switch(l){case "ch4moveTo":b=
this.deviceAdr+":4";break;case "ch5moveTo":b=this.deviceAdr+":5";break;case "ch6moveTo":b=this.deviceAdr+":6"}f.SHUTTER_VIRTUAL_RECEIVER.executeCommand(e,this.deviceIF,b,"moveTo"+u,a);break;case "ch4lamellaTo":case "ch5lamellaTo":case "ch6lamellaTo":switch(l){case "ch4lamellaTo":b=this.deviceAdr+":4";break;case "ch5lamellaTo":b=this.deviceAdr+":5";break;case "ch6lamellaTo":b=this.deviceAdr+":6"}e.getState({interface:this.deviceIF,channel:b,datapoint:"LEVEL"},function(A,B){if(A)a&&a(A);else if("undefined"==
typeof B||null==B)a&&a(Error("get blind current value return invalid"));else{var C=B.value;C=Math.round(100*C);f.BLIND_VIRTUAL_RECEIVER.executeCommand(e,y.deviceIF,b,"lamellaTo"+u,function(G,H){G?a&&a(G):f.BLIND_VIRTUAL_RECEIVER.executeCommand(e,y.deviceIF,b,"moveTo"+C,function(F,K){a&&a(F,K)})})}});break;default:a&&a(Error("no such command"))}};R.prototype.parseDptState=function(e,c,a){var b=e.indexOf(":");if(-1==b)return null;var f=e.substr(0,b);e=e.substr(b+1);var l=this.deviceAdr;b=this.deviceAdr.indexOf(":");
-1!=b&&(l=this.deviceAdr.substr(0,b));if(f!=l)return null;f=x.hub.m.hm._Channel["HmIP-RF"];b=null;if(0==e){if("UNREACH"==c)return f.MAINTENANCE.parseDptState(c,a);b={};b["0_"+c.toLowerCase()]=a;return b}if(3==e){if(a=f.BLIND_TRANSMITTER.parseDptState(c,a))b={},"LEVEL"==c?b.blindLevel=a.blindTPos:"LEVEL_2"==c&&(b.lamellaLevel=a.lamellaTPos);return b}if(4==e||5==e||6==e){if(a=f.BLIND_VIRTUAL_RECEIVER.parseDptState(c,a))switch(b={},parseInt(e)){case 4:"LEVEL"==c?b.ch4blindLevel=a.blindPos:"LEVEL_2"==
c&&(b.ch4lamellaLevel=a.lamellaPos);break;case 5:"LEVEL"==c?b.ch5blindLevel=a.blindPos:"LEVEL_2"==c&&(b.ch5lamellaLevel=a.lamellaPos);break;case 6:"LEVEL"==c?b.ch6blindLevel=a.blindPos:"LEVEL_2"==c&&(b.ch6lamellaLevel=a.lamellaPos)}return b}return null};R.prototype.getConfig=function(e,c){var a=this.deviceAdr+":3";e.getParamset(this.deviceIF,a,"MASTER",function(b,f){if(b)c&&c(b);else{var l={},t=null;f&&(t={CHANGE_OVER_DELAY:f.CHANGE_OVER_DELAY,REFERENCE_RUNNING_TIME_BOTTOM_TOP_UNIT:f.REFERENCE_RUNNING_TIME_BOTTOM_TOP_UNIT,
REFERENCE_RUNNING_TIME_BOTTOM_TOP_VALUE:f.REFERENCE_RUNNING_TIME_BOTTOM_TOP_VALUE,REFERENCE_RUNNING_TIME_TOP_BOTTOM_UNIT:f.REFERENCE_RUNNING_TIME_TOP_BOTTOM_UNIT,REFERENCE_RUNNING_TIME_TOP_BOTTOM_VALUE:f.REFERENCE_RUNNING_TIME_TOP_BOTTOM_VALUE,REFERENCE_RUNNING_TIME_SLATS_UNIT:f.REFERENCE_RUNNING_TIME_SLATS_UNIT,REFERENCE_RUNNING_TIME_SLATS_VALUE:f.REFERENCE_RUNNING_TIME_SLATS_VALUE,REFERENCE_RUN_COUNTER:f.REFERENCE_RUN_COUNTER});l[a]=t;c&&c(b,l)}})};R.prototype.setConfig=function(e,c,a){if(c){var b=
this.deviceAdr+":3";if(c=c[b]){var f={};f.CHANGE_OVER_DELAY={__rpcValueType:"double",__rpcValue:c.CHANGE_OVER_DELAY};f.REFERENCE_RUN_COUNTER=c.REFERENCE_RUN_COUNTER;f.REFERENCE_RUNNING_TIME_BOTTOM_TOP_UNIT={__rpcValueType:"double",__rpcValue:c.REFERENCE_RUNNING_TIME_BOTTOM_TOP_UNIT};f.REFERENCE_RUNNING_TIME_BOTTOM_TOP_VALUE={__rpcValueType:"double",__rpcValue:c.REFERENCE_RUNNING_TIME_BOTTOM_TOP_VALUE};f.REFERENCE_RUNNING_TIME_TOP_BOTTOM_UNIT={__rpcValueType:"double",__rpcValue:c.REFERENCE_RUNNING_TIME_TOP_BOTTOM_UNIT};
f.REFERENCE_RUNNING_TIME_TOP_BOTTOM_VALUE={__rpcValueType:"double",__rpcValue:c.REFERENCE_RUNNING_TIME_TOP_BOTTOM_VALUE};f.REFERENCE_RUNNING_TIME_SLATS_UNIT={__rpcValueType:"double",__rpcValue:c.REFERENCE_RUNNING_TIME_SLATS_UNIT};f.REFERENCE_RUNNING_TIME_SLATS_VALUE={__rpcValueType:"double",__rpcValue:c.REFERENCE_RUNNING_TIME_SLATS_VALUE};e.setParamset(this.deviceIF,b,"MASTER",f,function(l){a&&a(l)})}else a&&a(Error("config data not complete"))}else a&&a(Error("config data invalid"))};R.prototype.isButton=
function(){return!0};R.prototype.claimEvent=function(e,c){var a=this.deviceAdr;-1==a.indexOf(":")&&this.channel&&(a+=":"+this.channel);var b=this;this._claimButtonEvent(1,e,function(){b._claimButtonEvent(2,e,function(){c&&c()})})};R.prototype._claimButtonEvent=function(e,c,a){var b=this;c.reportValueUsage(this.deviceIF,this.deviceAdr+":"+e,"PRESS_SHORT",function(f,l){f&&console.error("button:"+e+" claim PRESS_SHORT event error:"+f.stack);c.reportValueUsage(b.deviceIF,b.deviceAdr+":"+e,"PRESS_LONG",
function(t,u){t&&console.error("button:"+e+" claim PRESS_LONG event error:"+t.stack);a&&a()})})};var Ha=function(e,c,a){p.call(this,e,c,a);this.channel=1;this.legacyType="ip_presence"};util.inherits(Ha,p);Ha.prototype._getReadableDpts=function(){var e=[],c=this,a=x.hub.m.hm._Channel["HmIP-RF"],b=a.MAINTENANCE_BAT_EL.getReadableDpts();b&&b.forEach(function(f){e.push({channel:c.deviceAdr+":0",dpt:f})});(b=a.PRESENCEDETECTOR_TRANSCEIVER.getReadableDpts())&&b.forEach(function(f){e.push({channel:c.deviceAdr+
":1",dpt:f})});return e};Ha.prototype._getDptFromRef=function(e){var c=this.deviceAdr,a={channel:c+":"+this.channel,dataPoint:null},b=x.hub.m.hm._Channel["HmIP-RF"];switch(e){case "timeout":case "lowbat":case "sabotage":a.channel=c+":0";a.dataPoint=b.MAINTENANCE_BAT_EL.getDptFromState(e);break;case "state":case "illumination":case "current_illumination":case "active":a.channel=c+":1";a.dataPoint=b.PRESENCEDETECTOR_TRANSCEIVER.getDptFromState(e);break;default:return null}return a};Ha.prototype.executeCommand=
function(e,c,a){var b=x.hub.m.hm._Channel["HmIP-RF"];switch(c){case "reset":case "activate":case "deactivate":case "toggleActivate":b.PRESENCEDETECTOR_TRANSCEIVER.executeCommand(e,this.deviceIF,this.deviceAdr+":1",c,a);break;default:a&&a(Error("no such command"))}};Ha.prototype.parseDptState=function(e,c,a){var b=e.indexOf(":");if(-1==b)return null;var f=e.substr(0,b);e=e.substr(b+1);var l=this.deviceAdr;b=this.deviceAdr.indexOf(":");-1!=b&&(l=this.deviceAdr.substr(0,b));if(f!=l)return null;b=x.hub.m.hm._Channel["HmIP-RF"];
if(0==e){if("UNREACH"==c||"LOW_BAT"==c||"SABOTAGE"==c)return b.MAINTENANCE_BAT_EL.parseDptState(c,a);b={};b["0_"+c.toLowerCase()]=a;return b}return 1==e?b.PRESENCEDETECTOR_TRANSCEIVER.parseDptState(c,a):null};var Ya=function(e,c,a){p.call(this,e,c,a);this.channel=1;this.legacyType="ip_floor_heater"};util.inherits(Ya,p);Ya.prototype._getReadableDpts=function(){var e=[],c=this,a=x.hub.m.hm._Channel["HmIP-RF"].CLIMATECONTROL_FLOOR_TRANSCEIVER.getReadableDpts();a&&a.forEach(function(b){e.push({channel:c.deviceAdr+
":"+c.channel,dpt:b})});return e};Ya.prototype._getDptFromRef=function(e){var c=this.deviceAdr,a={channel:c+":"+this.channel,dataPoint:null},b=x.hub.m.hm._Channel["HmIP-RF"];switch(e){case "cl_f_humidityLimiter":case "cl_f_emergencyOP":case "cl_f_frostProtection":case "cl_f_state":case "cl_f_dewPointAlarm":case "cl_f_externalClock":a.channel=c+":"+this.channel;a.dataPoint=b.CLIMATECONTROL_FLOOR_TRANSCEIVER.getDptFromState(e);break;default:return null}return a};Ya.prototype.parseDptState=function(e,
c,a){var b=e.indexOf(":");if(-1==b)return null;var f=e.substr(0,b);e=e.substr(b+1);var l=this.deviceAdr;b=this.deviceAdr.indexOf(":");-1!=b&&(l=this.deviceAdr.substr(0,b));if(f!=l)return null;b=x.hub.m.hm._Channel["HmIP-RF"];return e==this.channel?b.CLIMATECONTROL_FLOOR_TRANSCEIVER.parseDptState(c,a):null};var Za=function(e,c,a){p.call(this,e,c,a);this.channel=1;this.legacyType="ip_floor_pump_heater"};util.inherits(Za,p);Za.prototype._getReadableDpts=function(){var e=[],c=this,a=x.hub.m.hm._Channel["HmIP-RF"].CLIMATECONTROL_FLOOR_PUMP_TRANSCEIVER.getReadableDpts();
a&&a.forEach(function(b){e.push({channel:c.deviceAdr+":"+c.channel,dpt:b})});return e};Za.prototype._getDptFromRef=function(e){var c=this.deviceAdr,a={channel:c+":"+this.channel,dataPoint:null},b=x.hub.m.hm._Channel["HmIP-RF"];switch(e){case "cl_fp_humidityLimiter":case "cl_fp_emergencyOP":case "cl_fp_frostProtection":case "cl_fp_state":case "cl_fp_dewPointAlarm":case "cl_fp_externalClock":a.channel=c+":"+this.channel;a.dataPoint=b.CLIMATECONTROL_FLOOR_PUMP_TRANSCEIVER.getDptFromState(e);break;default:return null}return a};
Za.prototype.parseDptState=function(e,c,a){var b=e.indexOf(":");if(-1==b)return null;var f=e.substr(0,b);e=e.substr(b+1);var l=this.deviceAdr;b=this.deviceAdr.indexOf(":");-1!=b&&(l=this.deviceAdr.substr(0,b));if(f!=l)return null;b=x.hub.m.hm._Channel["HmIP-RF"];return e==this.channel?b.CLIMATECONTROL_FLOOR_PUMP_TRANSCEIVER.parseDptState(c,a):null};var $a=function(e,c,a){p.call(this,e,c,a);this.channel=1;this.legacyType="ip_weather"};util.inherits($a,p);$a.prototype._getReadableDpts=function(){var e=
[],c=this,a=x.hub.m.hm._Channel["HmIP-RF"],b=a.MAINTENANCE_BAT_CL.getReadableDpts();b&&b.forEach(function(f){e.push({channel:c.deviceAdr+":0",dpt:f})});(b=a.WEATHER_TRANSMIT.getReadableDpts())&&b.forEach(function(f){-1==f.indexOf("RAIN")&&-1==f.indexOf("WIND_DIR")&&e.push({channel:c.deviceAdr+":1",dpt:f})});return e};$a.prototype._getDptFromRef=function(e){var c=this.deviceAdr,a={channel:c+":"+this.channel,dataPoint:null},b=x.hub.m.hm._Channel["HmIP-RF"];switch(e){case "timeout":case "lowbat":a.channel=
c+":0";a.dataPoint=b.MAINTENANCE_BAT_CL.getDptFromState(e);break;default:a.channel=c+":1";e=b.WEATHER_TRANSMIT.getDptFromState(e);if(!e)return null;a.dataPoint=e}return a};$a.prototype.parseDptState=function(e,c,a){var b=e.indexOf(":");if(-1==b)return null;var f=e.substr(0,b);e=e.substr(b+1);var l=this.deviceAdr;b=this.deviceAdr.indexOf(":");-1!=b&&(l=this.deviceAdr.substr(0,b));if(f!=l)return null;b=x.hub.m.hm._Channel["HmIP-RF"];if(0==e){if("UNREACH"==c||"LOW_BAT"==c)return b.MAINTENANCE_BAT_CL.parseDptState(c,
a);b={};b["0_"+c.toLowerCase()]=a;return b}return 1==e?b.WEATHER_TRANSMIT.parseDptState(c,a):null};var ab=function(e,c,a){p.call(this,e,c,a);this.channel=1;this.legacyType="ip_weather2"};util.inherits(ab,p);ab.prototype._getReadableDpts=function(){var e=[],c=this,a=x.hub.m.hm._Channel["HmIP-RF"],b=a.MAINTENANCE_BAT_CL.getReadableDpts();b&&b.forEach(function(f){e.push({channel:c.deviceAdr+":0",dpt:f})});(b=a.WEATHER_TRANSMIT.getReadableDpts())&&b.forEach(function(f){-1==f.indexOf("WIND_DIR")&&e.push({channel:c.deviceAdr+
":1",dpt:f})});return e};ab.prototype._getDptFromRef=function(e){var c=this.deviceAdr,a={channel:c+":"+this.channel,dataPoint:null},b=x.hub.m.hm._Channel["HmIP-RF"];switch(e){case "timeout":case "lowbat":a.channel=c+":0";a.dataPoint=b.MAINTENANCE_BAT_CL.getDptFromState(e);break;default:a.channel=c+":1";e=b.WEATHER_TRANSMIT.getDptFromState(e);if(!e)return null;a.dataPoint=e}return a};ab.prototype.parseDptState=function(e,c,a){var b=e.indexOf(":");if(-1==b)return null;var f=e.substr(0,b);e=e.substr(b+
1);var l=this.deviceAdr;b=this.deviceAdr.indexOf(":");-1!=b&&(l=this.deviceAdr.substr(0,b));if(f!=l)return null;b=x.hub.m.hm._Channel["HmIP-RF"];if(0==e){if("UNREACH"==c||"LOW_BAT"==c)return b.MAINTENANCE_BAT_CL.parseDptState(c,a);b={};b["0_"+c.toLowerCase()]=a;return b}return 1==e?b.WEATHER_TRANSMIT.parseDptState(c,a):null};var bb=function(e,c,a){p.call(this,e,c,a);this.channel=1;this.legacyType="ip_weather3"};util.inherits(bb,p);bb.prototype._getReadableDpts=function(){var e=[],c=this,a=x.hub.m.hm._Channel["HmIP-RF"],
b=a.MAINTENANCE_BAT_CL.getReadableDpts();b&&b.forEach(function(f){e.push({channel:c.deviceAdr+":0",dpt:f})});(b=a.CLIMATE_TRANSCEIVER.getReadableDpts())&&b.forEach(function(f){e.push({channel:c.deviceAdr+":1",dpt:f})});return e};bb.prototype._getDptFromRef=function(e){var c=this.deviceAdr,a={channel:c+":"+this.channel,dataPoint:null},b=x.hub.m.hm._Channel["HmIP-RF"];switch(e){case "timeout":case "lowbat":a.channel=c+":0";a.dataPoint=b.MAINTENANCE_BAT_CL.getDptFromState(e);break;default:a.channel=
c+":1";e=b.CLIMATE_TRANSCEIVER.getDptFromState(e);if(!e)return null;a.dataPoint=e}return a};bb.prototype.parseDptState=function(e,c,a){var b=e.indexOf(":");if(-1==b)return null;var f=e.substr(0,b);e=e.substr(b+1);var l=this.deviceAdr;b=this.deviceAdr.indexOf(":");-1!=b&&(l=this.deviceAdr.substr(0,b));if(f!=l)return null;b=x.hub.m.hm._Channel["HmIP-RF"];if(0==e){if("UNREACH"==c||"LOW_BAT"==c)return b.MAINTENANCE_BAT_CL.parseDptState(c,a);b={};b["0_"+c.toLowerCase()]=a;return b}return 1==e?b.CLIMATE_TRANSCEIVER.parseDptState(c,
a):null};var cb=function(e,c,a){p.call(this,e,c,a);this.channel=1;this.legacyType="ip_weather4"};util.inherits(cb,p);cb.prototype._getReadableDpts=function(){var e=[],c=this,a=x.hub.m.hm._Channel["HmIP-RF"],b=a.MAINTENANCE_BAT_CL.getReadableDpts();b&&b.forEach(function(f){e.push({channel:c.deviceAdr+":0",dpt:f})});(b=a.WEATHER_TRANSMIT.getReadableDpts())&&b.forEach(function(f){-1==f.indexOf("WIND_DIR")&&e.push({channel:c.deviceAdr+":1",dpt:f})});return e};cb.prototype._getDptFromRef=function(e){var c=
this.deviceAdr,a={channel:c+":"+this.channel,dataPoint:null},b=x.hub.m.hm._Channel["HmIP-RF"];switch(e){case "timeout":case "lowbat":a.channel=c+":0";a.dataPoint=b.MAINTENANCE_BAT_CL.getDptFromState(e);break;default:a.channel=c+":1";e=b.WEATHER_TRANSMIT.getDptFromState(e);if(!e)return null;a.dataPoint=e}return a};cb.prototype.parseDptState=function(e,c,a){var b=e.indexOf(":");if(-1==b)return null;var f=e.substr(0,b);e=e.substr(b+1);var l=this.deviceAdr;b=this.deviceAdr.indexOf(":");-1!=b&&(l=this.deviceAdr.substr(0,
b));if(f!=l)return null;b=x.hub.m.hm._Channel["HmIP-RF"];if(0==e){if("UNREACH"==c||"LOW_BAT"==c)return b.MAINTENANCE_BAT_CL.parseDptState(c,a);b={};b["0_"+c.toLowerCase()]=a;return b}return 1==e?b.WEATHER_TRANSMIT.parseDptState(c,a):null};var Ia=function(e,c,a){p.call(this,e,c,a);this.channel=2;this.legacyType="ip_direction"};util.inherits(Ia,p);Ia.prototype._getReadableDpts=function(){var e=[],c=this,a=x.hub.m.hm._Channel["HmIP-RF"],b=a.MAINTENANCE_BAT_EL.getReadableDpts();b&&b.forEach(function(f){e.push({channel:c.deviceAdr+
":0",dpt:f})});(b=a.PASSAGE_DETECTOR_DIRECTION_TRANSMITTER.getReadableDpts())&&b.forEach(function(f){e.push({channel:c.deviceAdr+":2",dpt:f});e.push({channel:c.deviceAdr+":3",dpt:f})});return e};Ia.prototype._getDptFromRef=function(e){var c=this.deviceAdr,a={channel:c+":"+this.channel,dataPoint:null},b=x.hub.m.hm._Channel["HmIP-RF"];switch(e){case "timeout":case "lowbat":a.channel=c+":0";a.dataPoint=b.MAINTENANCE_BAT_EL.getDptFromState(e);break;case "ch2State":a.channel=c+":2";a.dataPoint=b.SWITCH_VIRTUAL_RECEIVER.getDptFromState("switchState");
break;case "ch3State":a.channel=c+":3";a.dataPoint=b.SWITCH_VIRTUAL_RECEIVER.getDptFromState("switchState");break;case "ch4State":a.channel=c+":4";a.dataPoint=b.SWITCH_VIRTUAL_RECEIVER.getDptFromState("switchState");break;default:a.channel=c+":2";e=b.PASSAGE_DETECTOR_DIRECTION_TRANSMITTER.getDptFromState(e);if(!e)return null;a.dataPoint=e}return a};Ia.prototype.parseDptState=function(e,c,a){var b=e.indexOf(":");if(-1==b)return null;var f=e.substr(0,b);e=e.substr(b+1);var l=this.deviceAdr;b=this.deviceAdr.indexOf(":");
-1!=b&&(l=this.deviceAdr.substr(0,b));if(f!=l)return null;f=x.hub.m.hm._Channel["HmIP-RF"];b=null;if(0==e){if("UNREACH"==c||"LOW_BAT"==c)return f.MAINTENANCE_BAT_EL.parseDptState(c,a);b={};b["0_"+c.toLowerCase()]=a;return b}if(2==e){if(c=f.PASSAGE_DETECTOR_DIRECTION_TRANSMITTER.parseDptState(c,a))b={},"undefined"!=typeof c.current_direction&&(b.current_passage_r2l=c.current_direction),"undefined"!=typeof c.last_direction&&(b.last_passage_r2l=c.last_direction),"undefined"!=typeof c.passage_counter&&
(b.r2l_passage_counter=c.passage_counter),"undefined"!=typeof c.passage_counter_overflow&&(b.r2l_passage_counter_overflow=c.passage_counter_overflow);return b}if(3==e){if(c=f.PASSAGE_DETECTOR_DIRECTION_TRANSMITTER.parseDptState(c,a))b={},"undefined"!=typeof c.current_direction&&(b.current_passage_l2r=c.current_direction),"undefined"!=typeof c.last_direction&&(b.last_passage_l2r=c.last_direction),"undefined"!=typeof c.passage_counter&&(b.l2r_passage_counter=c.passage_counter),"undefined"!=typeof c.passage_counter_overflow&&
(b.l2r_passage_counter_overflow=c.passage_counter_overflow);return b}return null};Ia.prototype.parseStates=function(e){var c={},a;for(a in e){var b=this.parseChnState(a,e[a]);b&&(c=x.hub.m.hm._Util.mergeObj(c,b))}c.current_passage_r2l&&c.current_passage_l2r&&(c.current_direction=c.current_passage_r2l.value?{value:"right_to_left",time:c.current_passage_r2l.time}:{value:"left_to_right",time:c.current_passage_l2r.time});c.last_passage_r2l&&c.last_passage_l2r&&(c.last_direction=c.last_passage_r2l.value?
{value:"right_to_left",time:c.last_passage_r2l.time}:{value:"left_to_right",time:c.last_passage_l2r.time});delete c.current_passage_r2l;delete c.current_passage_l2r;delete c.last_passage_r2l;delete c.last_passage_l2r;return c};var la=function(e,c,a){p.call(this,e,c,a);this.channel=1;this.legacyType="ip_button8"};util.inherits(la,p);la.prototype._getReadableDpts=function(){var e=[],c=this,a=x.hub.m.hm._Channel["HmIP-RF"].MAINTENANCE_BAT_EL.getReadableDpts();a&&a.forEach(function(b){"SABOTAGE"!=b&&
e.push({channel:c.deviceAdr+":0",dpt:b})});return e};la.prototype._getDptFromRef=function(e){var c=this.deviceAdr,a={channel:c+":"+this.channel,dataPoint:null},b=x.hub.m.hm._Channel["HmIP-RF"];switch(e){case "timeout":case "lowbat":a.channel=c+":0";a.dataPoint=b.MAINTENANCE_BAT_EL.getDptFromState(e);break;default:return null}return a};la.prototype.parseDptState=function(e,c,a){var b=e.indexOf(":");if(-1==b)return null;var f=e.substr(0,b);e=e.substr(b+1);var l=this.deviceAdr;b=this.deviceAdr.indexOf(":");
-1!=b&&(l=this.deviceAdr.substr(0,b));if(f!=l)return null;f=x.hub.m.hm._Channel["HmIP-RF"];b=null;if(0==e){if("UNREACH"==c||"LOW_BAT"==c)return f.MAINTENANCE_BAT_EL.parseDptState(c,a);b={};b["0_"+c.toLowerCase()]=a;return b}if(1==e||2==e||3==e||4==e||5==e||6==e||7==e||8==e)if(c=f.KEY_TRANRECEIVER.parseDptState(c,a))b||(b={}),c.pressShort&&(b["btn"+e+"pressShort"]=!0),c.pressLong&&(b["btn"+e+"pressLong"]=!0);return b};la.prototype.isButton=function(){return!0};la.prototype.claimEvent=function(e,c){var a=
this.deviceAdr;-1==a.indexOf(":")&&this.channel&&(a+=":"+this.channel);var b=this;this._claimButtonEvent(1,e,function(){b._claimButtonEvent(2,e,function(){b._claimButtonEvent(3,e,function(){b._claimButtonEvent(4,e,function(){b._claimButtonEvent(5,e,function(){b._claimButtonEvent(6,e,function(){b._claimButtonEvent(7,e,function(){b._claimButtonEvent(8,e,function(){c&&c()})})})})})})})})};la.prototype._claimButtonEvent=function(e,c,a){var b=this;c.reportValueUsage(this.deviceIF,this.deviceAdr+":"+e,
"PRESS_SHORT",function(f,l){f&&console.error("button:"+e+" claim PRESS_SHORT event error:"+f.stack);c.reportValueUsage(b.deviceIF,b.deviceAdr+":"+e,"PRESS_LONG",function(t,u){t&&console.error("button:"+e+" claim PRESS_LONG event error:"+t.stack);a&&a()})})};var db=function(e,c,a){p.call(this,e,c,a);this.channel=1;this.legacyType="ip_generic_input"};util.inherits(db,p);db.prototype._getReadableDpts=function(){var e=[],c=this,a=x.hub.m.hm._Channel["HmIP-RF"].GENERIC_INPUT_TRANSMITER.getReadableDpts();
a&&a.forEach(function(b){e.push({channel:c.deviceAdr+":"+c.channel,dpt:b})});return e};db.prototype._getDptFromRef=function(e){var c=this.deviceAdr,a={channel:c+":"+this.channel,dataPoint:null},b=x.hub.m.hm._Channel["HmIP-RF"];a.channel=c+":"+this.channel;e=b.GENERIC_INPUT_TRANSMITER.getDptFromState(e);if(!e)return null;a.dataPoint=e;return a};db.prototype.parseDptState=function(e,c,a){var b=e.indexOf(":");if(-1==b)return null;var f=e.substr(0,b);e=e.substr(b+1);var l=this.deviceAdr;b=this.deviceAdr.indexOf(":");
-1!=b&&(l=this.deviceAdr.substr(0,b));if(f!=l)return null;b=x.hub.m.hm._Channel["HmIP-RF"];return e==this.channel?b.GENERIC_INPUT_TRANSMITER.parseDptState(c,a):null};var Ja=function(e,c,a){p.call(this,e,c,a);this.channel=1;this.legacyType="ip_analog_output"};util.inherits(Ja,p);Ja.prototype._getReadableDpts=function(){var e=[],c=this,a=x.hub.m.hm._Channel["HmIP-RF"].ANALOG_OUTPUT_TRANSCEIVER.getReadableDpts();a&&a.forEach(function(b){e.push({channel:c.deviceAdr+":"+c.channel,dpt:b})});return e};Ja.prototype._getDptFromRef=
function(e){var c=this.deviceAdr,a={channel:c+":"+this.channel,dataPoint:null},b=x.hub.m.hm._Channel["HmIP-RF"];switch(e){case "outputLevel":a.channel=c+":"+this.channel;a.dataPoint=b.ANALOG_OUTPUT_TRANSCEIVER.getDptFromState("outputLevel");break;default:return null}return a};Ja.prototype.executeCommand=function(e,c,a){x.hub.m.hm._Channel["HmIP-RF"].ANALOG_OUTPUT_TRANSCEIVER.executeCommand(e,this.deviceIF,this.deviceAdr+":"+this.channel,c,function(b,f){a&&a(b,f)})};Ja.prototype.parseDptState=function(e,
c,a){var b=e.indexOf(":");if(-1==b)return null;var f=e.substr(0,b);e=e.substr(b+1);var l=this.deviceAdr;b=this.deviceAdr.indexOf(":");-1!=b&&(l=this.deviceAdr.substr(0,b));if(f!=l)return null;b=x.hub.m.hm._Channel["HmIP-RF"];f=null;e==this.channel&&(f=b.ANALOG_OUTPUT_TRANSCEIVER.parseDptState(c,a));return f};var eb=function(e,c,a){p.call(this,e,c,a);this.channel=1;this.legacyType="ip_water"};util.inherits(eb,p);eb.prototype._getReadableDpts=function(){var e=[],c=this,a=x.hub.m.hm._Channel["HmIP-RF"],
b=a.MAINTENANCE_BAT_CL.getReadableDpts();b&&b.forEach(function(f){e.push({channel:c.deviceAdr+":0",dpt:f})});(b=a.WATER_DETECTION_TRANSMITTER.getReadableDpts())&&b.forEach(function(f){e.push({channel:c.deviceAdr+":1",dpt:f})});return e};eb.prototype._getDptFromRef=function(e){var c=this.deviceAdr,a={channel:c+":"+this.channel,dataPoint:null},b=x.hub.m.hm._Channel["HmIP-RF"];switch(e){case "timeout":case "lowbat":a.channel=c+":0";a.dataPoint=b.MAINTENANCE_BAT_CL.getDptFromState(e);break;case "alarm":case "moisture":case "water":a.channel=
c+":1";a.dataPoint=b.WATER_DETECTION_TRANSMITTER.getDptFromState(e);break;default:return null}return a};eb.prototype.parseDptState=function(e,c,a){var b=e.indexOf(":");if(-1==b)return null;var f=e.substr(0,b);e=e.substr(b+1);var l=this.deviceAdr;b=this.deviceAdr.indexOf(":");-1!=b&&(l=this.deviceAdr.substr(0,b));if(f!=l)return null;b=x.hub.m.hm._Channel["HmIP-RF"];if(0==e){if("UNREACH"==c||"LOW_BAT"==c||"ERROR_NON_FLAT_POSITIONING"==c)return b.MAINTENANCE_BAT_CL.parseDptState(c,a);b={};b["0_"+c.toLowerCase()]=
a;return b}return 1==e?b.WATER_DETECTION_TRANSMITTER.parseDptState(c,a):null};var fb=function(e,c,a){p.call(this,e,c,a);this.channel=1;this.legacyType="ip_acce"};util.inherits(fb,p);fb.prototype._getReadableDpts=function(){var e=[],c=this,a=x.hub.m.hm._Channel["HmIP-RF"],b=a.MAINTENANCE_BAT_EL.getReadableDpts();b&&b.forEach(function(f){"SABOTAGE"!=f&&e.push({channel:c.deviceAdr+":0",dpt:f})});(b=a.ACCELERATION_TRANSCEIVER.getReadableDpts())&&b.forEach(function(f){e.push({channel:c.deviceAdr+":1",
dpt:f})});return e};fb.prototype._getDptFromRef=function(e){var c=this.deviceAdr,a={channel:c+":"+this.channel,dataPoint:null},b=x.hub.m.hm._Channel["HmIP-RF"];switch(e){case "timeout":case "lowbat":case "volatage":case "errorCode":case "sensorError":a.channel=c+":0";a.dataPoint=b.MAINTENANCE_BAT_EL.getDptFromState(e);break;case "motion":a.channel=c+":1";a.dataPoint=b.ACCELERATION_TRANSCEIVER.getDptFromState(e);break;default:return null}return a};fb.prototype.parseDptState=function(e,c,a){var b=e.indexOf(":");
if(-1==b)return null;var f=e.substr(0,b);e=e.substr(b+1);var l=this.deviceAdr;b=this.deviceAdr.indexOf(":");-1!=b&&(l=this.deviceAdr.substr(0,b));if(f!=l)return null;b=x.hub.m.hm._Channel["HmIP-RF"];if(0==e){if("UNREACH"==c||"LOW_BAT"==c||"OPERATING_VOLTAGE"==c||"ERROR_CODE"==c||"SENSOR_ERROR"==c)return b.MAINTENANCE_BAT_EL.parseDptState(c,a);b={};b["0_"+c.toLowerCase()]=a;return b}return 1==e?b.ACCELERATION_TRANSCEIVER.parseDptState(c,a):null};var Z=function(e,c,a){p.call(this,e,c,a);this.channel=
1;this.legacyType="ip_garagedoor"};util.inherits(Z,p);Z.prototype._getReadableDpts=function(){var e=[],c=this,a=x.hub.m.hm._Channel["HmIP-RF"].MAINTENANCE_BAT_EL.getReadableDpts();a&&a.forEach(function(b){"SABOTAGE"!=b&&e.push({channel:c.deviceAdr+":0",dpt:b})});return e};Z.prototype._getDptFromRef=function(e){var c=this.deviceAdr,a={channel:c+":"+this.channel,dataPoint:null},b=x.hub.m.hm._Channel["HmIP-RF"];switch(e){case "timeout":case "lowbat":case "voltage":case "errorCode":a.channel=c+":0";a.dataPoint=
b.MAINTENANCE_BAT_EL.getDptFromState(e);break;default:return null}return a};Z.prototype.executeCommand=function(e,c,a){var b=x.hub.m.hm._Channel["HmIP-RF"];switch(c){case "on":var f=this.deviceAdr+":3";b.SWITCH_VIRTUAL_RECEIVER.executeCommand(e,this.deviceIF,f,"onFor0.5",a);break;default:"onFor"==c.substr(0,5)?(f=this.deviceAdr+":3",b.SWITCH_VIRTUAL_RECEIVER.executeCommand(e,this.deviceIF,f,c,a)):a&&a(Error("no such command"))}};Z.prototype.parseDptState=function(e,c,a){var b=e.indexOf(":");if(-1==
b)return null;var f=e.substr(0,b);e=e.substr(b+1);var l=this.deviceAdr;b=this.deviceAdr.indexOf(":");-1!=b&&(l=this.deviceAdr.substr(0,b));if(f!=l)return null;f=x.hub.m.hm._Channel["HmIP-RF"];b=null;if(0==e){if("UNREACH"==c||"LOW_BAT"==c||"OPERATING_VOLTAGE"==c||"ERROR_CODE"==c)return f.MAINTENANCE_BAT_EL.parseDptState(c,a);b={};b["0_"+c.toLowerCase()]=a;return b}if(1==e){if(c=f.KEY_TRANRECEIVER.parseDptState(c,a))b||(b={}),c.pressShort&&(b.btnPressShort=!0),c.pressLong&&(b.btnPressLong=!0);return b}return null};
Z.prototype.isButton=function(){return!0};Z.prototype.claimEvent=function(e,c){this._claimButtonEvent(1,e,function(){c&&c()})};Z.prototype._claimButtonEvent=function(e,c,a){var b=this;c.reportValueUsage(this.deviceIF,this.deviceAdr+":"+e,"PRESS_SHORT",function(f,l){f&&console.error("button:"+e+" claim PRESS_SHORT event error:"+f.stack);c.reportValueUsage(b.deviceIF,b.deviceAdr+":"+e,"PRESS_LONG",function(t,u){t&&console.error("button:"+e+" claim PRESS_LONG event error:"+t.stack);a&&a()})})};var nb=
function(){var e=function(c,a,b){p.call(this,c,a,b);this._chMaintenance=0;this._chKeyTransceiver1=1;this._chKeyTransceiver2=2;this._chSwitchTransmitter3=3;this._chSwitchVirtualReceiver4=4;this._chDimmerTransmitter7=7;this._chDimmerVirtualReceiver8=8;this._chDimmerTransmitter11=11;this._chDimmerVirtualReceiver12=12;this._chDimmerWeekProfile=15;this.legacyType="ip_bsl"};util.inherits(e,p);e.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":"+this._chMaintenance,dpt:"UNREACH"},{channel:this.deviceAdr+
":"+this._chSwitchTransmitter3,dpt:"STATE"},{channel:this.deviceAdr+":"+this._chDimmerTransmitter7,dpt:"LEVEL"},{channel:this.deviceAdr+":"+this._chDimmerTransmitter7,dpt:"COLOR"},{channel:this.deviceAdr+":"+this._chDimmerTransmitter11,dpt:"LEVEL"},{channel:this.deviceAdr+":"+this._chDimmerTransmitter11,dpt:"COLOR"}]};e.prototype._getDptFromRef=function(c){var a={channel:this.getSerial()+":",dataPoint:null};switch(c){case "timeout":a.channel+=this._chMaintenance;a.dataPoint="UNREACH";break;case "state":a.channel+=
this._chSwitchTransmitter3;a.dataPoint="STATE";break;case "led1Level":a.channel+=this._chDimmerTransmitter7;a.dataPoint="LEVEL";break;case "led1Color":a.channel+=this._chDimmerTransmitter7;a.dataPoint="COLOR";break;case "led2Level":a.channel+=this._chDimmerTransmitter11;a.dataPoint="LEVEL";break;case "led2Color":a.channel+=this._chDimmerTransmitter11;a.dataPoint="COLOR";break;default:return null}return a};e.prototype.executeCommand=function(c,a,b){var f=x.hub.m.hm._Channel["HmIP-RF"],l=this.getSerial();
var t=a;if(-1!=a.indexOf("dimUp")){var u=a.indexOf("dimUp");t=a.substr(0,u+5);u=a.substr(u)}else-1!=a.indexOf("dimDown")?(u=a.indexOf("dimDown"),t=a.substr(0,u+7),u=a.substr(u)):-1!=a.indexOf("dimTo")?(u=a.indexOf("dimTo"),t=a.substr(0,u+5),u=a.substr(u)):-1!=a.indexOf("toggleTo")?(u=a.indexOf("toggleTo"),t=a.substr(0,u+8),u=a.substr(u)):-1!=a.indexOf("colorTo")&&(u=a.indexOf("colorTo"),t=a.substr(0,u+7),u=a.substr(u));switch(t){case "on":case "off":case "toggle":a=l+":"+this._chSwitchVirtualReceiver4;
f.SWITCH_VIRTUAL_RECEIVER.executeCommand(c,this.deviceIF,a,t,b);break;case "led1on":case "led1off":case "led1dimUp":case "led1dimDown":case "led1dimTo":case "led1toggleTo":case "led1colorTo":case "led2on":case "led2off":case "led2dimUp":case "led2dimDown":case "led2dimTo":case "led2toggleTo":case "led2colorTo":a="led1"==t.substr(0,4)?l+":"+this._chDimmerVirtualReceiver12:l+":"+this._chDimmerVirtualReceiver8;"led1on"==t?u="dimTo100":"led1off"==t?u="dimOff":"led2on"==t?u="dimTo100":"led2off"==t&&(u=
"dimOff");f.DIMMER_VIRTUAL_RECEIVER.executeCommand(c,this.deviceIF,a,u,b);break;default:"onFor"==t.substr(0,5)?(a=l+":"+this._chSwitchVirtualReceiver4,f.SWITCH_VIRTUAL_RECEIVER.executeCommand(c,this.deviceIF,a,t,b)):b&&b(Error("no such command"))}};e.prototype.parseDptState=function(c,a,b){var f=c.indexOf(":");if(-1==f)return null;var l=c.substr(0,f);c=c.substr(f+1);f=this.getSerial();if(l!=f)return null;l=x.hub.m.hm._Channel["HmIP-RF"];switch(parseInt(c)){case this._chMaintenance:switch(a){case "UNREACH":return l.MAINTENANCE.parseDptState(a,
b);default:var t={};t["0_"+a.toLowerCase()]=b;return t}case this._chKeyTransceiver1:case this._chKeyTransceiver2:if(b=l.KEY_TRANRECEIVER.parseDptState(a,b))t||(t={}),b.pressShort&&(t["btn"+c+"pressShort"]=!0),b.pressLong&&(t["btn"+c+"pressLong"]=!0);return t;case this._chSwitchTransmitter3:switch(a){case "STATE":if(b=l.SWITCH_TRANSMITTER.parseDptState(a,b))t={},t.state=b.switchTState;return t;default:return null}case this._chDimmerTransmitter7:if(b=l.DIMMER_TRANSMITTER.parseDptState(a,b))t={},"LEVEL"==
a?t.led2Level=b.dimmerTLevel:"COLOR"==a&&(t.led2Color=b.dimmerTColor);return t;case this._chDimmerTransmitter11:if(b=l.DIMMER_TRANSMITTER.parseDptState(a,b))t={},"LEVEL"==a?t.led1Level=b.dimmerTLevel:"COLOR"==a&&(t.led1Color=b.dimmerTColor);return t;default:return null}};e.prototype.isButton=function(){return!0};e.prototype.claimEvent=function(c,a){var b=this.getSerial(),f=this;c.reportValueUsage(this.deviceIF,b+":"+this._chKeyTransceiver1,"PRESS_SHORT",function(l,t){l&&console.error("button:1 claim PRESS_SHORT event error:"+
l.stack);c.reportValueUsage(f.deviceIF,b+":"+f._chKeyTransceiver1,"PRESS_LONG",function(u,y){u&&console.error("button:1 claim PRESS_LONG event error:"+u.stack);c.reportValueUsage(f.deviceIF,b+":"+f._chKeyTransceiver2,"PRESS_SHORT",function(A,B){A&&console.error("button:2 claim PRESS_SHORT event error:"+A.stack);c.reportValueUsage(f.deviceIF,b+":"+f._chKeyTransceiver2,"PRESS_LONG",function(C,G){C&&console.error("button:2 claim PRESS_LONG event error:"+C.stack);a&&a()})})})})};return e}(),ob=function(){var e=
function(c,a,b){p.call(this,c,a,b);this._chMaintenance=0;this._chDoorReceiver=1;this._chSimpleSwitchReceiver=2;this.legacyType="ip_tormatic"};util.inherits(e,p);e.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":"+this._chMaintenance,dpt:"UNREACH"},{channel:this.deviceAdr+":"+this._chDoorReceiver,dpt:"DOOR_STATE"},{channel:this.deviceAdr+":"+this._chSimpleSwitchReceiver,dpt:"STATE"}]};e.prototype._getDptFromRef=function(c){var a={channel:this.getSerial()+":",dataPoint:null};
switch(c){case "timeout":a.channel+=this._chMaintenance;a.dataPoint="UNREACH";break;case "doorState":a.channel+=this._chDoorReceiver;a.dataPoint="DOOR_STATE";break;case "lightState":a.channel+=this._chSimpleSwitchReceiver;a.dataPoint="STATE";break;default:return null}return a};e.prototype.executeCommand=function(c,a,b){var f=x.hub.m.hm._Channel["HmIP-RF"],l=this.getSerial();switch(a){case "open":case "close":case "partialOpen":case "stop":l=l+":"+this._chDoorReceiver;f.DOOR_RECEIVER.executeCommand(c,
this.deviceIF,l,a,b);break;case "lightOn":case "lightOff":case "lightToggle":a=a.substr(5).toLowerCase();l=l+":"+this._chSimpleSwitchReceiver;f.SIMPLE_SWITCH_RECEIVER.executeCommand(c,this.deviceIF,l,a,b);break;default:b&&b(Error("no such command"))}};e.prototype.parseDptState=function(c,a,b){var f=c.indexOf(":");if(-1==f)return null;var l=c.substr(0,f);c=c.substr(f+1);f=this.getSerial();if(l!=f)return null;l=x.hub.m.hm._Channel["HmIP-RF"];switch(parseInt(c)){case this._chMaintenance:switch(a){case "UNREACH":return l.MAINTENANCE.parseDptState(a,
b);default:var t={};t["0_"+a.toLowerCase()]=b;return t}case this._chDoorReceiver:return(a=l.DOOR_RECEIVER.parseDptState(a,b))&&(t=a),t;case this._chSimpleSwitchReceiver:if(a=l.SIMPLE_SWITCH_RECEIVER.parseDptState(a,b))t={},t.lightState=a.state;return t;default:return null}};return e}(),pb=function(){var e=function(c,a,b){p.call(this,c,a,b);this._chMaintenance=0;this._chBrightness=1;this.legacyType="ip_lux"};util.inherits(e,p);e.prototype._getReadableDpts=function(){var c=[],a=this,b=x.hub.m.hm._Channel["HmIP-RF"],
f=b.MAINTENANCE_BAT_EL.getReadableDpts();f&&f.forEach(function(l){"SABOTAGE"!=l&&"ERROR_CODE"!=l&&"SENSOR_ERROR"!=l&&c.push({channel:a.deviceAdr+":0",dpt:l})});(f=b.BRIGHTNESS_TRANSMITTER.getReadableDpts())&&f.forEach(function(l){c.push({channel:a.deviceAdr+":1",dpt:l})});return c};e.prototype._getDptFromRef=function(c){var a=this.deviceAdr,b={channel:a+":"+this.channel,dataPoint:null},f=x.hub.m.hm._Channel["HmIP-RF"];switch(c){case "timeout":case "lowbat":case "volatage":b.channel=a+":0";b.dataPoint=
f.MAINTENANCE_BAT_EL.getDptFromState(c);break;case "illu":case "avgIllu":case "maxIllu":case "minIllu":b.channel=a+":1";b.dataPoint=f.BRIGHTNESS_TRANSMITTER.getDptFromState(c);break;default:return null}return b};e.prototype.parseDptState=function(c,a,b){var f=c.indexOf(":");if(-1==f)return null;var l=c.substr(0,f);c=c.substr(f+1);var t=this.deviceAdr;f=this.deviceAdr.indexOf(":");-1!=f&&(t=this.deviceAdr.substr(0,f));if(l!=t)return null;f=x.hub.m.hm._Channel["HmIP-RF"];if(0==c){if("UNREACH"==a||"LOW_BAT"==
a||"OPERATING_VOLTAGE"==a)return f.MAINTENANCE_BAT_EL.parseDptState(a,b);f={};f["0_"+a.toLowerCase()]=b;return f}return 1==c?f.BRIGHTNESS_TRANSMITTER.parseDptState(a,b):null};return e}(),qb=function(){var e=function(c,a,b){p.call(this,c,a,b);this._chMaintenance=0;this._chPowerMainsTransmitter=1;this.legacyType="ip_pmfs"};util.inherits(e,p);e.prototype._getReadableDpts=function(){var c=this.getSerial(),a=[],b=this,f=x.hub.m.hm._Channel["HmIP-RF"],l=f.MAINTENANCE.getReadableDpts();l&&l.forEach(function(t){"UNREACH"==
t&&a.push({channel:c+":"+b._chMaintenance,dpt:t})});(l=f.POWER_MAINS_TRANSMITTER.getReadableDpts())&&l.forEach(function(t){a.push({channel:c+":"+b._chPowerMainsTransmitter,dpt:t})});return a};e.prototype._getDptFromRef=function(c){var a=this.getSerial(),b={channel:null,dataPoint:null},f=x.hub.m.hm._Channel["HmIP-RF"];switch(c){case "timeout":b.channel=a+":"+this._chMaintenance;b.dataPoint=f.MAINTENANCE.getDptFromState(c);break;case "powerMainsFailure":b.channel=a+":"+this._chPowerMainsTransmitter;
b.dataPoint=f.POWER_MAINS_TRANSMITTER.getDptFromState(c);break;default:return null}return b};e.prototype.parseDptState=function(c,a,b){var f=c.indexOf(":");if(-1==f)return null;var l=c.substr(0,f);c=c.substr(f+1);var t=this.deviceAdr;f=this.deviceAdr.indexOf(":");-1!=f&&(t=this.deviceAdr.substr(0,f));if(l!=t)return null;f=x.hub.m.hm._Channel["HmIP-RF"];if(c==this._chMaintenance){if("UNREACH"==a)return f.MAINTENANCE.parseDptState(a,b);f={};f["0_"+a.toLowerCase()]=b;return f}return c==this._chPowerMainsTransmitter?
f.POWER_MAINS_TRANSMITTER.parseDptState(a,b):null};return e}(),rb=function(){var e=function(c,a,b){p.call(this,c,a,b);this.channel=1;this.legacyType="ip_rotary"};util.inherits(e,p);e.prototype._getReadableDpts=function(){var c=[],a=this,b=x.hub.m.hm._Channel["HmIP-RF"].MAINTENANCE_BAT_EL.getReadableDpts();b&&b.forEach(function(f){"SABOTAGE"!=f&&"ERROR_CODE"!=f&&"SENSOR_ERROR"!=f&&c.push({channel:a.deviceAdr+":0",dpt:f})});return c};e.prototype._getDptFromRef=function(c){var a=this.deviceAdr,b={channel:a+
":"+this.channel,dataPoint:null},f=x.hub.m.hm._Channel["HmIP-RF"];switch(c){case "timeout":case "lowbat":case "voltage":b.channel=a+":0";b.dataPoint=f.MAINTENANCE_BAT_EL.getDptFromState(c);break;default:return null}return b};e.prototype.parseDptState=function(c,a,b){var f=c.indexOf(":");if(-1==f)return null;var l=c.substr(0,f);c=c.substr(f+1);var t=this.deviceAdr;f=this.deviceAdr.indexOf(":");-1!=f&&(t=this.deviceAdr.substr(0,f));if(l!=t)return null;l=x.hub.m.hm._Channel["HmIP-RF"];f=null;if(0==c){if("UNREACH"==
a||"LOW_BAT"==a||"OPERATING_VOLTAGE"==a)return l.MAINTENANCE_BAT_EL.parseDptState(a,b);f={};f["0_"+a.toLowerCase()]=b;return f}if(1==c||2==c||3==c)if(a=l.KEY_TRANRECEIVER.parseDptState(a,b))f||(f={}),a.pressShort&&(f["btn"+c+"pressShort"]=!0),a.pressLong&&(f["btn"+c+"pressLong"]=!0);return f};e.prototype.isButton=function(){return!0};e.prototype.claimEvent=function(c,a){var b=this.deviceAdr;-1==b.indexOf(":")&&this.channel&&(b+=":"+this.channel);var f=this;this._claimButtonEvent(1,c,function(){f._claimButtonEvent(2,
c,function(){f._claimButtonEvent(3,c,function(){a&&a()})})})};e.prototype._claimButtonEvent=function(c,a,b){var f=this;a.reportValueUsage(this.deviceIF,this.deviceAdr+":"+c,"PRESS_SHORT",function(l,t){l&&console.error("button:"+c+" claim PRESS_SHORT event error:"+l.stack);a.reportValueUsage(f.deviceIF,f.deviceAdr+":"+c,"PRESS_LONG",function(u,y){u&&console.error("button:"+c+" claim PRESS_LONG event error:"+u.stack);b&&b()})})};return e}(),ib=function(){var e=function(c,a,b){p.call(this,c,a,b);this._chKeyTransceivers=
[1];this._chMaintenance=0;this._chMaintenanceDpts=["UNREACH","LOW_BAT"];this.legacyType=1==this._chKeyTransceivers.length?"ip_button":"ip_button"+this._chKeyTransceivers};util.inherits(e,p);e.prototype._getReadableDpts=function(){var c=[],a=this,b=this.getSerial(),f=x.hub.m.hm._Channel["HmIP-RF"].T_MAINTENANCE.getReadableDpts();f&&f.forEach(function(l){-1!=a._chMaintenanceDpts.indexOf(l)&&c.push({channel:b+":"+a._chMaintenance,dpt:l})});return c};e.prototype._getDptFromRef=function(c){return(c=x.hub.m.hm._Channel["HmIP-RF"].T_MAINTENANCE.getDptFromState(c))?
{channel:this.getSerial()+":"+this._chMaintenance,dataPoint:c}:null};e.prototype.parseDptState=function(c,a,b){var f=c.indexOf(":");if(-1==f)return null;var l=x.hub.m.hm._Channel["HmIP-RF"],t=c.substr(0,f);c=c.substr(f+1);f=this.getSerial();if(t!=f)return null;if(parseInt(c)==this._chMaintenance){if(-1!=this._chMaintenanceDpts.indexOf(a))return l.T_MAINTENANCE.parseDptState(a,b);var u={};u["0_"+a.toLowerCase()]=b;return u}if(-1!=this._chKeyTransceivers.indexOf(parseInt(c))){if(tmp=l.KEY_TRANRECEIVER.parseDptState(a,
b))u={},1==this._chKeyTransceivers.length?u=tmp:(tmp.pressShort&&(u["btn"+c+"pressShort"]=!0),tmp.pressLong&&(u["btn"+c+"pressLong"]=!0));return u}};e.prototype.isButton=function(){return!0};e.prototype.claimEvent=function(c,a){var b=0,f=this,l=function(){b++;b<f._chKeyTransceivers.length?f._claimButtonEvent(f._chKeyTransceivers[b],c,l):a&&a()};this._claimButtonEvent(this._chKeyTransceivers[b],c,l)};e.prototype._claimButtonEvent=function(c,a,b){var f=this;a.reportValueUsage(this.deviceIF,this.deviceAdr+
":"+c,"PRESS_SHORT",function(l,t){l&&console.error("button:"+c+" claim PRESS_SHORT event error:"+l.stack);a.reportValueUsage(f.deviceIF,f.deviceAdr+":"+c,"PRESS_LONG",function(u,y){u&&console.error("button:"+c+" claim PRESS_LONG event error:"+u.stack);b&&b()})})};e.parse=function(c){var a=null,b=c.address,f=c.address.indexOf(":");-1!=f&&(a=c.address.substr(f+1),b=c.address.substr(0,f));f=null;switch(c.type){case "HmIP-MOD-OC8":f=new e(c.type,c.interface,b),f._chMaintenance=0,f._chMaintenanceDpts=
["UNREACH","OPERATING_VOLTAGE"],f._chKeyTransceivers=[parseInt(a)]}return f};e.resolve=function(c,a){return"HmIP-MOD-OC8"==c?this._resolveIPMultiButton(c,a,1,8,["UNREACH","OPERATING_VOLTAGE"]):"HmIP-RCV-50"==c.substr(0,11)?this._resolveIPMultiButton(c,a,1,50,null):null};e._resolveIPMultiButton=function(c,a,b,f,l){var t,u=[];for(t=0;t<f;t++){var y=new e(c,a.interface,a.address+":"+(t+b));y._chMaintenance=0;l&&(y._chMaintenanceDpts=l);y._chKeyTransceivers=[t+b];u.push(y)}return u};return e}(),aa=function(){var e=
function(c,a,b){p.call(this,c,a,b);this.channel=1;this._chMaintenance=this._switchIdx=0;this._chSwitchVirtualReceiver1=2;this._chSwitchVirtualReceiver2=3;this._chSwitchVirtualReceiver3=4;this._chSwitchWeekProfile=5;this.legacyType="ip_switch"};util.inherits(e,p);e.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":"+this._chMaintenance,dpt:"UNREACH"},{channel:this.deviceAdr+":"+this.channel,dpt:"STATE"}]};e.prototype._getDptFromRef=function(c){var a={channel:this.getSerial()+":",
dataPoint:null};switch(c){case "timeout":a.channel+=this._chMaintenance;a.dataPoint="UNREACH";break;case "state":a.channel+=this.channel;a.dataPoint="STATE";break;default:return null}return a};e.prototype.executeCommand=function(c,a,b){var f=this.getSerial(),l=this;switch(a){case "on":var t="STATE";var u=f+":"+this._chSwitchVirtualReceiver1;c.writeValue(this.deviceIF,u,t,!0,b);break;case "off":t="STATE";u=f+":"+this._chSwitchVirtualReceiver1;c.writeValue(this.deviceIF,u,t,!1,b);break;case "toggle":t=
"STATE";u=f+":"+this.channel;c.getState({interface:this.deviceIF,channel:u,datapoint:t},function(y,A){y?b&&b(y):A?(y=!0,A.value&&(y=!1),t="STATE",u=f+":"+l._chSwitchVirtualReceiver1,c.writeValue(l.deviceIF,u,t,y,b)):b&&b(Error("get switch current value return invalid"))});break;default:"onFor"==a.substr(0,5)?(a=parseFloat(a.substr(5)),isNaN(a)?b&&b(Error("onFor command invalid")):(t="ON_TIME",u=f+":"+l._chSwitchVirtualReceiver1,c.writeValue(this.deviceIF,u,t,{type:"double",value:a},function(y){y?
b&&b(y):(t="STATE",u=f+":"+l._chSwitchVirtualReceiver1,c.writeValue(l.deviceIF,u,t,!0,b))}))):b&&b(Error("no such command"))}};e.prototype.parseDptState=function(c,a,b){var f=c.indexOf(":");if(-1==f)return null;var l=c.substr(0,f);c=c.substr(f+1);f=this.getSerial();if(l!=f)return null;switch(parseInt(c)){case this._chMaintenance:switch(a){case "UNREACH":return{timeout:b};default:return l={},l["0_"+a.toLowerCase()]=b,l}case this.channel:switch(a){case "STATE":return{state:1==b?"on":"off"};default:return null}default:return null}};
e.parse=function(c){var a=null,b=c.address.indexOf(":");-1!=b&&(a=c.address.substr(b+1));b=null;switch(c.type){case "HmIP-MOD-OC8":b=this._parseTSwitch(c,a,41)}return b};e._parseTSwitch=function(c,a,b){c=new e(c.type,c.interface,c.address);c._chMaintenance=0;c.channel=parseInt(a);c._chSwitchVirtualReceiver1=c.channel+1;c._chSwitchVirtualReceiver2=c.channel+2;c._chSwitchVirtualReceiver3=c.channel+3;c._chSwitchWeekProfile=b;return c};e.resolve=function(c,a,b,f){var l=[];if("HmIP-MOD-OC8"==c)for(y=0;8>
y;y++)d=new e(c,a.interface,a.address+":"+(4*y+9)),d._chMaintenance=0,d.channel=4*y+9,d._chSwitchVirtualReceiver1=d.channel+1,d._chSwitchVirtualReceiver2=d.channel+2,d._chSwitchVirtualReceiver3=d.channel+3,d._chSwitchWeekProfile=41,l.push(d);else if(!b||!b.length){b=[];if(a.channels)for(y in a.channels){var t=a.channels[y];if(t&&"SWITCH_TRANSMITTER"==t.type&&t.address){var u=t.address.indexOf(":");-1!=u&&(t=parseInt(t.address.substr(u+1)),isNaN(t)||b.push(t))}else t&&"SWITCH_WEEK_PROFILE"==t.type&&
t.addres&&(u=t.address.indexOf(":"),-1!=u&&(t=parseInt(t.address.substr(u+1)),isNaN(t)||(f=t)))}if(b&&b.length)for(var y=0;y<b.length;y++)d=new e(c,a.interface,a.address+":"+b[y]),d._chMaintenance=0,d.channel=b[y],d._switchIdx=y,d._chSwitchVirtualReceiver1=d.channel+1,d._chSwitchVirtualReceiver2=d.channel+2,d._chSwitchVirtualReceiver3=d.channel+3,d._chSwitchWeekProfile=f,l.push(d)}return l};return e}(),kb=function(){var e=function(c,a,b){p.call(this,c,a,b);this.channel=1;this._chMaintenance=0;this._chDimmerVirtualReceiver1=
2;this._chDimmerVirtualReceiver2=3;this._chDimmerVirtualReceiver3=4;this._chDimmerWeekProfile=13;this.legacyType="ip_dimmer"};util.inherits(e,p);e.prototype._getReadableDpts=function(){var c=[],a=this,b=x.hub.m.hm._Channel["HmIP-RF"],f=b.MAINTENANCE.getReadableDpts();f&&f.forEach(function(l){"UNREACH"==l&&c.push({channel:a.deviceAdr+":"+a._chMaintenance,dpt:l})});(f=b.DIMMER_TRANSMITTER.getReadableDpts())&&f.forEach(function(l){c.push({channel:a.deviceAdr+":"+a.channel,dpt:l})});(f=b.DIMMER_VIRTUAL_RECEIVER.getReadableDpts())&&
f.forEach(function(l){c.push({channel:a.deviceAdr+":"+a._chDimmerVirtualReceiver1,dpt:l});c.push({channel:a.deviceAdr+":"+a._chDimmerVirtualReceiver2,dpt:l});c.push({channel:a.deviceAdr+":"+a._chDimmerVirtualReceiver3,dpt:l})});return c};e.prototype._getDptFromRef=function(c){var a=this.getSerail(),b={channel:null,dataPoint:null},f=x.hub.m.hm._Channel["HmIP-RF"];switch(c){case "timeout":b.channel=a+":"+this._chMaintenance;b.dataPoint=f.MAINTENANCE.getDptFromState(c);break;case "dimmerLevel":b.channel=
a+":"+this.channel;b.dataPoint=f.DIMMER_TRANSMITTER.getDptFromState("dimmerTLevel");break;default:return null}return b};e.prototype.executeCommand=function(c,a,b){var f=x.hub.m.hm._Channel["HmIP-RF"],l=a;if(-1!=a.indexOf("dimUp")){var t=a.indexOf("dimUp");l=a.substr(0,t+5);var u=a.substr(t+5)}else-1!=a.indexOf("dimDown")?(t=a.indexOf("dimDown"),l=a.substr(0,t+7),u=a.substr(t+7)):-1!=a.indexOf("dimTo")?(t=a.indexOf("dimTo"),l=a.substr(0,t+5),u=a.substr(t+5)):-1!=a.indexOf("toggleTo")&&(t=a.indexOf("toggleTo"),
l=a.substr(0,t+8),u=a.substr(t+8));var y=this.getSerial(),A=this;switch(l){case "dimOff":f.DIMMER_VIRTUAL_RECEIVER.executeCommand(c,this.deviceIF,y+":"+this._chDimmerVirtualReceiver1,"dimOff",b);break;case "dimUp":u=u?parseInt(u)/100:.1;c.getState({interface:this.deviceIF,channel:y+":"+this.channel,datapoint:"LEVEL"},function(B,C){B?b&&b(B):"undefined"==typeof C||null==C?b&&b(Error("get dimmer current value return invalid")):(u=C.value+u,1<u&&(u=1),u=Math.round(100*u),f.DIMMER_VIRTUAL_RECEIVER.executeCommand(c,
A.deviceIF,y+":"+A._chDimmerVirtualReceiver1,"dimTo"+u,b))});break;case "dimDown":u=u?parseInt(u)/100:.1;c.getState({interface:this.deviceIF,channel:y+":"+this.channel,datapoint:"LEVEL"},function(B,C){B?b&&b(B):"undefined"==typeof C||null==C?b&&b(Error("get dimmer current value return invalid")):(u=C.value-u,0>u&&(u=0),u=Math.round(100*u),f.DIMMER_VIRTUAL_RECEIVER.executeCommand(c,A.deviceIF,y+":"+A._chDimmerVirtualReceiver1,"dimTo"+u,b))});break;case "dimTo":if(!u){b&&b(Error("dimTo has no value"));
break}f.DIMMER_VIRTUAL_RECEIVER.executeCommand(c,this.deviceIF,y+":"+A._chDimmerVirtualReceiver1,"dimTo"+u,channel);break;case "toggleTo":if(!u){b&&b(Error("toggle has no value"));break}c.getState({interface:this.deviceIF,channel:y+":"+this.channel,datapoint:"LEVEL"},function(B,C){B?b&&b(B):"undefined"==typeof C||null==C?b&&b(Error("get dimmer current value return invalid")):(C.value&&(u=0),f.DIMMER_VIRTUAL_RECEIVER.executeCommand(c,A.deviceIF,y+":"+A._chDimmerVirtualReceiver1,"dimTo"+u,b))});break;
default:b&&b(Error("no such command"))}};e.prototype.parseDptState=function(c,a,b){var f=c.indexOf(":");if(-1==f)return null;var l=c.substr(0,f);c=c.substr(f+1);f=this.getSerial();if(l!=f)return null;f=x.hub.m.hm._Channel["HmIP-RF"];l=null;switch(parseInt(c)){case this._chMaintenance:switch(a){case "UNREACH":return f.MAINTENANCE.parseDptState(a,b);default:return l={},l["0_"+a.toLowerCase()]=b,l}case this.channel:if(a=f.DIMMER_TRANSMITTER.parseDptState(a,b))l={},l.dimmerLevel=a.dimmerTLevel;return l}return null};
return e}(),lb=function(){var e=function(c,a,b){p.call(this,c,a,b);this.channel=1;this._chMaintenance=0;this._chBlindVirtualReceiver1=2;this._chBlindVirtualReceiver2=3;this._chBlindVirtualReceiver3=4;this._chBlindWeekProfile=5;this.legacyType="ip_jalousie"};util.inherits(e,p);e.prototype._getReadableDpts=function(){var c=[],a=this,b=x.hub.m.hm._Channel["HmIP-RF"],f=b.MAINTENANCE.getReadableDpts();f&&f.forEach(function(l){"UNREACH"==l&&c.push({channel:a.deviceAdr+":"+a._chMaintenance,dpt:l})});(f=
b.BLIND_TRANSMITTER.getReadableDpts())&&f.forEach(function(l){c.push({channel:a.deviceAdr+":"+a.channel,dpt:l})});(f=b.BLIND_VIRTUAL_RECEIVER.getReadableDpts())&&f.forEach(function(l){c.push({channel:a.deviceAdr+":"+a._chBlindVirtualReceiver1,dpt:l});c.push({channel:a.deviceAdr+":"+a._chBlindVirtualReceiver2,dpt:l});c.push({channel:a.deviceAdr+":"+a._chBlindVirtualReceiver3,dpt:l})});return c};e.prototype._getDptFromRef=function(c){var a=this.getSerial(),b={channel:null,dataPoint:null},f=x.hub.m.hm._Channel["HmIP-RF"];
switch(c){case "timeout":b.channel=a+":"+this._chMaintenance;b.dataPoint=f.MAINTENANCE.getDptFromState(c);break;case "blindLevel":b.channel=a+":"+this.channel;b.dataPoint=f.BLIND_TRANSMITTER.getDptFromState("blindTPos");break;case "lamellaLevel":b.channel=a+":"+this.channel;b.dataPoint=f.BLIND_TRANSMITTER.getDptFromState("lamellaTPos");break;default:return null}return b};e.prototype.executeCommand=function(c,a,b){var f=x.hub.m.hm._Channel["HmIP-RF"],l=a;if(-1!=a.indexOf("stepUp")){var t=a.indexOf("stepUp");
l=a.substr(0,t+6);var u=a.substr(t+6)}else-1!=a.indexOf("stepDown")?(t=a.indexOf("stepDown"),l=a.substr(0,t+8),u=a.substr(t+8)):-1!=a.indexOf("moveTo")?(t=a.indexOf("moveTo"),l=a.substr(0,t+6),u=a.substr(t+6)):-1!=a.indexOf("stop")?(t=a.indexOf("stop"),l=a.substr(0,t+4),u=a.substr(t+4)):-1!=a.indexOf("lamellaStepUp")?(t=a.indexOf("lamellaStepUp"),l=a.substr(0,t+13),u=a.substr(t+13)):-1!=a.indexOf("lamellaStepDown")?(t=a.indexOf("lamellaStepDown"),l=a.substr(0,t+15),u=a.substr(t+15)):-1!=a.indexOf("lamellaTo")&&
(t=a.indexOf("lamellaTo"),l=a.substr(0,t+9),u=a.substr(t+9));var y=this.getSerial(),A=this;switch(l){case "stop":case "moveUp":case "moveDown":f.BLIND_VIRTUAL_RECEIVER.executeCommand(c,this.deviceIF,y+":"+this._chBlindVirtualReceiver1,l,b);break;case "lamellaUp":case "lamellaDown":c.getState({interface:this.deviceIF,channel:y+":"+this.channel,datapoint:"LEVEL"},function(B,C){B?b&&b(B):"undefined"==typeof C||null==C?b&&b(Error("get blind current value return invalid")):f.BLIND_VIRTUAL_RECEIVER.executeCommand(c,
this.deviceIF,y+":"+this._chBlindVirtualReceiver1,"lamellaTo"+(l=100),function(G){G?b&&b(G):f.BLIND_VIRTUAL_RECEIVER.executeCommand(c,A.deviceIF,y+":"+A._chBlindVirtualReceiver1,"moveTo"+Math.round(100*C.value),b)})});break;case "stepUp":case "stepDown":u=u?parseInt(u)/100:.05;c.getState({interface:this.deviceIF,channel:y+":"+this.channel,datapoint:"LEVEL"},function(B,C){B?b&&b(B):"undefined"==typeof C||null==C?b&&b(Error("get blind current value return invalid")):(u="stepUp"==l?C.value+u:C.value-
u,1<u&&(u=1),0>u&&(u=0),u=Math.round(100*u),f.BLIND_VIRTUAL_RECEIVER.executeCommand(c,A.deviceIF,y+":"+A._chBlindVirtualReceiver1,"moveTo"+u,b))});break;case "moveTo":if(!u){b&&b(Error("moveTo has no value"));break}f.BLIND_VIRTUAL_RECEIVER.executeCommand(c,this.deviceIF,y+":"+this._chBlindVirtualReceiver1,"moveTo"+u,b);break;case "lamellaStepUp":case "lamellaStepDown":u=u?parseInt(u)/100:.05;c.getState({interface:this.deviceIF,channel:y+":"+this.channel,datapoint:"LEVEL"},function(B,C){if(B)b&&b(B);
else if("undefined"==typeof C||null==C)b&&b(Error("get blind current value return invalid"));else{var G=C.value;G=Math.round(100*G);c.getState({interface:A.deviceIF,channel:y+":"+A.channel,datapoint:"LEVEL_2"},function(H,F){H?b&&b(H):"undefined"==typeof F||null==F?b&&b(Error("get lamella current value return invalid")):(u="lamellaStepUp"==l?F.value+u:F.value-u,1<u&&(u=1),0>u&&(u=0),u=Math.round(100*u),f.BLIND_VIRTUAL_RECEIVER.executeCommand(c,A.deviceIF,y+":"+A._chBlindVirtualReceiver1,"lamellaTo"+
u,function(K,I){K?b&&b(K,I):f.BLIND_VIRTUAL_RECEIVER.executeCommand(c,A.deviceIF,y+":"+A._chBlindVirtualReceiver1,"moveTo"+G,b)}))})}});break;case "lamellaTo":if(!u){b&&b(Error("lamellaTo has no value"));break}c.getState({interface:this.deviceIF,channel:y+":"+this.channel,datapoint:"LEVEL"},function(B,C){if(B)b&&b(B);else if("undefined"==typeof C||null==C)b&&b(Error("get blind current value return invalid"));else{var G=C.value;G=Math.round(100*G);f.BLIND_VIRTUAL_RECEIVER.executeCommand(c,A.deviceIF,
y+":"+A._chBlindVirtualReceiver1,"lamellaTo"+u,function(H){H?b&&b(H):f.BLIND_VIRTUAL_RECEIVER.executeCommand(c,A.deviceIF,y+":"+A._chBlindVirtualReceiver1,"moveTo"+G,b)})}});break;default:b&&b(Error("no such command"))}};e.prototype.parseDptState=function(c,a,b){var f=c.indexOf(":");if(-1==f)return null;var l=c.substr(0,f);c=c.substr(f+1);f=this.getSerial();if(l!=f)return null;f=x.hub.m.hm._Channel["HmIP-RF"];l=null;switch(parseInt(c)){case this._chMaintenance:switch(a){case "UNREACH":return f.MAINTENANCE.parseDptState(a,
b);default:return l={},l["0_"+a.toLowerCase()]=b,l}case this.channel:if(b=f.BLIND_TRANSMITTER.parseDptState(a,b))l={},"LEVEL"==a?l.blindLevel=b.blindTPos:"LEVEL_2"==a&&(l.lamellaLevel=b.lamellaTPos);return l}return null};e.prototype.getConfig=function(c,a){var b=this.getSerial()+":"+this.channel;c.getParamset(this.deviceIF,b,"MASTER",function(f,l){if(f)a&&a(f);else{var t={},u=null;l&&(u={CHANGE_OVER_DELAY:l.CHANGE_OVER_DELAY,REFERENCE_RUNNING_TIME_BOTTOM_TOP_UNIT:l.REFERENCE_RUNNING_TIME_BOTTOM_TOP_UNIT,
REFERENCE_RUNNING_TIME_BOTTOM_TOP_VALUE:l.REFERENCE_RUNNING_TIME_BOTTOM_TOP_VALUE,REFERENCE_RUNNING_TIME_TOP_BOTTOM_UNIT:l.REFERENCE_RUNNING_TIME_TOP_BOTTOM_UNIT,REFERENCE_RUNNING_TIME_TOP_BOTTOM_VALUE:l.REFERENCE_RUNNING_TIME_TOP_BOTTOM_VALUE,REFERENCE_RUNNING_TIME_SLATS_UNIT:l.REFERENCE_RUNNING_TIME_SLATS_UNIT,REFERENCE_RUNNING_TIME_SLATS_VALUE:l.REFERENCE_RUNNING_TIME_SLATS_VALUE,REFERENCE_RUN_COUNTER:l.REFERENCE_RUN_COUNTER});t[b]=u;a&&a(f,t)}})};e.prototype.setConfig=function(c,a,b){if(a){var f=
this.getSerial()+":"+this.channel;if(a=a[f]){var l={};l.CHANGE_OVER_DELAY={__rpcValueType:"double",__rpcValue:a.CHANGE_OVER_DELAY};l.REFERENCE_RUN_COUNTER=a.REFERENCE_RUN_COUNTER;l.REFERENCE_RUNNING_TIME_BOTTOM_TOP_UNIT={__rpcValueType:"double",__rpcValue:a.REFERENCE_RUNNING_TIME_BOTTOM_TOP_UNIT};l.REFERENCE_RUNNING_TIME_BOTTOM_TOP_VALUE={__rpcValueType:"double",__rpcValue:a.REFERENCE_RUNNING_TIME_BOTTOM_TOP_VALUE};l.REFERENCE_RUNNING_TIME_TOP_BOTTOM_UNIT={__rpcValueType:"double",__rpcValue:a.REFERENCE_RUNNING_TIME_TOP_BOTTOM_UNIT};
l.REFERENCE_RUNNING_TIME_TOP_BOTTOM_VALUE={__rpcValueType:"double",__rpcValue:a.REFERENCE_RUNNING_TIME_TOP_BOTTOM_VALUE};l.REFERENCE_RUNNING_TIME_SLATS_UNIT={__rpcValueType:"double",__rpcValue:a.REFERENCE_RUNNING_TIME_SLATS_UNIT};l.REFERENCE_RUNNING_TIME_SLATS_VALUE={__rpcValueType:"double",__rpcValue:a.REFERENCE_RUNNING_TIME_SLATS_VALUE};c.setParamset(this.deviceIF,f,"MASTER",l,function(t){b&&b(t)})}else b&&b(Error("config data not complete"))}else b&&b(Error("config data invalid"))};return e}(),
P=function(){var e=function(a,b,f){p.call(this,a,b,f);this.channel=1;this._chMaintenance=0;this.legacyType="ip_multi_input"};util.inherits(e,p);e.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":"+this._chMaintenance,dpt:"UNREACH"},{channel:this.deviceAdr+":"+this.channel,dpt:"STATE"}]};e.prototype._getDptFromRef=function(a){var b={channel:this.getSerial()+":",dataPoint:null};switch(a){case "timeout":b.channel+=this._chMaintenance;b.dataPoint="UNREACH";break;case "state":b.channel+=
this.channel;b.dataPoint="STATE";break;default:return null}return b};e.prototype.parseDptState=function(a,b,f){var l=a.indexOf(":");if(-1==l)return null;var t=a.substr(0,l);a=a.substr(l+1);l=this.getSerial();if(t!=l)return null;t=x.hub.m.hm._Channel["HmIP-RF"];switch(parseInt(a)){case this._chMaintenance:switch(b){case "UNREACH":return{timeout:f};default:return t={},t["0_"+b.toLowerCase()]=f,t}case this.channel:switch(b){case "STATE":return{state:1==f?"on":"off"};case "PRESS_SHORT":case "PRESS_LONG":return t.KEY_TRANRECEIVER.parseDptState(b,
f);default:return null}default:return null}};e.prototype.isButton=function(){return!0};e.prototype.claimEvent=function(a,b){this._claimButtonEvent(this.channel,a,function(){b&&b()})};e.prototype._claimButtonEvent=function(a,b,f){var l=this.getSerial()+":"+a,t=this;b.reportValueUsage(this.deviceIF,l,"PRESS_SHORT",function(u,y){u&&console.error("button:"+a+" claim PRESS_SHORT event error:"+u.stack);b.reportValueUsage(t.deviceIF,l,"PRESS_LONG",function(A,B){A&&console.error("button:"+a+" claim PRESS_LONG event error:"+
A.stack);f&&f()})})};var c=function(a,b,f){e.call(this,a,b,f);this.legacyType="ip_multi_input_bat"};util.inherits(c,e);c.prototype._getReadableDpts=function(){for(var a=x.hub.m.hm._Channel["HmIP-RF"].MAINTENANCE_BAT_EL.getReadableDpts,b=x.hub.m.hm._Channel["HmIP-RF"].MULTI_MODE_INPUT_TRANSMITTER.getReadableDpts,f=[],l=0;l<a.length;l++)f.push({channel:this.deviceAdr+":"+this._chMaintenance,dpt:a[l]});for(l=0;l<b.length;l++)f.push({channel:this.deviceAdr+":"+this.channel,dpt:b[l]});return f};c.prototype._getDptFromRef=
function(a){var b={channel:this.getSerial()+":",dataPoint:null},f=x.hub.m.hm._Channel["HmIP-RF"];switch(a){case "timeout":case "lowbat":case "voltage":case "errorCode":b.channel+=this._chMaintenance;b.dataPoint=f.MAINTENANCE_BAT_EL.getDptFromState(a);break;case "state":b.channel+=this.channel;b.dataPoint=f.MULTI_MODE_INPUT_TRANSMITTER.getDptFromState(a);break;default:return null}return b};c.prototype.parseDptState=function(a,b,f){var l=a.indexOf(":");if(-1==l)return null;var t=a.substr(0,l);a=a.substr(l+
1);l=this.getSerial();if(t!=l)return null;t=x.hub.m.hm._Channel["HmIP-RF"];switch(parseInt(a)){case this._chMaintenance:switch(b){case "UNREACH":case "LOW_BAT":case "OPERATING_VOLTAGE":case "ERROR_CODE":return t.MAINTENANCE_BAT_EL.parseDptState(b,f);default:return t={},t["0_"+b.toLowerCase()]=f,t}case this.channel:switch(b){case "STATE":case "PRESS_SHORT":case "PRESS_LONG":return t.MULTI_MODE_INPUT_TRANSMITTER.parseDptState(b,f);default:return null}default:return null}};e.resolve=function(a,b,f){if("HmIP-FCI"==
a.substr(0,8)){f=parseInt(a.substr(8));var l=c}else if("HmIP-MOD-RC"==a.substr(0,11))f=parseInt(a.substr(11)),l=c;else if("HmIPW-DRI"==a.substr(0,9))f=parseInt(a.substr(9)),l=e;else{if(!f||!f.length)if(f=[],b.channels)for(l in b.channels){var t=b.channels[l];if(t&&"MULTI_MODE_INPUT_TRANSMITTER"==t.type&&t.address){var u=t.address.indexOf(":");-1!=u&&(t=parseInt(t.address.substr(u+1)),isNaN(t)||f.push(t))}}if(!f||!f.length)return[];l=[];for(t=0;t<f.length;t++)u=new e(a,b.interface,b.address+":"+f[t]),
u._chMaintenance=0,u.channel=f[t],l.push(u);return l}return this._resolveIPMultiInput(a,b,f,l)};e._resolveIPMultiInput=function(a,b,f,l){var t,u=[];for(t=0;t<f;t++){var y=new l(a,b.interface,b.address+":"+(t+1));y._chMaintenance=0;y.channel=t+1;u.push(y)}return u};e.parse=function(a){var b=null,f=a.address,l=a.address.indexOf(":");-1!=l&&(b=a.address.substr(l+1),f=a.address.substr(0,l));l=P;if("HmIP-FCI1"==a.type||"HmIP-FCI6"==a.type||"HmIP-MOD-RC8"==a.type)l=c;a=new l(a.type,a.interface,f);a._chMaintenance=
0;a.channel=parseInt(b);return a};return e}(),sb=function(){var e=function(c,a,b){p.call(this,c,a,b);this.channel=3;this._chKeyTransceivers=[];this._chMaintenance=0;this._chMaintenanceDpts=["UNREACH"];this._chMotionDetectorTransceiver=3;this.legacyType="ip_motion2"};util.inherits(e,p);e.prototype._getReadableDpts=function(){var c=[],a=this,b=x.hub.m.hm._Channel["HmIP-RF"],f=b.MAINTENANCE_BAT_EL.getReadableDpts();f&&f.forEach(function(l){-1!=a._chMaintenanceDpts.indexOf(l)&&c.push({channel:serialNum+
":"+a._chMaintenance,dpt:l})});(f=b.MOTIONDETECTOR_TRANSCEIVER.getReadableDpts())&&f.forEach(function(l){c.push({channel:a.deviceAdr+":"+a._chMotionDetectorTransceiver,dpt:l})});return c};e.prototype._getDptFromRef=function(c){var a=this.deviceAdr,b={channel:a+":"+this.channel,dataPoint:null},f=x.hub.m.hm._Channel["HmIP-RF"];switch(c){case "timeout":case "lowbat":b.channel=a+":0";b.dataPoint=f.MAINTENANCE_BAT_EL.getDptFromState(c);break;case "state":case "illumination":case "active":b.channel=a+":"+
this._chMotionDetectorTransceiver;b.dataPoint=f.MOTIONDETECTOR_TRANSCEIVER.getDptFromState(c);break;default:return null}return b};e.prototype.executeCommand=function(c,a,b){var f=x.hub.m.hm._Channel["HmIP-RF"];switch(a){case "reset":case "activate":case "deactivate":case "toggleActivate":f.MOTIONDETECTOR_TRANSCEIVER.executeCommand(c,this.deviceIF,this.deviceAdr+":"+this._chMotionDetectorTransceiver,a,b);break;default:b&&b(Error("no such command"))}};e.prototype.parseDptState=function(c,a,b){var f=
c.indexOf(":");if(-1==f)return null;var l=c.substr(0,f);c=c.substr(f+1);var t=this.deviceAdr;f=this.deviceAdr.indexOf(":");-1!=f&&(t=this.deviceAdr.substr(0,f));if(l!=t)return null;f=x.hub.m.hm._Channel["HmIP-RF"];l=null;if(0==c){if("UNREACH"==a||"LOW_BAT"==a)return f.MAINTENANCE_BAT_EL.parseDptState(a,b);l={};l["0_"+a.toLowerCase()]=b;return l}1==c&&(t=f.KEY_TRANRECEIVER.parseDptState(a,b))&&(t.pressShort&&(l={btn1pressShort:!0}),t.pressLong&&(l={btn1pressLong:!0}));2==c&&(t=f.KEY_TRANRECEIVER.parseDptState(a,
b))&&(t.pressShort&&(l={btn2pressShort:!0}),t.pressLong&&(l={btn2pressLong:!0}));return 3==c?f.MOTIONDETECTOR_TRANSCEIVER.parseDptState(a,b):l};e.prototype.isButton=function(){return 0<this._chKeyTransceivers.length};e.prototype.claimEvent=function(c,a){if(this._chKeyTransceivers&&this._chKeyTransceivers.length){var b=function(y,A,B,C){c.reportValueUsage(y,A+":"+B,"PRESS_SHORT",function(G,H){G&&console.error("button:1 claim PRESS_SHORT event error:"+G.stack);c.reportValueUsage(y,A+":"+B,"PRESS_LONG",
function(F,K){F&&console.error("button:1 claim PRESS_LONG event error:"+F.stack);C()})})},f=this,l=0,t=function(){l++;l<f._chKeyTransceivers.length?b(f.deviceIF,f.deviceAdr,f._chKeyTransceivers[l],t):a&&a()},u=this.deviceAdr;-1==u.indexOf(":")&&this.channel&&(u+=":"+this.channel);b(this.deviceIF,this.deviceAdr,this._chKeyTransceivers[l],t)}else a&&a()};e.resolve=function(c,a){a=new e(c,a.interface,a.address);"HmIPW-SMI55"==c&&(a._chKeyTransceivers=[1,2],a._chMotionDetectorTransceiver=3);return a};
return e}(),mb=function(){var e=function(c,a,b){p.call(this,c,a,b);this.channel=1;this._chMaintenance=0;this.legacyType="ip_analog_input"};util.inherits(e,p);e.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":"+this._chMaintenance,dpt:"UNREACH"},{channel:this.deviceAdr+":"+this.channel,dpt:"VOLTAGE"}]};e.prototype._getDptFromRef=function(c){var a={channel:this.getSerial()+":",dataPoint:null};switch(c){case "timeout":a.channel+=this._chMaintenance;a.dataPoint="UNREACH";break;
case "state":a.channel+=this.channel;a.dataPoint="VOLTAGE";break;default:return null}return a};e.prototype.parseDptState=function(c,a,b){var f=c.indexOf(":");if(-1==f)return null;var l=c.substr(0,f);c=c.substr(f+1);f=this.getSerial();if(l!=f)return null;switch(parseInt(c)){case this._chMaintenance:switch(a){case "UNREACH":return{timeout:b};default:return l={},l["0_"+a.toLowerCase()]=b,l}case this.channel:switch(a){case "VOLTAGE":return{voltage:parseFloat(b)};default:return null}default:return null}};
e.parse=function(c){var a=null,b=c.address,f=c.address.indexOf(":");-1!=f&&(a=c.address.substr(f+1),b=c.address.substr(0,f));c=new e(c.type,c.interface,b);c._chMaintenance=0;c.channel=parseInt(a);return c};return e}(),L={};L.CLASS_MAP={maintenance:n,button:q,vbutton:h,switch:g,dimmer:k,blind:r,powerswitch:m,weather:v,heater:D,heater2:E,heater3:J,wallthermo:M,wallthermo2:O,contact:W,weatherstation:z,rain:sa,gong2:ba,gong:gb,window:Ka,temp:La,co2:Na,motion:Oa,smoke:Pa,siren:ta,capacity:Qa,switch_interface:ma,
tilt:Ra,temp2:Ma,water:Sa,weather2:w,energymeter:Ta,rgb:na,lux:Ua,siren2:ua,jalousie:va,mod_em_8bit:ca,mod_em_8:da,keymatic:wa,ou_led16:ea,hm_dis_ep_wm55:hb,dualwhite:xa};L.CLASS_MAP_IP={ip_switch:jb,ip_contact:Va,ip_heater:ya,ip_powerswitch:za,ip_energyactor:X,ip_dimmer:Ba,ip_motion:Ea,ip_motion2:fa,ip_button2:pa,ip_siren:Fa,ip_wallthermo:Y,ip_smoke:Ga,ip_window:Xa,ip_button4:ha,ip_dimmer2:Ca,ip_energyactor2:Aa,ip_blind:Q,ip_jalousie:R,ip_presence:Ha,ip_dimmer3:Da,ip_wallthermo2:Wa,ip_floor_heater:Ya,
ip_floor_pump_heater:Za,ip_button6:ia,ip_weather:$a,ip_weather2:ab,ip_weather3:bb,ip_weather4:cb,ip_direction:Ia,ip_button8:la,ip_generic_input:db,ip_analog_output:Ja,ip_water:eb,ip_acce:fb,ip_garagedoor:Z,ip_bsl:nb,ip_tormatic:ob,ip_button:oa,ip_lux:pb,ip_pmfs:qb,ip_rotary:rb};L.parseJson=function(e){if(!(e&&e.type&&e.interface&&e.address))return null;switch(e.interface){case "BidCos-RF":e=this._parseRFDeviceJson(e);break;case "HmIP-RF":e=this._parseIPDeviceJson(e);break;default:return null}return e};
L._parseRFDeviceJson=function(e){var c=x.hub.m.hm.RFDeviceTypes[e.type];if("undefined"==typeof c||null==c)return null;c=x.hub.m.hm.RFDeviceCatagory[c];if(!c||!c.type)return null;var a=this.CLASS_MAP[c.type];if(!a)return null;c=null;var b=e.address.indexOf(":");-1!=b&&(c=e.address.substr(b+1));"HM-Dis-EP-WM55"==e.type&&3==c&&(a=this.CLASS_MAP.hm_dis_ep_wm55);e=new a(e.type,e.interface,e.address);c&&(e.channel=parseInt(c));return e};L._parseIPDeviceJson=function(e){if("HmIPW"==e.type.substr(0,5))return this._parseIPW(e);
if("HmIP-MIOB"==e.type)return L._parse_HMIP_MIOB(e);if("HmIP-FCI1"==e.type||"HmIP-FCI6"==e.type||"HmIP-MOD-RC8"==e.type)return P.parse(e);var c=null,a=e.address.indexOf(":");-1!=a&&(c=e.address.substr(a+1));switch(e.type){case "HmIP-WHS2":return this._parseTSwitch(e,c,9);case "HmIP-MOD-OC8":return 8>=parseInt(c)?ib.parse(e):aa.parse(e);case "HmIP-MIO16-PCB":return 13>parseInt(c)?mb.parse(e):17>parseInt(c)?P.parse(e):aa.parse(e)}c=L._getIPMetaIndex(e.type);if("undefined"==typeof c||null==c)return null;
c=x.hub.m.hm.IPDeviceCatagory[c];if(!c||!c.type)return null;var b=this.CLASS_MAP_IP[c.type];if(!b)return null;c=null;a=e.address.indexOf(":");-1!=a&&(c=e.address.substr(a+1));e=new b(e.type,e.interface,e.address);c&&(e.channel=parseInt(c));return e};L._parseIPW=function(e){var c=null;var a=e.address.indexOf(":");-1!=a&&(c=e.address.substr(a+1));return"HmIPW-DRS"==e.type.substr(0,9)?(a=parseInt(e.type.substr(9)),e=new aa(e.type,e.interface,e.address),e._chMaintenance=0,e.channel=parseInt(c),e._chSwitchVirtualReceiver1=
e.channel+1,e._chSwitchVirtualReceiver2=e.channel+2,e._chSwitchVirtualReceiver3=e.channel+3,e._chSwitchWeekProfile=4*a+1,e):"HmIPW-DRD"==e.type.substr(0,9)?(a=parseInt(e.type.substr(9)),e=new kb(e.type,e.interface,e.address),e._chMaintenance=0,e.channel=parseInt(c),e._chDimmerVirtualReceiver1=e.channel+1,e._chDimmerVirtualReceiver2=e.channel+2,e._chDimmerVirtualReceiver3=e.channel+3,e._chDimmerWeekProfile=4*a+1,e):"HmIPW-DRBL"==e.type.substr(0,10)?(a=parseInt(e.type.substr(10)),e=new lb(e.type,e.interface,
e.address),e._chMaintenance=0,e.channel=parseInt(c),e._chBlindVirtualReceiver1=e.channel+1,e._chBlindVirtualReceiver2=e.channel+2,e._chBlindVirtualReceiver3=e.channel+3,e._chBlindWeekProfile=4*a+1,e):"HmIPW-DRI"==e.type.substr(0,9)?(parseInt(e.type.substr(9)),e=new P(e.type,e.interface,e.address),e._chMaintenance=0,e.channel=parseInt(c),e):"HmIPW-FIO"==e.type.substr(0,9)?(a=parseInt(e.type.substr(9)),c=parseInt(c),c<=a?(e=new P(e.type,e.interface,e.address),e._chMaintenance=0,e.channel=parseInt(c)):
(e=new aa(e.type,e.interface,e.address),e._chMaintenance=0,e.channel=parseInt(c),e._chSwitchVirtualReceiver1=e.channel+1,e._chSwitchVirtualReceiver2=e.channel+2,e._chSwitchVirtualReceiver3=e.channel+3,e._chSwitchWeekProfile=a+4*a+1),e):null};L._parse_HMIP_MIOB=function(e){var c=e.address,a=null,b=e.address.indexOf(":");-1!=b&&(c=e.address.substr(0,b),a=e.address.substr(b+1));b=null;0==a?b=this.CLASS_MAP.maintenance:3==a||7==a?b=this.CLASS_MAP_IP.ip_switch:9==a||10==a?b=this.CLASS_MAP_IP.ip_generic_input:
11==a&&(b=this.CLASS_MAP_IP.ip_analog_output);return b?(e=new b(e.type,e.interface,c),e.channel=a,e):null};L._parseTSwitch=function(e,c,a){e=new aa(e.type,e.interface,e.address);e._chMaintenance=0;e.channel=parseInt(c);e._chSwitchVirtualReceiver1=e.channel+1;e._chSwitchVirtualReceiver2=e.channel+2;e._chSwitchVirtualReceiver3=e.channel+3;e._chSwitchWeekProfile=a;return e};L.resolve=function(e){if(!e||!e.type||!e.interface)return null;switch(e.interface){case "BidCos-RF":e=this._resolveRFFromType(e.type,
e);break;case "HmIP-RF":e=this._resolveIPFromType(e.type,e);break;default:return null}return e?Array.isArray(e)?e:[e]:null};L._resolveRFFromType=function(e,c){if("HM-MOD-EM-8"==e)return this._resolve_HM_MOD_EM_8(e,c);if("HM-OU-LED16"==e)return this._resolve_HM_OU_LED16(e,c);if("HM-Dis-EP-WM55"==e)return this._resolve_HM_Dis_EP_WM55(e,c);var a=x.hub.m.hm.RFDeviceTypes[e];if("undefined"==typeof a||null==a)return null;a=x.hub.m.hm.RFDeviceCatagory[a];if(!a||!a.type)return this._resolveRFFromTypeGeneral(e,
c);var b=[];if(c.channels)for(var f in c.channels){var l=c.channels[f];l.type==a.channel&&b.push(l)}var t=this.CLASS_MAP[a.type];if(!t)return null;if("*"==a.channelNum){var u=[];b.forEach(function(y){var A=new t(e,c.interface,c.address),B=y.address.indexOf(":");1<b.length&&(A.deviceAdr=y.address);A.channel=y.address.substr(B+1);u.push(A)});return u}f=new t(e,c.interface,c.address);"undefined"!=typeof a.channelNum&&null!=a.channelNum&&(f.channel=a.channelNum);return f};L._resolveIPFromType=function(e,
c){if("HmIPW"==e.substr(0,5))return this._resolveIPW(e,c);if("HmIP-MOD-OC8"==e){var a=ib.resolve(e,c),b=aa.resolve(e,c);return a.concat(b)}if(0==e.indexOf("HmIP-FAL"))return L._resolve_HMIP_FAL_X(e,c);if(0==e.indexOf("HmIP-MIOB"))return L._resolve_HMIP_MIOB(e,c);if("HmIP-DRSI"==e.substr(0,9)){a=parseInt(e.substr(9));b=[];for(var f=1;f<=a;f++)b.push(f);return P.resolve(e,c,b)}if("HmIP-DRDI"==e.substr(0,9)){a=parseInt(e.substr(9));b=[];for(f=1;f<=a;f++)b.push(f);return P.resolve(e,c,b)}if("HmIP-DRBLI"==
e.substr(0,10)){a=parseInt(e.substr(10));b=[];for(f=1;f<=2*a;f++)b.push(f);return P.resolve(e,c,b)}switch(e){case "HmIP-PCBS2":return ib._resolveIPMultiButton(e,c,1,2,["UNREACH","OPERATING_VOLTAGE"]);case "HmIP-WHS2":return this._resolveIPMultiSwitch(e,c,2);case "HmIP-FCI1":case "HmIP-FCI6":case "HmIP-MOD-RC8":return P.resolve(e,c);case "HmIP-MIO16-PCB":return L._resolve_HMIP_MIO16_PCB(e,c)}a=this._getIPMetaIndex(e);if("undefined"==typeof a||null==a)return null;a=x.hub.m.hm.IPDeviceCatagory[a];if(!a||
!a.type)return null;var l=[];if(c.channels)for(b in c.channels)f=c.channels[b],f.type==a.channel&&l.push(f);var t=this.CLASS_MAP_IP[a.type];if(!t)return null;if("*"==a.channelNum){var u=[];l.forEach(function(y){var A=new t(e,c.interface,c.address),B=y.address.indexOf(":");1<l.length&&(A.deviceAdr=y.address);A.channel=y.address.substr(B+1);u.push(A)});return u}b=new t(e,c.interface,c.address);"undefined"!=typeof a.channelNum&&null!=a.channelNum&&(b.channel=a.channelNum);return b};L._resolveIPW=function(e,
c){var a,b=[];if("HmIPW-DRS"==e.substr(0,9)){var f=parseInt(e.substr(9));b=this._resolveIPMultiSwitch(e,c,f)}else if("HmIPW-DRD"==e.substr(0,9))for(f=parseInt(e.substr(9)),a=0;a<f;a++){var l=new kb(e,c.interface,c.address+":"+(4*a+1));l._chMaintenance=0;l.channel=4*a+1;l._chDimmerVirtualReceiver1=l.channel+1;l._chDimmerVirtualReceiver2=l.channel+2;l._chDimmerVirtualReceiver3=l.channel+3;l._chDimmerWeekProfile=4*f+1;b.push(l)}else if("HmIPW-DRBL"==e.substr(0,10))for(f=parseInt(e.substr(10)),a=0;a<
f;a++)l=new lb(e,c.interface,c.address+":"+(4*a+1)),l._chMaintenance=0,l.channel=4*a+1,l._chBlindVirtualReceiver1=l.channel+1,l._chBlindVirtualReceiver2=l.channel+2,l._chBlindVirtualReceiver3=l.channel+3,l._chBlindWeekProfile=4*f+1,b.push(l);else if("HmIPW-DRI"==e.substr(0,9))for(f=parseInt(e.substr(9)),a=0;a<f;a++)l=new P(e,c.interface,c.address+":"+(a+1)),l._chMaintenance=0,l.channel=a+1,b.push(l);else if("HmIPW-FIO"==e.substr(0,9))for(f=parseInt(e.substr(9)),a=0;a<f;a++)l=new P(e,c.interface,c.address+
":"+(a+1)),l._chMaintenance=0,l.channel=a+1,b.push(l),l=new aa(e,c.interface,c.address+":"+(4*a+f+1)),l._chMaintenance=0,l.channel=4*a+f+1,l._chSwitchVirtualReceiver1=l.channel+1,l._chSwitchVirtualReceiver2=l.channel+2,l._chSwitchVirtualReceiver3=l.channel+3,l._chSwitchWeekProfile=f+4*f+1,b.push(l);else"HmIPW-SMI55"==e&&(l=sb.resolve(e,c),b.push(l));return b};L._resolveIPMultiSwitch=function(e,c,a){var b,f=[];for(b=0;b<a;b++){var l=new aa(e,c.interface,c.address+":"+(4*b+1));l._chMaintenance=0;l.channel=
4*b+1;l._chSwitchVirtualReceiver1=l.channel+1;l._chSwitchVirtualReceiver2=l.channel+2;l._chSwitchVirtualReceiver3=l.channel+3;l._chSwitchWeekProfile=4*a+1;f.push(l)}return f};L._resolveRFFromTypeGeneral=function(e,c){var a=[];if(!c||!c.channels)return null;var b=c.channels,f;for(f in b){var l=b[f];if(l&&l.type&&x.hub.m.hm._Channel["BidCos-RF"][l.type]&&(l=x.hub.m.hm._Channel["BidCos-RF"][l.type].device)&&(l=this.CLASS_MAP[l])){l=new l(e,c.interface,f);var t=f.indexOf(":");l.channel=f.substr(t+1);
a.push(l)}}return a};L._resolve_HM_MOD_EM_8=function(e,c){var a=[];if(!c||!c.channels)return null;var b=c.channels,f;for(f in b){b=f.indexOf(":");b=f.substr(b+1);var l=new (0==b?this.CLASS_MAP.maintenance:this.CLASS_MAP.mod_em_8)(e,c.interface,f);l.channel=b;a.push(l)}return a};L._resolve_HM_OU_LED16=function(e,c){var a=[];if(!c||!c.channels)return null;var b=c.channels,f;for(f in b){b=f.indexOf(":");b=f.substr(b+1);var l=new (0==b?this.CLASS_MAP.maintenance:this.CLASS_MAP.ou_led16)(e,c.interface,
f);l.channel=b;a.push(l)}return a};L._resolve_HM_Dis_EP_WM55=function(e,c){var a=[];if(!c||!c.channels)return null;var b=c.channels,f;for(f in b){b=f.indexOf(":");b=f.substr(b+1);var l=null;0==b?l=this.CLASS_MAP.maintenance:1==b||2==b?l=this.CLASS_MAP.button:3==b&&(l=this.CLASS_MAP.hm_dis_ep_wm55);l&&(l=new l(e,c.interface,f),l.channel=b,a.push(l))}return a};L._resolve_HMIP_FAL_X=function(e,c){var a=[];if(!c||!c.channels)return null;var b=c.channels,f;for(f in b){var l=b[f],t=f.indexOf(":");t=f.substr(t+
1);if(0==t)var u=this.CLASS_MAP.maintenance;else"CLIMATECONTROL_FLOOR_PUMP_TRANSCEIVER"==l.type?u=this.CLASS_MAP_IP.ip_floor_pump_heater:"CLIMATECONTROL_FLOOR_TRANSCEIVER"==l.type&&(u=this.CLASS_MAP_IP.ip_floor_heater);u&&(l=new u(e,c.interface,f),l.channel=t,a.push(l))}return a};L._resolve_HMIP_MIOB=function(e,c){var a=[];if(!c||!c.channels)return null;var b=c.channels,f;for(f in b){b=f.indexOf(":");b=f.substr(b+1);var l=null;0==b?l=this.CLASS_MAP.maintenance:3==b||7==b?l=this.CLASS_MAP_IP.ip_switch:
9==b||10==b?l=this.CLASS_MAP_IP.ip_generic_input:11==b&&(l=this.CLASS_MAP_IP.ip_analog_output);l&&(l=new l(e,c.interface,f),l.channel=b,a.push(l))}return a};L._resolve_HMIP_MIO16_PCB=function(e,c){var a=[];if(!c||!c.channels)return null;var b=c.channels,f;for(f in b){b=f.indexOf(":");b=f.substr(b+1);var l;if(l=0==b?this.CLASS_MAP.maintenance:1<=b&&12>=b?mb:13<=b&&16>=b?P:aa)l=new l(e,c.interface,f),l.channel=b,a.push(l)}return a};L._getIPMetaIndex=function(e){for(var c in x.hub.m.hm.IPDeviceTypes)if(x.hub.m.hm.IPDeviceTypes.hasOwnProperty(c)&&
c.toUpperCase()==e.toUpperCase())return x.hub.m.hm.IPDeviceTypes[c];return null};return L}();
x.hub.m.hm.Manager=function(){var p=function(n){this._logger=require("x.logger.js").getLogger("x.hub.m.hm.Manager");this._gateway=n;this._devices={};this._meta={}};p.prototype.init=function(n){x.hub.m.hm._Util.isIP(this._gateway.ip)?(this._logger.log("info","start connect monitor to "+this._gateway.ip),this._startMonitor(n)):n&&n()};p.prototype.onDeviceEvent=function(n){this._logger.log("trace","receive device event:"+JSON.stringify({device:n.device?n.device.type:null,address:n.device?n.device.address:
null,channel:n.channel,datapoint:n.datapoint,value:n.value?n.value.value:null,ip:n.ip}));var q=function(z,D){var E=null;if(!D||0==D.length)return null;D.forEach(function(J){J&&J.key==z&&(E=J)});return E};if(!n||!n.device)return null;var h=x.hub.m.hm.HM_MODULE.resolveGateway(this._gateway);if(!h)return null;var g=n.device;g.hsstype=g.type;if(g.channels)for(var k in g.channels)if(g.channels.hasOwnProperty(k)){var r=g.channels[k];r.hsstype=r.type}g=h._parseDevice(g);if(!g||0==g.length)return null;var m;
1==g.length?m=g[0]:g.forEach(function(z){if(z.address==n.channel)m=z;else if(0==n.channel.indexOf(z.address)){var D=n.channel.split(":")[1];if(z.channels)for(var E in z.channels)if(z.channels[E].address==D){m=z;break}}});if(!m)return null;g=x.hub.m.hm._Util.getDeviceHashCode(m);var v=h.resolveState(m,n,n.oldValue.value);h=h.resolveState(m,n,n.value.value);if(!h)return null;this._logger.log("trace","event to device state");this._logger.log("trace","device:"+JSON.stringify(m));this._logger.log("trace",
"state:"+JSON.stringify(h));var w=[];Array.isArray(h)?h.forEach(function(z){var D=q(z.key,v);w.push({device:m,gateway:this._gateway,data:{key:z.key,value:z.value,changed:D?z.value!=D.value:!0,oldValue:D?D.value:void 0}})}.bind(this)):w.push({device:m,gateway:this._gateway,data:{key:h.key,value:h.value,changed:h.value!=v.value,oldValue:v.value}});this._generateEvent(g,w)};p.prototype._generateEvent=function(n,q){var h=require("x.hub.eventbus.js");if((n=this._meta[n])&&0<n.length)for(var g=0;g<n.length;g++){var k=
n[g];if(k)for(var r=0;r<q.length;r++){var m=q[r];m&&m.data&&(m.data.key==k.statusKey||"*"==m.data.key)&&h.emit("status",{module:"hm",device:m.device,gateway:m.gateway,data:m.data},k)}}};p.prototype.addStateDevice=function(n,q,h){if(n){n=JSON.parse(JSON.stringify(n));var g=x.hub.m.hm._Util.getDeviceHashCode(n),k=this._devices[g];k||(delete n.gateway,this._devices[g]=n);this._meta[g]||(this._meta[g]=[]);h&&this._meta[g].push(h);"HmIP-RCV-50"==n.type&&"HmIP-RCV"!=n.address.substr(0,8)&&(n=JSON.parse(JSON.stringify(n)),
g=0,k=n.address.split(":"),2<=k.length&&(g=k[1]),g&&(n.address="HmIP-RCV-1:"+g,g=x.hub.m.hm._Util.getDeviceHashCode(n),k=this._devices[g],k||(delete n.gateway,this._devices[g]=n),this._meta[g]||(this._meta[g]=[]),h&&this._meta[g].push(h)));q&&q()}else q&&q(Error("device json invalid"))};p.prototype.removeStateDevice=function(n,q,h){if(!n)q&&q(Error("device json invalid"));else if(h){n=JSON.parse(JSON.stringify(n));n=x.hub.m.hm._Util.getDeviceHashCode(n);var g=this._meta[n];if(g){for(var k=-1,r=0;r<
g.length;r++){var m=g[r];if(m&&"taskman"==m.src&&"taskman"==h.src&&m.taskID==h.taskID&&m.statusKey==h.statusKey){k=r;break}}0<=k&&g.splice(k,1);0==g.length&&(delete this._devices[n],delete this._meta[n])}q&&q()}};p.prototype.getAllStates=function(){var n=[],q;for(q in this._devices)if(this._devices.hasOwnProperty(q)){var h=this._devices[q];h&&h.device&&(h=this.getStates(h.device))&&n.push(h)}return n};p.prototype.getStates=function(n){if(!n)return null;n=JSON.parse(JSON.stringify(n));var q=x.hub.m.hm._Util.getDeviceHashCode(n),
h=this._devices[q];h||this.addStateDevice(n);var g=require("x.hub.m.hm.js")._monitorManager.getMonitor(this._gateway.ip,this._gateway.uuid);if(!g)return null;var k={};h=this._devices[q];for(var r in h.states)q=g.getBufferedState(h.states[r]),k[r]=this._resolveRawState(n,r,q);return{device:n,gateway:this._gateway,states:k}};p.prototype.updateStates=function(n,q){if(n){n=JSON.parse(JSON.stringify(n));var h=x.hub.m.hm._Util.getDeviceHashCode(n),g=this._devices[h];g||this.addStateDevice(n);g=this._devices[h];
this._updateStates(n,g.states,q)}else q&&q(Error("device json is null"))};p.prototype.getState=function(n,q,h){if(!n||!q)return h&&h(Error("argument invalid")),null;if("SysVar"==n.type||"CUxD"==n["interface"])x.hub.m.hm.HM_MODULE.doStatus("var",this._gateway,n,{value:q},function(m,v){m?h&&h(m):v?(m={value:v.status,time:(new Date).getTime()},h&&h(null,m)):h&&h(Error("get sys var status return null"))});else{n=JSON.parse(JSON.stringify(n));var g=x.hub.m.hm._Util.getDeviceHashCode(n);this._devices[g]||
this.addStateDevice(n);g=require("x.hub.m.hm.js")._monitorManager.getMonitor(this._gateway.ip,this._gateway.uuid);if(!g)return h&&h(Error("no monitor for gateway")),null;var k=x.hub.m.hm.HM_MODULE.resolveGateway(this._gateway);if(!k)return h&&h(Error("gateway json invalid")),null;var r=k.resolveDatapointInfo(n,q);if(!r)return h&&h(Error("device json or state ref invalid")),null;g.getState(r,function(m,v){if(m)h&&h(m);else if(v){m=k.resolveState(n,r,v.value);var w;m?Array.isArray(m)?m.forEach(function(z){z&&
z.key==q&&(w={value:z.value,time:v.time})}):w={value:m.value,time:v.time}:w={value:m,time:v.time};h&&h(null,w)}else h&&h(null,null)})}};p.prototype.executeCommand=function(n,q,h){var g=x.hub.m.hm.HM_MODULE.resolveGateway(this._gateway);if(!g)return h&&h(Error("gateway json invalid")),null;g.executeCommandCreator(n,q,h)};p.prototype.updateState=function(n,q,h){if(!n||!q)return h&&h(Error("argument invalid")),null;n=JSON.parse(JSON.stringify(n));var g=x.hub.m.hm._Util.getDeviceHashCode(n);this._devices[g]||
this.addStateDevice(n);g=require("x.hub.m.hm.js")._monitorManager.getMonitor(this._gateway.ip,this._gateway.uuid);if(!g)return h&&h(Error("no monitor for gateway")),null;var k=x.hub.m.hm.HM_MODULE.resolveGateway(this._gateway);if(!k)return h&&h(Error("gateway json invalid")),null;var r=k.resolveDatapointInfo(n,q);if(!r)return h&&h(Error("device json or state ref invalid")),null;g.updateState(r,function(m,v){if(m)h&&h(m);else{m=k.resolveState(n,r,v);var w;m?Array.isArray(m)?m.forEach(function(z){z&&
z.key==q&&(w={value:z.value})}):w={value:m.value}:w={value:m};h&&h(null,w)}})};p.prototype._startMonitor=function(n){var q=require("x.hub.m.hm.js")._monitorManager,h=this;q.startMonitor(this._gateway,{persistant:!0},function(g){var k=q.getMonitor(h._gateway.ip,h._gateway.uuid);if(k)k.on("new_devices",h._onNewDevices.bind(h));n&&n(g)})};p.prototype._onNewDevices=function(n){var q=[],h;for(h in n)if(n.hasOwnProperty(h)){var g=x.hub.m.hm._Device.resolve(n[h]);g&&0<g.length&&(g=g.filter(function(v){return v&&
v.isButton()}),q=q.concat(g))}var k=require("x.hub.m.hm.js")._monitorManager.getMonitor(this._gateway.ip,this._gateway.uuid);if(k&&0<q.length){var r=0,m=function(){r++;r<q.length&&q[r].claimEvent(k,m)};q[r].claimEvent(k,m)}};p.prototype._updateStates=function(n,q,h){var g=this;require("x.hub.m.hm.js")._monitorManager.startMonitor(this._gateway,{persistant:!0},function(k){k?h&&h(k):g._getStateByScript(n,q,h)})};p.prototype._resolveDetailDpt=function(n){var q=require("xnm.aio.hm.js").devicemanager,
h=q.applyUIFilter(n,{catagory:"status",elems:"*"}),g=h?h.status:null;q=(h=q.applyUIFilter(n,{catagory:"command",elems:"*"}))?h.command:null;h={states:{},commands:{}};if(g&&0<=g.length)for(var k=0;k<g.length;k++){var r=g[k],m=this._resolveDatapointRef(n,r.ref.value,!1);m&&(h.states[r.ref.value]=m)}if(q&&0<=q.length)for(k=0;k<q.length;k++)g=q[k],(m=this._resolveDatapointRef(n,g.ref.value,!0))&&(h.commands[g.ref.value]=m);return h};p.prototype.learnRFDevice=function(n){var q=require("x.hub.m.hm.js")._monitorManager.getMonitor(this._gateway.ip,
this._gateway.uuid);q?q.learnRF(function(h,g){if(h)n&&n(h);else{h=[];var k=new x.hub.m.hm.HM_MODULE.CCU,r;for(r in g){var m=g[r];m.hsstype=m.type;if(m.channels)for(r in m.channels)m.channels[r].hsstype=m.channels[r].type;(m=k._parseDevice(m))&&(h=h.concat(m))}n&&n(null,h)}}):n&&n(Error("monitor not started"))};p.prototype.learnIPDevice=function(n,q,h){var g=require("x.hub.m.hm.js")._monitorManager.getMonitor(this._gateway.ip,this._gateway.uuid);g?g.learnIP(n,q,function(k,r){if(k)h&&h(k);else{k=[];
var m=new x.hub.m.hm.HM_MODULE.CCU,v;for(v in r){var w=r[v];w.hsstype=w.type;if(w.channels)for(v in w.channels)w.channels[v].hsstype=w.channels[v].type;(w=m._parseDevice(w))&&(k=k.concat(w))}h&&h(null,k)}}):h&&h(Error("monitor not started"))};p.prototype.learnIPDeviceQR=function(n,q){var h=require("x.hub.m.hm.js")._monitorManager.getMonitor(this._gateway.ip,this._gateway.uuid);h?h.learnIPQR(n,function(g,k){if(g)q&&q(g);else{g=[];var r=new x.hub.m.hm.HM_MODULE.CCU,m;for(m in k){var v=k[m];v.hsstype=
v.type;if(v.channels)for(m in v.channels)v.channels[m].hsstype=v.channels[m].type;(v=r._parseDevice(v))&&(g=g.concat(v))}q&&q(null,g)}}):q&&q(Error("monitor not started"))};p.prototype.deleteDevice=function(n,q,h){var g=require("x.hub.m.hm.js")._monitorManager.getMonitor(this._gateway.ip,this._gateway.uuid);g?g.deleteDevice(n,q,h):h&&h(Error("monitor not started"))};p.prototype.getRFInterfaces=function(n){var q=require("x.hub.m.hm.js")._monitorManager.getMonitor(this._gateway.ip,this._gateway.uuid);
q?q.getRFInterfaces(n):n&&n(Error("monitor not started"))};return p}();x.hub.m.hm.ChipManager=function(p){x.hub.m.hm.Manager.call(this,p);this._logger=require("x.logger.js").getLogger("x.hub.m.hm.Manager.ChipManager")};util.inherits(x.hub.m.hm.ChipManager,x.hub.m.hm.Manager);
x.hub.m.hm.ChipManager.prototype.init=function(p){if(x.hub.m.hm._Util.isIP(this._gateway.ip)){this._logger.log("info","start connect monitor to "+this._gateway.ip);var n=this,q=require("x.hub.m.hm.js")._monitorManager;q.startMonitor(this._gateway,{localChip:"chip",persistant:!0},function(h){var g=q.getMonitor(n._gateway.ip,n._gateway.uuid);if(g)g.on("new_devices",n._onNewDevices.bind(n));p&&p(h)},!0,!0)}else p&&p()};
x.hub.m.hm.ChipManager.prototype.reset=function(p){var n=require("x.hub.m.hm.js")._monitorManager.getMonitor(this._gateway.ip,this._gateway.uuid);if(!n)return p&&p(Error("no chip monitor")),null;n.reset(p)};
x.hub.m.hm.ChipManager.prototype.executeCommand=function(p,n,q){if(p&&p.address&&n)if(p=p.address.split("."),3>p.length)q&&q({error:Error("address invalid")});else{var h={type:p[0],interface:p[1],address:p[2]};p=require("x.hub.m.hm.js")._monitorManager.getMonitor(this._gateway.ip,this._gateway.uuid);if(!p)return q&&q(Error("no chip monitor")),null;(h=x.hub.m.hm._Device.parseJson(h))?h.executeCommand(p,n.value,q):q&&q(Error("unknow device"))}else q&&q(Error("argument invalid"))};
x.hub.m.hm.ChipManager.prototype.getState=function(p,n,q){if(!p||!p.address||!n)return q&&q(Error("argument invalid")),null;p=p.address.split(".");if(3>p.length)q&&q(Error("address invalid"));else{var h={type:p[0],interface:p[1],address:p[2]};p=require("x.hub.m.hm.js")._monitorManager.getMonitor(this._gateway.ip,this._gateway.uuid);if(!p)return q&&q(Error("no chip monitor")),null;(h=x.hub.m.hm._Device.parseJson(h))?h.getState(p,n.value,q):q&&q(Error("unknow device"))}};
x.hub.m.hm.ChipManager.prototype.getBufferedStateLegacy=function(p,n){if(!p)return null;p=x.hub.m.hm._Device.resolve(p);if(!p||0==p.length)return null;var q;1==p.length?q=p[0]:p.forEach(function(m){m.deviceAdr==n&&(q=m)});if(!q)return null;var h;if(p=require("x.hub.m.hm.js")._monitorManager.getMonitor(this._gateway.ip,this._gateway.uuid)){p=p.getAllBufferedStates();var g=q.deviceAdr,k=g.indexOf(":");-1!=k&&(g=g.substr(0,k));p[g]&&p[g].states&&(h=q.parseStates(p[g].states))}if(!h)return null;p={type:"HM",
adr:q.toLegacyAdr(),state:{}};for(var r in h)p.state[r]=h[r].value;return p};
x.hub.m.hm.ChipManager.prototype.checkButtonEvent=function(p){if(!p||!p.device||!p.datapoint||0!=p.datapoint.indexOf("PRESS"))return null;var n=x.hub.m.hm._Device.resolve(p.device);if(!n||0==n.length)return null;var q;1==n.length?q=n[0]:n.forEach(function(k){k.deviceAdr==p.channel&&(q=k)});if(!q)return null;n=q.parseDptState(p.channel,p.datapoint,p.value.value);if(!n)return null;var h={type:"HM",adr:q.deviceType+"."+q.deviceIF+"."+q.deviceAdr,state:{},_ver:"v5+"},g=Object.keys(n);h.state[g[0]]=n[g[0]];
require("x.hub.eventbus.js").emit("gatewayevent",h,{address:"HM"},"BTN")};
x.hub.m.hm.ChipManager.prototype.onDeviceEvent=function(p){if(!p||!p.device)return null;var n=x.hub.m.hm._Device.resolve(p.device);if(!n||0==n.length)return null;var q;1==n.length?q=n[0]:n.forEach(function(v){v.deviceAdr==p.channel&&(q=v)});if(!q)return null;n=q.parseDptState(p.channel,p.datapoint,p.oldValue.value);var h=q.parseDptState(p.channel,p.datapoint,p.value.value);if(!h)return null;var g={sys:"aio",type:"HM",address:q.deviceType+"."+q.deviceIF+"."+q.deviceAdr},k=this._gateway,r={key:null,
value:null,changed:p.changed,oldValue:null},m=Object.keys(h);r.key=m[0];r.value=h[m[0]];r.oldValue=n?n[m[0]]:void 0;this._logger.log("debug","EVENT:\t"+g.address+"\t"+r.key+"\t"+r.value);return{device:g,gateway:k,data:r}};
x.hub.m.hm.ChipManager.prototype.learnRFDevice=function(p){var n=require("x.hub.m.hm.js")._monitorManager.getMonitor(this._gateway.ip,this._gateway.uuid);n?n.learnRF(function(q,h){if(q)p&&p(q);else{var g=[],k;for(k in h){var r=x.hub.m.hm._Device.resolve(h[k]);r&&(g=g.concat(r))}p&&p(q,g)}}):p&&p(Error("monitor not started"))};
x.hub.m.hm.ChipManager.prototype.learnRFDeviceSN=function(p,n){var q=require("x.hub.m.hm.js")._monitorManager.getMonitor(this._gateway.ip,this._gateway.uuid);q?q.learnRFSN(p,function(h,g){if(h)n&&n(h);else{var k=[],r;for(r in g){var m=x.hub.m.hm._Device.resolve(g[r]);m&&(k=k.concat(m))}n&&n(h,k)}}):n&&n(Error("monitor not started"))};
x.hub.m.hm.ChipManager.prototype.learnIPDevice=function(p,n,q){var h=require("x.hub.m.hm.js")._monitorManager.getMonitor(this._gateway.ip,this._gateway.uuid);h?h.learnIP(p,n,function(g,k){if(g)q&&q(g);else{var r=[],m;for(m in k){var v=x.hub.m.hm._Device.resolve(k[m]);v&&(r=r.concat(v))}q&&q(g,r)}}):q&&q(Error("monitor not started"))};
x.hub.m.hm.ChipManager.prototype.learnIPDeviceQR=function(p,n){var q=require("x.hub.m.hm.js")._monitorManager.getMonitor(this._gateway.ip,this._gateway.uuid);q?q.learnIPQR(p,function(h,g){if(h)n&&n(h);else{var k=[],r;for(r in g){var m=x.hub.m.hm._Device.resolve(g[r]);m&&(k=k.concat(m))}n&&n(h,k)}}):n&&n(Error("monitor not started"))};
x.hub.m.hm.ChipManager.prototype.getAllBufferedStates=function(){var p=require("x.hub.m.hm.js")._monitorManager.getMonitor(this._gateway.ip,this._gateway.uuid);if(!p)return[];p=p.getAllBufferedStates();var n=[],q;for(q in p){var h=p[q],g=x.hub.m.hm._Device.resolve(h.device);if(g)for(var k=0,r=g.length;k<r;k++){var m=g[k],v=m.parseStates(h.states);n.push({device:m,states:v})}}return n};
x.hub.m.hm.ChipManager.prototype.getConfig=function(p,n){if(p&&p.address)if(p=p.address.split("."),3>p.length)n&&n({error:Error("address invalid")});else{var q={type:p[0],interface:p[1],address:p[2]};p=require("x.hub.m.hm.js")._monitorManager.getMonitor(this._gateway.ip,this._gateway.uuid);if(!p)return n&&n(Error("no chip monitor")),null;(q=x.hub.m.hm._Device.parseJson(q))?q.getConfig(p,n):n&&n(Error("unknow device"))}else n&&n(Error("device json invalid"))};
x.hub.m.hm.ChipManager.prototype.setConfig=function(p,n,q){if(p&&p.address)if(p=p.address.split("."),3>p.length)q&&q({error:Error("address invalid")});else{var h={type:p[0],interface:p[1],address:p[2]};p=require("x.hub.m.hm.js")._monitorManager.getMonitor(this._gateway.ip,this._gateway.uuid);if(!p)return q&&q(Error("no chip monitor")),null;(h=x.hub.m.hm._Device.parseJson(h))?h.setConfig(p,n,q):q&&q(Error("unknow device"))}else q&&q(Error("device json invalid"))};
x.hub.m.hm.ChipManager.prototype._onNewDevices=function(p){var n=[],q;for(q in p)if(p.hasOwnProperty(q)){var h=x.hub.m.hm._Device.resolve(p[q]);h&&0<h.length&&(h=h.filter(function(m){return m&&m.isButton()}),n=n.concat(h))}var g=require("x.hub.m.hm.js")._monitorManager.getMonitor(this._gateway.ip,this._gateway.uuid);if(g&&0<n.length){var k=0,r=function(){k++;k<n.length&&n[k].claimEvent(g,r)};n[k].claimEvent(g,r)}};
x.hub.m.hm.CCU2Discovery=function(){var p=function(n){this._logger=require("x.logger.js").getLogger("x.hub.m.hm.CCU2Discovery");this._autoDiscoverTO=null;var q=this;this._hmHandlerCB=function(h,g){q._logger.log("debug","find ccu:"+h.uuid+"@"+h.ip+" from netif:"+g);q._searchCB&&q._searchCB(h,g);if(h.ip){var k=!1;q._searchTmpHMs.forEach(function(r){r.ip==h.ip&&(k=!0)});k||q._searchTmpHMs.push(h)}};this._searchCB=n;this._searchRunning=!1;this._searchTmpHMs=[];this._searchTmpCBs=[]};p.prototype.discover=
function(n){n&&-1==this._searchTmpCBs.indexOf(n)&&this._searchTmpCBs.push(n);if(!this._searchRunning){this._searchRunning=!0;this._searchTmpHMs=[];this._autoDiscoverTO&&(clearTimeout(this._autoDiscoverTO),this._autoDiscoverTO=null);require("xnm.aio.hm.js").discoverCCUs(this._hmHandlerCB);var q=this;setTimeout(function(){q._searchRunning=!1;q._autoDiscoverTO=setTimeout(function(){q.discover()},3E4);q._searchTmpCBs.forEach(function(h){h&&h(q._searchTmpHMs)});q._searchTmpCBs=[]},3E3)}};return p}();
x.hub.m.hm._Util={isDeviceJsonValid:function(p){return p&&p.type&&p.address&&p.interface},isGatewayJsonValid:function(p){return p&&p.ip},getDeviceHashCode:function(p){if(!p)return-1;var n=0;n=(n<<5)-n+this._getStringHashCode(p.type);n=(n<<5)-n+this._getStringHashCode(p.address);return n=(n<<5)-n+this._getStringHashCode(p.interface)},getGatewayHashCode:function(p){if(!p)return-1;var n=80;p.port&&((n=parseInt(p.port))||(n=80));var q=0;q=(q<<5)-q+this._getStringHashCode(p.ip);q=(q<<5)-q+n;q=(q<<5)-q+
this._getStringHashCode(p.uuid);q=(q<<5)-q+this._getStringHashCode(p.username);return q=(q<<5)-q+this._getStringHashCode(p.password)},getLocalIP:function(p,n){var q=function(D){return D?(D=D.match(/^(\d+)\.(\d+)\.(\d+)\.(\d+)$/))?(+D[1]<<24)+(+D[2]<<16)+(+D[3]<<8)+ +D[4]:-1:-1};if("127.0.0.1"==n||"localhost"==n)return"127.0.0.1";var h=require("os").networkInterfaces(),g;for(g in h)if(h.hasOwnProperty(g))for(var k=h[g],r=0;r<k.length;r++){var m=k[r];if(m&&"IPv4"==m.family&&m.address){if(p==g||!p&&
!n)return m.address;if(!p&&m.netmask&&n){var v=q(m.netmask),w=q(m.address),z=q(n);if((w&v)==(z&v))return m.address}}}return null},getLocalMac:function(p){var n=require("os").networkInterfaces(),q;for(q in n)if(n.hasOwnProperty(q))for(var h=n[q],g=0;g<h.length;g++){var k=h[g];if(k&&"IPv4"==k.family&&k.address&&k.mac&&p==k.address)return k.mac}return"00:00:00:00:00:00"},isIP:function(p){return/^(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/.test(p)},
mergeObj:function(p,n){var q={},h;for(h in p)p.hasOwnProperty(h)&&(q[h]=p[h]);for(h in n)n.hasOwnProperty(h)&&(q[h]=n[h]);return q},_getStringHashCode:function(p){var n=0,q;if("undefined"==typeof p||null==p)return-1;if(0===p.length)return n;var h=0;for(q=p.length;h<q;h++){var g=p.charCodeAt(h);n=(n<<5)-n+g}return n}};
x.hub.m.hm.UdpEventProducer=function(){var p=function(n){this._handler=n;this._pool={}};p.prototype.EVENT_TO=300;p.prototype.onEvent=function(n){if(n&&n.channel){var q=0,h=n.channel,g=h.indexOf(":");-1!=g&&(h=n.channel.substr(0,g),q=n.channel.substr(g+1));(g=this._pool[h])&&g.timeout&&clearTimeout(g.timeout);var k=this;g=setTimeout(function(){var r=k._pool[h];k._pool[h]=null;for(var m in r){var v=r[m];if(v=k._handler._chipManager.getBufferedStateLegacy(v.device,v.channel)){v._ver="v5+";var w=require("x.hub.eventbus.js");
w.emit("gatewayevent",v,{address:"HM"},"STA");w.emit("udpevent",v,"STA")}}},this.EVENT_TO);this._pool[h]||(this._pool[h]={});this._pool[h].timeout=g;this._pool[h][q]||(this._pool[h][q]=n)}};p.prototype.addSTAEvent=function(n){if(n&&n.adr){var q=(new Date).getTime(),h=n.adr,g=this._pool[h];g&&g.timeout&&clearTimeout(g.timeout);var k=this;g=setTimeout(function(){var r=k._pool[h];if(r&&r.states){var m=require("x.hub.eventbus.js");m.emit("gatewayevent",r.states,{address:"HM"},"STA");m.emit("udpevent",
r.states,"STA")}},this.EVENT_TO);this._pool[h]={states:n,timestamp:q,timeout:g}}};return p}();
x.hub.m.hm.Handler=function(){var p=function(){this._logger=require("x.logger.js").getLogger("x.hub.m.hm.Handler");var n=this;this._udpEvtProducer=new x.hub.m.hm.UdpEventProducer(this);this._discoveryCB=function(q,h){n._onFindHM(q,h)};this._monitorManager=this._discovery=null;this._managers={};this._chipManager=this._xmlrpcServer=null};util.inherits(p,EventEmitter);p.prototype.CCU=x.hub.m.hm.CCU;p.prototype.XMLRPCClient=x.hub.m.hm.Client;p.prototype.init=function(n){var q=this;if(localStorage){var h=
!0;"false"==localStorage.getItem("x.hub.m.hm.CCU_INIT_STATE")&&(h=!1);x.hub.m.hm.CCU_INIT_STATE=h}require("x.hub.eventbus.js").on("x.hub.m.hm.CCU_INIT_STATE",function(g){var k=!0;"false"==g&&(k=!1);x.hub.m.hm.CCU_INIT_STATE=k});this._discovery=new x.hub.m.hm.CCU2Discovery(this._discoveryCB);this._monitorManager=new x.hub.m.hm.MonitorManager;this._xmlrpcServer=new x.hub.m.hm.Server(global.HM_LOCAL_PORT);this._xmlrpcServer.start(function(g){g?(q._logger.log("warn","start homematic local server error with port:"+
q._xmlrpcServer.getPort()),q._logger.log("warn",g.stack),n&&n({error:g})):q._monitorManager.init(q._xmlrpcServer,function(k){k?n&&n({error:k}):global&&global.HM_CHIP?q._initChipManager(function(r){n&&n({error:r})}):n&&n({})})})};p.prototype.getSystems=function(){return["hm"]};p.prototype.addStateDevice=function(n,q,h){if(n)if(n.gateway&&"mediola"!=n.gateway.uuid)if(n.gateway.ip&&x.hub.m.hm._Util.isIP(n.gateway.ip))if(x.hub.m.hm._Util.isIP(n.gateway.ip)){var g=this._getManager(n.gateway);g?g.addStateDevice(n,
function(k){q&&q({error:k})},h):(g=this._addManager(n.gateway),g.init(function(k){}),g.addStateDevice(n,function(k){q&&q({error:k})},h))}else this._logger.log("warn","ccu has ip:"+n.gateway.ip," , may not receive event from it."),q&&q({error:Error("gateway ip is url")});else q&&q({error:Error("gateway ip format invalid")});else q&&q();else q&&q({error:Error("device json format invalid")})};p.prototype.removeStateDevice=function(n,q,h){if(n)if(n.gateway&&"mediola"!=n.gateway.uuid)if(n.gateway.ip&&
x.hub.m.hm._Util.isIP(n.gateway.ip))if(x.hub.m.hm._Util.isIP(n.gateway.ip)){var g=this._getManager(n.gateway);g?g.removeStateDevice(n,function(k){q&&q({error:k})},h):q&&q({})}else this._logger.log("warn","ccu has ip:"+n.gateway.ip," , may not receive event from it."),q&&q({error:Error("gateway ip is url")});else q&&q({error:Error("gateway ip format invalid")});else q&&q();else q&&q({error:Error("device json format invalid")})};p.prototype.getAllStates=function(){return this._chipManager?this._chipManager.getAllBufferedStates():
[]};p.prototype.getStates=function(n){if(!(n&&x.hub.m.hm._Util.isDeviceJsonValid(n)&&n.gateway&&x.hub.m.hm._Util.isGatewayJsonValid(n.gateway)))return null;var q=this._getManager(n.gateway);if(q)return q.getStates(n);q=this._addManager(n.gateway);q.init();return null};p.prototype.getState=function(n,q,h){if(!n)return h&&h({error:Error("device is null")}),null;if(!n.gateway||"mediola"==n.gateway.uuid){if(!this._chipManager){h&&h({error:Error("chip manager not inited")});return}return this._chipManager.getState(n,
{value:q},function(g,k){h&&h({error:g,data:k})})}if(!x.hub.m.hm._Util.isDeviceJsonValid(n)||!n.gateway||!x.hub.m.hm._Util.isGatewayJsonValid(n.gateway))return h&&h({error:Error("device json invalid")}),null;x.hub.m.hm.HM_MODULE.doStatus("xhub",n.gateway,n,{value:q},function(g,k){g?h&&h({error:g}):k?h&&h({data:{value:k.status}}):h&&h({error:Error("do status failed")})})};p.prototype.executeCommand=function(n,q,h){n?q?n.gateway&&"mediola"!=n.gateway.uuid?n.gateway?x.hub.m.hm.HM_MODULE.doCommand(n.gateway,
n,q,function(g){g?h&&h({error:g}):h&&h({})}):h&&h({error:Error("gateway is null")}):this._chipManager?this._chipManager.executeCommand(n,q,function(g){h&&h({error:g})}):h&&h({error:Error("chip manager not inited")}):h&&h({error:Error("command invalid")}):h&&h({error:Error("device is null")})};p.prototype.updateStates=function(n,q){if(n&&x.hub.m.hm._Util.isDeviceJsonValid(n)&&n.gateway&&x.hub.m.hm._Util.isGatewayJsonValid(n.gateway)){var h=this._getManager(n.gateway);h?h.updateStates(n,function(g,
k){q&&q({error:g,data:k})}):(h=this._addManager(n.gateway),h.init(function(g){g?q&&q({error:g}):h.updateStates(n,function(k,r){q&&q({error:k,data:r})})}))}else q&&q({error:Error("device json format invalid")})};p.prototype.checkDeviceMatch=function(n,q){if(!(q&&q.device&&n&&n.device))return!1;if(q.gateway&&"mediola"!=q.gateway.uuid){q=x.hub.m.hm._Util.getDeviceHashCode(q.device);var h=x.hub.m.hm._Util.getDeviceHashCode(n.device);if(q==h)return!0;if("HmIP-RCV-50"==n.device.type&&"HmIP-RCV"!=n.device.address.substr(0,
8)){n=JSON.parse(JSON.stringify(n.device));h=0;var g=n.address.split(":");2<=g.length&&(h=g[1]);if(h)return n.address="HmIP-RCV-1:"+h,h=x.hub.m.hm._Util.getDeviceHashCode(n),q==h}return!1}h=n.device.address;n.device.interface&&n.device.type&&(h=n.device.type+"."+n.device.interface+"."+n.device.address);return h!=q.device.address?!1:!0};p.prototype._initChipManager=function(n){var q="127.0.0.1";global&&global.HM_CHIP&&(q=global.HM_CHIP);this._chipManager=new x.hub.m.hm.ChipManager({ip:q,username:global.HM_CHIP_USERNAME,
password:global.HM_CHIP_PASSWORD,uuid:"mediola"});this._chipManager.init(n)};p.prototype._initCCU3Manager=function(n){this._addManager({ip:"127.0.0.1",type:3}).init(function(q){n&&n(q)})};p.prototype._discover=function(n){this._discovery.discover(n)};p.prototype._onFindHM=function(n,q){this._logger.log("debug","find ccu:"+n.uuid+"@"+n.ip+" from netif:"+q);this._monitorManager.onFindHomeMatic(n.ip,q,n.uuid)};p.prototype._getManager=function(n){n=x.hub.m.hm._Util.getGatewayHashCode(n);return this._managers[n]};
p.prototype._addManager=function(n){var q=x.hub.m.hm._Util.getGatewayHashCode(n);n=new x.hub.m.hm.Manager(n);return this._managers[q]=n};p.prototype.onDeviceEvent=function(n,q){this._logger.log("trace","receive device event:"+JSON.stringify(n));require("x.hub.eventbus.js");if(q)this._chipManager&&(this._chipManager.checkButtonEvent(n),this._udpEvtProducer.onEvent(n));else for(var h in this._managers)if(q=this._managers[h])try{q.onDeviceEvent(n)}catch(g){console.error(g.stack)}};p.prototype.resetChip=
function(n){this._chipManager?this._chipManager.reset(function(){n&&n({})}):n&&n(Error("chip manager not inited"))};p.prototype.initManager=function(n,q){if(n){var h=this._getManager(n);h||(h=this._addManager(n));h.init(function(g){q&&q({error:g})})}else q&&q({error:Error("gateway invalid")})};p.prototype.learnRFDevice=function(n,q){if(n){var h=this._getManager(n);h?h.learnRFDevice(function(g,k){q&&q({error:g,data:k})}):(h=this._addManager(n),h.init(function(g){g?q&&q({error:g}):setTimeout(function(){h.learnRFDevice(function(k,
r){q&&q({error:k,data:r})})},3E3)}))}else this._chipManager?this._chipManager.learnRFDevice(function(g,k){if(g)q&&q({error:g});else{var r=[];k.forEach(function(m){if(m){var v=m.toLegacyAdr();m=m.toLegacyType();r.push({address:v,type:m})}});q&&q({data:r})}}):q&&q(Error("chip manager not inited"))};p.prototype.learnRFDeviceSN=function(n,q,h){if(n){var g=this._getManager(n);g?g.learnRFDevice(function(k,r){h&&h({error:k,data:r})}):(g=this._addManager(n),g.init(function(k){k?h&&h({error:k}):setTimeout(function(){g.learnRFDevice(function(r,
m){h&&h({error:r,data:m})})},3E3)}))}else this._chipManager?this._chipManager.learnRFDeviceSN(q,function(k,r){if(k)h&&h({error:k});else{var m=[];r.forEach(function(v){if(v){var w=v.toLegacyAdr();v=v.toLegacyType();m.push({address:w,type:v})}});h&&h({data:m})}}):h&&h(Error("chip manager not inited"))};p.prototype.learnIPDevice=function(n,q,h,g){if(n){var k=this._getManager(n);k?k.learnIPDevice(q,h,function(r,m){g&&g({error:r,data:m})}):(k=this._addManager(n),k.init(function(r){r?g&&g({error:r}):setTimeout(function(){k.learnIPDevice(q,
h,function(m,v){g&&g({error:m,data:v})})},3E3)}))}else q?h?this._chipManager?this._chipManager.learnIPDevice(q,h,function(r,m){if(r)g&&g({error:r});else{var v=[];m.forEach(function(w){if(w){var z=w.toLegacyAdr();w=w.toLegacyType();v.push({address:z,type:w})}});g&&g({data:v})}}):g&&g(Error("chip manager not inited")):g&&g({error:Error("key is null")}):g&&g({error:Error("sgtin is null")})};p.prototype.learnIPDeviceQR=function(n,q,h){if(q)if(n){var g=this._getManager(n);g?g.learnIPDeviceQR(q,function(k,
r){h&&h({error:k,data:r})}):(g=this._addManager(n),g.init(function(k){k?h&&h({error:k}):setTimeout(function(){g.learnIPDeviceQR(q,function(r,m){h&&h({error:r,data:m})})},3E3)}))}else this._chipManager?this._chipManager.learnIPDeviceQR(q,function(k,r){if(k)h&&h({error:k});else{var m=[];r.forEach(function(v){if(v){var w=v.toLegacyAdr();v=v.toLegacyType();m.push({address:w,type:v})}});h&&h({data:m})}}):h&&h(Error("chip manager not inited"));else h&&h({error:Error("qrKey is null")})};p.prototype.deleteDevice=
function(n,q,h){if(q){var g=q.split(".");3>g.length?h&&h({error:Error("address invalid")}):(q=g[1],g=g[2],n?h&&h({error:Error("not supported yet")}):this._chipManager?this._chipManager.deleteDevice(q,g,function(k){h&&h({error:k})}):h&&h(Error("chip manager not inited")))}else h&&h({error:Error("address invalid")})};p.prototype.getRFInterfaces=function(n,q){if(n){var h=this._getManager(n);h?h.getRFInterfaces(function(g,k){q&&q({error:g,data:k})}):(h=this._addManager(n),h.init(function(g){g?q&&q({error:g}):
setTimeout(function(){h.getRFInterfaces(function(k,r){q&&q({error:k,data:r})})},3E3)}))}else this._chipManager?this._chipManager.getRFInterfaces(function(g,k){q&&q({error:g,data:k})}):q&&q(Error("chip manager not inited"))};p.prototype.executeCommandLegacy=function(n,q,h,g){n?g&&g({error:Error("not supported yet")}):this._chipManager?q?this.executeCommand({address:q},{value:h},function(k){g&&g({error:k?k.error:null})}):g&&g({error:Error("address invalid")}):g&&g({error:Error("chip manager not inited")})};
p.prototype.getAllStatesLegacy=function(n){var q=[];try{this.getAllStates().forEach(function(h){if(h&&h.device&&h.states){var g={type:"HM",adr:h.device.toLegacyAdr(),state:{}},k;for(k in h.states)g.state[k]=h.states[k].value;q.push(g)}})}catch(h){console.error(h.stack)}n&&n({data:q})};p.prototype.getConfig=function(n,q){n?n.gateway&&"mediola"!=n.gateway.uuid?q&&q({error:Error("not supported yet")}):this._chipManager?this._chipManager.getConfig(n,function(h,g){q&&q({error:h,data:g})}):q&&q({error:Error("chip manager not inited")}):
q&&q({error:Error("device is null")})};p.prototype.setConfig=function(n,q,h){n?n.gateway&&"mediola"!=n.gateway.uuid?h&&h({error:Error("not supported yet")}):this._chipManager?this._chipManager.setConfig(n,q,function(g){h&&h({error:g})}):h&&h({error:Error("chip manager not inited")}):h&&h({error:Error("device is null")})};p.prototype.getMonitorStates=function(n){this._monitorManager.getMonitorStates(function(q,h){n&&n({error:q,data:h})})};p.prototype.getAllDevices=function(n){var q=[];try{this.getAllStates().forEach(function(h){h&&
h.device&&h.states&&(h={type:"HM",address:h.device.toLegacyAdr(),data:h.device.toLegacyType(),snr:h.device.getSerial(),_ver:"v5+"},q.push(h))})}catch(h){console.error(h.stack)}n&&n({data:q})};p.prototype.isWindowOpen=function(){try{for(var n=this.getAllStates(),q=0;q<n.length;q++){var h=n[q];if(h&&h.device&&h.states){var g=h.device.toLegacyType();if("window"==g){if(h.states.state&&"closed"!=h.states.state.value)return!0}else if("contact"==g){if(h.states.state&&"closed"!=h.states.state.value)return!0}else if("ip_contact"==
g){if(h.states.state&&"closed"!=h.states.state.value)return!0}else if("ip_window"==g&&h.states.state&&"closed"!=h.states.state.value)return!0}}}catch(k){return!1}};return p}();"undefined"!=typeof exports&&"undefined"!=typeof module&&module.exports&&(exports=module.exports=new x.hub.m.hm.Handler);
