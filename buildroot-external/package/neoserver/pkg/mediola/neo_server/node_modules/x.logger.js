var x=x||{};
x.Logger={_level:0,_file:null,_fileMaxSize:200,_levelMap:{},_fileMap:{},_fileSizeMap:{},_logRoot:null,_logTrackerMap:{},_log2consoleMap:{},getLogger:function(a){return new x.Logger._LoggerImpl(a)},setLevel:function(a,b){a&&"string"===typeof a&&(a=x.Logger._resolveLevel(a),0<=a&&(b?x.Logger._levelMap[b]=a:x.Logger._level=a))},getAll:function(){var a={};a.defaultLevel=x.Logger._level;for(var b in x.Logger._levelMap)a[b]=this._level2Str(x.Logger._levelMap[b]);return a},setFile:function(a){x.Logger._file=a},
setLogFolder:function(a){x.Logger._logRoot=a},setTagFile:function(a,b){a&&b&&(this._fileMap[a]=b)},setTagFileNode:function(a,b){if(a&&b&&this._logRoot){var c=require("path");this._fileMap[a]=c.resolve(this._logRoot,b)}},setFileSize:function(a,b){a&&b&&(this._fileSizeMap[a]=b)},getFileSize:function(a){return this._fileSizeMap[a]},setLogToConsole:function(a,b){this._log2consoleMap[b]=a},getLogToConsole:function(a){a=this._matchKeyForTag(a,this._log2consoleMap);null==a&&(a=!0);return a},setLogTracker:function(a,
b){a&&b&&(this._logTrackerMap[a]||(this._logTrackerMap[a]=[]),-1==this._logTrackerMap[a].indexOf(b)&&this._logTrackerMap[a].push(b))},removeLogTracker:function(a,b){if(a&&this._logTrackerMap[a]){var c=-1;b&&(c=this._logTrackerMap[a].indexOf(b));-1!=c&&this._logTrackerMap[a].splice(c,1)}},getLogTrackers:function(a){if(!a)return[];a=a.split(".");for(var b=[];0<a.length;){var c=a.join(".");if(this._logTrackerMap[c]){b=b.concat(this._logTrackerMap[c]);break}a.splice(a.length-1,1)}return b},_matchKeyForTag:function(a,
b){if(!a)return null;a=a.split(".");for(var c=null;0<a.length&&(c=a.join("."),c=b[c],"undefined"==typeof c||null==c);)a.splice(a.length-1,1);return c},_level2Str:function(a){switch(a){case 0:return"all";case 1:return"trace";case 1.1:return"trace_l1";case 1.2:return"trace_l2";case 1.3:return"trace_l3";case 2:return"debug";case 3:return"info";case 4:return"warn";case 5:return"error";case 6:return"fatal";default:return"unknown"}},_resolveLevel:function(a){switch(a.toLowerCase()){case "all":return 0;
case "trace":case "trace_l0":return 1;case "trace_l1":return 1.1;case "trace_l2":return 1.2;case "trace_l3":return 1.3;case "debug":return 2;case "info":return 3;case "warn":return 4;case "error":return 5;case "fatal":return 6;default:return-1}},_getLevel:function(a){if(!a)return x.Logger._level;a=a.split(".");for(var b=x.Logger._level;0<a.length;){var c=a.join(".");c=x.Logger._levelMap[c];if("undefined"!=typeof c&&null!=c)return c;a.splice(a.length-1,1)}return b},_getFile:function(a){if(!a)return null;
a=a.split(".");for(var b;0<a.length;){var c=a.join(".");if(c=this._fileMap[c]){b=c;break}a.splice(a.length-1,1)}return b}};x.Logger._LoggerImpl=function(a){this.tag=a;this._queue=[]};
x.Logger._LoggerImpl.prototype.log=function(a,b){var c=x.Logger._resolveLevel(a);0<=c&&c>=x.Logger._getLevel(this.tag)&&(c=new Date,a=c.getDate()+"/"+(c.getMonth()+1)+"/"+c.getFullYear()+" "+c.getHours()+":"+c.getMinutes()+":"+c.getSeconds()+"."+(c.getMilliseconds()/1E3).toFixed(3).slice(2,5)+" "+a+": ["+this.tag+"] "+b,this._write(a))};
x.Logger._LoggerImpl.prototype._write=function(a){var b=x.Logger.getLogTrackers(this.tag);if(b&&0<b.length)for(var c=0;c<b.length;c++){var d=b[c];d&&d(a)}!x.Logger._logWriter&&"undefined"!=typeof XC&&null!=XC&&XC.createObject&&(x.Logger._logWriter=XC.createObject("x.logger.writer"));x.Logger._logWriter&&(x.Logger.getLogToConsole(this.tag)&&x.Logger._logWriter.writeConsole(a),c=x.Logger._getFile(this.tag),b=x.Logger.getFileSize(c),b||(b=x.Logger._fileMaxSize),c&&x.Logger._logRoot?(c=require("path").resolve(x.Logger._logRoot,
c),x.Logger._logWriter.writeFile(a,c,b)):x.Logger._file&&x.Logger._logWriter.writeFile(a,x.Logger._file,b))};"undefined"!=typeof exports&&"undefined"!=typeof module&&module.exports&&(exports=module.exports=x.Logger);
