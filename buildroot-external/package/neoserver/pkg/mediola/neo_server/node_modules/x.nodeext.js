function _typeof(o){"@babel/helpers - typeof";return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(o){return typeof o;}:function(o){return o&&"function"==typeof Symbol&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o;},_typeof(o);}var http=require("http"),fs=require("fs");if(http._getFileFallback=function(e,r,t){var n=require("os").tmpdir()+require("path").sep+"xcdl"+require("path").sep,s=n+Math.random().toString(36).substring(2);fs.existsSync(n)||fs.mkdirSync(n);var a=require("url").parse(e),i=80,o=!1;if(a.port){if((0===(i=parseInt(a.port))||isNaN(i))&&(i=80),!(i>0&&i<65536))return void(t&&t(null));o=!0;}var u={host:a.hostname,port:i,path:a.path,method:"GET"};"https"==e.substring(0,5).toLowerCase()&&(o||(u.port=443)),r&&r.user&&(u.auth=r.user+":"+r.password),null==u.port&&(u.port=80);var l="",c=0,h=!1,f=require("net").connect({port:u.port,host:u.host},function(){var e=u.method+" "+u.path+" HTTP/1.1\r\n";e+="Host: "+u.host+"\r\n",u.auth&&(e+="Authorization: Basic "+new Buffer(u.auth).toString("base64")+"\r\n"),e+="Connection: close\r\n\r\n",f.write(e);});f.on("data",function(e){if(h)fs.appendFileSync(s,e);else{c=l.length;var r=(l+=e.toString()).indexOf("\n\r\n");if(-1==r&&(r=l.indexOf("\n\n")),-1!=r){var t=l.indexOf("\n",r+1);h=!0,fs.writeFileSync(s,e.slice(t-c+1)),l=l.substr(0,r);}}}),f.on("end",function(){fs.existsSync(s)?t(s):t(null);}),f.on("error",function(){t(null);});},http.getFile=function(e,r,t,n,s){void 0===s&&(s={}),void 0===s.encodeURL&&(s.encodeURL=!0);var a=require("os").tmpdir()+require("path").sep+"xcdl"+require("path").sep,i=a+Math.random().toString(36).substring(2);try{fs.existsSync(a)||fs.mkdirSync(a);}catch(e){return void(t&&t(e));}var o=require("url").parse(e),u=80,l=!1;if(o.port){if((0===(u=parseInt(o.port))||isNaN(u))&&(u=80),!(u>0&&u<65536))return void(t&&t(null));l=!0;}o.path;var c={host:o.hostname,port:u,path:s.encodeURL?encodeURI(decodeURI(o.path)):o.path,method:"GET",headers:{}};r&&r.headers&&(c.headers=r.headers),r&&r.user&&(c.auth=r.user+":"+r.password),n&&(c.headers.Authorization=n);var h=require("http"),f=h;"https"==e.substring(0,5).toLowerCase()&&(f=require("https"),l||(c.port=443));var d=f.request(c,function(s){if(200==s.statusCode){var a=fs.createWriteStream(i);s.pipe(a),a.on("finish",function(){a.end(),t(i);}),a.on("error",function(){a.end();});}else if(301==s.statusCode||302==s.statusCode)s.headers.location?(h.getFile(s.headers.location,r,t,null,{encodeURL:!1}),s.destroy()):t&&t(null,s);else if(401!=s.statusCode||n)t(null,s);else if(n=null,s.headers&&s.headers["www-authenticate"]&&"Digest "==s.headers["www-authenticate"].substr(0,7)){var o=require("x.crypt.js");(n=o.DigestAuth(s.headers["www-authenticate"],c.path,r.user,r.password))?h.getFile(e,r,t,n):t&&t(null,s);}else t&&t(null,s);});d.on("error",function(n){XC.debugf(n),h._getFileFallback(e,r,t);}),d.end();},http.postFile=function(e,r,t,n){var s=require("url").parse(r),a=80,i=!1;if(s.port){if((0===(a=parseInt(s.port))||isNaN(a))&&(a=80),!(a>0&&a<65536))return void(n&&n(null));i=!0;}s.path;var o={host:s.hostname,port:a,path:s.path,method:"POST",headers:{Connection:"close","Content-Type":"application/octet-stream"}};if(t&&t.user&&(o.auth=t.user+":"+t.password),t&&t.headers)for(var u in t.headers)o.headers[u]=t.headers[u];var l=require("http");"https"==r.substring(0,5).toLowerCase()&&(l=require("https"),i||(o.port=443));var c=l.request(o,function(e){n&&n(e);});try{var h=fs.createReadStream(e);h.pipe(c),h.on("finish",function(){h.close();}),h.on("error",function(e){h.close(),c.emit("error",e);});}catch(e){c.emit("error",e);}return c;},http.getFileAIOCloud=function(e,r,t,n,s){void 0===s&&(s={});var a=require("os").tmpdir()+require("path").sep+"xcdl"+require("path").sep,i=a+Math.random().toString(36).substring(2);try{fs.existsSync(a)||fs.mkdirSync(a);}catch(e){return void(t&&t(e));}var o=require("url").parse(e),u=80,l=!1;if(o.port){if((0===(u=parseInt(o.port))||isNaN(u))&&(u=80),!(u>0&&u<65536))return void(t&&t(null));l=!0;}o.path;var c={host:o.hostname,port:u,path:o.path,method:"GET",headers:{}};if(r&&r.url){"?"==c.path[c.path.length-1]&&(c.path=c.path.substring(0,c.path.length-1));var h=!0;for(var f in r.url)c.path+=h?"?":"&",c.path+=f+"="+encodeURIComponent(r.url[f]),h=!1;}r&&r.user&&(c.auth=r.user+":"+r.password),n&&(c.headers.Authorization=n);var d=require("http"),p=d;"https"==e.substring(0,5).toLowerCase()&&(p=require("https"),l||(c.port=443));var v=fs.createWriteStream(i);v.on("error",function(e){XC.debugf(e.message,"error"),v.end();}),v.on("finish",function(){v.end(),t(i);}),v.on("open",function(){var s=p.request(c,function(s){if(200==s.statusCode)s.pipe(v);else if(302==s.statusCode)s.headers.location?(delete r.url,d.getFile(s.headers.location,r,t,null,{encodeURL:!1}),s.destroy()):t&&t(null);else if(401!=s.statusCode||n)t(null);else if(n=null,s.headers&&s.headers["www-authenticate"]&&"Digest "==s.headers["www-authenticate"].substr(0,7)){var a=require("x.crypt.js");(n=a.DigestAuth(s.headers["www-authenticate"],c.path,r.user,r.password))?d.getFile(e,r,t,n):t&&t(null);}else t&&t(null);});s.on("error",function(n){XC.debugf(n,"error"),d._getFileFallback(e,r,t);}),s.end();});},fs.readFileLine=function(e,r,t){fs.readFile(e,function(e,n){var s=!1,a=n.toString("utf-8").split("\n");a[r-1]&&(t(null,a[r-1]),s=!0),s||t("failed",null);});},fs.readFileBinary=function(e,r,t,n){fs.open(e,"r",function(e,s){fs.fstat(s,function(e,a){var i=a.size;if(r>=i)fs.closeSync?fs.closeSync(s):fs.close(s),n(null,"");else{r+t>i&&(t=i-r),t>1024&&(t=1024);var o=new Buffer(t);fs.read(s,o,0,t,r,function(e,r,t){var a=t.toString("hex");fs.closeSync?fs.closeSync(s):fs.close(s),e?n("failed",null):n(null,a);});}});});},fs.rmdirRecursiveSync=function(e){fs.existsSync(e)&&(fs.readdirSync(e).forEach(function(r,t){var n=e+"/"+r;fs.lstatSync(n).isDirectory()?fs.rmdirRecursiveSync(n):fs.unlinkSync(n);}),fs.rmdirSync(e));},fs.mkdirRecursiveSync=function(e){var r=require("path");fs.existsSync(r.dirname(e))||fs.mkdirRecursiveSync(r.dirname(e)),fs.existsSync(e)||fs.mkdirSync(e);},fs.copyFileSync=function(e,r){var t=r.substring(0,r.lastIndexOf("/"));fs.mkdirRecursiveSync(t),fs.writeFileSync(r,fs.readFileSync(e));},fs.dataPath=function(){var e=null;try{e=require("nw.gui");}catch(e){}return"object"==(typeof nw==="undefined"?"undefined":_typeof(nw))&&null!==nw&&nw.App?nw.App.dataPath+require("path").sep+"..":e?e.App.dataPath:process.cwd();},"undefined"==typeof localStorage||null===localStorage){localStorage=null;try{var ls=require("node-localstorage").LocalStorage;localStorage=new ls("./localstorage");}catch(e){}}