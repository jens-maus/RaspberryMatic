var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.findInternal=function(c,a,b){c instanceof String&&(c=String(c));for(var d=c.length,e=0;e<d;e++){var h=c[e];if(a.call(b,h,e,c))return{i:e,v:h}}return{i:-1,v:void 0}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;$jscomp.ISOLATE_POLYFILLS=!1;$jscomp.FORCE_POLYFILL_PROMISE=!1;$jscomp.FORCE_POLYFILL_PROMISE_WHEN_NO_UNHANDLED_REJECTION=!1;
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(c,a,b){if(c==Array.prototype||c==Object.prototype)return c;c[a]=b.value;return c};$jscomp.getGlobal=function(c){c=["object"==typeof globalThis&&globalThis,c,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global];for(var a=0;a<c.length;++a){var b=c[a];if(b&&b.Math==Math)return b}throw Error("Cannot find global object");};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.IS_SYMBOL_NATIVE="function"===typeof Symbol&&"symbol"===typeof Symbol("x");$jscomp.TRUST_ES6_POLYFILLS=!$jscomp.ISOLATE_POLYFILLS||$jscomp.IS_SYMBOL_NATIVE;$jscomp.polyfills={};$jscomp.propertyToPolyfillSymbol={};$jscomp.POLYFILL_PREFIX="$jscp$";var $jscomp$lookupPolyfilledValue=function(c,a){var b=$jscomp.propertyToPolyfillSymbol[a];if(null==b)return c[a];b=c[b];return void 0!==b?b:c[a]};
$jscomp.polyfill=function(c,a,b,d){a&&($jscomp.ISOLATE_POLYFILLS?$jscomp.polyfillIsolated(c,a,b,d):$jscomp.polyfillUnisolated(c,a,b,d))};$jscomp.polyfillUnisolated=function(c,a,b,d){b=$jscomp.global;c=c.split(".");for(d=0;d<c.length-1;d++){var e=c[d];if(!(e in b))return;b=b[e]}c=c[c.length-1];d=b[c];a=a(d);a!=d&&null!=a&&$jscomp.defineProperty(b,c,{configurable:!0,writable:!0,value:a})};
$jscomp.polyfillIsolated=function(c,a,b,d){var e=c.split(".");c=1===e.length;d=e[0];d=!c&&d in $jscomp.polyfills?$jscomp.polyfills:$jscomp.global;for(var h=0;h<e.length-1;h++){var l=e[h];if(!(l in d))return;d=d[l]}e=e[e.length-1];b=$jscomp.IS_SYMBOL_NATIVE&&"es6"===b?d[e]:null;a=a(b);null!=a&&(c?$jscomp.defineProperty($jscomp.polyfills,e,{configurable:!0,writable:!0,value:a}):a!==b&&(void 0===$jscomp.propertyToPolyfillSymbol[e]&&($jscomp.propertyToPolyfillSymbol[e]=$jscomp.IS_SYMBOL_NATIVE?$jscomp.global.Symbol(e):
$jscomp.POLYFILL_PREFIX+e),$jscomp.defineProperty(d,$jscomp.propertyToPolyfillSymbol[e],{configurable:!0,writable:!0,value:a})))};$jscomp.polyfill("Array.prototype.find",function(c){return c?c:function(a,b){return $jscomp.findInternal(this,a,b).v}},"es6","es3");$jscomp.arrayIteratorImpl=function(c){var a=0;return function(){return a<c.length?{done:!1,value:c[a++]}:{done:!0}}};$jscomp.arrayIterator=function(c){return{next:$jscomp.arrayIteratorImpl(c)}};$jscomp.initSymbol=function(){};
$jscomp.polyfill("Symbol",function(c){if(c)return c;var a=function(e,h){this.$jscomp$symbol$id_=e;$jscomp.defineProperty(this,"description",{configurable:!0,writable:!0,value:h})};a.prototype.toString=function(){return this.$jscomp$symbol$id_};var b=0,d=function(e){if(this instanceof d)throw new TypeError("Symbol is not a constructor");return new a("jscomp_symbol_"+(e||"")+"_"+b++,e)};return d},"es6","es3");
$jscomp.polyfill("Symbol.iterator",function(c){if(c)return c;c=Symbol("Symbol.iterator");for(var a="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),b=0;b<a.length;b++){var d=$jscomp.global[a[b]];"function"===typeof d&&"function"!=typeof d.prototype[c]&&$jscomp.defineProperty(d.prototype,c,{configurable:!0,writable:!0,value:function(){return $jscomp.iteratorPrototype($jscomp.arrayIteratorImpl(this))}})}return c},"es6",
"es3");$jscomp.iteratorPrototype=function(c){c={next:c};c[Symbol.iterator]=function(){return this};return c};$jscomp.iteratorFromArray=function(c,a){c instanceof String&&(c+="");var b=0,d=!1,e={next:function(){if(!d&&b<c.length){var h=b++;return{value:a(h,c[h]),done:!1}}d=!0;return{done:!0,value:void 0}}};e[Symbol.iterator]=function(){return e};return e};$jscomp.polyfill("Array.prototype.keys",function(c){return c?c:function(){return $jscomp.iteratorFromArray(this,function(a){return a})}},"es6","es3");
var xnm=xnm||{};xnm.aio=xnm.aio||{};xnm.aio.cams=xnm.aio.cams||{};xnm.aio.cams._moveFromTmp=function(c,a,b){var d=require("fs"),e=d.createReadStream(c);a=d.createWriteStream(a);a.on("error",function(h){XC.debugf(h.message,"error");b&&b(h)});e.on("error",function(h){XC.debugf(h.message,"error");b&&b(h)});e.on("end",function(){try{d.unlinkSync(c)}catch(h){}b&&b()});e.pipe(a)};
xnm.aio.cams.rename=function(c,a,b,d){var e=function(){setTimeout(function(){b&&b()},100)};if("undefined"===typeof process||"object"!==typeof process.release||"node"!==process.release.name||"win32"!==process.platform&&!d){d=require("fs");try{d.renameSync(c,a)}catch(h){xnm.aio.cams.rename(c,a,e,!0);return}e&&e()}else this._moveFromTmp(c,a,e)};
xnm.aio.cams.SystemCam=function(c,a){this._$cam=c;this._options=a;this.jpegurl=this._addAuth("http://"+this._getIP()+c.attr("imageurl"));this.mjpegurl=null;c.attr("mjpegurl")&&(this.mjpegurl=this._addAuth("http://"+this._getIP()+c.attr("mjpegurl")),"true"==c.attr("useurlauth")&&(this.mjpegurl=this._addAuth("http://"+a.user+":"+a.password+"@"+this._getIP()+c.attr("mjpegurl"))),!window.XCHost||!window.XCHost.getType||"node-webkit"!=window.XCHost.getType()&&"Android"!=window.XCHost.getType()||"doorbird"==
c.attr("id")||c.attr("name")&&-1!=c.attr("name").indexOf("DoorBird")||(this.mjpegurl=null));this.controlurl=null;this.pantilt=!1;"true"==a.pantilt&&(this.pantilt=!0,c.attr("controlurl")&&(this.controlurl=this._addAuth("http://"+this._getIP()+c.attr("controlurl"))),c.attr("controlpostdata")&&(this.controlpostdata=c.attr("controlpostdata")));c.attr("imagepathurl")&&(this.mjpegurl=this.jpegurl=null,this.jpegpathurl=this._addAuth("http://"+this._getIP()+c.attr("imagepathurl")))};
xnm.aio.cams.SystemCam.prototype._getIP=function(){var c=this._$cam.attr("port"),a=this._options.address;0>a.indexOf(":")&&c&&80!=c&&(a+=":"+c);return a};xnm.aio.cams.SystemCam.prototype._addAuth=function(c){var a=this._$cam.attr("auth");if(a){a=a.replace("@user",encodeURIComponent(this._options.user));a=a.replace("@pwd",encodeURIComponent(this._options.password));var b="&";-1==c.indexOf("?")&&(b="?");c+=b+a}return c};
xnm.aio.cams.SystemCam.prototype._doRequest=function(c,a,b){c=require("url").parse(c);c.port||(c.port=80);c={host:c.hostname,port:c.port,path:c.path,method:"GET",user:this._options.user,password:this._options.password,headers:{"Content-Type":'text/xml; charset="utf-8"',Authorization:"Basic "+(new Buffer(this._options.user+":"+this._options.password)).toString("base64"),Connection:"close"}};a&&(c.method="POST",c.headers["Content-Length"]=a.length);c=require("http").request(c,function(d){b&&b(d)});
if(c.on)c.on("error",function(d){b&&b()});a&&c.write(a);c.end()};
xnm.aio.cams.SystemCam.prototype.executeCommand=function(c){if(this.controlurl){var a=this;this._$cam.find("key").each(function(){var b=$(this);if(b.attr("id")==c){var d=a.controlurl.replace("%@",b.attr("code")),e=null;a.controlpostdata&&(d=a.controlurl,e=a.controlpostdata.replace("%@",b.attr("code")));a._doRequest(d,e,function(h){h=500;if("left"==c||"right"==c)h=800;"XS100"==a._$cam.attr("id")?setTimeout(function(){d=a.controlurl.replace("%@","1");a._doRequest(d)},h):a._$cam.attr("stop")&&setTimeout(function(){d=
a.controlurl.replace("%@",a._$cam.attr("stop"));a._doRequest(d)},h/2)})}})}};xnm.aio.cams.JPEGCam=function(c,a,b,d){this._url=c;this._imgPath=b;this._imgPage=d;this._options=a;this._prevDone=!0};
xnm.aio.cams.JPEGCam.prototype._loadImage=function(c){var a=require("fs"),b=this;this._loadImage2Tmp(function(d,e){if(d&&a.existsSync(d)){var h=null;h="object"===typeof nw?nw.App.dataPath+"/../cams/":a.dataPath()+"/cams/";var l="image.jpg";b._options&&b._options.imageName&&(l=b._options.imageName);a.mkdirRecursiveSync(h);if(a.existsSync(h+l)){var f=h+l+"_"+(new Date).getTime();xnm.aio.cams.rename(h+l,f,function(){a.existsSync(f)&&a.unlinkSync(f);xnm.aio.cams.rename(d,h+l,function(){c&&c("file://"+
h+l+"?"+(new Date).getTime())})})}else xnm.aio.cams.rename(d,h+l,function(){c&&c("file://"+h+l+"?"+(new Date).getTime())})}else c&&c(null,e)})};xnm.aio.cams.JPEGCam.prototype._loadImage2Tmp=function(c){if(this._url)if(this._prevDone){var a=require("http");require("fs");var b=this;this._prevDone=!1;a.getFile(this._url,this._options,function(d,e){d?c&&c(d):(XC.debugf("failed to load "+b._url),c&&c(null,e));b._prevDone=!0},null,{encodeURL:!1})}else c&&c();else XC.debugf("[xnm.aio.cams.JPEGCam._loadImage] No URL set!")};
xnm.aio.cams.JPEGCam.prototype._getImagePath=function(c){var a=require("url").parse(this._imgPath);a.port||(a.port=80);this._ip=a.hostname+":"+a.port;a={host:a.hostname,port:a.port,path:a.path,method:"GET",user:this._options.user,password:this._options.password,headers:{"Content-Type":'text/xml; charset="utf-8"',Authorization:"Basic "+(new Buffer(this._options.user+":"+this._options.password)).toString("base64"),Connection:"close"}};a=require("http").request(a,function(b){b.setEncoding("utf-8");var d=
"";b.on("data",function(e){d+=e});b.on("end",function(){c&&c(d)})});if(a.on)a.on("error",function(b){c&&c()});a.end()};
xnm.aio.cams.JPEGCam.prototype._getImagePage=function(c){var a=require("url").parse(this._imgPage);a.port||(a.port=80);this._ip=a.hostname+":"+a.port;a={host:a.hostname,port:a.port,path:a.path,method:"GET",user:this._options.user,password:this._options.password,headers:{"Content-Type":'text/xml; charset="utf-8"',Authorization:"Basic "+(new Buffer(this._options.user+":"+this._options.password)).toString("base64"),Connection:"close"}};a=require("http").request(a,function(b){b.setEncoding("utf-8");var d=
"";b.on("data",function(e){d+=e});b.on("end",function(){200!=b.statusCode?c&&c(Error("http status code:"+b.statusCode)):c&&c(null,d);c=null})});a.setTimeout&&a.setTimeout(5E3,function(){c&&c(Error("timeout"));c=null});if(a.on)a.on("error",function(b){c&&c(b);c=null});a.end()};
xnm.aio.cams.JPEGCam.prototype.loadImage=function(c){var a=this;this._imgPath?this._getImagePath(function(b){a._url=null;if(b){var d=b.indexOf('path="'),e=b.lastIndexOf('"');-1<d&&e>d&&(a._url="http://"+a._ip+b.substring(d+6,e))}a._loadImage(c)}):this._imgPage?this._getImagePage(function(b,d){b||!d?c&&c():(a._url=null,b=d.substr(d.indexOf('<img src="')+10),b=b.substr(0,b.indexOf('"/>')),b=b.substr(2),a._url="http://"+a._ip+b,a._loadImage(c))}):this._loadImage(c)};
xnm.aio.cams.JPEGCam.prototype.loadImage2Tmp=function(c){if(this._imgPath){var a=this;this._getImagePath(function(b){a._url=null;if(b){var d=b.indexOf('path="'),e=b.lastIndexOf('"');-1<d&&e>d&&(a._url="http://"+a._ip+b.substring(d+6,e))}a._loadImage2Tmp(c)})}else this._loadImage2Tmp(c)};xnm.aio.cams.MJPEGCam=function(c,a){this._url=c;this._options=a;this._mjpegClient=null;this._loading=!1};
xnm.aio.cams.MJPEGCam.prototype._loadImage=function(c){var a=require("fs"),b=this;this._loadImage2Tmp(function(d){if(d){if(a.existsSync(d)){var e=null;e="object"===typeof nw?nw.App.dataPath+"/../cams/":a.dataPath()+"/cams/";var h="image.jpg";b._options&&b._options.imageName&&(h=b._options.imageName);a.mkdirRecursiveSync(e);if(a.existsSync(e+h)){var l=e+h+"_"+(new Date).getTime();xnm.aio.cams.rename(e+h,l,function(){a.existsSync(l)&&a.unlinkSync(l);xnm.aio.cams.rename(d,e+h,function(){c&&c("file://"+
e+h+"?"+(new Date).getTime())})})}else xnm.aio.cams.rename(d,e+h,function(){c&&c("file://"+e+h+"?"+(new Date).getTime())})}}else c&&c()})};
xnm.aio.cams.MJPEGCam.prototype._loadImage2Tmp=function(c){if(this._url)if(this._mjpegClient||(this._mjpegClient=require("x.mjpeg.js").getClient(this._url,this._options)),this._loading)c&&c();else{require("fs");var a=this;this._loading=!0;this._mjpegClient.getFile(this._url,this._options,function(b){a._loading=!1;b?c&&c(b):(XC.debugf("failed to load "+a._url),c())})}else c&&c()};xnm.aio.cams.MJPEGCam.prototype.loadImage=function(c){this._loadImage(c)};
xnm.aio.cams.MJPEGCam.prototype.loadImage2Tmp=function(c){this._loadImage2Tmp(c)};xnm.aio.cams.FoscamDiscovery=function(){this._sockets=[];var c=require("os"),a=require("dgram");if(c&&c.networkInterfaces){var b=this;a=a.createSocket("udp4");a.bind(9600,"0.0.0.0");a.on("message",function(h,l){b._receivedData(l.address,h.toString("hex"))});c=c.networkInterfaces();for(var d in c){a=c[d];for(var e=0;e<a.length;e++)this._addDiscoverSocket(9600,a[e])}}else this._addDiscoverSocket(9600,null)};
xnm.aio.cams.FoscamDiscovery.prototype._receivedData=function(c,a){XC.debugf("Received camdata from "+c)};xnm.aio.cams.FoscamDiscovery.prototype._addDiscoverSocket=function(c,a){var b=require("dgram"),d=this;if(a)"IPv4"==a.family&&0==a.internal&&(e=b.createSocket("udp4"),e.on("listening",function(){e.setBroadcast(!0)}),e.bind(c,a.address),this._sockets.push(e));else{var e=b.createSocket("udp4");e.on("message",function(h,l){d._receivedData(l.address,h.toString("hex"))});this._sockets.push(e)}};
xnm.aio.cams.FoscamDiscovery.prototype._sendDiscoveryMessages=function(c,a,b,d){c=new Buffer([77,79,95,73,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,4,0,0,0,0,0,0,1]);a=new Buffer([68,72,1,1]);for(b=0;b<this._sockets.length;b++)this._sockets[b].send(c,0,c.length,1E4,"255.255.255.255"),this._sockets[b].send(a,0,a.length,8600,"255.255.255.255")};xnm.aio.cams.FoscamDiscovery.prototype.discoverCams=function(){var c=this,a=0,b=setInterval(function(){c._sendDiscoveryMessages();4<=a++&&clearInterval(b)},250)};
xnm.aio.cams.Cam=function(){var c=function(a,b){this._options=a;this._camInfo=b};c.prototype.getIP=function(){if(!this._options)return null;var a=this._options.ip,b=a.indexOf(":");-1!=b&&(a=a.substr(0,b));return a};c.prototype.getPort=function(){if(!this._options)return null;var a=this._options.port,b=this._options.ip,d=b.indexOf(":");a||-1==d||(a=parseInt(b.substr(d+1)));return a};c.prototype.getUsername=function(){return this._options?this._options.username:null};c.prototype.getPassword=function(){return this._options?
this._options.password:null};c.prototype.getVideoInfo=function(a){var b={username:this._options.username,password:this._options.password,jpeg:this.getJPEGURL(),mjpeg:this.getMJPEGURL(),jpegPath:this.getJPEGPathURL(),jpegPage:this.getJPEGPageURL()};a&&a(null,b)};c.prototype.getJPEGURL=function(){if(!this._camInfo||!this._camInfo.imageurl)return null;var a=this.getRootUrl()+this._camInfo.imageurl;return this._addAuth(a)};c.prototype.getJPEGPathURL=function(){return this._camInfo&&this._camInfo.imagepathurl?
this._addAuth(this.getRootUrl()+this._camInfo.imagepathurl):null};c.prototype.getJPEGPageURL=function(){return this._camInfo&&this._camInfo.imagepageurl?this._addAuth(this.getRootUrl()+this._camInfo.imagepageurl):null};c.prototype.getMJPEGURL=function(){if(!this._camInfo||!this._camInfo.mjpegurl)return null;var a=this.getRootUrl()+this._camInfo.mjpegurl;"true"==this._camInfo.useurlauth&&(a="",this._options.username&&(a=this._options.username+":"+(this._options.password?this._options.password:"")),
a=this.getRootUrl(a)+this._camInfo.mjpegurl);return this._addAuth(a)};c.prototype.executeCommandCreator=function(a,b,d){this.executeCommand(b.value,d)};c.prototype.getStatesCreator=function(a,b,d){d&&d(null,[])};c.prototype.executeCommand=function(a,b){if(a)if("snapshot"==a)this.snapshot(b);else{var d=this._buildControlUrl(a);if(d){var e=this._buildPostData(a),h=this;this._doRequest(d,{user:this._options.username,password:this._options.password},e,function(l,f){var g=500;if("left"==a||"right"==a)g=
800;"XS100"==h._camInfo.id||"telefunken.XS100"==h._camInfo.link?setTimeout(function(){var k=h._buildControlUrlRaw("1");h._doRequest(k,h._options,null,null)},g):h._camInfo.stop&&setTimeout(function(){var k=h._buildControlUrlRaw(h._camInfo.stop);h._doRequest(k,h._options,null,null)},g/2);b&&b(l,f)})}else b&&b(Error("build control url error"))}else b&&b(Error("command is empty"))};c.prototype.getRootUrl=function(a){var b="http://",d=this._options.ip;"https://"==d.substr(0,8).toLowerCase()?(b="https://",
d=d.substr(8)):"http://"==d.substr(0,7).toLowerCase()&&(d=d.substr(7));var e=this._options.port,h=d.indexOf(":");-1!=h&&(e=d.substr(h+1),d=d.substr(0,h));e||(e="https://"==b?443:80);return b+(a?a+"@":"")+d+":"+e};c.prototype._buildControlUrl=function(a){if(!this._camInfo||!this._camInfo.controlurl)return null;var b=this._decodeXml(this._camInfo.controlurl);a=this._getCommandCode(a);if(!a)return null;a=this._decodeXml(a);b=this.getRootUrl()+b.replace("%@",a);return this._addAuth(b)};c.prototype._buildControlUrlRaw=
function(a){if(!this._camInfo||!this._camInfo.controlurl||!a)return null;var b=this._decodeXml(this._camInfo.controlurl);a=this._decodeXml(a);a=this.getRootUrl()+b.replace("%@",a);return this._addAuth(a)};c.prototype._buildPostData=function(a){if(!this._camInfo||!this._camInfo.controlpostdata)return null;a=this._getCommandCode(a);if(!a)return null;a=this._decodeXml(a);return this._camInfo.controlpostdata.replace("%@",a)};c.prototype._getCommandCode=function(a){if(!a||!this._camInfo||!this._camInfo.keys)return null;
for(var b=0;b<this._camInfo.keys.length;b++){var d=this._camInfo.keys[b];if(d.id&&d.id==a)return d.code}return null};c.prototype._addAuth=function(a){if(!this._camInfo||!this._camInfo.auth)return a;var b=this._camInfo.auth;b=this._decodeXml(b);b=b.replace("@user",this._options.username?encodeURIComponent(this._options.username):"");b=this._options&&"instar"==this._options.manufacturer?b.replace("@pwd",this._options.password?this._options.password:""):b.replace("@pwd",this._options.password?encodeURIComponent(this._options.password):
"");var d="&";-1==a.indexOf("?")&&(d="?");return a+(d+b)};c.prototype._decodeXml=function(a){return a.replace(/&apos;/g,"'").replace(/&quot;/g,'"').replace(/&gt;/g,">").replace(/&lt;/g,"<").replace(/&amp;/g,"&")};c.prototype._doRequest=function(a,b,d,e,h){var l=require("url").parse(a),f=require("http");"https"==a.substring(0,5).toLowerCase()&&(f=require("https"),l.port||(l.port=443));l.port||(l.port=80);var g={host:l.hostname,port:l.port,path:l.path,method:"GET",headers:{"Content-Type":'text/xml; charset="utf-8"',
Connection:"close"}};h?g.headers.Authorization=h:b.user&&(b.password||(b.password=""),g.user=b.user,g.password=b.password,g.headers.Authorization="Basic "+(new Buffer(b.user+":"+b.password)).toString("base64"));d&&(g.method="POST",g.headers["Content-Length"]=d.length);var k=this;l=f.request(g,function(m){m.setEncoding("utf-8");var n="";m.on("data",function(p){n+=p});m.on("end",function(){XC.debugf("response:"+m.statusCode);if(401==m.statusCode&&!h&&m.headers&&m.headers["www-authenticate"]&&"Digest "==
m.headers["www-authenticate"].substr(0,7)){h=null;if(h=require("x.crypt.js").DigestAuth(m.headers["www-authenticate"],g.path,b.user,b.password,g.method)){h+=', opaque=""';XC.debugf("do digest auth:"+h);k._doRequest(a,b,d,e,h);return}var p=Error("http response:"+m.statusCode)}else 200!=m.statusCode&&(p=Error("http response:"+m.statusCode));e&&e(p,n)})});if(l.on)l.on("error",function(m){e&&e(m)});d&&l.write(d);l.end()};c.prototype.snapshot=function(a){this.getVideoInfo(function(b,d){b?a&&a(b):(b={user:d.username,
password:d.password},d.jpeg||d.jpegPath||d.jpegPage?(new xnm.aio.cams.JPEGCam(d.jpeg,b,d.jpegPath,d.jpegPage)).loadImage2Tmp(function(e){e?a&&a(null,e):a&&a(Error("load image error"))}):d.mjpeg?(new xnm.aio.cams.MJPEGCam(d.mjpeg,b)).loadImage2Tmp(function(e){e?a&&a(null,e):a&&a(Error("load image error"))}):a&&a(Error("not support snapshot")))})};c.prototype.equalsTo=function(a){return!(a&&a instanceof c)||this._options&&!a._options||!this._options&&a._options||!this._options&&!a._options?!1:this._options.ip==
a._options.ip&&this._options.port==a._options.port&&this._options.username==a._options.username&&this._options.password==a._options.password&&this._options.type==a._options.type&&this._options.model==a._options.model};return c}();
xnm.aio.cams.DoorBird=function(){DoorBird=function(c,a){xnm.aio.cams.Cam.call(this,c,a);this._logger=require("x.logger.js").getLogger("xnm.aio.cams.DoorBird.["+c.username+"@"+c.ip+"]")};DoorBird.prototype=new xnm.aio.cams.Cam;DoorBird.prototype.constructor=xnm.aio.cams.DoorBird;DoorBird.prototype.getRefId=function(){return this._options.username+":"+this._options.password+"@"+this._options.ip+":"+this._options.port};DoorBird.prototype.executeCommandCreator=function(c,a,b){this.executeCommand(a,b)};
DoorBird.prototype.getStatesCreator=function(c,a,b){this.getStates(function(d,e){var h=[];if(!d&&e)for(d=0;d<a.length;d++)if(a[d]&&a[d].id&&a[d].status&&a[d].status.value){var l=a[d].status.value;null!=e[l]&&"undefined"!=typeof e[l]&&(l=e[l],h.push({id:a[d].id,status:l}))}b&&b(null,h)})};DoorBird.prototype.executeCommand=function(c,a){c&&c.value?"open_app"==c.value||"open_live"==c.value?(window&&window.XC&&window.XC.callHost&&window.XCHost&&window.XCHost.getType&&("iOS"==window.XCHost.getType()||
"Android"==window.XCHost.getType())&&("open_app"==c.value?window.XC.callHost("SYSTEM","startApp",{scheme:"doorbird://"}):(c=this._options.username.substr(0,6),window.XC.callHost("SYSTEM","startApp",{scheme:"doorbird://live/"+c}))),a&&a()):"open_door"==c.value||"open_relay"==c.value||"open_relay_custom"==c.value?this.openDoor(c.ext,a):"light_on"==c.value?this.lightOn(a):a&&a(Error("command unknown")):a&&a(Error("command invalid"))};DoorBird.prototype.getStates=function(c){this._logger.log("debug",
"get states");var a=require("xnm.aio.cams.js").getDoorBirdHandler(),b=a.getMonitor(this._options);b||(this._logger.log("trace","add monitor"),a._udpMonitor.isRunning()||a.startUdpMonitor(),b=a.addMonitor(this._options));var d={ring:!1,motion:!1,ringT:null,ringTStr:null,motionT:null,motionTStr:null},e=b._stateBuffer;if(e){this._logger.log("debug","buffered states in monitor:"+JSON.stringify(e));a=(new Date).getTime();for(var h in e)(b=e[h])&&b.length&&("motion"==h?1==b[0]&&1E4>=a-b[1]&&(d.motion=!0):
"ring"==h?1==b[0]&&1E4>=a-b[1]&&(d.ring=!0):"ringT"==h?(d.ringT=b[0],d.ringTStr=(new Date(b[0])).toLocaleString()):"motionT"==h&&(d.motionT=b[0],d.motionTStr=(new Date(b[0])).toLocaleString()))}if(d.ringT)this._logger.log("debug","return states:"+JSON.stringify(d)),c&&c(null,d);else{var l=this;this.getHistory("doorbell",1,function(f,g,k){null!=g&&(d.ringT=1E3*g,d.ringTStr=(new Date(1E3*g)).toLocaleString(),e.ringT=[d.ringT]);l._logger.log("debug","return states:"+JSON.stringify(d));c&&c(null,d)})}};
DoorBird.prototype.getInfo=function(c){this._doRequest("/bha-api/info.cgi",function(a,b){if(a)c&&c(a);else try{var d=JSON.parse(b);d&&d.BHA&&d.BHA.VERSION&&d.BHA.VERSION.length&&1==d.BHA.RETURNCODE?c&&c(null,d.BHA.VERSION[0]):c&&c(Error("info response invaild"))}catch(e){c&&c(e)}})};DoorBird.prototype.openDoor=function(c,a){this._logger.log("debug","open door (relay="+c+")");var b="/bha-api/open-door.cgi";c&&(b+="?r="+encodeURIComponent(c));var d=this;this._doRequest(b,function(e,h){d._logger.log("debug",
"open door (relay="+c+")"+(e?" failed:"+e.message:" success"));a&&a(e)})};DoorBird.prototype.lightOn=function(c){this._logger.log("debug","light on");var a=this;this._doRequest("/bha-api/light-on.cgi",function(b,d){a._logger.log("debug","light on"+(b?" failed:"+b.message:" success"));c&&c(b)})};DoorBird.prototype.loadHistoryImage=function(c,a,b){this._logger.log("trace","load image "+a+"@"+c);var d=this._options.ip,e=this._options.port;e||(e=80);d="http://"+d+":"+e+"/bha-api/history.cgi?index="+a+
"&event="+c;this._logger.log("trace","load image: "+d);e={user:this._options.username,password:this._options.password};var h=this;require("xnm.aio.cams.js").createJPEGCam(d,e).loadImage(function(l,f){h._logger.log("trace","load image "+a+"@"+c+" finish: file="+l);b&&b(l,f)})};DoorBird.prototype.getHistory=function(c,a,b){var d=this;this._logger.log("trace","get history "+a+"@"+c);this._doRequest("/bha-api/history.cgi?index="+a+"&event="+c,function(e,h,l){e?(d._logger.log("trace","get history "+a+
"@"+c+" failed:"+e.message),b&&b(e)):(d._logger.log("trace","get history "+a+"@"+c+" headers:"+(l?JSON.stringify(l):"none")),h=e=null,l&&(void 0!=l["x-count"]&&null!=l["x-count"]&&(e=parseInt(l["x-count"])),void 0!=l["x-timestamp"]&&null!=l["x-timestamp"]&&(h=parseInt(l["x-timestamp"]))),b&&b(null,h,e))})};DoorBird.prototype._doRequest=function(c,a){var b=this._options.ip,d=this._options.port;d||(d=80);this._logger.log("trace","send to url:http://"+(b+":"+d+c));c={host:b,port:d,path:c,method:"GET",
headers:{Connection:"close"}};this._options.username&&(this._options.password||(this._options.password=""),c.headers.Authorization="Basic "+(new Buffer(this._options.username+":"+this._options.password)).toString("base64"));var e=require("http").request(c,function(h){h.setEncoding("utf-8");var l="";h.on("data",function(f){l+=f});h.on("end",function(){var f;200!=h.statusCode&&(f=Error("http response:"+h.statusCode));a&&a(f,l,h.headers)})});e.setTimeout&&e.setTimeout(2E3,function(){e.abort()});if(e.on)e.on("error",
function(h){a&&a(h)});e.end()};DoorBird.Handler=function(){var c=function(){this._logger=require("x.logger.js").getLogger("xnm.aio.cams.DoorBird.Handler.NativeDecrypter")};c.prototype.decrypt=function(f,g,k){this._logger.log("trace","decrypt data:"+f);g=g.substr(0,5);var m=this;XC.callHost("doorbird","decryptUdpMessage",{data:f,password:g},function(n){m._logger.log("trace","decrypt result:"+JSON.stringify(n));n?n.error?k&&k(Error(n.error)):k&&k(null,n):k&&k(Error("no reponse from xc doorbird module"))})};
var a=function(){this._logger=require("x.logger.js").getLogger("xnm.aio.cams.DoorBird.Handler.NodeJSDecrypter")};a.prototype.decrypt=function(f,g,k){this._logger.log("trace","decrypt data:"+f.substr(0,10)+"...");var m=parseInt(f.substr(8,8),16),n=parseInt(f.substr(16,8),16),p=new Buffer(f.substr(24,32),"hex"),q=new Buffer(f.substr(56,16),"hex");f=new Buffer(f.substr(72),"hex");g=new Buffer(g.substr(0,5),"utf8");var u=new Buffer(32);var r=require("sodium").api;r.crypto_pwhash_argon2i(u,g,p,m,n,1)?
(n=r.crypto_aead_chacha20poly1305_decrypt(f,null,q,u))?(g=n.slice(0,6).toString("utf8"),m=n.slice(6,14).toString("utf8").trim(),n=n.slice(14,18).readInt32BE(),g={intercom_id:g,event:m,timestamp:n},this._logger.log("trace","decrypt result:"+JSON.stringify(g)),k&&k(null,g)):k&&k(Error("decrypt failed")):k&&k(Error("password hash failed"))};var b=function(){this._logger=require("x.logger.js").getLogger("xnm.aio.cams.DoorBird.Handler.NWJSDecrypter")};b.prototype.decrypt=function(f,g,k){this._logger.log("trace",
"decrypt data:"+f);var m=this,n=parseInt(f.substr(8,8),16),p=parseInt(f.substr(16,8),16),q=new Buffer(f.substr(24,32),"hex"),u=new Buffer(f.substr(56,16),"hex"),r=new Buffer(f.substr(72),"hex");g=new Buffer(g.substr(0,5),"utf8");var t=null,x=new Buffer(32);t=require("libsodium-wrappers");t.ready.catch(function(v){k&&k(v)});t.ready.then(function(){var v=null;try{var w=t.crypto_pwhash(x.length,t.from_string(g.toString("utf8")),q,n,p,t.crypto_pwhash_ALG_ARGON2I13);v=t.crypto_aead_chacha20poly1305_decrypt(null,
r,null,u,w)}catch(y){k&&k(y);return}w=Buffer.from(v.slice(0,6)).toString("utf8");var z=Buffer.from(v.slice(6,14)).toString("utf8").trim();v=Buffer.from(v.slice(14,18)).readInt32BE();v={intercom_id:w,event:z,timestamp:v};m._logger.log("trace","(libsodium-wrappers) decrypt result:"+JSON.stringify(v));k&&k(null,v)})};var d=function(f,g){var k=this._gentId(f);this._logger=require("x.logger.js").getLogger("xnm.aio.cams.DoorBird.HttpMonitor.["+k+"]");this._listener=g;this._doorbird=f;this._running=!1;this._reconnectTO=
this._req=null;this.reconnTimeout=5;this.dataTimeout=30;this._dataTO=null};d.prototype._gentId=function(f){return f.username+"@"+f.ip};d.prototype.start=function(){this._logger.log("debug","start monitor");this._running||(this._running=!0,this._startHttpMonitor())};d.prototype.stop=function(f){this._logger.log("debug","stop monitor");this._running&&(this._running=!1,this._stopHttpMonitor());f&&f(null,!0)};d.prototype.updateIP=function(f){this._stopHttpMonitor();this._doorbird.ip=f;f=this._gentId(this._doorbird);
this._logger=require("x.logger.js").getLogger("xnm.aio.cams.DoorBird.HttpMonitor.["+f+"]");this._startHttpMonitor()};d.prototype._startHttpMonitor=function(){this._logger.log("debug","start http monitor");var f=this._doorbird.ip,g=this._doorbird.port,k=f.indexOf(":");-1==k||g||(g=f.substr(k+1));g||(g=80);var m=this;this._logger.log("trace","send to url:http://"+(f+":"+g+"/bha-api/monitor.cgi?ring=doorbell,motionsensor"));g={host:f,port:g,path:"/bha-api/monitor.cgi?ring=doorbell,motionsensor",method:"GET",
headers:{}};k=this._doorbird.username;var n=this._doorbird.password;k&&(g.auth=k+":"+(n?n:""));var p=!1,q=!1,u=require("http").request(g,function(r){r.setEncoding("utf-8");r.on("data",function(t){p=!0;m._dataTO&&(clearTimeout(m._dataTO),m._dataTO=null);m._dataTO=setTimeout(function(){m._logger.log("warn","monitor data timeout:"+f);u.abort();q||(q=!0,m._onClose(Error("data timeout")))},1E3*m.dataTimeout);m._onData(t)});r.on("end",function(){var t;509==r.statusCode?t=Error("door bird busy"):200!=r.statusCode&&
(t=Error("door bird monitor reutrn http:"+r.statusCode));q||(q=!0,m._onClose(t))})});u.setTimeout(2E3,function(){p||(u.abort(),q||(q=!0,m._onClose(Error("connection timeout"))))});u.on("error",function(r){q||(q=!0,m._onClose(r))});u.end();this._req=u};d.prototype._stopHttpMonitor=function(){this._logger.log("debug","stop http monitor");this._dataTO&&(clearTimeout(this._dataTO),this._dataTO=null);this._req&&this._req.abort()};d.prototype._reconnect=function(){this._logger.log("trace","reconnect monitor in "+
this.reconnTimeout+" s");this._reconnectTO&&(clearTimeout(this._reconnectTO),this._reconnectTO=null);var f=this;this._reconnectTO=setTimeout(function(){f._startHttpMonitor()},1E3*this.reconnTimeout)};d.prototype._onData=function(f){if(this._listener&&this._listener.onHttpData)this._listener.onHttpData(f)};d.prototype._onClose=function(f){this._logger.log("debug","http monitor closed:"+(f?" err: "+f.message:""));this._dataTO&&(clearTimeout(this._dataTO),this._dataTO=null);this._running&&this._reconnect()};
var e=function(f){this._logger=require("x.logger.js").getLogger("xnm.aio.cams.DoorBird.Handler.UdpMonitor");this._sockets=[];this._port=35344;this._running=!1;this._listener=f};e.prototype.start=function(){this._running||(this._running=!0,this._addDiscoverSocket(this._port,null))};e.prototype.isRunning=function(){return this._running};e.prototype._addDiscoverSocket=function(f,g){var k=require("dgram"),m=this;this._logger.log("trace","bind udp monitor on port "+f+(g?" ip "+g.address:""));if(!g){try{var n=
k.createSocket({reuseAddr:!0,type:"udp4"})}catch(p){n=k.createSocket("udp4")}n.on("message",function(p,q){m._receivedData(q.address,p)});n.on("error",function(p){m._logger.log("trace","bind udp monitor error "+p.message)});n.bind(f);this._sockets.push(n)}else if("IPv4"==g.family&&0==g.internal){try{n=k.createSocket({reuseAddr:!0,type:"udp4"})}catch(p){n=k.createSocket("udp4")}n.on("listening",function(){n.setBroadcast(!0)});n.on("message",function(p,q){m._receivedData(q.address,p)});n.on("error",
function(p){m._logger.log("trace","bind udp monitor error "+p.message)});n.bind(f,g.address);this._sockets.push(n)}};e.prototype._receivedData=function(f,g){g=g.toString("hex");this._logger.log("trace","receive data from "+f+" data "+g);if(this._listener&&this._listener.onUdpData)this._listener.onUdpData(f,g)};var h=function(f){var g=f.username+"@"+f.ip;this._logger=require("x.logger.js").getLogger("xnm.aio.cams.DoorBird.Monitor.["+g+"]");this._useHttpMonitor=this._supportHttpMonitor();this._doorbirdJSON=
f;this._httpMonitor=new d(f,this);this._listeners=[];this._stateBuffer={}};h.prototype._supportHttpMonitor=function(){var f=null;window&&!window.XCHost&&(f="node-webkit");window&&window.XCHost&&window.XCHost.getType&&(f=window.XCHost.getType());return"undefined"!==typeof nw?!0:"node-webkit"==f||"undefined"!=typeof process&&null!=process&&"node"==process.title?!0:!1};h.prototype.getRefId=function(){return doorBird.username+":"+doorBird.password+"@"+doorBird.ip+":"+doorBird.port};h.prototype.addListener=
function(f){f&&-1==this._listeners.indexOf(f)&&this._listeners.push(f)};h.prototype.removeListener=function(f){f=this._listeners.indexOf(f);-1!=f&&this._listeners.splice(f,1)};h.prototype.start=function(){this._logger.log("debug","start monitor");this._running||(this._running=!0,this._useHttpMonitor&&this._httpMonitor.start())};h.prototype.stop=function(){this._logger.log("debug","stop monitor");this._running&&(this._running=!1,this._listeners=[],this._useHttpMonitor&&this._httpMonitor.stop())};h.prototype.updateDoorbird=
function(f){if(this._doorbirdJSON&&this._doorbirdJSON.mac&&this._doorbirdJSON.mac==f.mac&&this._doorbirdJSON.ip!=f.ip){this._logger.log("debug","doorbird has new ip:"+f.ip);var g=this._doorbirdJSON.username+"@"+f.ip;this._logger=require("x.logger.js").getLogger("xnm.aio.cams.DoorBird.Monitor.["+g+"]");this._useHttpMonitor&&this._httpMonitor.updateIP(f.ip)}};h.prototype.onHttpData=function(f){this._logger.log("trace","receive notify:"+f.replace(/(\r\n|\n|\r)/gm,"\\n "));var g=f.indexOf("doorbell:"),
k=null,m=null;-1!=g&&(k=f.substr(g+9,1),k="H"==k?!0:!1);g=f.indexOf("motionsensor:");-1!=g&&(m=f.substr(g+13,1),m="H"==m?!0:!1);this._logger.log("debug","receive http event: ring="+k+" motion="+m);null!=m&&this._onEvent("motion",m);null!=k&&this._onEvent("ring",k)};h.prototype.onUdpData=function(f,g){this._logger.log("trace","decrypt udp data");var k=this._doorbirdJSON;if(k&&k.password){var m=this._getDecrypter();if(m){var n=this;m.decrypt(f,k.password,function(p,q){n._logger.log("trace","decrypt data "+
(p?"failed: "+p.message:"success"));!p&&q&&(k.username&&k.username.indexOf(q.intercom_id),n._logger.log("debug","receive udp event: "+JSON.stringify(q)),"motionsensor"==q.event||"motion"==q.event?n._onEvent("motion",!0):isNaN(parseInt(q.event))||n._onEvent("ring",!0));g&&g(p,q)})}else this._logger.log("trace","decrypt data failed: can not find decrypter"),g&&g(Error("can not find decrypter"))}else this._logger.log("trace","decrypt data failed: no password"),g&&g(Error("no password"))};h.prototype._onEvent=
function(f,g){var k=(new Date).getTime();this._stateBuffer[f]=[g,k];"ring"==f&&1==g?this._stateBuffer.ringT=[k]:"motion"==f&&1==g&&(this._stateBuffer.motionT=[k]);for(k=0;k<this._listeners.length;k++){var m=this._listeners[k];if(m.onEvent)try{m.onEvent(f,g)}catch(n){}}};h.prototype._getDecrypter=function(){var f=null;window&&!window.XCHost&&(f="node-webkit");window&&window.XCHost&&window.XCHost.getType&&(f=window.XCHost.getType());return"undefined"!==typeof nw?new b:"node-webkit"==f||"undefined"!=
typeof process&&null!=process&&"node"==process.title?new a:new c};var l=function(){this._logger=require("x.logger.js").getLogger("xnm.aio.cams.DoorBird.Handler");this._udpMonitor=new e(this);this._monitors={}};l.prototype.finalize=function(){for(var f in this._monitors){var g=this._monitors[f];g&&g.stop()}this._monitors={}};l.prototype.startUdpMonitor=function(){this._udpMonitor.start()};l.prototype.addMonitor=function(f){if(f){var g=f.username+":"+f.password+"@"+f.ip,k=this._monitors[g];if(k)throw Error("monitor already exit");
k=new h(JSON.parse(JSON.stringify(f)));this._monitors[g]=k;k.start();return k}};l.prototype.removeMonitor=function(f){if(f){f=f.username+":"+f.password+"@"+f.ip;var g=this._monitors[f];g&&(g.stop(),delete this._monitors[f])}};l.prototype.getMonitor=function(f){return f?this._monitors[f.username+":"+f.password+"@"+f.ip]:null};l.prototype.onUdpData=function(f,g){if(g&&"DEADBE"==g.substr(0,6).toUpperCase()&&"01"==g.substr(6,2)){var k=Object.keys(this._monitors);if(k.length){var m=0,n=this,p=function(){m++;
if(m<k.length)n._monitors[k[m]].onUdpData(g,p)};this._monitors[k[m]].onUdpData(g,p)}}};return l}();return DoorBird}();xnm.aio.cams.Foscam=function(c,a){xnm.aio.cams.Cam.call(this,c,a);this._logger=require("x.logger.js").getLogger("xnm.aio.cams.Foscam")};xnm.aio.cams.Foscam.prototype=new xnm.aio.cams.Cam;xnm.aio.cams.Foscam.prototype.constructor=xnm.aio.cams.Foscam;
xnm.aio.cams.Foscam.prototype.executeCommandCreator=function(c,a,b){a?"gotoPreset"==a.value?this._gotoPreset(c,a,b):this.executeCommand(a.value,b):b&&b(Error("command invalid"))};
xnm.aio.cams.Foscam.prototype._gotoPreset=function(c,a,b){if("undefined"==typeof a.ext||null==a.ext)b&&b(Error("command ext invalid"));else if(this._camInfo&&this._camInfo.controlurl){var d;c=this._decodeXml(this._camInfo.controlurl);"/cgi-bin/CGIProxy.fcgi?cmd=%@"==c?d="ptzGotoPresetPoint&name="+encodeURIComponent(a.ext):"/web/cgi-bin/hi3510/%@"==c&&(d="preset.cgi?-act=goto&-number="+encodeURIComponent(a.ext));d?(a=this.getRootUrl()+c.replace("%@",d),a=this._addAuth(a),this._doRequest(a,{user:this._options.username,
password:this._options.password},null,function(e,h){b&&b(e,h)})):b&&b(Error("unknow preset command"))}else b&&b(Error("no control url"))};xnm.aio.cams.Welcome=function(c,a){xnm.aio.cams.Cam.call(this,c,a);this._logger=require("x.logger.js").getLogger("xnm.aio.cams.Welcome")};xnm.aio.cams.Welcome.prototype=new xnm.aio.cams.Cam;xnm.aio.cams.Welcome.prototype.constructor=xnm.aio.cams.Welcome;
xnm.aio.cams.Welcome.prototype.getVideoInfo=function(c){var a=require("xnm.aio.netatmo.js");a?(a=a.resolveGateway({refreshToken:this._options.refreshToken}))?a.getCamUrl(this._options.address,function(b,d){b?c&&c(b):(b={hls:d},c&&c(null,b))}):c&&c(Error("netatmo cam info invalid")):c&&c(Error("netatmo module not loaded"))};xnm.aio.cams.Mobotix=function(c,a){xnm.aio.cams.Cam.call(this,c,a);this._logger=require("x.logger.js").getLogger("xnm.aio.cams.Mobotix")};xnm.aio.cams.Mobotix.prototype=new xnm.aio.cams.Cam;
xnm.aio.cams.Mobotix.prototype.constructor=xnm.aio.cams.Mobotix;
xnm.aio.cams.Mobotix.prototype.executeCommandCreator=function(c,a,b){if(a)if("gotoPreset"==a.value||"displayMode"==a.value||"customCMD"==a.value)if("undefined"==typeof a.ext||null==a.ext)b&&b(Error("command ext invalid"));else{if("gotoPreset"==a.value){if(!this._camInfo||!this._camInfo.controlurl){b&&b(Error("no control url"));return}a="loadview="+encodeURIComponent(a.ext);c=this._decodeXml(this._camInfo.controlurl);var d=c.replace("%@",a)}else if("displayMode"==a.value)switch(c="/control/control?set&section=general&display_mode=",
a.ext){case "Full Image":d=c+"simple";break;case "Normal":d=c+"lenscorr_l11";break;case "Surround":d=c+"surround";break;case "Panorama":d=c+"panorama";break;case "Panorama/Focus":d=c+"pano_focus";break;case "Double Panorama":d=c+"pano_dbl"}else d=a.ext;d&&this._sendRequest(d,function(e,h){b&&b(e,h)})}else this.executeCommand(a.value,b);else b&&b(Error("command invalid"))};
xnm.aio.cams.Mobotix.prototype._gotoPreset=function(c,a,b){"undefined"==typeof a.ext||null==a.ext?b&&b(Error("command ext invalid")):this._camInfo&&this._camInfo.controlurl?(c="loadview="+encodeURIComponent(a.ext),c=this._decodeXml(this._camInfo.controlurl).replace("%@",c),this._sendRequest(c,function(d,e){b&&b(d,e)})):b&&b(Error("no control url"))};
xnm.aio.cams.Mobotix.prototype._sendRequest=function(c,a){c=this.getRootUrl()+c;c=this._addAuth(c);this._doRequest(c,{user:this._options.username,password:this._options.password},null,function(b,d){a&&a(b,d)})};xnm.aio.cams.Axis=function(c,a){xnm.aio.cams.Cam.call(this,c,a);this._logger=require("x.logger.js").getLogger("xnm.aio.cams.Mobotix")};xnm.aio.cams.Axis.prototype=new xnm.aio.cams.Cam;xnm.aio.cams.Axis.prototype.constructor=xnm.aio.cams.Axis;
xnm.aio.cams.Axis.prototype.executeCommandCreator=function(c,a,b){a?"playClip"==a.value?this._playClip(c,a,b):"lightOn"==a.value||"lightOff"==a.value?this._setLight(c,a,b):"actOut"==a.value||"deactOut"==a.value?this._setOutput(c,a,b):this.executeCommand(a.value,b):b&&b(Error("command invalid"))};
xnm.aio.cams.Axis.prototype._playClip=function(c,a,b){"undefined"==typeof a.ext||null==a.ext?b&&b(Error("command ext invalid")):(c="/axis-cgi/playclip.cgi?clip="+a.ext,c=this.getRootUrl()+c,c=this._addAuth(c),this._doRequest(c,{user:this._options.username,password:this._options.password},null,function(d,e){b&&b(d,e)}))};
xnm.aio.cams.Axis.prototype._setOutput=function(c,a,b){if("undefined"==typeof a.ext||null==a.ext)b&&b(Error("command ext invalid"));else{c=a.ext;var d="\\";"actOut"==a.value&&(d="/");a="/axis-cgi/io/port.cgi?action="+encodeURIComponent(c+":"+d);a=this.getRootUrl()+a;a=this._addAuth(a);this._doRequest(a,{user:this._options.username,password:this._options.password},null,function(e,h){b&&b(e,h)})}};
xnm.aio.cams.Axis.prototype._setLight=function(c,a,b){a.value?(c="0","lightOn"==a.value&&(c="100"),a="/axis-cgi/io/lightcontrol.cgi?action=L1:-"+c,a=this.getRootUrl()+a,a=this._addAuth(a),this._doRequest(a,{user:this._options.username,password:this._options.password},null,function(d,e){b&&b(d,e)})):b&&b(Error("command ext invalid"))};
xnm.aio.cams.CAM_INFO={telefunken:{name:"Telefunken",versions:[{id:"XS100",name:"XS100",imageurl:"/snapshot.cgi",mjpegurl:"/videostream.cgi",controlurl:"/decoder_control.cgi?command=%@&amp;onestep=1",auth:"user=@user&amp;pwd=@pwd",pantilt:"true",link:"telefunken.XS100",keys:[{id:"left",code:"4&amp;degree=18"},{id:"right",code:"6&amp;degree=18"},{id:"up",code:"0&amp;degree=15"},{id:"down",code:"2&amp;degree=15"},{id:"switchOn",code:"94"},{id:"switchOff",code:"95"}]}]},konine:{name:"Konine",versions:[{id:"konine",
name:"Konine IP Cam",imageurl:"/snapshot.cgi",mjpegurl:"/videostream.cgi",controlurl:"/decoder_control.cgi?command=%@",auth:"user=@user&amp;pwd=@pwd",pantilt:"true",link:"konine.konine",keys:[{id:"left",code:"4&amp;onestep=1"},{id:"right",code:"6&amp;onestep=1"},{id:"up",code:"0&amp;onestep=1"},{id:"down",code:"2&amp;onestep=1"},{id:"switchOn",code:"94&amp;onestep=1"},{id:"switchOff",code:"95&amp;onestep=1"},{id:"call1",code:"31&amp;onestep=0"},{id:"call2",code:"33&amp;onestep=0"},{id:"call3",code:"35&amp;onestep=0"},
{id:"call4",code:"37&amp;onestep=0"},{id:"call5",code:"39&amp;onestep=0"},{id:"call6",code:"41&amp;onestep=0"},{id:"call7",code:"43&amp;onestep=0"},{id:"call8",code:"45&amp;onestep=0"},{id:"call9",code:"47&amp;onestep=0"},{id:"call10",code:"49&amp;onestep=0"},{id:"call11",code:"51&amp;onestep=0"},{id:"call12",code:"53&amp;onestep=0"},{id:"call13",code:"55&amp;onestep=0"},{id:"call14",code:"57&amp;onestep=0"},{id:"call15",code:"59&amp;onestep=0"},{id:"call16",code:"61&amp;onestep=0"}]}]},abus:{name:"ABUS",
versions:[{id:"tv7204",name:"TV7204",pantilt:"false",link:"dlink.2000"}]},"7links":{name:"7Links",versions:[{id:"PX3615675",name:"PX-3615-675",link:"telefunken.XS100",pantilt:"true"},{id:"robocam1",name:"Robocam 1",imageurl:"/IMAGE.JPG",controlurl:"/PANTILTCONTROL.CGI",controlpostdata:"PanSingleMoveDegree=1&amp;TiltSingleMoveDegree=1&amp;PanTiltSingleMove=%@",pantilt:"true",link:"7links.robocam1",keys:[{id:"left",code:"3"},{id:"right",code:"2"},{id:"up",code:"1"},{id:"down",code:"7"},{id:"home",code:"4"}]},
{id:"robocam2",name:"Robocam 2",imageurl:"/cgi/jpg/image.cgi",controlurl:"/users/ptctl.cgi?move=%@",pantilt:"true",link:"7links.robocam2",keys:[{id:"left",code:"left"},{id:"right",code:"right"},{id:"up",code:"up"},{id:"down",code:"down"},{id:"home",code:"h"}]},{id:"730hd",name:"IPC-730HD",imageurl:"/cgi-bin/CGIProxy.fcgi?cmd=snapPicture2",auth:"usr=@user&amp;pwd=@pwd",pantilt:"false",link:"7links.730hd"},{id:"730hd2",name:"IPC-730HD 2",imagepageurl:"/cgi-bin/CGIProxy.fcgi?cmd=snapPicture2",auth:"usr=@user&amp;pwd=@pwd",
pantilt:"false",link:"7links.730hd2"},{id:"770hd",name:"IPC-770HD",imageurl:"/cgi-bin/video_snapshot.cgi",mjpegurl:"/cgi-bin/videostream.cgi",controlurl:"/cgi-bin/decoder_control.cgi?type=0&amp;cmd=%@&amp;onestep=1",auth:"user=@user&amp;pwd=@pwd",link:"7links.770hd",pantilt:"true",keys:[{id:"left",code:"2"},{id:"right",code:"3"},{id:"up",code:"0"},{id:"down",code:"1"}]},{id:"vga",name:"Generic Type",link:"telefunken.XS100",pantilt:"true"},{id:"hd",name:"Generic Type HD",link:"7links.770hd",pantilt:"true"}]},
dlink:{name:"D-Link",versions:[{id:"dcs930",name:"DCS-930L",imageurl:"/image.jpg",mjpegurl:"/video.cgi",useurlauth:"true",link:"dlink.dcs930"},{id:"dcs942",name:"DCS-942L",imageurl:"/image/jpeg.cgi",mjpegurl:"/video/mjpg.cgi",useurlauth:"true",link:"dlink.dcs942"},{id:"2000",name:"DCS-2000",imageurl:"/cgi-bin/video.jpg?size=2",controlurl:"/cgi-bin/camctrl.cgi?%@",pantilt:"true",link:"dlink.2000",keys:[{id:"home",code:"move=home"},{id:"left",code:"move=left"},{id:"right",code:"move=right"},{id:"up",
code:"move=up"},{id:"down",code:"move=down"},{id:"tele",code:"zoom=tele"},{id:"wide",code:"zoom=wide"}]},{id:"dcs2132",name:"DCS-2132L",imageurl:"/dms?nowprofileid=2",useurlauth:"true",link:"dlink.dcs2132"},{id:"dcs935",name:"DCS-935L",link:"dlink.dcs942",pantilt:"false"},{id:"dcs5222",name:"DCS-5222L",imageurl:"/image/jpeg.cgi",mjpegurl:"/video/mjpg.cgi",controlurl:"/cgi/ptdc.cgi?%@",pantilt:"true",link:"dlink.dcs5222",keys:[{id:"home",code:"command=go_home"},{id:"left",code:"command=set_relative_pos&posX=-10&posY=0"},
{id:"right",code:"command=set_relative_pos&posX=10&posY=0"},{id:"up",code:"command=set_relative_pos&posX=0&posY=10"},{id:"down",code:"command=set_relative_pos&posX=0&posY=-10 "}]}]},hama:{name:"Hama",versions:[{id:"hwlancam",name:"WLAN IP",link:"telefunken.XS100",pantilt:"false"}]},nueva:{name:"Nueva",versions:[{id:"nueva",name:"NVI Camera",link:"telefunken.XS100",pantilt:"true"},{id:"hd",name:"NVI HD Camera",imageurl:"/snapshot.cgi",mjpegurl:"/videostream.cgi",controlurl:"/decoder_control.cgi?command=%@&amp;onestep=1",
auth:"loginuse=@user&amp;loginpas=@pwd",pantilt:"true",link:"nueva.hd",keys:[{id:"left",code:"4&amp;degree=18"},{id:"right",code:"6&amp;degree=18"},{id:"up",code:"0&amp;degree=15"},{id:"down",code:"2&amp;degree=15"}]},{id:"hd_new",name:"NVI New HD Camera",link:"nueva.hd_new",imageurl:"/tmpfs/snap.jpg",controlurl:"/cgi-bin/hi3510/%@",auth:"user=@user&amp;pwd=@pwd",pantilt:"true",keys:[{id:"move_left",code:"ptzctrl.cgi?-step=0&amp;-act=left"},{id:"move_right",code:"ptzctrl.cgi?-step=0&amp;-act=right"},
{id:"move_up",code:"ptzctrl.cgi?-step=0&amp;-act=up"},{id:"move_down",code:"ptzctrl.cgi?-step=0&amp;-act=down"},{id:"stop",code:"ptzctrl.cgi?-step=0&amp;-act=stop"},{id:"step_left",code:"ptzctrl.cgi?-step=1&amp;-act=left"},{id:"step_right",code:"ptzctrl.cgi?-step=1&amp;-act=right"},{id:"step_up",code:"ptzctrl.cgi?-step=1&amp;-act=up"},{id:"step_down",code:"ptzctrl.cgi?-step=1&amp;-act=down"},{id:"home",code:"ptzctrl.cgi?-step=0&amp;-act=home"},{id:"horizontal_scan",code:"ptzctrl.cgi?-step=0&amp;-act=hscan"},
{id:"vertical_scan",code:"ptzctrl.cgi?-step=0&amp;-act=vscan"},{id:"position_0",code:"preset.cgi?-act=goto&amp;-status=1&amp;-number=0"},{id:"position_1",code:"preset.cgi?-act=goto&amp;-status=1&amp;-number=1"},{id:"position_2",code:"preset.cgi?-act=goto&amp;-status=1&amp;-number=2"},{id:"position_3",code:"preset.cgi?-act=goto&amp;-status=1&amp;-number=3"},{id:"position_4",code:"preset.cgi?-act=goto&amp;-status=1&amp;-number=4"},{id:"position_5",code:"preset.cgi?-act=goto&amp;-status=1&amp;-number=5"},
{id:"position_6",code:"preset.cgi?-act=goto&amp;-status=1&amp;-number=6"},{id:"position_7",code:"preset.cgi?-act=goto&amp;-status=1&amp;-number=7"}]}]},instar:{name:"INSTAR",versions:[{id:"vga",name:"Generic VGA Cam",imageurl:"/snapshot.cgi",mjpegurl:"/videostream.cgi",controlurl:"/decoder_control.cgi?command=%@",auth:"-usr=@user&amp;-pwd=@pwd",pantilt:"true",link:"instar.vga",keys:[{id:"left",code:"4&amp;onestep=1"},{id:"right",code:"6&amp;onestep=1"},{id:"up",code:"0&amp;onestep=1"},{id:"down",
code:"2&amp;onestep=1"},{id:"home",code:"25"}]},{id:"hd",name:"Generic HD Cam",link:"instar.hd",imageurl:"/tmpfs/snap.jpg",mjpegurl:"/cgi-bin/hi3510/mjpegstream.cgi?-chn=11",controlurl:"/cgi-bin/hi3510/%@",auth:"-usr=@user&amp;-pwd=@pwd",pantilt:"true",keys:[{id:"move_left",code:"ptzctrl.cgi?-step=0&amp;-act=left"},{id:"move_right",code:"ptzctrl.cgi?-step=0&amp;-act=right"},{id:"move_up",code:"ptzctrl.cgi?-step=0&amp;-act=up"},{id:"move_down",code:"ptzctrl.cgi?-step=0&amp;-act=down"},{id:"stop",code:"ptzctrl.cgi?-step=0&amp;-act=stop"},
{id:"step_left",code:"ptzctrl.cgi?-step=1&amp;-act=left"},{id:"step_right",code:"ptzctrl.cgi?-step=1&amp;-act=right"},{id:"step_up",code:"ptzctrl.cgi?-step=1&amp;-act=up"},{id:"step_down",code:"ptzctrl.cgi?-step=1&amp;-act=down"},{id:"home",code:"ptzctrl.cgi?-step=0&amp;-act=home"},{id:"horizontal_scan",code:"ptzctrl.cgi?-step=0&amp;-act=hscan"},{id:"vertical_scan",code:"ptzctrl.cgi?-step=0&amp;-act=vscan"},{id:"position_0",code:"preset.cgi?-act=goto&amp;-status=1&amp;-number=0"},{id:"position_1",
code:"preset.cgi?-act=goto&amp;-status=1&amp;-number=1"},{id:"position_2",code:"preset.cgi?-act=goto&amp;-status=1&amp;-number=2"},{id:"position_3",code:"preset.cgi?-act=goto&amp;-status=1&amp;-number=3"},{id:"position_4",code:"preset.cgi?-act=goto&amp;-status=1&amp;-number=4"},{id:"position_5",code:"preset.cgi?-act=goto&amp;-status=1&amp;-number=5"},{id:"position_6",code:"preset.cgi?-act=goto&amp;-status=1&amp;-number=6"},{id:"position_7",code:"preset.cgi?-act=goto&amp;-status=1&amp;-number=7"}]},
{id:"IN-3010",name:"IN-3010",link:"telefunken.XS100",pantilt:"true"},{id:"IN-6012",name:"IN-6012 HD",imageurl:"/tmpfs/snap.jpg",controlurl:"/cgi-bin/hi3510/%@",auth:"usr=@user&amp;pwd=@pwd",pantilt:"true",link:"instar.IN-6012",keys:[{id:"move_left",code:"ptzctrl.cgi?-step=0&amp;-act=left"},{id:"move_right",code:"ptzctrl.cgi?-step=0&amp;-act=right"},{id:"move_up",code:"ptzctrl.cgi?-step=0&amp;-act=up"},{id:"move_down",code:"ptzctrl.cgi?-step=0&amp;-act=down"},{id:"stop",code:"ptzctrl.cgi?-step=0&amp;-act=stop"},
{id:"step_left",code:"ptzctrl.cgi?-step=1&amp;-act=left"},{id:"step_right",code:"ptzctrl.cgi?-step=1&amp;-act=right"},{id:"step_up",code:"ptzctrl.cgi?-step=1&amp;-act=up"},{id:"step_down",code:"ptzctrl.cgi?-step=1&amp;-act=down"},{id:"home",code:"ptzctrl.cgi?-step=0&amp;-act=home"},{id:"horizontal_scan",code:"ptzctrl.cgi?-step=0&amp;-act=hscan"},{id:"vertical_scan",code:"ptzctrl.cgi?-step=0&amp;-act=vscan"},{id:"position_0",code:"preset.cgi?-act=goto&amp;-status=1&amp;-number=0"},{id:"position_1",
code:"preset.cgi?-act=goto&amp;-status=1&amp;-number=1"},{id:"position_2",code:"preset.cgi?-act=goto&amp;-status=1&amp;-number=2"},{id:"position_3",code:"preset.cgi?-act=goto&amp;-status=1&amp;-number=3"},{id:"position_4",code:"preset.cgi?-act=goto&amp;-status=1&amp;-number=4"},{id:"position_5",code:"preset.cgi?-act=goto&amp;-status=1&amp;-number=5"},{id:"position_6",code:"preset.cgi?-act=goto&amp;-status=1&amp;-number=6"},{id:"position_7",code:"preset.cgi?-act=goto&amp;-status=1&amp;-number=7"}]},
{id:"IN-8015",name:"IN-8015 Full HD",link:"instar.hd",pantilt:"true"},{id:"IN-9008",name:"IN-9008 Full HD",link:"instar.hd",pantilt:"false"}]},foscam:{name:"Foscam",versions:[{id:"fi8904W",name:"FI8904W",link:"telefunken.XS100",pantilt:"false"},{id:"fi8620",name:"FI8620",imageurl:"/tmpfs/snap.jpg",controlurl:"/web/cgi-bin/hi3510/%@",pantilt:"true",link:"foscam.fi8620",keys:[{id:"left",code:"ytleft.cgi"},{id:"right",code:"ytright.cgi"},{id:"up",code:"ytup.cgi"},{id:"down",code:"ytdown.cgi"}],command:[{type:"int",
name:"go to preset",ref:{value:"gotoPreset",ext:"%d"}}]},{id:"fi8602",name:"FI8602",link:"foscam.fi8620",pantilt:"false"},{id:"fi8919W",name:"FI8919W",imageurl:"/snapshot.cgi",mjpegurl:"/videostream.cgi",controlurl:"/decoder_control.cgi?command=%@&amp;onestep=1",auth:"user=@user&amp;pwd=@pwd",pantilt:"true",link:"foscam.fi8919W",keys:[{id:"left",code:"6&amp;degree=18"},{id:"right",code:"4&amp;degree=18"},{id:"up",code:"0&amp;degree=15"},{id:"down",code:"2&amp;degree=15"},{id:"switchOn",code:"94"},
{id:"switchOff",code:"95"}]},{id:"fi9826w",name:"FI9826W",pantilt:"true",link:"foscam.fi9900p"},{id:"fi9831w",name:"FI9831W",pantilt:"true",link:"foscam.fi9900p"},{id:"fi9831p",name:"FI9831P V2",imageurl:"/cgi-bin/CGIProxy.fcgi?cmd=snapPicture2",mjpegurl:"/cgi-bin/CGIStream.cgi?cmd=GetMJStream",controlurl:"/cgi-bin/CGIProxy.fcgi?cmd=%@",stop:"ptzStopRun",auth:"usr=@user&amp;pwd=@pwd",pantilt:"true",link:"foscam.fi9831p",keys:[{id:"left",code:"ptzMoveLeft"},{id:"topLeft",code:"ptzMoveTopLeft"},{id:"right",
code:"ptzMoveRight"},{id:"topRight",code:"ptzMoveTopRight"},{id:"bottomLeft",code:"ptzMoveBottomLeft"},{id:"bottomRight",code:"ptzMoveBottomRight"},{id:"up",code:"ptzMoveUp"},{id:"down",code:"ptzMoveDown"},{id:"reset",code:"ptzReset"},{id:"zoomIn",code:"zoomIn"},{id:"zoomOut",code:"zoomOut"},{id:"zoomStop",code:"zoomStop"}],command:[{type:"string",name:"go to preset",ref:{value:"gotoPreset",ext:"%s"}}]},{id:"fi9900p",name:"FI9900P",imageurl:"/cgi-bin/CGIProxy.fcgi?cmd=snapPicture2",controlurl:"/cgi-bin/CGIProxy.fcgi?cmd=%@",
stop:"ptzStopRun",auth:"usr=@user&amp;pwd=@pwd",pantilt:"false",link:"foscam.fi9900p",keys:[{id:"left",code:"ptzMoveLeft"},{id:"topLeft",code:"ptzMoveTopLeft"},{id:"right",code:"ptzMoveRight"},{id:"topRight",code:"ptzMoveTopRight"},{id:"bottomLeft",code:"ptzMoveBottomLeft"},{id:"bottomRight",code:"ptzMoveBottomRight"},{id:"up",code:"ptzMoveUp"},{id:"down",code:"ptzMoveDown"},{id:"reset",code:"ptzReset"},{id:"zoomIn",code:"zoomIn"},{id:"zoomOut",code:"zoomOut"},{id:"zoomStop",code:"zoomStop"}],command:[{type:"string",
name:"go to preset",ref:{value:"gotoPreset",ext:"%s"}}]},{id:"c1",name:"C1",pantilt:"false",link:"foscam.fi9900p"},{id:"c2",name:"C2",pantilt:"false",link:"foscam.fi9900p"},{id:"r2",name:"R2",pantilt:"true",link:"foscam.fi9900p"},{id:"fi86xx",name:"Generic FI86xx Series",pantilt:"true",link:"foscam.fi8620"},{id:"mjpeg",name:"Generic MJPEG Series",pantilt:"true",link:"foscam.fi8919W"},{id:"h264",name:"Generic H.264 Series",pantilt:"true",link:"foscam.fi9900p"}]},edimax:{name:"Edimax",versions:[{id:"3010",
name:"IC-3010 Series",imageurl:"/jpg/image.jpg",pantilt:"false",link:"edimax.3010"},{id:"7010",name:"IC-7010 Series",imageurl:"/jpg/image.jpg",mjpegurl:"/mjpg/video.mjpg",controlurl:"/camera-cgi/com/ptz.cgi",controlpostdata:"%@",pantilt:"true",useurlauth:"true",link:"edimax.7010",keys:[{id:"home",code:"move=center"},{id:"left",code:"move=left"},{id:"right",code:"move=right"},{id:"up",code:"move=up"},{id:"down",code:"move=down"},{id:"preset0",code:"gotoserverpresetIndex=0"},{id:"preset1",code:"gotoserverpresetIndex=1"},
{id:"preset2",code:"gotoserverpresetIndex=2"},{id:"preset3",code:"gotoserverpresetIndex=3"},{id:"preset4",code:"gotoserverpresetIndex=4"}]},{id:"3030",name:"IC-3030 Series",pantilt:"false",link:"edimax.7010"},{id:"3110",name:"IC-3110 Series",pantilt:"false",link:"edimax.7010"},{id:"3115",name:"IC-3115 Series",pantilt:"false",link:"edimax.7010"},{id:"3116",name:"IC-3116 Series",pantilt:"false",link:"edimax.7010"},{id:"5150w",name:"IC-5150W",pantilt:"false",link:"edimax.7010"},{id:"3140",name:"IC-3140 Series",
pantilt:"false",link:"edimax.7010"},{id:"7001",name:"IC-7001 Series",imageurl:"/jpg/image.jpg",mjpegurl:"/mjpg/video.mjpg",controlurl:"/camera-cgi/com/ptz.cgi",controlpostdata:"%@",pantilt:"true",useurlauth:"true",link:"edimax.7001",keys:[{id:"home",code:"move=center"},{id:"left",code:"move=left"},{id:"right",code:"move=right"},{id:"up",code:"move=up"},{id:"down",code:"move=down"},{id:"preset0",code:"gotopresetIndex=0"},{id:"preset1",code:"gotopresetIndex=1"},{id:"preset2",code:"gotopresetIndex=2"},
{id:"preset3",code:"gotopresetIndex=3"},{id:"preset4",code:"gotopresetIndex=4"}]},{id:"7100",name:"IC-7100 Series",pantilt:"true",link:"edimax.7010"},{id:"7110",name:"IC-7110 Series",pantilt:"true",link:"edimax.7010"},{id:"7112",name:"IC-7112 Series",pantilt:"true",link:"edimax.7001"},{id:"7112w",name:"IC-7112W",pantilt:"true",link:"edimax.7001"},{id:"7113",name:"IC-7113 Series",pantilt:"true",link:"edimax.7001"},{id:"9110",name:"IC-9110 Series",pantilt:"true",link:"edimax.7010"},{id:"9110w",name:"IC-9110W",
pantilt:"false",link:"edimax.7010"},{id:"type1",name:"Generic Type 1 (no PTZ)",pantilt:"false",link:"edimax.3010"},{id:"type2",name:"Generic Type 2 (PTZ)",pantilt:"true",link:"edimax.7001"},{id:"type3",name:"Generic Type 3 (PTZ)",pantilt:"true",link:"edimax.7010"}]},digitus:{name:"DIGITUS",versions:[{id:"plugandview",name:"Plug&View",imagepathurl:"/web/cgi-bin/hi3510/snap.cgi",stop:"ptzstop.cgi",controlurl:"/cgi-bin/hi3510/%@",pantilt:"true",link:"digitus.plugandview",keys:[{id:"left",code:"ptzleft.cgi"},
{id:"right",code:"ptzright.cgi"},{id:"up",code:"ptzup.cgi"},{id:"down",code:"ptzdown.cgi"},{id:"home",code:"ptzgotopoint.cgi?&amp;-chn=0&amp;-point=1"}]}]},doorbird:{name:"DoorBird",versions:[{id:"doorbird",name:"DoorBird",imageurl:"/bha-api/video.cgi",mjpegurl:"/bha-api/video.cgi",controlurl:"/bha-api/%@",pantilt:"true",useurlauth:"true",link:"doorbird.doorbird",keys:[{id:"open_door",code:"open-door.cgi"},{id:"light_on",code:"light-on.cgi"}],command:[{type:"string",name:"open relay (custom)",ref:{value:"open_relay_custom",
ext:"%s"}}],status:[{type:"enum",name:"door bell ring",ref:{value:"ring",value_t:"door_bell_ring",options:["true","false"]}},{type:"enum",name:"motion detect",ref:{value:"motion",options:["true","false"]}},{type:"int",name:"last ring timestamp",ref:{value:"ringT"}},{type:"string",name:"last ring time",ref:{value:"ringTStr"}}],ipevt:[{type:"enum",name:"door bell ring",ref:{value:"ring",value_t:"door_bell_ring",options:["true"]}},{type:"enum",name:"motion detect",ref:{value:"motion",options:["true"]}}]}]},
mobotix:{name:"MOBOTIX",versions:[{id:"general",name:"General Camera",imageurl:"/record/current.jpg",mjpegurl:"/cgi-bin/faststream.jpg?needlength&fps=0",controlurl:"/control/click.cgi?%@",pantilt:"true",link:"mobotix.general",keys:[{id:"up",code:"moverel&x=0&y=50"},{id:"down",code:"moverel&x=0&y=-50"},{id:"left",code:"moverel&x=-50&y=0"},{id:"right",code:"moverel&x=50&y=0"},{id:"center",code:"center"},{id:"zoomIn",code:"zoomrel=-200"},{id:"zoomOut",code:"zoomrel=200"},{id:"1xZoom",code:"zoom=0"}],
command:[{type:"int",name:"go to preset",ref:{value:"gotoPreset",ext:"%d",extExtra:"1-127"}},{type:"enum",name:"display mode",ref:{value:"displayMode",ext:"%e",extMeta:"Full Image;Normal;Surround;Panorama;Panorama/Focus;Double Panorama".split(";")}},{type:"string",name:"custom command",ref:{value:"customCMD",ext:"%s"}}]}]},axis:{name:"Axis",versions:[{id:"212",name:"212 PTZ",link:"axis.ptz",pantilt:"true"},{id:"215",name:"215 PTZ",link:"axis.ptz",pantilt:"true"},{id:"m10",name:"M10 Series",link:"axis.general",
pantilt:"true"},{id:"m1054",name:"M1054",link:"axis.ptz",pantilt:"true"},{id:"m11",name:"M11 Series",link:"axis.ptz",pantilt:"true"},{id:"m3014",name:"M3014",link:"axis.ptz",pantilt:"true"},{id:"m32",name:"M32 Series",link:"axis.ptz",pantilt:"true"},{id:"m50",name:"M50 Series",link:"axis.ptz",pantilt:"true"},{id:"p1311",name:"P1311",link:"axis.ptz",pantilt:"false"},{id:"p1346",name:"P1346 Series",link:"axis.ptz",pantilt:"true"},{id:"p1347",name:"P1347 Series",link:"axis.ptz",pantilt:"true"},{id:"q1755",
name:"Q 1755 Series",link:"axis.ptz",pantilt:"true"},{id:"p33",name:"P33 Series",link:"axis.ptz",pantilt:"true"},{id:"q6034",name:"Q6034",link:"axis.ptz",pantilt:"true"},{id:"ptz",name:"General (PTZ)",imageurl:"/jpg/image.jpg",mjpegurl:"/mjpg/video.mjpg",controlurl:"/axis-cgi/com/ptz.cgi?camera=1&amp;%@",useurlauth:"true",pantilt:"true",link:"axis.ptz",keys:[{id:"home",code:"move=home"},{id:"left",code:"move=left"},{id:"right",code:"move=right"},{id:"up",code:"move=up"},{id:"down",code:"move=down"},
{id:"tele",code:"rzoom=1000"},{id:"wide",code:"rzoom=-1000"}],command:[{type:"enum",name:"light on",ref:{value:"lightOn"}},{type:"enum",name:"light off",ref:{value:"lightOff"}},{type:"int",name:"play clip",ref:{value:"playClip",ext:"%d"}},{type:"int",name:"activate output ",ref:{value:"actOut",ext:"%d"}},{type:"int",name:"deactivate output ",ref:{value:"deactOut",ext:"%d"}}]},{id:"general",name:"General",imageurl:"/jpg/image.jpg",mjpegurl:"/mjpg/video.mjpg",controlurl:"/axis-cgi/com/ptz.cgi?camera=1&amp;%@",
useurlauth:"true",link:"axis.general",pantilt:"true",command:[{type:"enum",name:"light on",ref:{value:"lightOn"}},{type:"enum",name:"light off",ref:{value:"lightOff"}},{type:"int",name:"play clip",ref:{value:"playClip",ext:"%d"}},{type:"int",name:"activate output ",ref:{value:"actOut",ext:"%d"}},{type:"int",name:"deactivate output ",ref:{value:"deactOut",ext:"%d"}}]}]},generic:{name:"Generic IP Camera",versions:[{id:"type1",name:"Type 1",link:"telefunken.XS100",pantilt:"false"},{id:"type2",name:"Type 2 (PTZ)",
link:"telefunken.XS100",pantilt:"true"},{id:"type3",name:"Type 3 (PTZ)",link:"konine.konine",pantilt:"true"},{id:"type4",name:"Type 4",link:"dlink.2000",pantilt:"false"},{id:"type5",name:"Type 5 (PTZ)",link:"7links.770hd",pantilt:"true"},{id:"type6",name:"Type 6",link:"dlink.dcs930",pantilt:"false"},{id:"type7",name:"Type 7",link:"dlink.dcs942",pantilt:"false"},{id:"type8",name:"Type 8 (PTZ)",link:"dlink.2000",pantilt:"true"},{id:"type9",name:"Type 9",link:"dlink.dcs2132",pantilt:"false"},{id:"type10",
name:"Type 10 (PTZ)",link:"nueva.hd",pantilt:"true"},{id:"type11",name:"Type 11 (PTZ)",link:"instar.vga",pantilt:"true"},{id:"type12",name:"Type 12 (PTZ)",link:"instar.hd",pantilt:"true"},{id:"type13",name:"Type 13 (PTZ)",pantilt:"true",link:"foscam.fi8620"},{id:"type14",name:"Type 14 (PTZ)",pantilt:"true",link:"foscam.fi8919W"},{id:"type15",name:"Type 15 (PTZ)",pantilt:"true",link:"foscam.fi9826w"},{id:"type16",name:"Type 16",pantilt:"false",link:"edimax.3010"},{id:"type17",name:"Type 17 (PTZ)",
pantilt:"true",link:"edimax.7001"},{id:"type18",name:"Type 18 (PTZ)",pantilt:"true",link:"edimax.7010"},{id:"type19",name:"Type 19 (PTZ)",pantilt:"true",link:"digitus.plugandview"},{id:"type20",name:"Type 20 (PTZ)",pantilt:"true",link:"doorbird.doorbird"},{id:"type21",name:"Type 21 (PTZ)",pantilt:"true",link:"mobotix.general"}]}};
xnm.aio.cams.DM=function(){var c=function(a,b){this.code=a;this.message=b;this.stack=Error().stack};c.prototype=Error();c.prototype.name="CamDMError";c.prototype.code=0;c.ERROR_CODE={DEFAULT:0,INDEX_EXISTS:1,ID_EXISTS:2,INVALID:3,UNKNOW:4,NOT_FOUND:5,IP_EXISTS:6};return{SYS:"cam",getIPDeviceType:function(a,b){var d=[],e;for(e in xnm.aio.cams.CAM_INFO)if(xnm.aio.cams.CAM_INFO.hasOwnProperty(e)){var h=xnm.aio.cams.CAM_INFO[e];if((!(b&&b.lm&&b.license)||b.lm.permitFeature("read",{sys:this.SYS,type:"system",
manufacturer:e},b.license))&&h.name){var l={category:"system",type:e,name:h.name,versions:[]};if(h.versions)for(var f=0;f<h.versions.length;f++){var g=h.versions[f];g&&g.id&&g.name&&l.versions.push({model:g.id,name:g.name,link:g.link})}d.push(l)}}if(a&&(a=a.getIPCams()))for(e=0;e<a.length;e++)if(l=a[e],(h=$(l).getAttributes())&&h.id&&h.name&&!xnm.aio.cams.CAM_INFO[h.id]&&(!(b&&b.lm&&b.license)||b.lm.permitFeature("read",{sys:this.SYS,type:"custom",manufacturer:h.id},b.license))&&(h={category:"custom",
type:h.id,name:h.name,versions:[]},d.push(h),l=$(l).children()))for(f=0;f<l.length;f++)(g=$(l[f]).getAttributes())&&g.id&&g.name&&h.versions.push({model:g.id,name:g.name});return[{sys:this.SYS,name:"IP Camera",types:d}]},createDevice:function(a,b,d){b=c.ERROR_CODE;a?a.type?a.ip?d(null,a):d(new c(b.INVALID,"ip is invalid")):d(new c(b.INVALID,"type is invalid")):d(new c(b.INVALID,"info is invalid"))},updateDevice:function(a,b,d){b=c.ERROR_CODE;a?a.type?a.ip?d(null,a):d(new c(b.INVALID,"ip is invalid")):
d(new c(b.INVALID,"type is invalid")):d(new c(b.INVALID,"info is invalid"))},deleteDevice:function(a,b,d){d()},applyUIFilter:function(a,b,d){var e=function(k,m){if("*"==k)return!0;for(var n=!1,p=0;p<k.length;p++)if(k[p]==m){n=!0;break}return n},h=function(k,m,n){var p=[];switch(n.catagory){case "command":k.command&&k.command.forEach(function(q){e(n.elems,q.type)&&(q=JSON.parse(JSON.stringify(q)),p.push(q))});break;case "status":k.status&&k.status.forEach(function(q){e(n.elems,q.type)&&(q=JSON.parse(JSON.stringify(q)),
p.push(q))})}return p},l=function(k,m){var n=[],p=xnm.aio.cams.DM.getCommandStatusMap(k,d);p&&(k=h(p,k,m),n=n.concat(k));return n};if(!a.sys)return null;var f=JSON.parse(JSON.stringify(a)),g=null;switch(b.catagory){case "command":g=l(a,b);f.command=g;break;case "status":g=l(a,b);f.status=g;break;default:return null}return g&&0!=g.length?f:null},applyNeoServerFilter:function(a,b,d){var e=function(k,m){if("*"==k)return!0;for(var n=!1,p=0;p<k.length;p++)if(k[p]==m){n=!0;break}return n},h=function(k,
m,n){var p=[];switch(n.catagory){case "command":k.command&&k.command.forEach(function(q){e(n.elems,q.type)&&(q=JSON.parse(JSON.stringify(q)),p.push(q))});break;case "status":k.status&&k.status.forEach(function(q){e(n.elems,q.type)&&(q=JSON.parse(JSON.stringify(q)),p.push(q))})}return p},l=function(k,m){var n=[],p=xnm.aio.cams.DM.getNeoServerCommandStatusMap(k,d);p&&(k=h(p,k,m),n=n.concat(k));return n};if(!a.sys)return null;var f=JSON.parse(JSON.stringify(a)),g=null;switch(b.catagory){case "command":g=
l(a,b);f.command=g;break;case "status":g=l(a,b);f.status=g;break;default:return null}return g&&0!=g.length?f:null},applyIPEventFilter:function(a,b,d){return(a=this.getCamInfo(a,d))&&a.ipevt?{ipevt:a.ipevt}:null},getCamInfo:function(a,b){var d=function(f,g){for(var k in f)f.hasOwnProperty(k)&&(g[k]=f[k]);return g},e=function(f){var g=f.type;"tfcam"==f.type&&(g="telefunken");g=xnm.aio.cams.CAM_INFO[g];if(!g)return null;for(var k,m=0;m<g.versions.length;m++){var n=g.versions[m];if(n&&n.id==f.model){k=
n;break}}if(!k)return null;if(!k.link||k.link==f.type+"."+f.model)return k;f=k.link.indexOf(".");f=e({type:k.link.substr(0,f),model:k.link.substr(f+1)});if(!f)return null;f=JSON.parse(JSON.stringify(f));return d(k,f)},h=function(f,g){var k,m=g.find('cam[id="'+f.type+'"]');m&&0<m.length&&(k=m[0]);if(!k)return null;k=$(k).find('version[id="'+f.model+'"]');if(!k||0==k.length)return null;k=k[0];m=$(k).attr("link");if(!m||m==f.type+"."+f.model){k=$(k);g=k.getAttributes();g=JSON.parse(JSON.stringify(g));
k=k.children();for(f=0;f<k.length;f++){var n=$(k[f]);n&&(m=n.attr("id"),n=n.attr("code"),m&&n&&(g.keys||(g.keys=[]),g.keys.push({id:m,code:n})))}return g}f=m.indexOf(".");if(n=e({type:m.substr(0,f),model:m.substr(f+1)}))return g=JSON.parse(JSON.stringify(n)),d(k,g);n=h({type:m.substr(0,f),model:m.substr(f+1)},g);if(!n)return null;g=JSON.parse(JSON.stringify(n));return d(k,g)};if(!a.type||!a.model)return null;"system"!=a.type&&"custom"!=a.type||!a.manufacturer||(a=JSON.parse(JSON.stringify(a)),a.type=
a.manufacturer);var l=e(a);!l&&b&&(l=h(a,b));return l},getCommandStatusMap:function(a,b){b=this.getCamInfo(a,b);if(!b||!b.pantilt||"false"==b.pantilt)return null;var d={command:[]};if(b.keys)for(var e=0;e<b.keys.length;e++){var h=b.keys[e];d.command.push({type:"enum",name:h.id,ref:{value:h.id}})}b.command&&(d.command=d.command.concat(b.command));b.status&&(d.status=b.status);"system"==a.type&&"doorbird"==a.manufacturer&&(a.relays&&a.relays.length&&d.command.push({type:"enum",name:"open relay",ref:{value:"open_relay",
ext:"%e",extMeta:a.relays}}),d.command.push({type:"enum",name:"open doorbird app",ref:{value:"open_app",value_t:"open_app_doorbird"}}),d.command.push({type:"enum",name:"open liveview",ref:{value:"open_live"}}));return d},getNeoServerCommandStatusMap:function(a,b){b={command:[]};if(a&&"system"==a.type&&("doorbird"==a.manufacturer||"doorbird"==a.type)&&"doorbird"==a.model||a&&"system"==a.type&&("netatmo"==a.manufacturer||"netatmo"==a.type))return b;b.command.push({type:"enum",name:"take snapshot",ref:{value:"snapshot"}});
return b}}}();
xnm.aio.cams.Handler=function(){var c=function(){var a=require("x.logger.js");xnm.aio.cams.DM._logger=a?a.getLogger("xnm.aio.cams.DM"):{log:function(){}};this._foscamDiscovery=null;this._doorbirdHandler=new xnm.aio.cams.DoorBird.Handler};c.prototype.devicemanager=xnm.aio.cams.DM;c.prototype.registModule=function(a){a.register(xnm.aio.cams.DM.SYS,"cams")};c.prototype.resolveDevice=function(a,b){b=xnm.aio.cams.DM.getCamInfo(a,b);return!a||"system"!=a.type||"doorbird"!=a.manufacturer&&"doorbird"!=a.type||
"doorbird"!=a.model?!a||"system"!=a.type||"foscam"!=a.manufacturer&&"foscam"!=a.type?!a||"system"!=a.type||"netatmo"!=a.manufacturer&&"netatmo"!=a.type?!a||"system"!=a.type||"mobotix"!=a.manufacturer&&"mobotix"!=a.type?!a||"system"!=a.type||"axis"!=a.manufacturer&&"axis"!=a.type?new xnm.aio.cams.Cam(a,b):new xnm.aio.cams.Axis(a,b):new xnm.aio.cams.Mobotix(a,b):new xnm.aio.cams.Welcome(a,b):new xnm.aio.cams.Foscam(a,b):new xnm.aio.cams.DoorBird(a,b)};c.prototype.getCamJPEGUrl=function(a,b,d){b=xnm.aio.cams.DM.getCamInfo(a,
b);a=new xnm.aio.cams.Cam(a,b);var e=d,h=a.getJPEGURL(function(l){h||l?e&&e(null,l):e&&e(Error("cam has no jpeg url"))});h&&(e&&e(null,{url:h}),e=null)};c.prototype.getCamMJPEGUrl=function(a,b,d){b=xnm.aio.cams.DM.getCamInfo(a,b);a=(new xnm.aio.cams.Cam(a,b)).getMJPEGURL();d&&d(a?null:Error("cam has no mjpeg url"),{url:a})};c.prototype.getCamVideoInfo=function(a,b,d){(a=this.resolveDevice(a,b))?a.getVideoInfo(d):d&&d(Error("no such camera"))};c.prototype.getDeviceCommands=function(a,b){a=(a=xnm.aio.cams.DM.applyUIFilter(a,
{catagory:"command",elems:"*"}))?a.command:[];b&&b(null,a)};c.prototype.getDeviceStatus=function(a,b){a=(a=xnm.aio.cams.DM.applyUIFilter(a,{catagory:"status",elems:"*"}))?a.status:[];b&&b(null,a)};c.prototype.doCommand=function(a,b,d,e){(d=this.resolveDevice(a,d))?d.executeCommandCreator(a,b,e):e&&e(Error("device json format invalid"))};c.prototype.doStatus=function(a,b,d,e){var h=this.resolveDevice(b);h?h.getStatesCreator(null,[{id:a,device:b,status:d}],function(l,f){l?e&&e(l):e&&e(null,f)}):e&&
e(Error("device json format invalid"))};c.prototype.listSystemCam=function(a){var b=xnm.aio.cams.DM.getIPDeviceType();b=b?b:[];a&&a(null,b)};c.prototype.createJPEGCam=function(a,b,d,e){return b&&b._extra&&"system"==b._extra.type&&"doorbird"==b._extra.manufacturer&&"doorbird"==b._extra.model&&b._mjpegurl?new xnm.aio.cams.MJPEGCam(b._mjpegurl,b):new xnm.aio.cams.JPEGCam(a,b,d,e)};c.prototype.createSystemCam=function(a,b){return new xnm.aio.cams.SystemCam(a,b)};c.prototype.detectCams=function(){this._foscamDiscovery||
(this._foscamDiscovery=new xnm.aio.cams.FoscamDiscovery);this._foscamDiscovery.discoverCams()};c.prototype.getDoorBirdHandler=function(){return this._doorbirdHandler};c.prototype.discoverDoorbird=function(a,b){var d=this,e=require("x.mdns.js");e.clearRecordBuffer();e.discoverServiceWithTimeout("_axis-video._tcp.local",a,function(h,l){if(h)b&&b(h);else{h=[];for(var f=0;f<l.length;f++){var g=l[f];if(g.domain&&"Doorstation"==g.domain.substr(0,11)&&g.ip&&0<g.ip.length){var k={sys:"cam",type:"system",
manufacturer:"doorbird",ip:g.ip[0],port:80};g.info&&g.info.macaddress&&(k.mac=g.info.macaddress);(g=d.resolveDevice(k))&&h.push(g)}}b&&b(null,h)}})};c.prototype.finalize=function(a){this._doorbirdHandler&&this._doorbirdHandler.finalize();a&&a()};c.prototype.pause=function(a){this.finalize(a)};return c}();"undefined"!=typeof module&&null!=module&&(module.exports=new xnm.aio.cams.Handler);
