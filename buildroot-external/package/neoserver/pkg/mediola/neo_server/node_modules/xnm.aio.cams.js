var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.findInternal=function(b,a,c){b instanceof String&&(b=String(b));for(var d=b.length,e=0;e<d;e++){var f=b[e];if(a.call(c,f,e,b))return{i:e,v:f}}return{i:-1,v:void 0}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(b,a,c){b!=Array.prototype&&b!=Object.prototype&&(b[a]=c.value)};$jscomp.getGlobal=function(b){b=["object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global,b];for(var a=0;a<b.length;++a){var c=b[a];if(c&&c.Math==Math)return c}return globalThis};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.polyfill=function(b,a,c,d){if(a){c=$jscomp.global;b=b.split(".");for(d=0;d<b.length-1;d++){var e=b[d];e in c||(c[e]={});c=c[e]}b=b[b.length-1];d=c[b];a=a(d);a!=d&&null!=a&&$jscomp.defineProperty(c,b,{configurable:!0,writable:!0,value:a})}};$jscomp.polyfill("Array.prototype.find",function(b){return b?b:function(a,c){return $jscomp.findInternal(this,a,c).v}},"es6","es3");$jscomp.arrayIteratorImpl=function(b){var a=0;return function(){return a<b.length?{done:!1,value:b[a++]}:{done:!0}}};
$jscomp.arrayIterator=function(b){return{next:$jscomp.arrayIteratorImpl(b)}};$jscomp.SYMBOL_PREFIX="jscomp_symbol_";$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.SymbolClass=function(b,a){this.$jscomp$symbol$id_=b;$jscomp.defineProperty(this,"description",{configurable:!0,writable:!0,value:a})};$jscomp.SymbolClass.prototype.toString=function(){return this.$jscomp$symbol$id_};
$jscomp.Symbol=function(){function b(c){if(this instanceof b)throw new TypeError("Symbol is not a constructor");return new $jscomp.SymbolClass($jscomp.SYMBOL_PREFIX+(c||"")+"_"+a++,c)}var a=0;return b}();
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var b=$jscomp.global.Symbol.iterator;b||(b=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("Symbol.iterator"));"function"!=typeof Array.prototype[b]&&$jscomp.defineProperty(Array.prototype,b,{configurable:!0,writable:!0,value:function(){return $jscomp.iteratorPrototype($jscomp.arrayIteratorImpl(this))}});$jscomp.initSymbolIterator=function(){}};
$jscomp.initSymbolAsyncIterator=function(){$jscomp.initSymbol();var b=$jscomp.global.Symbol.asyncIterator;b||(b=$jscomp.global.Symbol.asyncIterator=$jscomp.global.Symbol("Symbol.asyncIterator"));$jscomp.initSymbolAsyncIterator=function(){}};$jscomp.iteratorPrototype=function(b){$jscomp.initSymbolIterator();b={next:b};b[$jscomp.global.Symbol.iterator]=function(){return this};return b};
$jscomp.iteratorFromArray=function(b,a){$jscomp.initSymbolIterator();b instanceof String&&(b+="");var c=0,d={next:function(){if(c<b.length){var e=c++;return{value:a(e,b[e]),done:!1}}d.next=function(){return{done:!0,value:void 0}};return d.next()}};d[Symbol.iterator]=function(){return d};return d};$jscomp.polyfill("Array.prototype.keys",function(b){return b?b:function(){return $jscomp.iteratorFromArray(this,function(a){return a})}},"es6","es3");var xnm=xnm||{};xnm.aio=xnm.aio||{};
xnm.aio.cams=xnm.aio.cams||{};xnm.aio.cams._moveFromTmp=function(b,a,c){var d=require("fs"),e=d.createReadStream(b);a=d.createWriteStream(a);a.on("error",function(a){XC.debugf(a.message,"error");c&&c(a)});e.on("error",function(a){XC.debugf(a.message,"error");c&&c(a)});e.on("end",function(){try{d.unlinkSync(b)}catch(f){}c&&c()});e.pipe(a)};
xnm.aio.cams.rename=function(b,a,c,d){var e=function(){setTimeout(function(){c&&c()},100)};if("undefined"===typeof process||"object"!==typeof process.release||"node"!==process.release.name||"win32"!==process.platform&&!d){d=require("fs");try{d.renameSync(b,a)}catch(f){xnm.aio.cams.rename(b,a,e,!0);return}e&&e()}else this._moveFromTmp(b,a,e)};
xnm.aio.cams.SystemCam=function(b,a){this._$cam=b;this._options=a;this.jpegurl=this._addAuth("http://"+this._getIP()+b.attr("imageurl"));this.mjpegurl=null;b.attr("mjpegurl")&&(this.mjpegurl=this._addAuth("http://"+this._getIP()+b.attr("mjpegurl")),"true"==b.attr("useurlauth")&&(this.mjpegurl=this._addAuth("http://"+a.user+":"+a.password+"@"+this._getIP()+b.attr("mjpegurl"))),!window.XCHost||!window.XCHost.getType||"node-webkit"!=window.XCHost.getType()&&"Android"!=window.XCHost.getType()||"doorbird"==
b.attr("id")||b.attr("name")&&-1!=b.attr("name").indexOf("DoorBird")||(this.mjpegurl=null));this.controlurl=null;this.pantilt=!1;"true"==a.pantilt&&(this.pantilt=!0,b.attr("controlurl")&&(this.controlurl=this._addAuth("http://"+this._getIP()+b.attr("controlurl"))),b.attr("controlpostdata")&&(this.controlpostdata=b.attr("controlpostdata")));b.attr("imagepathurl")&&(this.mjpegurl=this.jpegurl=null,this.jpegpathurl=this._addAuth("http://"+this._getIP()+b.attr("imagepathurl")))};
xnm.aio.cams.SystemCam.prototype._getIP=function(){var b=this._$cam.attr("port"),a=this._options.address;0>a.indexOf(":")&&b&&80!=b&&(a+=":"+b);return a};xnm.aio.cams.SystemCam.prototype._addAuth=function(b){var a=this._$cam.attr("auth");if(a){a=a.replace("@user",encodeURIComponent(this._options.user));a=a.replace("@pwd",encodeURIComponent(this._options.password));var c="&";-1==b.indexOf("?")&&(c="?");b+=c+a}return b};
xnm.aio.cams.SystemCam.prototype._doRequest=function(b,a,c){b=require("url").parse(b);b.port||(b.port=80);b={host:b.hostname,port:b.port,path:b.path,method:"GET",user:this._options.user,password:this._options.password,headers:{"Content-Type":'text/xml; charset="utf-8"',Authorization:"Basic "+(new Buffer(this._options.user+":"+this._options.password)).toString("base64"),Connection:"close"}};a&&(b.method="POST",b.headers["Content-Length"]=a.length);b=require("http").request(b,function(a){c&&c(a)});
if(b.on)b.on("error",function(a){c&&c()});a&&b.write(a);b.end()};
xnm.aio.cams.SystemCam.prototype.executeCommand=function(b){if(this.controlurl){var a=this;this._$cam.find("key").each(function(){var c=$(this);if(c.attr("id")==b){var d=a.controlurl.replace("%@",c.attr("code")),e=null;a.controlpostdata&&(d=a.controlurl,e=a.controlpostdata.replace("%@",c.attr("code")));a._doRequest(d,e,function(c){c=500;if("left"==b||"right"==b)c=800;"XS100"==a._$cam.attr("id")?setTimeout(function(){d=a.controlurl.replace("%@","1");a._doRequest(d)},c):a._$cam.attr("stop")&&setTimeout(function(){d=
a.controlurl.replace("%@",a._$cam.attr("stop"));a._doRequest(d)},c/2)})}})}};xnm.aio.cams.JPEGCam=function(b,a,c,d){this._url=b;this._imgPath=c;this._imgPage=d;this._options=a;this._prevDone=!0};
xnm.aio.cams.JPEGCam.prototype._loadImage=function(b){var a=require("fs"),c=this;this._loadImage2Tmp(function(d,e){if(d&&a.existsSync(d)){var f=null;f="object"===typeof nw?nw.App.dataPath+"/../cams/":a.dataPath()+"/cams/";var g="image.jpg";c._options&&c._options.imageName&&(g=c._options.imageName);a.mkdirRecursiveSync(f);if(a.existsSync(f+g)){var k=f+g+"_"+(new Date).getTime();xnm.aio.cams.rename(f+g,k,function(){a.existsSync(k)&&a.unlinkSync(k);xnm.aio.cams.rename(d,f+g,function(){b&&b("file://"+
f+g+"?"+(new Date).getTime())})})}else xnm.aio.cams.rename(d,f+g,function(){b&&b("file://"+f+g+"?"+(new Date).getTime())})}else b&&b(null,e)})};xnm.aio.cams.JPEGCam.prototype._loadImage2Tmp=function(b){if(this._url)if(this._prevDone){var a=require("http");require("fs");var c=this;this._prevDone=!1;a.getFile(this._url,this._options,function(a,e){a?b&&b(a):(XC.debugf("failed to load "+c._url),b&&b(null,e));c._prevDone=!0},null,{encodeURL:!1})}else b&&b();else XC.debugf("[xnm.aio.cams.JPEGCam._loadImage] No URL set!")};
xnm.aio.cams.JPEGCam.prototype._getImagePath=function(b){var a=require("url").parse(this._imgPath);a.port||(a.port=80);this._ip=a.hostname+":"+a.port;a={host:a.hostname,port:a.port,path:a.path,method:"GET",user:this._options.user,password:this._options.password,headers:{"Content-Type":'text/xml; charset="utf-8"',Authorization:"Basic "+(new Buffer(this._options.user+":"+this._options.password)).toString("base64"),Connection:"close"}};a=require("http").request(a,function(a){a.setEncoding("utf-8");var c=
"";a.on("data",function(a){c+=a});a.on("end",function(){b&&b(c)})});if(a.on)a.on("error",function(a){b&&b()});a.end()};
xnm.aio.cams.JPEGCam.prototype._getImagePage=function(b){var a=require("url").parse(this._imgPage);a.port||(a.port=80);this._ip=a.hostname+":"+a.port;a={host:a.hostname,port:a.port,path:a.path,method:"GET",user:this._options.user,password:this._options.password,headers:{"Content-Type":'text/xml; charset="utf-8"',Authorization:"Basic "+(new Buffer(this._options.user+":"+this._options.password)).toString("base64"),Connection:"close"}};a=require("http").request(a,function(a){a.setEncoding("utf-8");var c=
"";a.on("data",function(a){c+=a});a.on("end",function(){200!=a.statusCode?b&&b(Error("http status code:"+a.statusCode)):b&&b(null,c);b=null})});a.setTimeout&&a.setTimeout(5E3,function(){b&&b(Error("timeout"));b=null});if(a.on)a.on("error",function(a){b&&b(a);b=null});a.end()};
xnm.aio.cams.JPEGCam.prototype.loadImage=function(b){var a=this;this._imgPath?this._getImagePath(function(c){a._url=null;if(c){var d=c.indexOf('path="'),e=c.lastIndexOf('"');-1<d&&e>d&&(a._url="http://"+a._ip+c.substring(d+6,e))}a._loadImage(b)}):this._imgPage?this._getImagePage(function(c,d){c||!d?b&&b():(a._url=null,c=d.substr(d.indexOf('<img src="')+10),c=c.substr(0,c.indexOf('"/>')),c=c.substr(2),a._url="http://"+a._ip+c,a._loadImage(b))}):this._loadImage(b)};
xnm.aio.cams.JPEGCam.prototype.loadImage2Tmp=function(b){if(this._imgPath){var a=this;this._getImagePath(function(c){a._url=null;if(c){var d=c.indexOf('path="'),e=c.lastIndexOf('"');-1<d&&e>d&&(a._url="http://"+a._ip+c.substring(d+6,e))}a._loadImage2Tmp(b)})}else this._loadImage2Tmp(b)};xnm.aio.cams.MJPEGCam=function(b,a){this._url=b;this._options=a;this._mjpegClient=null;this._loading=!1};
xnm.aio.cams.MJPEGCam.prototype._loadImage=function(b){var a=require("fs"),c=this;this._loadImage2Tmp(function(d){if(d){if(a.existsSync(d)){var e=null;e="object"===typeof nw?nw.App.dataPath+"/../cams/":a.dataPath()+"/cams/";var f="image.jpg";c._options&&c._options.imageName&&(f=c._options.imageName);a.mkdirRecursiveSync(e);if(a.existsSync(e+f)){var g=e+f+"_"+(new Date).getTime();xnm.aio.cams.rename(e+f,g,function(){a.existsSync(g)&&a.unlinkSync(g);xnm.aio.cams.rename(d,e+f,function(){b&&b("file://"+
e+f+"?"+(new Date).getTime())})})}else xnm.aio.cams.rename(d,e+f,function(){b&&b("file://"+e+f+"?"+(new Date).getTime())})}}else b&&b()})};
xnm.aio.cams.MJPEGCam.prototype._loadImage2Tmp=function(b){if(this._url)if(this._mjpegClient||(this._mjpegClient=require("x.mjpeg.js").getClient(this._url,this._options)),this._loading)b&&b();else{require("fs");var a=this;this._loading=!0;this._mjpegClient.getFile(this._url,this._options,function(c){a._loading=!1;c?b&&b(c):(XC.debugf("failed to load "+a._url),b())})}else b&&b()};xnm.aio.cams.MJPEGCam.prototype.loadImage=function(b){this._loadImage(b)};
xnm.aio.cams.MJPEGCam.prototype.loadImage2Tmp=function(b){this._loadImage2Tmp(b)};xnm.aio.cams.FoscamDiscovery=function(){this._sockets=[];var b=require("os"),a=require("dgram");if(b&&b.networkInterfaces){var c=this;a=a.createSocket("udp4");a.bind(9600,"0.0.0.0");a.on("message",function(a,b){c._receivedData(b.address,a.toString("hex"))});b=b.networkInterfaces();for(var d in b){a=b[d];for(var e=0;e<a.length;e++)this._addDiscoverSocket(9600,a[e])}}else this._addDiscoverSocket(9600,null)};
xnm.aio.cams.FoscamDiscovery.prototype._receivedData=function(b,a){XC.debugf("Received camdata from "+b)};xnm.aio.cams.FoscamDiscovery.prototype._addDiscoverSocket=function(b,a){var c=require("dgram"),d=this;if(a)"IPv4"==a.family&&0==a.internal&&(e=c.createSocket("udp4"),e.on("listening",function(){e.setBroadcast(!0)}),e.bind(b,a.address),this._sockets.push(e));else{var e=c.createSocket("udp4");e.on("message",function(a,b){d._receivedData(b.address,a.toString("hex"))});this._sockets.push(e)}};
xnm.aio.cams.FoscamDiscovery.prototype._sendDiscoveryMessages=function(b,a,c,d){b=new Buffer([77,79,95,73,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,4,0,0,0,0,0,0,1]);a=new Buffer([68,72,1,1]);for(c=0;c<this._sockets.length;c++)this._sockets[c].send(b,0,b.length,1E4,"255.255.255.255"),this._sockets[c].send(a,0,a.length,8600,"255.255.255.255")};xnm.aio.cams.FoscamDiscovery.prototype.discoverCams=function(){var b=this,a=0,c=setInterval(function(){b._sendDiscoveryMessages();4<=a++&&clearInterval(c)},250)};
xnm.aio.cams.Cam=function(){var b=function(a,b){this._options=a;this._camInfo=b};b.prototype.getIP=function(){if(!this._options)return null;var a=this._options.ip,b=a.indexOf(":");-1!=b&&(a=a.substr(0,b));return a};b.prototype.getPort=function(){if(!this._options)return null;var a=this._options.port,b=this._options.ip,d=b.indexOf(":");a||-1==d||(a=parseInt(b.substr(d+1)));return a};b.prototype.getUsername=function(){return this._options?this._options.username:null};b.prototype.getPassword=function(){return this._options?
this._options.password:null};b.prototype.getVideoInfo=function(a){var b={username:this._options.username,password:this._options.password,jpeg:this.getJPEGURL(),mjpeg:this.getMJPEGURL(),jpegPath:this.getJPEGPathURL(),jpegPage:this.getJPEGPageURL()};a&&a(null,b)};b.prototype.getJPEGURL=function(){if(!this._camInfo||!this._camInfo.imageurl)return null;var a=this.getRootUrl()+this._camInfo.imageurl;return this._addAuth(a)};b.prototype.getJPEGPathURL=function(){return this._camInfo&&this._camInfo.imagepathurl?
this._addAuth(this.getRootUrl()+this._camInfo.imagepathurl):null};b.prototype.getJPEGPageURL=function(){return this._camInfo&&this._camInfo.imagepageurl?this._addAuth(this.getRootUrl()+this._camInfo.imagepageurl):null};b.prototype.getMJPEGURL=function(){if(!this._camInfo||!this._camInfo.mjpegurl)return null;var a=this.getRootUrl()+this._camInfo.mjpegurl;"true"==this._camInfo.useurlauth&&(a="",this._options.username&&(a=this._options.username+":"+(this._options.password?this._options.password:"")),
a=this.getRootUrl(a)+this._camInfo.mjpegurl);return this._addAuth(a)};b.prototype.executeCommandCreator=function(a,b,d){this.executeCommand(b.value,d)};b.prototype.getStatesCreator=function(a,b,d){d&&d(null,[])};b.prototype.executeCommand=function(a,b){if(a)if("snapshot"==a)this.snapshot(b);else{var c=this._buildControlUrl(a);if(c){var e=this._buildPostData(a),f=this;this._doRequest(c,{user:this._options.username,password:this._options.password},e,function(c,d){var k=500;if("left"==a||"right"==a)k=
800;"XS100"==f._camInfo.id||"telefunken.XS100"==f._camInfo.link?setTimeout(function(){var a=f._buildControlUrlRaw("1");f._doRequest(a,f._options,null,null)},k):f._camInfo.stop&&setTimeout(function(){var a=f._buildControlUrlRaw(f._camInfo.stop);f._doRequest(a,f._options,null,null)},k/2);b&&b(c,d)})}else b&&b(Error("build control url error"))}else b&&b(Error("command is empty"))};b.prototype.getRootUrl=function(a){var b="http://",d=this._options.ip;"https://"==d.substr(0,8).toLowerCase()?(b="https://",
d=d.substr(8)):"http://"==d.substr(0,7).toLowerCase()&&(d=d.substr(7));var e=this._options.port,f=d.indexOf(":");-1!=f&&(e=d.substr(f+1),d=d.substr(0,f));e||(e="https://"==b?443:80);return b+(a?a+"@":"")+d+":"+e};b.prototype._buildControlUrl=function(a){if(!this._camInfo||!this._camInfo.controlurl)return null;var b=this._decodeXml(this._camInfo.controlurl);a=this._getCommandCode(a);if(!a)return null;a=this._decodeXml(a);b=this.getRootUrl()+b.replace("%@",a);return this._addAuth(b)};b.prototype._buildControlUrlRaw=
function(a){if(!this._camInfo||!this._camInfo.controlurl||!a)return null;var b=this._decodeXml(this._camInfo.controlurl);a=this._decodeXml(a);a=this.getRootUrl()+b.replace("%@",a);return this._addAuth(a)};b.prototype._buildPostData=function(a){if(!this._camInfo||!this._camInfo.controlpostdata)return null;a=this._getCommandCode(a);if(!a)return null;a=this._decodeXml(a);return this._camInfo.controlpostdata.replace("%@",a)};b.prototype._getCommandCode=function(a){if(!a||!this._camInfo||!this._camInfo.keys)return null;
for(var b=0;b<this._camInfo.keys.length;b++){var d=this._camInfo.keys[b];if(d.id&&d.id==a)return d.code}return null};b.prototype._addAuth=function(a){if(!this._camInfo||!this._camInfo.auth)return a;var b=this._camInfo.auth;b=this._decodeXml(b);b=b.replace("@user",this._options.username?encodeURIComponent(this._options.username):"");b=this._options&&"instar"==this._options.manufacturer?b.replace("@pwd",this._options.password?this._options.password:""):b.replace("@pwd",this._options.password?encodeURIComponent(this._options.password):
"");var d="&";-1==a.indexOf("?")&&(d="?");return a+(d+b)};b.prototype._decodeXml=function(a){return a.replace(/&apos;/g,"'").replace(/&quot;/g,'"').replace(/&gt;/g,">").replace(/&lt;/g,"<").replace(/&amp;/g,"&")};b.prototype._doRequest=function(a,b,d,e,f){var c=require("url").parse(a),k=require("http");"https"==a.substring(0,5).toLowerCase()&&(k=require("https"),c.port||(c.port=443));c.port||(c.port=80);var h={host:c.hostname,port:c.port,path:c.path,method:"GET",headers:{"Content-Type":'text/xml; charset="utf-8"',
Connection:"close"}};f?h.headers.Authorization=f:b.user&&(b.password||(b.password=""),h.user=b.user,h.password=b.password,h.headers.Authorization="Basic "+(new Buffer(b.user+":"+b.password)).toString("base64"));d&&(h.method="POST",h.headers["Content-Length"]=d.length);var l=this;c=k.request(h,function(c){c.setEncoding("utf-8");var k="";c.on("data",function(a){k+=a});c.on("end",function(){XC.debugf("response:"+c.statusCode);if(401==c.statusCode&&!f&&c.headers&&c.headers["www-authenticate"]&&"Digest "==
c.headers["www-authenticate"].substr(0,7)){f=null;if(f=require("x.crypt.js").DigestAuth(c.headers["www-authenticate"],h.path,b.user,b.password,h.method)){f+=', opaque=""';XC.debugf("do digest auth:"+f);l._doRequest(a,b,d,e,f);return}var m=Error("http response:"+c.statusCode)}else 200!=c.statusCode&&(m=Error("http response:"+c.statusCode));e&&e(m,k)})});if(c.on)c.on("error",function(a){e&&e(a)});d&&c.write(d);c.end()};b.prototype.snapshot=function(a){this.getVideoInfo(function(b,d){b?a&&a(b):(b={user:d.username,
password:d.password},d.jpeg||d.jpegPath||d.jpegPage?(new xnm.aio.cams.JPEGCam(d.jpeg,b,d.jpegPath,d.jpegPage)).loadImage2Tmp(function(b){b?a&&a(null,b):a&&a(Error("load image error"))}):d.mjpeg?(new xnm.aio.cams.MJPEGCam(d.mjpeg,b)).loadImage2Tmp(function(b){b?a&&a(null,b):a&&a(Error("load image error"))}):a&&a(Error("not support snapshot")))})};b.prototype.equalsTo=function(a){return!(a&&a instanceof b)||this._options&&!a._options||!this._options&&a._options||!this._options&&!a._options?!1:this._options.ip==
a._options.ip&&this._options.port==a._options.port&&this._options.username==a._options.username&&this._options.password==a._options.password&&this._options.type==a._options.type&&this._options.model==a._options.model};return b}();
xnm.aio.cams.DoorBird=function(){DoorBird=function(b,a){xnm.aio.cams.Cam.call(this,b,a);this._logger=require("x.logger.js").getLogger("xnm.aio.cams.DoorBird.["+b.username+"@"+b.ip+"]")};DoorBird.prototype=new xnm.aio.cams.Cam;DoorBird.prototype.constructor=xnm.aio.cams.DoorBird;DoorBird.prototype.getRefId=function(){return this._options.username+":"+this._options.password+"@"+this._options.ip+":"+this._options.port};DoorBird.prototype.executeCommandCreator=function(b,a,c){this.executeCommand(a,c)};
DoorBird.prototype.getStatesCreator=function(b,a,c){this.getStates(function(b,e){var d=[];if(!b&&e)for(b=0;b<a.length;b++)if(a[b]&&a[b].id&&a[b].status&&a[b].status.value){var g=a[b].status.value;null!=e[g]&&"undefined"!=typeof e[g]&&(g=e[g],d.push({id:a[b].id,status:g}))}c&&c(null,d)})};DoorBird.prototype.executeCommand=function(b,a){b&&b.value?"open_app"==b.value||"open_live"==b.value?(window&&window.XC&&window.XC.callHost&&window.XCHost&&window.XCHost.getType&&("iOS"==window.XCHost.getType()||
"Android"==window.XCHost.getType())&&("open_app"==b.value?window.XC.callHost("SYSTEM","startApp",{scheme:"doorbird://"}):(b=this._options.username.substr(0,6),window.XC.callHost("SYSTEM","startApp",{scheme:"doorbird://live/"+b}))),a&&a()):"open_door"==b.value||"open_relay"==b.value||"open_relay_custom"==b.value?this.openDoor(b.ext,a):"light_on"==b.value?this.lightOn(a):a&&a(Error("command unknonw")):a&&a(Error("command invalid"))};DoorBird.prototype.getStates=function(b){this._logger.log("debug",
"get states");var a=require("xnm.aio.cams.js").getDoorBirdHandler(),c=a.getMonitor(this._options);c||(this._logger.log("trace","add monitor"),a._udpMonitor.isRunning()||a.startUdpMonitor(),c=a.addMonitor(this._options));var d={ring:!1,motion:!1,ringT:null,ringTStr:null,motionT:null,motionTStr:null},e=c._stateBuffer;if(e){this._logger.log("debug","buffered states in monitor:"+JSON.stringify(e));a=(new Date).getTime();for(var f in e)(c=e[f])&&c.length&&("motion"==f?1==c[0]&&1E4>=a-c[1]&&(d.motion=!0):
"ring"==f?1==c[0]&&1E4>=a-c[1]&&(d.ring=!0):"ringT"==f?(d.ringT=c[0],d.ringTStr=(new Date(c[0])).toLocaleString()):"motionT"==f&&(d.motionT=c[0],d.motionTStr=(new Date(c[0])).toLocaleString()))}if(d.ringT)this._logger.log("debug","return states:"+JSON.stringify(d)),b&&b(null,d);else{var g=this;this.getHistory("doorbell",1,function(a,c,l){null!=c&&(d.ringT=1E3*c,d.ringTStr=(new Date(1E3*c)).toLocaleString(),e.ringT=[d.ringT]);g._logger.log("debug","return states:"+JSON.stringify(d));b&&b(null,d)})}};
DoorBird.prototype.getInfo=function(b){this._doRequest("/bha-api/info.cgi",function(a,c){if(a)b&&b(a);else try{var d=JSON.parse(c);d&&d.BHA&&d.BHA.VERSION&&d.BHA.VERSION.length&&1==d.BHA.RETURNCODE?b&&b(null,d.BHA.VERSION[0]):b&&b(Error("info response invaild"))}catch(e){b&&b(e)}})};DoorBird.prototype.openDoor=function(b,a){this._logger.log("debug","open door (relay="+b+")");var c="/bha-api/open-door.cgi";b&&(c+="?r="+encodeURIComponent(b));var d=this;this._doRequest(c,function(c,f){d._logger.log("debug",
"open door (relay="+b+")"+(c?" failed:"+c.message:" success"));a&&a(c)})};DoorBird.prototype.lightOn=function(b){this._logger.log("debug","light on");var a=this;this._doRequest("/bha-api/light-on.cgi",function(c,d){a._logger.log("debug","light on"+(c?" failed:"+c.message:" success"));b&&b(c)})};DoorBird.prototype.loadHistoryImage=function(b,a,c){this._logger.log("trace","load image "+a+"@"+b);var d=this._options.ip,e=this._options.port;e||(e=80);d="http://"+d+":"+e+"/bha-api/history.cgi?index="+a+
"&event="+b;this._logger.log("trace","load image: "+d);e={user:this._options.username,password:this._options.password};var f=this;require("xnm.aio.cams.js").createJPEGCam(d,e).loadImage(function(d,k){f._logger.log("trace","load image "+a+"@"+b+" finish: file="+d);c&&c(d,k)})};DoorBird.prototype.getHistory=function(b,a,c){var d=this;this._logger.log("trace","get history "+a+"@"+b);this._doRequest("/bha-api/history.cgi?index="+a+"&event="+b,function(e,f,g){e?(d._logger.log("trace","get history "+a+
"@"+b+" failed:"+e.message),c&&c(e)):(d._logger.log("trace","get history "+a+"@"+b+" headers:"+(g?JSON.stringify(g):"none")),f=e=null,g&&(void 0!=g["x-count"]&&null!=g["x-count"]&&(e=parseInt(g["x-count"])),void 0!=g["x-timestamp"]&&null!=g["x-timestamp"]&&(f=parseInt(g["x-timestamp"]))),c&&c(null,f,e))})};DoorBird.prototype._doRequest=function(b,a){var c=this._options.ip,d=this._options.port;d||(d=80);this._logger.log("trace","send to url:http://"+(c+":"+d+b));b={host:c,port:d,path:b,method:"GET",
headers:{Connection:"close"}};this._options.username&&(this._options.password||(this._options.password=""),b.headers.Authorization="Basic "+(new Buffer(this._options.username+":"+this._options.password)).toString("base64"));var e=require("http").request(b,function(b){b.setEncoding("utf-8");var c="";b.on("data",function(a){c+=a});b.on("end",function(){var d;200!=b.statusCode&&(d=Error("http response:"+b.statusCode));a&&a(d,c,b.headers)})});e.setTimeout&&e.setTimeout(2E3,function(){e.abort()});if(e.on)e.on("error",
function(b){a&&a(b)});e.end()};DoorBird.Handler=function(){var b=function(){this._logger=require("x.logger.js").getLogger("xnm.aio.cams.DoorBird.Handler.NativeDecrypter")};b.prototype.decrypt=function(a,b,c){this._logger.log("trace","decrypt data:"+a);b=b.substr(0,5);var d=this;XC.callHost("doorbird","decryptUdpMessage",{data:a,password:b},function(a){d._logger.log("trace","decrypt result:"+JSON.stringify(a));a?a.error?c&&c(Error(a.error)):c&&c(null,a):c&&c(Error("no reponse from xc doorbird module"))})};
var a=function(){this._logger=require("x.logger.js").getLogger("xnm.aio.cams.DoorBird.Handler.NodeJSDecrypter")};a.prototype.decrypt=function(a,b,c){this._logger.log("trace","decrypt data:"+a.substr(0,10)+"...");var d=parseInt(a.substr(8,8),16),k=parseInt(a.substr(16,8),16),e=new Buffer(a.substr(24,32),"hex"),h=new Buffer(a.substr(56,16),"hex");a=new Buffer(a.substr(72),"hex");b=new Buffer(b.substr(0,5),"utf8");var f=new Buffer(32);var l=require("sodium").api;l.crypto_pwhash_argon2i(f,b,e,d,k,1)?
(k=l.crypto_aead_chacha20poly1305_decrypt(a,null,h,f))?(b=k.slice(0,6).toString("utf8"),d=k.slice(6,14).toString("utf8").trim(),k=k.slice(14,18).readInt32BE(),b={intercom_id:b,event:d,timestamp:k},this._logger.log("trace","decrypt result:"+JSON.stringify(b)),c&&c(null,b)):c&&c(Error("decrypt failed")):c&&c(Error("password hash failed"))};var c=function(){this._logger=require("x.logger.js").getLogger("xnm.aio.cams.DoorBird.Handler.NWJSDecrypter")};c.prototype.decrypt=function(a,b,c){this._logger.log("trace",
"decrypt data:"+a);var d=this,k=parseInt(a.substr(8,8),16),e=parseInt(a.substr(16,8),16),h=new Buffer(a.substr(24,32),"hex"),f=new Buffer(a.substr(56,16),"hex"),l=new Buffer(a.substr(72),"hex");b=new Buffer(b.substr(0,5),"utf8");var g=null,r=new Buffer(32);g=require("libsodium-wrappers");g.ready.catch(function(a){c&&c(a)});g.ready.then(function(){var a=null;try{var m=g.crypto_pwhash(r.length,g.from_string(b.toString("utf8")),h,k,e,g.crypto_pwhash_ALG_ARGON2I13);a=g.crypto_aead_chacha20poly1305_decrypt(null,
l,null,f,m)}catch(t){c&&c(t);return}m=Buffer.from(a.slice(0,6)).toString("utf8");var p=Buffer.from(a.slice(6,14)).toString("utf8").trim();a=Buffer.from(a.slice(14,18)).readInt32BE();a={intercom_id:m,event:p,timestamp:a};d._logger.log("trace","(libsodium-wrappers) decrypt result:"+JSON.stringify(a));c&&c(null,a)})};var d=function(a,b){var c=this._gentId(a);this._logger=require("x.logger.js").getLogger("xnm.aio.cams.DoorBird.HttpMonitor.["+c+"]");this._listener=b;this._doorbird=a;this._running=!1;this._reconnectTO=
this._req=null;this.reconnTimeout=5;this.dataTimeout=30;this._dataTO=null};d.prototype._gentId=function(a){return a.username+"@"+a.ip};d.prototype.start=function(){this._logger.log("debug","start monitor");this._running||(this._running=!0,this._startHttpMonitor())};d.prototype.stop=function(a){this._logger.log("debug","stop monitor");this._running&&(this._running=!1,this._stopHttpMonitor());a&&a(null,!0)};d.prototype.updateIP=function(a){this._stopHttpMonitor();this._doorbird.ip=a;a=this._gentId(this._doorbird);
this._logger=require("x.logger.js").getLogger("xnm.aio.cams.DoorBird.HttpMonitor.["+a+"]");this._startHttpMonitor()};d.prototype._startHttpMonitor=function(){this._logger.log("debug","start http monitor");var a=this._doorbird.ip,b=this._doorbird.port,c=a.indexOf(":");-1==c||b||(b=a.substr(c+1));b||(b=80);var d=this;this._logger.log("trace","send to url:http://"+(a+":"+b+"/bha-api/monitor.cgi?ring=doorbell,motionsensor"));b={host:a,port:b,path:"/bha-api/monitor.cgi?ring=doorbell,motionsensor",method:"GET",
headers:{}};c=this._doorbird.username;var e=this._doorbird.password;c&&(b.auth=c+":"+(e?e:""));var f=!1,g=!1,n=require("http").request(b,function(b){b.setEncoding("utf-8");b.on("data",function(b){f=!0;d._dataTO&&(clearTimeout(d._dataTO),d._dataTO=null);d._dataTO=setTimeout(function(){d._logger.log("warn","monitor data timeout:"+a);n.abort();g||(g=!0,d._onClose(Error("data timeout")))},1E3*d.dataTimeout);d._onData(b)});b.on("end",function(){var a;509==b.statusCode?a=Error("door bird busy"):200!=b.statusCode&&
(a=Error("door bird monitor reutrn http:"+b.statusCode));g||(g=!0,d._onClose(a))})});n.setTimeout(2E3,function(){f||(n.abort(),g||(g=!0,d._onClose(Error("connection timeout"))))});n.on("error",function(a){g||(g=!0,d._onClose(a))});n.end();this._req=n};d.prototype._stopHttpMonitor=function(){this._logger.log("debug","stop http monitor");this._dataTO&&(clearTimeout(this._dataTO),this._dataTO=null);this._req&&this._req.abort()};d.prototype._reconnect=function(){this._logger.log("trace","reconnect monitor in "+
this.reconnTimeout+" s");this._reconnectTO&&(clearTimeout(this._reconnectTO),this._reconnectTO=null);var a=this;this._reconnectTO=setTimeout(function(){a._startHttpMonitor()},1E3*this.reconnTimeout)};d.prototype._onData=function(a){if(this._listener&&this._listener.onHttpData)this._listener.onHttpData(a)};d.prototype._onClose=function(a){this._logger.log("debug","http monitor closed:"+(a?" err: "+a.message:""));this._dataTO&&(clearTimeout(this._dataTO),this._dataTO=null);this._running&&this._reconnect()};
var e=function(a){this._logger=require("x.logger.js").getLogger("xnm.aio.cams.DoorBird.Handler.UdpMonitor");this._sockets=[];this._port=35344;this._running=!1;this._listener=a};e.prototype.start=function(){this._running||(this._running=!0,this._addDiscoverSocket(this._port,null))};e.prototype.isRunning=function(){return this._running};e.prototype._addDiscoverSocket=function(a,b){var c=require("dgram"),d=this;this._logger.log("trace","bind udp monitor on port "+a+(b?" ip "+b.address:""));if(!b){try{var e=
c.createSocket({reuseAddr:!0,type:"udp4"})}catch(q){e=c.createSocket("udp4")}e.on("message",function(a,b){d._receivedData(b.address,a)});e.on("error",function(a){d._logger.log("trace","bind udp monitor error "+a.message)});e.bind(a);this._sockets.push(e)}else if("IPv4"==b.family&&0==b.internal){try{e=c.createSocket({reuseAddr:!0,type:"udp4"})}catch(q){e=c.createSocket("udp4")}e.on("listening",function(){e.setBroadcast(!0)});e.on("message",function(a,b){d._receivedData(b.address,a)});e.on("error",
function(a){d._logger.log("trace","bind udp monitor error "+a.message)});e.bind(a,b.address);this._sockets.push(e)}};e.prototype._receivedData=function(a,b){b=b.toString("hex");this._logger.log("trace","receive data from "+a+" data "+b);if(this._listener&&this._listener.onUdpData)this._listener.onUdpData(a,b)};var f=function(a){var b=a.username+"@"+a.ip;this._logger=require("x.logger.js").getLogger("xnm.aio.cams.DoorBird.Monitor.["+b+"]");this._useHttpMonitor=this._supportHttpMonitor();this._doorbirdJSON=
a;this._httpMonitor=new d(a,this);this._listeners=[];this._stateBuffer={}};f.prototype._supportHttpMonitor=function(){var a=null;window&&!window.XCHost&&(a="node-webkit");window&&window.XCHost&&window.XCHost.getType&&(a=window.XCHost.getType());return"undefined"!==typeof nw?!0:"node-webkit"==a||"undefined"!=typeof process&&null!=process&&"node"==process.title?!0:!1};f.prototype.getRefId=function(){return doorBird.username+":"+doorBird.password+"@"+doorBird.ip+":"+doorBird.port};f.prototype.addListener=
function(a){a&&-1==this._listeners.indexOf(a)&&this._listeners.push(a)};f.prototype.removeListener=function(a){a=this._listeners.indexOf(a);-1!=a&&this._listeners.splice(a,1)};f.prototype.start=function(){this._logger.log("debug","start monitor");this._running||(this._running=!0,this._useHttpMonitor&&this._httpMonitor.start())};f.prototype.stop=function(){this._logger.log("debug","stop monitor");this._running&&(this._running=!1,this._listeners=[],this._useHttpMonitor&&this._httpMonitor.stop())};f.prototype.updateDoorbird=
function(a){if(this._doorbirdJSON&&this._doorbirdJSON.mac&&this._doorbirdJSON.mac==a.mac&&this._doorbirdJSON.ip!=a.ip){this._logger.log("debug","doorbird has new ip:"+a.ip);var b=this._doorbirdJSON.username+"@"+a.ip;this._logger=require("x.logger.js").getLogger("xnm.aio.cams.DoorBird.Monitor.["+b+"]");this._useHttpMonitor&&this._httpMonitor.updateIP(a.ip)}};f.prototype.onHttpData=function(a){this._logger.log("trace","receive notify:"+a.replace(/(\r\n|\n|\r)/gm,"\\n "));var b=a.indexOf("doorbell:"),
c=null,d=null;-1!=b&&(c=a.substr(b+9,1),c="H"==c?!0:!1);b=a.indexOf("motionsensor:");-1!=b&&(d=a.substr(b+13,1),d="H"==d?!0:!1);this._logger.log("debug","receive http event: ring="+c+" motion="+d);null!=d&&this._onEvent("motion",d);null!=c&&this._onEvent("ring",c)};f.prototype.onUdpData=function(a,b){this._logger.log("trace","decrypt udp data");var c=this._doorbirdJSON;if(c&&c.password){var d=this._getDecrypter();if(d){var e=this;d.decrypt(a,c.password,function(a,d){e._logger.log("trace","decrypt data "+
(a?"failed: "+a.message:"success"));!a&&d&&(c.username&&c.username.indexOf(d.intercom_id),e._logger.log("debug","receive udp event: "+JSON.stringify(d)),"motionsensor"==d.event||"motion"==d.event?e._onEvent("motion",!0):isNaN(parseInt(d.event))||e._onEvent("ring",!0));b&&b(a,d)})}else this._logger.log("trace","decrypt data failed: can not find decrypter"),b&&b(Error("can not find decrypter"))}else this._logger.log("trace","decrypt data failed: no password"),b&&b(Error("no password"))};f.prototype._onEvent=
function(a,b){var c=(new Date).getTime();this._stateBuffer[a]=[b,c];"ring"==a&&1==b?this._stateBuffer.ringT=[c]:"motion"==a&&1==b&&(this._stateBuffer.motionT=[c]);for(c=0;c<this._listeners.length;c++){var d=this._listeners[c];if(d.onEvent)try{d.onEvent(a,b)}catch(m){}}};f.prototype._getDecrypter=function(){var d=null;window&&!window.XCHost&&(d="node-webkit");window&&window.XCHost&&window.XCHost.getType&&(d=window.XCHost.getType());return"undefined"!==typeof nw?new c:"node-webkit"==d||"undefined"!=
typeof process&&null!=process&&"node"==process.title?new a:new b};var g=function(){this._logger=require("x.logger.js").getLogger("xnm.aio.cams.DoorBird.Handler");this._udpMonitor=new e(this);this._monitors={}};g.prototype.finalize=function(){for(var a in this._monitors){var b=this._monitors[a];b&&b.stop()}this._monitors={}};g.prototype.startUdpMonitor=function(){this._udpMonitor.start()};g.prototype.addMonitor=function(a){if(a){var b=a.username+":"+a.password+"@"+a.ip,c=this._monitors[b];if(c)throw Error("monitor already exit");
c=new f(JSON.parse(JSON.stringify(a)));this._monitors[b]=c;c.start();return c}};g.prototype.removeMonitor=function(a){if(a){a=a.username+":"+a.password+"@"+a.ip;var b=this._monitors[a];b&&(b.stop(),delete this._monitors[a])}};g.prototype.getMonitor=function(a){return a?this._monitors[a.username+":"+a.password+"@"+a.ip]:null};g.prototype.onUdpData=function(a,b){if(b&&"DEADBE"==b.substr(0,6).toUpperCase()&&"01"==b.substr(6,2)){var c=Object.keys(this._monitors);if(c.length){var d=0,e=this,f=function(){d++;
if(d<c.length)e._monitors[c[d]].onUdpData(b,f)};this._monitors[c[d]].onUdpData(b,f)}}};return g}();return DoorBird}();xnm.aio.cams.Foscam=function(b,a){xnm.aio.cams.Cam.call(this,b,a);this._logger=require("x.logger.js").getLogger("xnm.aio.cams.Foscam")};xnm.aio.cams.Foscam.prototype=new xnm.aio.cams.Cam;xnm.aio.cams.Foscam.prototype.constructor=xnm.aio.cams.Foscam;
xnm.aio.cams.Foscam.prototype.executeCommandCreator=function(b,a,c){a?"gotoPreset"==a.value?this._gotoPreset(b,a,c):this.executeCommand(a.value,c):c&&c(Error("command invalid"))};
xnm.aio.cams.Foscam.prototype._gotoPreset=function(b,a,c){if("undefined"==typeof a.ext||null==a.ext)c&&c(Error("command ext invalid"));else if(this._camInfo&&this._camInfo.controlurl){var d;b=this._decodeXml(this._camInfo.controlurl);"/cgi-bin/CGIProxy.fcgi?cmd=%@"==b?d="ptzGotoPresetPoint&name="+encodeURIComponent(a.ext):"/web/cgi-bin/hi3510/%@"==b&&(d="preset.cgi?-act=goto&-number="+encodeURIComponent(a.ext));d?(a=this.getRootUrl()+b.replace("%@",d),a=this._addAuth(a),this._doRequest(a,{user:this._options.username,
password:this._options.password},null,function(a,b){c&&c(a,b)})):c&&c(Error("unknow preset command"))}else c&&c(Error("no control url"))};xnm.aio.cams.Welcome=function(b,a){xnm.aio.cams.Cam.call(this,b,a);this._logger=require("x.logger.js").getLogger("xnm.aio.cams.Welcome")};xnm.aio.cams.Welcome.prototype=new xnm.aio.cams.Cam;xnm.aio.cams.Welcome.prototype.constructor=xnm.aio.cams.Welcome;
xnm.aio.cams.Welcome.prototype.getVideoInfo=function(b){var a=require("xnm.aio.netatmo.js");a?(a=a.resolveGateway({refreshToken:this._options.refreshToken}))?a.getCamUrl(this._options.address,function(a,d){a?b&&b(a):(a={hls:d},b&&b(null,a))}):b&&b(Error("netatmo cam info invalid")):b&&b(Error("netatmo module not loaded"))};xnm.aio.cams.Mobotix=function(b,a){xnm.aio.cams.Cam.call(this,b,a);this._logger=require("x.logger.js").getLogger("xnm.aio.cams.Mobotix")};xnm.aio.cams.Mobotix.prototype=new xnm.aio.cams.Cam;
xnm.aio.cams.Mobotix.prototype.constructor=xnm.aio.cams.Mobotix;
xnm.aio.cams.Mobotix.prototype.executeCommandCreator=function(b,a,c){if(a)if("gotoPreset"==a.value||"displayMode"==a.value||"customCMD"==a.value)if("undefined"==typeof a.ext||null==a.ext)c&&c(Error("command ext invalid"));else{if("gotoPreset"==a.value){if(!this._camInfo||!this._camInfo.controlurl){c&&c(Error("no control url"));return}a="loadview="+encodeURIComponent(a.ext);b=this._decodeXml(this._camInfo.controlurl);var d=b.replace("%@",a)}else if("displayMode"==a.value)switch(b="/control/control?set&section=general&display_mode=",
a.ext){case "Full Image":d=b+"simple";break;case "Normal":d=b+"lenscorr_l11";break;case "Surround":d=b+"surround";break;case "Panorama":d=b+"panorama";break;case "Panorama/Focus":d=b+"pano_focus";break;case "Double Panorama":d=b+"pano_dbl"}else d=a.ext;d&&this._sendRequest(d,function(a,b){c&&c(a,b)})}else this.executeCommand(a.value,c);else c&&c(Error("command invalid"))};
xnm.aio.cams.Mobotix.prototype._gotoPreset=function(b,a,c){"undefined"==typeof a.ext||null==a.ext?c&&c(Error("command ext invalid")):this._camInfo&&this._camInfo.controlurl?(b="loadview="+encodeURIComponent(a.ext),b=this._decodeXml(this._camInfo.controlurl).replace("%@",b),this._sendRequest(b,function(a,b){c&&c(a,b)})):c&&c(Error("no control url"))};
xnm.aio.cams.Mobotix.prototype._sendRequest=function(b,a){b=this.getRootUrl()+b;b=this._addAuth(b);this._doRequest(b,{user:this._options.username,password:this._options.password},null,function(b,d){a&&a(b,d)})};xnm.aio.cams.Axis=function(b,a){xnm.aio.cams.Cam.call(this,b,a);this._logger=require("x.logger.js").getLogger("xnm.aio.cams.Mobotix")};xnm.aio.cams.Axis.prototype=new xnm.aio.cams.Cam;xnm.aio.cams.Axis.prototype.constructor=xnm.aio.cams.Axis;
xnm.aio.cams.Axis.prototype.executeCommandCreator=function(b,a,c){a?"playClip"==a.value?this._playClip(b,a,c):"lightOn"==a.value||"lightOff"==a.value?this._setLight(b,a,c):"actOut"==a.value||"deactOut"==a.value?this._setOutput(b,a,c):this.executeCommand(a.value,c):c&&c(Error("command invalid"))};
xnm.aio.cams.Axis.prototype._playClip=function(b,a,c){"undefined"==typeof a.ext||null==a.ext?c&&c(Error("command ext invalid")):(b="/axis-cgi/playclip.cgi?clip="+a.ext,b=this.getRootUrl()+b,b=this._addAuth(b),this._doRequest(b,{user:this._options.username,password:this._options.password},null,function(a,b){c&&c(a,b)}))};
xnm.aio.cams.Axis.prototype._setOutput=function(b,a,c){if("undefined"==typeof a.ext||null==a.ext)c&&c(Error("command ext invalid"));else{b=a.ext;var d="\\";"actOut"==a.value&&(d="/");a="/axis-cgi/io/port.cgi?action="+encodeURIComponent(b+":"+d);a=this.getRootUrl()+a;a=this._addAuth(a);this._doRequest(a,{user:this._options.username,password:this._options.password},null,function(a,b){c&&c(a,b)})}};
xnm.aio.cams.Axis.prototype._setLight=function(b,a,c){a.value?(b="0","lightOn"==a.value&&(b="100"),a="/axis-cgi/io/lightcontrol.cgi?action=L1:-"+b,a=this.getRootUrl()+a,a=this._addAuth(a),this._doRequest(a,{user:this._options.username,password:this._options.password},null,function(a,b){c&&c(a,b)})):c&&c(Error("command ext invalid"))};
xnm.aio.cams.CAM_INFO={telefunken:{name:"Telefunken",versions:[{id:"XS100",name:"XS100",imageurl:"/snapshot.cgi",mjpegurl:"/videostream.cgi",controlurl:"/decoder_control.cgi?command=%@&amp;onestep=1",auth:"user=@user&amp;pwd=@pwd",pantilt:"true",link:"telefunken.XS100",keys:[{id:"left",code:"4&amp;degree=18"},{id:"right",code:"6&amp;degree=18"},{id:"up",code:"0&amp;degree=15"},{id:"down",code:"2&amp;degree=15"},{id:"switchOn",code:"94"},{id:"switchOff",code:"95"}]}]},konine:{name:"Konine",versions:[{id:"konine",
name:"Konine IP Cam",imageurl:"/snapshot.cgi",mjpegurl:"/videostream.cgi",controlurl:"/decoder_control.cgi?command=%@",auth:"user=@user&amp;pwd=@pwd",pantilt:"true",link:"konine.konine",keys:[{id:"left",code:"4&amp;onestep=1"},{id:"right",code:"6&amp;onestep=1"},{id:"up",code:"0&amp;onestep=1"},{id:"down",code:"2&amp;onestep=1"},{id:"switchOn",code:"94&amp;onestep=1"},{id:"switchOff",code:"95&amp;onestep=1"},{id:"call1",code:"31&amp;onestep=0"},{id:"call2",code:"33&amp;onestep=0"},{id:"call3",code:"35&amp;onestep=0"},
{id:"call4",code:"37&amp;onestep=0"},{id:"call5",code:"39&amp;onestep=0"},{id:"call6",code:"41&amp;onestep=0"},{id:"call7",code:"43&amp;onestep=0"},{id:"call8",code:"45&amp;onestep=0"},{id:"call9",code:"47&amp;onestep=0"},{id:"call10",code:"49&amp;onestep=0"},{id:"call11",code:"51&amp;onestep=0"},{id:"call12",code:"53&amp;onestep=0"},{id:"call13",code:"55&amp;onestep=0"},{id:"call14",code:"57&amp;onestep=0"},{id:"call15",code:"59&amp;onestep=0"},{id:"call16",code:"61&amp;onestep=0"}]}]},abus:{name:"ABUS",
versions:[{id:"tv7204",name:"TV7204",pantilt:"false",link:"dlink.2000"}]},"7links":{name:"7Links",versions:[{id:"PX3615675",name:"PX-3615-675",link:"telefunken.XS100",pantilt:"true"},{id:"robocam1",name:"Robocam 1",imageurl:"/IMAGE.JPG",controlurl:"/PANTILTCONTROL.CGI",controlpostdata:"PanSingleMoveDegree=1&amp;TiltSingleMoveDegree=1&amp;PanTiltSingleMove=%@",pantilt:"true",link:"7links.robocam1",keys:[{id:"left",code:"3"},{id:"right",code:"2"},{id:"up",code:"1"},{id:"down",code:"7"},{id:"home",code:"4"}]},
{id:"robocam2",name:"Robocam 2",imageurl:"/cgi/jpg/image.cgi",controlurl:"/users/ptctl.cgi?move=%@",pantilt:"true",link:"7links.robocam2",keys:[{id:"left",code:"left"},{id:"right",code:"right"},{id:"up",code:"up"},{id:"down",code:"down"},{id:"home",code:"h"}]},{id:"730hd",name:"IPC-730HD",imageurl:"/cgi-bin/CGIProxy.fcgi?cmd=snapPicture2",auth:"usr=@user&amp;pwd=@pwd",pantilt:"false",link:"7links.730hd"},{id:"730hd2",name:"IPC-730HD 2",imagepageurl:"/cgi-bin/CGIProxy.fcgi?cmd=snapPicture2",auth:"usr=@user&amp;pwd=@pwd",
pantilt:"false",link:"7links.730hd2"},{id:"770hd",name:"IPC-770HD",imageurl:"/cgi-bin/video_snapshot.cgi",mjpegurl:"/cgi-bin/videostream.cgi",controlurl:"/cgi-bin/decoder_control.cgi?type=0&amp;cmd=%@&amp;onestep=1",auth:"user=@user&amp;pwd=@pwd",link:"7links.770hd",pantilt:"true",keys:[{id:"left",code:"2"},{id:"right",code:"3"},{id:"up",code:"0"},{id:"down",code:"1"}]},{id:"vga",name:"Generic Type",link:"telefunken.XS100",pantilt:"true"},{id:"hd",name:"Generic Type HD",link:"7links.770hd",pantilt:"true"}]},
dlink:{name:"D-Link",versions:[{id:"dcs930",name:"DCS-930L",imageurl:"/image.jpg",mjpegurl:"/video.cgi",useurlauth:"true",link:"dlink.dcs930"},{id:"dcs942",name:"DCS-942L",imageurl:"/image/jpeg.cgi",mjpegurl:"/video/mjpg.cgi",useurlauth:"true",link:"dlink.dcs942"},{id:"2000",name:"DCS-2000",imageurl:"/cgi-bin/video.jpg?size=2",controlurl:"/cgi-bin/camctrl.cgi?%@",pantilt:"true",link:"dlink.2000",keys:[{id:"home",code:"move=home"},{id:"left",code:"move=left"},{id:"right",code:"move=right"},{id:"up",
code:"move=up"},{id:"down",code:"move=down"},{id:"tele",code:"zoom=tele"},{id:"wide",code:"zoom=wide"}]},{id:"dcs2132",name:"DCS-2132L",imageurl:"/dms?nowprofileid=2",useurlauth:"true",link:"dlink.dcs2132"},{id:"dcs935",name:"DCS-935L",link:"dlink.dcs942",pantilt:"false"},{id:"dcs5222",name:"DCS-5222L",imageurl:"/image/jpeg.cgi",mjpegurl:"/video/mjpg.cgi",controlurl:"/cgi/ptdc.cgi?%@",pantilt:"true",link:"dlink.dcs5222",keys:[{id:"home",code:"command=go_home"},{id:"left",code:"command=set_relative_pos&posX=-10&posY=0"},
{id:"right",code:"command=set_relative_pos&posX=10&posY=0"},{id:"up",code:"command=set_relative_pos&posX=0&posY=10"},{id:"down",code:"command=set_relative_pos&posX=0&posY=-10 "}]}]},hama:{name:"Hama",versions:[{id:"hwlancam",name:"WLAN IP",link:"telefunken.XS100",pantilt:"false"}]},nueva:{name:"Nueva",versions:[{id:"nueva",name:"NVI Camera",link:"telefunken.XS100",pantilt:"true"},{id:"hd",name:"NVI HD Camera",imageurl:"/snapshot.cgi",mjpegurl:"/videostream.cgi",controlurl:"/decoder_control.cgi?command=%@&amp;onestep=1",
auth:"loginuse=@user&amp;loginpas=@pwd",pantilt:"true",link:"nueva.hd",keys:[{id:"left",code:"4&amp;degree=18"},{id:"right",code:"6&amp;degree=18"},{id:"up",code:"0&amp;degree=15"},{id:"down",code:"2&amp;degree=15"}]},{id:"hd_new",name:"NVI New HD Camera",link:"nueva.hd_new",imageurl:"/tmpfs/snap.jpg",controlurl:"/cgi-bin/hi3510/%@",auth:"user=@user&amp;pwd=@pwd",pantilt:"true",keys:[{id:"move_left",code:"ptzctrl.cgi?-step=0&amp;-act=left"},{id:"move_right",code:"ptzctrl.cgi?-step=0&amp;-act=right"},
{id:"move_up",code:"ptzctrl.cgi?-step=0&amp;-act=up"},{id:"move_down",code:"ptzctrl.cgi?-step=0&amp;-act=down"},{id:"stop",code:"ptzctrl.cgi?-step=0&amp;-act=stop"},{id:"step_left",code:"ptzctrl.cgi?-step=1&amp;-act=left"},{id:"step_right",code:"ptzctrl.cgi?-step=1&amp;-act=right"},{id:"step_up",code:"ptzctrl.cgi?-step=1&amp;-act=up"},{id:"step_down",code:"ptzctrl.cgi?-step=1&amp;-act=down"},{id:"home",code:"ptzctrl.cgi?-step=0&amp;-act=home"},{id:"horizontal_scan",code:"ptzctrl.cgi?-step=0&amp;-act=hscan"},
{id:"vertical_scan",code:"ptzctrl.cgi?-step=0&amp;-act=vscan"},{id:"position_0",code:"preset.cgi?-act=goto&amp;-status=1&amp;-number=0"},{id:"position_1",code:"preset.cgi?-act=goto&amp;-status=1&amp;-number=1"},{id:"position_2",code:"preset.cgi?-act=goto&amp;-status=1&amp;-number=2"},{id:"position_3",code:"preset.cgi?-act=goto&amp;-status=1&amp;-number=3"},{id:"position_4",code:"preset.cgi?-act=goto&amp;-status=1&amp;-number=4"},{id:"position_5",code:"preset.cgi?-act=goto&amp;-status=1&amp;-number=5"},
{id:"position_6",code:"preset.cgi?-act=goto&amp;-status=1&amp;-number=6"},{id:"position_7",code:"preset.cgi?-act=goto&amp;-status=1&amp;-number=7"}]}]},instar:{name:"INSTAR",versions:[{id:"vga",name:"Generic VGA Cam",imageurl:"/snapshot.cgi",mjpegurl:"/videostream.cgi",controlurl:"/decoder_control.cgi?command=%@",auth:"-usr=@user&amp;-pwd=@pwd",pantilt:"true",link:"instar.vga",keys:[{id:"left",code:"4&amp;onestep=1"},{id:"right",code:"6&amp;onestep=1"},{id:"up",code:"0&amp;onestep=1"},{id:"down",
code:"2&amp;onestep=1"},{id:"home",code:"25"}]},{id:"hd",name:"Generic HD Cam",link:"instar.hd",imageurl:"/tmpfs/snap.jpg",mjpegurl:"/cgi-bin/hi3510/mjpegstream.cgi?-chn=11",controlurl:"/cgi-bin/hi3510/%@",auth:"-usr=@user&amp;-pwd=@pwd",pantilt:"true",keys:[{id:"move_left",code:"ptzctrl.cgi?-step=0&amp;-act=left"},{id:"move_right",code:"ptzctrl.cgi?-step=0&amp;-act=right"},{id:"move_up",code:"ptzctrl.cgi?-step=0&amp;-act=up"},{id:"move_down",code:"ptzctrl.cgi?-step=0&amp;-act=down"},{id:"stop",code:"ptzctrl.cgi?-step=0&amp;-act=stop"},
{id:"step_left",code:"ptzctrl.cgi?-step=1&amp;-act=left"},{id:"step_right",code:"ptzctrl.cgi?-step=1&amp;-act=right"},{id:"step_up",code:"ptzctrl.cgi?-step=1&amp;-act=up"},{id:"step_down",code:"ptzctrl.cgi?-step=1&amp;-act=down"},{id:"home",code:"ptzctrl.cgi?-step=0&amp;-act=home"},{id:"horizontal_scan",code:"ptzctrl.cgi?-step=0&amp;-act=hscan"},{id:"vertical_scan",code:"ptzctrl.cgi?-step=0&amp;-act=vscan"},{id:"position_0",code:"preset.cgi?-act=goto&amp;-status=1&amp;-number=0"},{id:"position_1",
code:"preset.cgi?-act=goto&amp;-status=1&amp;-number=1"},{id:"position_2",code:"preset.cgi?-act=goto&amp;-status=1&amp;-number=2"},{id:"position_3",code:"preset.cgi?-act=goto&amp;-status=1&amp;-number=3"},{id:"position_4",code:"preset.cgi?-act=goto&amp;-status=1&amp;-number=4"},{id:"position_5",code:"preset.cgi?-act=goto&amp;-status=1&amp;-number=5"},{id:"position_6",code:"preset.cgi?-act=goto&amp;-status=1&amp;-number=6"},{id:"position_7",code:"preset.cgi?-act=goto&amp;-status=1&amp;-number=7"}]},
{id:"IN-3010",name:"IN-3010",link:"telefunken.XS100",pantilt:"true"},{id:"IN-6012",name:"IN-6012 HD",imageurl:"/tmpfs/snap.jpg",controlurl:"/cgi-bin/hi3510/%@",auth:"usr=@user&amp;pwd=@pwd",pantilt:"true",link:"instar.IN-6012",keys:[{id:"move_left",code:"ptzctrl.cgi?-step=0&amp;-act=left"},{id:"move_right",code:"ptzctrl.cgi?-step=0&amp;-act=right"},{id:"move_up",code:"ptzctrl.cgi?-step=0&amp;-act=up"},{id:"move_down",code:"ptzctrl.cgi?-step=0&amp;-act=down"},{id:"stop",code:"ptzctrl.cgi?-step=0&amp;-act=stop"},
{id:"step_left",code:"ptzctrl.cgi?-step=1&amp;-act=left"},{id:"step_right",code:"ptzctrl.cgi?-step=1&amp;-act=right"},{id:"step_up",code:"ptzctrl.cgi?-step=1&amp;-act=up"},{id:"step_down",code:"ptzctrl.cgi?-step=1&amp;-act=down"},{id:"home",code:"ptzctrl.cgi?-step=0&amp;-act=home"},{id:"horizontal_scan",code:"ptzctrl.cgi?-step=0&amp;-act=hscan"},{id:"vertical_scan",code:"ptzctrl.cgi?-step=0&amp;-act=vscan"},{id:"position_0",code:"preset.cgi?-act=goto&amp;-status=1&amp;-number=0"},{id:"position_1",
code:"preset.cgi?-act=goto&amp;-status=1&amp;-number=1"},{id:"position_2",code:"preset.cgi?-act=goto&amp;-status=1&amp;-number=2"},{id:"position_3",code:"preset.cgi?-act=goto&amp;-status=1&amp;-number=3"},{id:"position_4",code:"preset.cgi?-act=goto&amp;-status=1&amp;-number=4"},{id:"position_5",code:"preset.cgi?-act=goto&amp;-status=1&amp;-number=5"},{id:"position_6",code:"preset.cgi?-act=goto&amp;-status=1&amp;-number=6"},{id:"position_7",code:"preset.cgi?-act=goto&amp;-status=1&amp;-number=7"}]},
{id:"IN-8015",name:"IN-8015 Full HD",link:"instar.hd",pantilt:"true"},{id:"IN-9008",name:"IN-9008 Full HD",link:"instar.hd",pantilt:"false"}]},foscam:{name:"Foscam",versions:[{id:"fi8904W",name:"FI8904W",link:"telefunken.XS100",pantilt:"false"},{id:"fi8620",name:"FI8620",imageurl:"/tmpfs/snap.jpg",controlurl:"/web/cgi-bin/hi3510/%@",pantilt:"true",link:"foscam.fi8620",keys:[{id:"left",code:"ytleft.cgi"},{id:"right",code:"ytright.cgi"},{id:"up",code:"ytup.cgi"},{id:"down",code:"ytdown.cgi"}],command:[{type:"int",
name:"go to preset",ref:{value:"gotoPreset",ext:"%d"}}]},{id:"fi8602",name:"FI8602",link:"foscam.fi8620",pantilt:"false"},{id:"fi8919W",name:"FI8919W",imageurl:"/snapshot.cgi",mjpegurl:"/videostream.cgi",controlurl:"/decoder_control.cgi?command=%@&amp;onestep=1",auth:"user=@user&amp;pwd=@pwd",pantilt:"true",link:"foscam.fi8919W",keys:[{id:"left",code:"6&amp;degree=18"},{id:"right",code:"4&amp;degree=18"},{id:"up",code:"0&amp;degree=15"},{id:"down",code:"2&amp;degree=15"},{id:"switchOn",code:"94"},
{id:"switchOff",code:"95"}]},{id:"fi9826w",name:"FI9826W",pantilt:"true",link:"foscam.fi9900p"},{id:"fi9831w",name:"FI9831W",pantilt:"true",link:"foscam.fi9900p"},{id:"fi9831p",name:"FI9831P V2",imageurl:"/cgi-bin/CGIProxy.fcgi?cmd=snapPicture2",mjpegurl:"/cgi-bin/CGIStream.cgi?cmd=GetMJStream",controlurl:"/cgi-bin/CGIProxy.fcgi?cmd=%@",stop:"ptzStopRun",auth:"usr=@user&amp;pwd=@pwd",pantilt:"true",link:"foscam.fi9831p",keys:[{id:"left",code:"ptzMoveLeft"},{id:"topLeft",code:"ptzMoveTopLeft"},{id:"right",
code:"ptzMoveRight"},{id:"topRight",code:"ptzMoveTopRight"},{id:"bottomLeft",code:"ptzMoveBottomLeft"},{id:"bottomRight",code:"ptzMoveBottomRight"},{id:"up",code:"ptzMoveUp"},{id:"down",code:"ptzMoveDown"},{id:"reset",code:"ptzReset"},{id:"zoomIn",code:"zoomIn"},{id:"zoomOut",code:"zoomOut"},{id:"zoomStop",code:"zoomStop"}],command:[{type:"string",name:"go to preset",ref:{value:"gotoPreset",ext:"%s"}}]},{id:"fi9900p",name:"FI9900P",imageurl:"/cgi-bin/CGIProxy.fcgi?cmd=snapPicture2",controlurl:"/cgi-bin/CGIProxy.fcgi?cmd=%@",
stop:"ptzStopRun",auth:"usr=@user&amp;pwd=@pwd",pantilt:"false",link:"foscam.fi9900p",keys:[{id:"left",code:"ptzMoveLeft"},{id:"topLeft",code:"ptzMoveTopLeft"},{id:"right",code:"ptzMoveRight"},{id:"topRight",code:"ptzMoveTopRight"},{id:"bottomLeft",code:"ptzMoveBottomLeft"},{id:"bottomRight",code:"ptzMoveBottomRight"},{id:"up",code:"ptzMoveUp"},{id:"down",code:"ptzMoveDown"},{id:"reset",code:"ptzReset"},{id:"zoomIn",code:"zoomIn"},{id:"zoomOut",code:"zoomOut"},{id:"zoomStop",code:"zoomStop"}],command:[{type:"string",
name:"go to preset",ref:{value:"gotoPreset",ext:"%s"}}]},{id:"c1",name:"C1",pantilt:"false",link:"foscam.fi9900p"},{id:"c2",name:"C2",pantilt:"false",link:"foscam.fi9900p"},{id:"r2",name:"R2",pantilt:"true",link:"foscam.fi9900p"},{id:"fi86xx",name:"Generic FI86xx Series",pantilt:"true",link:"foscam.fi8620"},{id:"mjpeg",name:"Generic MJPEG Series",pantilt:"true",link:"foscam.fi8919W"},{id:"h264",name:"Generic H.264 Series",pantilt:"true",link:"foscam.fi9900p"}]},edimax:{name:"Edimax",versions:[{id:"3010",
name:"IC-3010 Series",imageurl:"/jpg/image.jpg",pantilt:"false",link:"edimax.3010"},{id:"7010",name:"IC-7010 Series",imageurl:"/jpg/image.jpg",mjpegurl:"/mjpg/video.mjpg",controlurl:"/camera-cgi/com/ptz.cgi",controlpostdata:"%@",pantilt:"true",useurlauth:"true",link:"edimax.7010",keys:[{id:"home",code:"move=center"},{id:"left",code:"move=left"},{id:"right",code:"move=right"},{id:"up",code:"move=up"},{id:"down",code:"move=down"},{id:"preset0",code:"gotoserverpresetIndex=0"},{id:"preset1",code:"gotoserverpresetIndex=1"},
{id:"preset2",code:"gotoserverpresetIndex=2"},{id:"preset3",code:"gotoserverpresetIndex=3"},{id:"preset4",code:"gotoserverpresetIndex=4"}]},{id:"3030",name:"IC-3030 Series",pantilt:"false",link:"edimax.7010"},{id:"3110",name:"IC-3110 Series",pantilt:"false",link:"edimax.7010"},{id:"3115",name:"IC-3115 Series",pantilt:"false",link:"edimax.7010"},{id:"3116",name:"IC-3116 Series",pantilt:"false",link:"edimax.7010"},{id:"5150w",name:"IC-5150W",pantilt:"false",link:"edimax.7010"},{id:"3140",name:"IC-3140 Series",
pantilt:"false",link:"edimax.7010"},{id:"7001",name:"IC-7001 Series",imageurl:"/jpg/image.jpg",mjpegurl:"/mjpg/video.mjpg",controlurl:"/camera-cgi/com/ptz.cgi",controlpostdata:"%@",pantilt:"true",useurlauth:"true",link:"edimax.7001",keys:[{id:"home",code:"move=center"},{id:"left",code:"move=left"},{id:"right",code:"move=right"},{id:"up",code:"move=up"},{id:"down",code:"move=down"},{id:"preset0",code:"gotopresetIndex=0"},{id:"preset1",code:"gotopresetIndex=1"},{id:"preset2",code:"gotopresetIndex=2"},
{id:"preset3",code:"gotopresetIndex=3"},{id:"preset4",code:"gotopresetIndex=4"}]},{id:"7100",name:"IC-7100 Series",pantilt:"true",link:"edimax.7010"},{id:"7110",name:"IC-7110 Series",pantilt:"true",link:"edimax.7010"},{id:"7112",name:"IC-7112 Series",pantilt:"true",link:"edimax.7001"},{id:"7112w",name:"IC-7112W",pantilt:"true",link:"edimax.7001"},{id:"7113",name:"IC-7113 Series",pantilt:"true",link:"edimax.7001"},{id:"9110",name:"IC-9110 Series",pantilt:"true",link:"edimax.7010"},{id:"9110w",name:"IC-9110W",
pantilt:"false",link:"edimax.7010"},{id:"type1",name:"Generic Type 1 (no PTZ)",pantilt:"false",link:"edimax.3010"},{id:"type2",name:"Generic Type 2 (PTZ)",pantilt:"true",link:"edimax.7001"},{id:"type3",name:"Generic Type 3 (PTZ)",pantilt:"true",link:"edimax.7010"}]},digitus:{name:"DIGITUS",versions:[{id:"plugandview",name:"Plug&View",imagepathurl:"/web/cgi-bin/hi3510/snap.cgi",stop:"ptzstop.cgi",controlurl:"/cgi-bin/hi3510/%@",pantilt:"true",link:"digitus.plugandview",keys:[{id:"left",code:"ptzleft.cgi"},
{id:"right",code:"ptzright.cgi"},{id:"up",code:"ptzup.cgi"},{id:"down",code:"ptzdown.cgi"},{id:"home",code:"ptzgotopoint.cgi?&amp;-chn=0&amp;-point=1"}]}]},doorbird:{name:"DoorBird",versions:[{id:"doorbird",name:"DoorBird",imageurl:"/bha-api/video.cgi",mjpegurl:"/bha-api/video.cgi",controlurl:"/bha-api/%@",pantilt:"true",useurlauth:"true",link:"doorbird.doorbird",keys:[{id:"open_door",code:"open-door.cgi"},{id:"light_on",code:"light-on.cgi"}],command:[{type:"string",name:"open relay (custom)",ref:{value:"open_relay_custom",
ext:"%s"}}],status:[{type:"enum",name:"door bell ring",ref:{value:"ring",options:["true","false"]}},{type:"enum",name:"motion detect",ref:{value:"motion",options:["true","false"]}},{type:"int",name:"last ring timestamp",ref:{value:"ringT"}},{type:"string",name:"last ring time",ref:{value:"ringTStr"}}],ipevt:[{type:"enum",name:"door bell ring",ref:{value:"ring",options:["true"]}},{type:"enum",name:"motion detect",ref:{value:"motion",options:["true"]}}]}]},mobotix:{name:"MOBOTIX",versions:[{id:"general",
name:"General Camera",imageurl:"/record/current.jpg",mjpegurl:"/cgi-bin/faststream.jpg?needlength&fps=0",controlurl:"/control/click.cgi?%@",pantilt:"true",link:"mobotix.general",keys:[{id:"up",code:"moverel&x=0&y=50"},{id:"down",code:"moverel&x=0&y=-50"},{id:"left",code:"moverel&x=-50&y=0"},{id:"right",code:"moverel&x=50&y=0"},{id:"center",code:"center"},{id:"zoomIn",code:"zoomrel=-200"},{id:"zoomOut",code:"zoomrel=200"},{id:"1xZoom",code:"zoom=0"}],command:[{type:"int",name:"go to preset",ref:{value:"gotoPreset",
ext:"%d",extExtra:"1-127"}},{type:"enum",name:"display mode",ref:{value:"displayMode",ext:"%e",extMeta:"Full Image;Normal;Surround;Panorama;Panorama/Focus;Double Panorama".split(";")}},{type:"string",name:"custom command",ref:{value:"customCMD",ext:"%s"}}]}]},axis:{name:"Axis",versions:[{id:"212",name:"212 PTZ",link:"axis.ptz",pantilt:"true"},{id:"215",name:"215 PTZ",link:"axis.ptz",pantilt:"true"},{id:"m10",name:"M10 Series",link:"axis.general",pantilt:"true"},{id:"m1054",name:"M1054",link:"axis.ptz",
pantilt:"true"},{id:"m11",name:"M11 Series",link:"axis.ptz",pantilt:"true"},{id:"m3014",name:"M3014",link:"axis.ptz",pantilt:"true"},{id:"m32",name:"M32 Series",link:"axis.ptz",pantilt:"true"},{id:"m50",name:"M50 Series",link:"axis.ptz",pantilt:"true"},{id:"p1311",name:"P1311",link:"axis.ptz",pantilt:"false"},{id:"p1346",name:"P1346 Series",link:"axis.ptz",pantilt:"true"},{id:"p1347",name:"P1347 Series",link:"axis.ptz",pantilt:"true"},{id:"q1755",name:"Q 1755 Series",link:"axis.ptz",pantilt:"true"},
{id:"p33",name:"P33 Series",link:"axis.ptz",pantilt:"true"},{id:"q6034",name:"Q6034",link:"axis.ptz",pantilt:"true"},{id:"ptz",name:"General (PTZ)",imageurl:"/jpg/image.jpg",mjpegurl:"/mjpg/video.mjpg",controlurl:"/axis-cgi/com/ptz.cgi?camera=1&amp;%@",useurlauth:"true",pantilt:"true",link:"axis.ptz",keys:[{id:"home",code:"move=home"},{id:"left",code:"move=left"},{id:"right",code:"move=right"},{id:"up",code:"move=up"},{id:"down",code:"move=down"},{id:"tele",code:"rzoom=1000"},{id:"wide",code:"rzoom=-1000"}],
command:[{type:"enum",name:"light on",ref:{value:"lightOn"}},{type:"enum",name:"light off",ref:{value:"lightOff"}},{type:"int",name:"play clip",ref:{value:"playClip",ext:"%d"}},{type:"int",name:"activate output ",ref:{value:"actOut",ext:"%d"}},{type:"int",name:"deactivate output ",ref:{value:"deactOut",ext:"%d"}}]},{id:"general",name:"General",imageurl:"/jpg/image.jpg",mjpegurl:"/mjpg/video.mjpg",controlurl:"/axis-cgi/com/ptz.cgi?camera=1&amp;%@",useurlauth:"true",link:"axis.general",pantilt:"true",
command:[{type:"enum",name:"light on",ref:{value:"lightOn"}},{type:"enum",name:"light off",ref:{value:"lightOff"}},{type:"int",name:"play clip",ref:{value:"playClip",ext:"%d"}},{type:"int",name:"activate output ",ref:{value:"actOut",ext:"%d"}},{type:"int",name:"deactivate output ",ref:{value:"deactOut",ext:"%d"}}]}]},generic:{name:"Generic IP Camera",versions:[{id:"type1",name:"Type 1",link:"telefunken.XS100",pantilt:"false"},{id:"type2",name:"Type 2 (PTZ)",link:"telefunken.XS100",pantilt:"true"},
{id:"type3",name:"Type 3 (PTZ)",link:"konine.konine",pantilt:"true"},{id:"type4",name:"Type 4",link:"dlink.2000",pantilt:"false"},{id:"type5",name:"Type 5 (PTZ)",link:"7links.770hd",pantilt:"true"},{id:"type6",name:"Type 6",link:"dlink.dcs930",pantilt:"false"},{id:"type7",name:"Type 7",link:"dlink.dcs942",pantilt:"false"},{id:"type8",name:"Type 8 (PTZ)",link:"dlink.2000",pantilt:"true"},{id:"type9",name:"Type 9",link:"dlink.dcs2132",pantilt:"false"},{id:"type10",name:"Type 10 (PTZ)",link:"nueva.hd",
pantilt:"true"},{id:"type11",name:"Type 11 (PTZ)",link:"instar.vga",pantilt:"true"},{id:"type12",name:"Type 12 (PTZ)",link:"instar.hd",pantilt:"true"},{id:"type13",name:"Type 13 (PTZ)",pantilt:"true",link:"foscam.fi8620"},{id:"type14",name:"Type 14 (PTZ)",pantilt:"true",link:"foscam.fi8919W"},{id:"type15",name:"Type 15 (PTZ)",pantilt:"true",link:"foscam.fi9826w"},{id:"type16",name:"Type 16",pantilt:"false",link:"edimax.3010"},{id:"type17",name:"Type 17 (PTZ)",pantilt:"true",link:"edimax.7001"},{id:"type18",
name:"Type 18 (PTZ)",pantilt:"true",link:"edimax.7010"},{id:"type19",name:"Type 19 (PTZ)",pantilt:"true",link:"digitus.plugandview"},{id:"type20",name:"Type 20 (PTZ)",pantilt:"true",link:"doorbird.doorbird"},{id:"type21",name:"Type 21 (PTZ)",pantilt:"true",link:"mobotix.general"}]}};
xnm.aio.cams.DM=function(){var b=function(a,b){this.code=a;this.message=b;this.stack=Error().stack};b.prototype=Error();b.prototype.name="CamDMError";b.prototype.code=0;b.ERROR_CODE={DEFAULT:0,INDEX_EXISTS:1,ID_EXISTS:2,INVALID:3,UNKNOW:4,NOT_FOUND:5,IP_EXISTS:6};return{SYS:"cam",getIPDeviceType:function(a,b){var c=[],e;for(e in xnm.aio.cams.CAM_INFO)if(xnm.aio.cams.CAM_INFO.hasOwnProperty(e)){var f=xnm.aio.cams.CAM_INFO[e];if((!(b&&b.lm&&b.license)||b.lm.permitFeature("read",{sys:this.SYS,type:"system",
manufacturer:e},b.license))&&f.name){var g={category:"system",type:e,name:f.name,versions:[]};if(f.versions)for(var k=0;k<f.versions.length;k++){var h=f.versions[k];h&&h.id&&h.name&&g.versions.push({model:h.id,name:h.name,link:h.link})}c.push(g)}}if(a&&(a=a.getIPCams()))for(e=0;e<a.length;e++)if(g=a[e],(f=$(g).getAttributes())&&f.id&&f.name&&!xnm.aio.cams.CAM_INFO[f.id]&&(!(b&&b.lm&&b.license)||b.lm.permitFeature("read",{sys:this.SYS,type:"custom",manufacturer:f.id},b.license))&&(f={category:"custom",
type:f.id,name:f.name,versions:[]},c.push(f),g=$(g).children()))for(k=0;k<g.length;k++)(h=$(g[k]).getAttributes())&&h.id&&h.name&&f.versions.push({model:h.id,name:h.name});return[{sys:this.SYS,name:"IP Camera",types:c}]},createDevice:function(a,c,d){c=b.ERROR_CODE;a?a.type?a.ip?d(null,a):d(new b(c.INVALID,"ip is invalid")):d(new b(c.INVALID,"type is invalid")):d(new b(c.INVALID,"info is invalid"))},updateDevice:function(a,c,d){c=b.ERROR_CODE;a?a.type?a.ip?d(null,a):d(new b(c.INVALID,"ip is invalid")):
d(new b(c.INVALID,"type is invalid")):d(new b(c.INVALID,"info is invalid"))},deleteDevice:function(a,b,d){d()},applyUIFilter:function(a,b,d){var c=function(a,b){if("*"==a)return!0;for(var c=!1,d=0;d<a.length;d++)if(a[d]==b){c=!0;break}return c},f=function(a,b,d){var e=[];switch(d.catagory){case "command":a.command&&a.command.forEach(function(a){c(d.elems,a.type)&&(a=JSON.parse(JSON.stringify(a)),e.push(a))});break;case "status":a.status&&a.status.forEach(function(a){c(d.elems,a.type)&&(a=JSON.parse(JSON.stringify(a)),
e.push(a))})}return e},g=function(a,b){var c=[],e=xnm.aio.cams.DM.getCommandStatusMap(a,d);e&&(a=f(e,a,b),c=c.concat(a));return c};if(!a.sys)return null;var k=JSON.parse(JSON.stringify(a)),h=null;switch(b.catagory){case "command":h=g(a,b);k.command=h;break;case "status":h=g(a,b);k.status=h;break;default:return null}return h&&0!=h.length?k:null},applyNeoServerFilter:function(a,b,d){var c=function(a,b){if("*"==a)return!0;for(var c=!1,d=0;d<a.length;d++)if(a[d]==b){c=!0;break}return c},f=function(a,
b,d){var e=[];switch(d.catagory){case "command":a.command&&a.command.forEach(function(a){c(d.elems,a.type)&&(a=JSON.parse(JSON.stringify(a)),e.push(a))});break;case "status":a.status&&a.status.forEach(function(a){c(d.elems,a.type)&&(a=JSON.parse(JSON.stringify(a)),e.push(a))})}return e},g=function(a,b){var c=[],e=xnm.aio.cams.DM.getNeoServerCommandStatusMap(a,d);e&&(a=f(e,a,b),c=c.concat(a));return c};if(!a.sys)return null;var k=JSON.parse(JSON.stringify(a)),h=null;switch(b.catagory){case "command":h=
g(a,b);k.command=h;break;case "status":h=g(a,b);k.status=h;break;default:return null}return h&&0!=h.length?k:null},applyIPEventFilter:function(a,b,d){return(a=this.getCamInfo(a,d))&&a.ipevt?{ipevt:a.ipevt}:null},getCamInfo:function(a,b){var c=function(a,b){for(var c in a)a.hasOwnProperty(c)&&(b[c]=a[c]);return b},e=function(a){var b=a.type;"tfcam"==a.type&&(b="telefunken");b=xnm.aio.cams.CAM_INFO[b];if(!b)return null;for(var d,f=0;f<b.versions.length;f++){var g=b.versions[f];if(g&&g.id==a.model){d=
g;break}}if(!d)return null;if(!d.link||d.link==a.type+"."+a.model)return d;a=d.link.indexOf(".");a=e({type:d.link.substr(0,a),model:d.link.substr(a+1)});if(!a)return null;a=JSON.parse(JSON.stringify(a));return c(d,a)},f=function(a,b){var d,g=b.find('cam[id="'+a.type+'"]');g&&0<g.length&&(d=g[0]);if(!d)return null;d=$(d).find('version[id="'+a.model+'"]');if(!d||0==d.length)return null;d=d[0];g=$(d).attr("link");if(!g||g==a.type+"."+a.model){d=$(d);b=d.getAttributes();b=JSON.parse(JSON.stringify(b));
d=d.children();for(a=0;a<d.length;a++){var h=$(d[a]);h&&(g=h.attr("id"),h=h.attr("code"),g&&h&&(b.keys||(b.keys=[]),b.keys.push({id:g,code:h})))}return b}a=g.indexOf(".");if(h=e({type:g.substr(0,a),model:g.substr(a+1)}))return b=JSON.parse(JSON.stringify(h)),c(d,b);h=f({type:g.substr(0,a),model:g.substr(a+1)},b);if(!h)return null;b=JSON.parse(JSON.stringify(h));return c(d,b)};if(!a.type||!a.model)return null;"system"!=a.type&&"custom"!=a.type||!a.manufacturer||(a=JSON.parse(JSON.stringify(a)),a.type=
a.manufacturer);var g=e(a);!g&&b&&(g=f(a,b));return g},getCommandStatusMap:function(a,b){b=this.getCamInfo(a,b);if(!b||!b.pantilt||"false"==b.pantilt)return null;var c={command:[]};if(b.keys)for(var e=0;e<b.keys.length;e++){var f=b.keys[e];c.command.push({type:"enum",name:f.id,ref:{value:f.id}})}b.command&&(c.command=c.command.concat(b.command));b.status&&(c.status=b.status);"system"==a.type&&"doorbird"==a.manufacturer&&(a.relays&&a.relays.length&&c.command.push({type:"enum",name:"open relay",ref:{value:"open_relay",
ext:"%e",extMeta:a.relays}}),c.command.push({type:"enum",name:"open doorbird app",ref:{value:"open_app"}}),c.command.push({type:"enum",name:"open liveview",ref:{value:"open_live"}}));return c},getNeoServerCommandStatusMap:function(a,b){b={command:[]};if(a&&"system"==a.type&&("doorbird"==a.manufacturer||"doorbird"==a.type)&&"doorbird"==a.model||a&&"system"==a.type&&("netatmo"==a.manufacturer||"netatmo"==a.type))return b;b.command.push({type:"enum",name:"take snapshot",ref:{value:"snapshot"}});return b}}}();
xnm.aio.cams.Handler=function(){var b=function(){var a=require("x.logger.js");xnm.aio.cams.DM._logger=a?a.getLogger("xnm.aio.cams.DM"):{log:function(){}};this._foscamDiscovery=null;this._doorbirdHandler=new xnm.aio.cams.DoorBird.Handler};b.prototype.devicemanager=xnm.aio.cams.DM;b.prototype.registModule=function(a){a.register(xnm.aio.cams.DM.SYS,"cams")};b.prototype.resolveDevice=function(a,b){b=xnm.aio.cams.DM.getCamInfo(a,b);return!a||"system"!=a.type||"doorbird"!=a.manufacturer&&"doorbird"!=a.type||
"doorbird"!=a.model?!a||"system"!=a.type||"foscam"!=a.manufacturer&&"foscam"!=a.type?!a||"system"!=a.type||"netatmo"!=a.manufacturer&&"netatmo"!=a.type?!a||"system"!=a.type||"mobotix"!=a.manufacturer&&"mobotix"!=a.type?!a||"system"!=a.type||"axis"!=a.manufacturer&&"axis"!=a.type?new xnm.aio.cams.Cam(a,b):new xnm.aio.cams.Axis(a,b):new xnm.aio.cams.Mobotix(a,b):new xnm.aio.cams.Welcome(a,b):new xnm.aio.cams.Foscam(a,b):new xnm.aio.cams.DoorBird(a,b)};b.prototype.getCamJPEGUrl=function(a,b,d){b=xnm.aio.cams.DM.getCamInfo(a,
b);a=new xnm.aio.cams.Cam(a,b);var c=d,f=a.getJPEGURL(function(a){f||a?c&&c(null,a):c&&c(Error("cam has no jpeg url"))});f&&(c&&c(null,{url:f}),c=null)};b.prototype.getCamMJPEGUrl=function(a,b,d){b=xnm.aio.cams.DM.getCamInfo(a,b);a=(new xnm.aio.cams.Cam(a,b)).getMJPEGURL();d&&d(a?null:Error("cam has no mjpeg url"),{url:a})};b.prototype.getCamVideoInfo=function(a,b,d){(a=this.resolveDevice(a,b))?a.getVideoInfo(d):d&&d(Error("no such camera"))};b.prototype.getDeviceCommands=function(a,b){a=(a=xnm.aio.cams.DM.applyUIFilter(a,
{catagory:"command",elems:"*"}))?a.command:[];b&&b(null,a)};b.prototype.getDeviceStatus=function(a,b){a=(a=xnm.aio.cams.DM.applyUIFilter(a,{catagory:"status",elems:"*"}))?a.status:[];b&&b(null,a)};b.prototype.doCommand=function(a,b,d,e){(d=this.resolveDevice(a,d))?d.executeCommandCreator(a,b,e):e&&e(Error("device json format invalid"))};b.prototype.doStatus=function(a,b,d,e){var c=this.resolveDevice(b);c?c.getStatesCreator(null,[{id:a,device:b,status:d}],function(a,b){a?e&&e(a):e&&e(null,b)}):e&&
e(Error("device json format invalid"))};b.prototype.listSystemCam=function(a){var b=xnm.aio.cams.DM.getIPDeviceType();b=b?b:[];a&&a(null,b)};b.prototype.createJPEGCam=function(a,b,d,e){return b&&b._extra&&"system"==b._extra.type&&"doorbird"==b._extra.manufacturer&&"doorbird"==b._extra.model&&b._mjpegurl?new xnm.aio.cams.MJPEGCam(b._mjpegurl,b):new xnm.aio.cams.JPEGCam(a,b,d,e)};b.prototype.createSystemCam=function(a,b){return new xnm.aio.cams.SystemCam(a,b)};b.prototype.detectCams=function(){this._foscamDiscovery||
(this._foscamDiscovery=new xnm.aio.cams.FoscamDiscovery);this._foscamDiscovery.discoverCams()};b.prototype.getDoorBirdHandler=function(){return this._doorbirdHandler};b.prototype.discoverDoorbird=function(a,b){var c=this,e=require("x.mdns.js");e.clearRecordBuffer();e.discoverServiceWithTimeout("_axis-video._tcp.local",a,function(a,d){if(a)b&&b(a);else{a=[];for(var e=0;e<d.length;e++){var f=d[e];if(f.domain&&"Doorstation"==f.domain.substr(0,11)&&f.ip&&0<f.ip.length){var g={sys:"cam",type:"system",
manufacturer:"doorbird",ip:f.ip[0],port:80};f.info&&f.info.macaddress&&(g.mac=f.info.macaddress);(f=c.resolveDevice(g))&&a.push(f)}}b&&b(null,a)}})};b.prototype.finalize=function(a){this._doorbirdHandler&&this._doorbirdHandler.finalize();a&&a()};b.prototype.pause=function(a){this.finalize(a)};return b}();"undefined"!=typeof module&&null!=module&&(module.exports=new xnm.aio.cams.Handler);
