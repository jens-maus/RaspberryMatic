var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.arrayIteratorImpl=function(e){var b=0;return function(){return b<e.length?{done:!1,value:e[b++]}:{done:!0}}};$jscomp.arrayIterator=function(e){return{next:$jscomp.arrayIteratorImpl(e)}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;$jscomp.ISOLATE_POLYFILLS=!1;$jscomp.FORCE_POLYFILL_PROMISE=!1;$jscomp.FORCE_POLYFILL_PROMISE_WHEN_NO_UNHANDLED_REJECTION=!1;
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(e,b,a){if(e==Array.prototype||e==Object.prototype)return e;e[b]=a.value;return e};$jscomp.getGlobal=function(e){e=["object"==typeof globalThis&&globalThis,e,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global];for(var b=0;b<e.length;++b){var a=e[b];if(a&&a.Math==Math)return a}throw Error("Cannot find global object");};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.IS_SYMBOL_NATIVE="function"===typeof Symbol&&"symbol"===typeof Symbol("x");$jscomp.TRUST_ES6_POLYFILLS=!$jscomp.ISOLATE_POLYFILLS||$jscomp.IS_SYMBOL_NATIVE;$jscomp.polyfills={};$jscomp.propertyToPolyfillSymbol={};$jscomp.POLYFILL_PREFIX="$jscp$";var $jscomp$lookupPolyfilledValue=function(e,b){var a=$jscomp.propertyToPolyfillSymbol[b];if(null==a)return e[b];a=e[a];return void 0!==a?a:e[b]};
$jscomp.polyfill=function(e,b,a,c){b&&($jscomp.ISOLATE_POLYFILLS?$jscomp.polyfillIsolated(e,b,a,c):$jscomp.polyfillUnisolated(e,b,a,c))};$jscomp.polyfillUnisolated=function(e,b,a,c){a=$jscomp.global;e=e.split(".");for(c=0;c<e.length-1;c++){var d=e[c];if(!(d in a))return;a=a[d]}e=e[e.length-1];c=a[e];b=b(c);b!=c&&null!=b&&$jscomp.defineProperty(a,e,{configurable:!0,writable:!0,value:b})};
$jscomp.polyfillIsolated=function(e,b,a,c){var d=e.split(".");e=1===d.length;c=d[0];c=!e&&c in $jscomp.polyfills?$jscomp.polyfills:$jscomp.global;for(var f=0;f<d.length-1;f++){var g=d[f];if(!(g in c))return;c=c[g]}d=d[d.length-1];a=$jscomp.IS_SYMBOL_NATIVE&&"es6"===a?c[d]:null;b=b(a);null!=b&&(e?$jscomp.defineProperty($jscomp.polyfills,d,{configurable:!0,writable:!0,value:b}):b!==a&&(void 0===$jscomp.propertyToPolyfillSymbol[d]&&($jscomp.propertyToPolyfillSymbol[d]=$jscomp.IS_SYMBOL_NATIVE?$jscomp.global.Symbol(d):
$jscomp.POLYFILL_PREFIX+d),$jscomp.defineProperty(c,$jscomp.propertyToPolyfillSymbol[d],{configurable:!0,writable:!0,value:b})))};$jscomp.initSymbol=function(){};
$jscomp.polyfill("Symbol",function(e){if(e)return e;var b=function(d,f){this.$jscomp$symbol$id_=d;$jscomp.defineProperty(this,"description",{configurable:!0,writable:!0,value:f})};b.prototype.toString=function(){return this.$jscomp$symbol$id_};var a=0,c=function(d){if(this instanceof c)throw new TypeError("Symbol is not a constructor");return new b("jscomp_symbol_"+(d||"")+"_"+a++,d)};return c},"es6","es3");
$jscomp.polyfill("Symbol.iterator",function(e){if(e)return e;e=Symbol("Symbol.iterator");for(var b="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),a=0;a<b.length;a++){var c=$jscomp.global[b[a]];"function"===typeof c&&"function"!=typeof c.prototype[e]&&$jscomp.defineProperty(c.prototype,e,{configurable:!0,writable:!0,value:function(){return $jscomp.iteratorPrototype($jscomp.arrayIteratorImpl(this))}})}return e},"es6",
"es3");$jscomp.iteratorPrototype=function(e){e={next:e};e[Symbol.iterator]=function(){return this};return e};$jscomp.iteratorFromArray=function(e,b){e instanceof String&&(e+="");var a=0,c=!1,d={next:function(){if(!c&&a<e.length){var f=a++;return{value:b(f,e[f]),done:!1}}c=!0;return{done:!0,value:void 0}}};d[Symbol.iterator]=function(){return d};return d};$jscomp.polyfill("Array.prototype.keys",function(e){return e?e:function(){return $jscomp.iteratorFromArray(this,function(b){return b})}},"es6","es3");
var xnm=xnm||{};xnm.aio=xnm.aio||{};xnm.aio.hautau=xnm.aio.hautau||{};
xnm.aio.hautau.Gateway=function(){var e=function(b,a){this._logger="undefined"==typeof require||null==require?{log:function(){}}:require("x.logger.js").getLogger("xnm.aio.hautau.Gateway");this.ip=b;this.port=a;this.port||(this.port=80);this.timeout=1E3;this._statesBuffer={};this._fifo=[]};e.DEVICETYPE_MAP={0:"general",1:"multisensor",2:"outputbox203v",4:"general",5:"ventra",6:"general",7:"general",8:"general",9:"drive",10:"general",11:"general",100:"general",101:"ska20cd",102:"drive",103:"hscd",104:"general",
105:"ventra2",106:"drive",107:"general",108:"general",255:"general"};e.prototype.executeCommandCreator=function(b,a,c){if(a&&a.value)if(b)if("undefined"==typeof b.address||null==b.address)c&&c(Error("device json format invali"));else switch(a.value){case "open":this._open(b.address,c);break;case "close":this._close(b.address,c);break;case "stop":this._stop(b.address,c);break;case "levelUp":this._setVentraLevel(b.address,"up",c);break;case "levelDown":this._setVentraLevel(b.address,"down",c);break;
case "levelTo":this._setVentraLevel(b.address,a.ext,c);break;case "keyboardOn":this._setVentraKeyboard(b.address,"on",c);break;case "keyboardOff":this._setVentraKeyboard(b.address,"off",c);break;case "lockOn":this._setHscdLock(b.address,"on",c);break;case "lockOff":this._setHscdLock(b.address,"off",c);break;default:c&&c(Error("command not exist"))}else c&&c(Error("device json is null"));else c&&c(Error("command json format invalid"))};e.prototype.getStatesCreator=function(b,a,c){for(var d={},f=0;f<
a.length;f++)(b=a[f])&&b.device&&"undefined"!=typeof b.device.address&&null!=b.device.address&&b.device.type&&(d[b.device.address]=b.device.type);var g=[],h=this,l=Object.keys(d);f=0;var q=function(n,k){if(!n&&k){n=l[f];if(k){for(var m=[],r=0;r<a.length;r++){var p=a[r];if(p&&p.id&&p.device&&p.device.address&&p.device.address==n&&p.status&&p.status.value){var t=k[p.status.value];"undefined"!=typeof t&&null!=t&&m.push({id:p.id,status:t})}}k=m}else k=[];k&&(g=g.concat(k))}f++;f<l.length?h._getDeviceStates(l[f],
d[l[f]],q):c&&c(null,g)};this._getDeviceStates(l[f],d[l[f]],q)};e.prototype.listDevices=function(b,a){var c=this,d=!1,f=0,g=30;if("object"===typeof b&&null!==b){var h=Number(b.start),l=Number(b.end),q=b.custom||null;q&&0<q.length&&(d=!0);d?f=q[0]:(!isNaN(h)&&0<=h&&255>=h&&(f=h),!isNaN(l)&&0<=l&&255>=l&&(g=l),g<f&&(g=f))}var n=f,k=0,m=[],r=function(p,t){p&&-3!=p.code?f==n&&5>k?(k++,c._ping(f,r)):a&&a(p,m):(!p&&t&&(t.sys="hautau",t.type=t.DeviceType,t.address=f,m.push(t)),d?(q.shift(),f=q[0],0==q.length?
a&&a(null,m):c._ping(f,r)):(f++,f>g?a&&a(null,m):c._ping(f,r)))};this._ping(f,r)};e.prototype._getDeviceStates=function(b,a,c){var d=(new Date).getTime(),f=!1,g=this._statesBuffer[b];g?g.timestamp&&3E3<d-g.timestamp&&(f=!0,g.timestamp=d):(f=!0,this._statesBuffer[b]={states:null,timestamp:d},g=this._statesBuffer[b]);a=e.DEVICETYPE_MAP[a];if("undefined"==typeof a||null==a)c&&c(Error("unknown device type"));else if(f){var h=this;this.getDeviceStates(b,a,function(l,q){!l&&q&&(h._statesBuffer[b]={states:q,
timestamp:(new Date).getTime()});c&&c(l,q)})}else c&&c(null,g.states)};e.prototype.getDeviceStates=function(b,a,c){switch(a){case "drive":this._getDriveStates(b,function(d,f){c&&c(d,f)});break;case "multisensor":this._getMultiSensorStates(b,function(d,f){c&&c(d,f)});break;case "ska20cd":this._getSka20cdStates(b,function(d,f){c&&c(d,f)});break;case "ventra":case "ventra2":this._getVentraStates(b,function(d,f){c&&c(d,f)});break;case "hscd":case "hscdi":this._getHscdStates(b,function(d,f){c&&c(d,f)});
break;default:c&&c(null,null)}};e.prototype._open=function(b,a){this._executeRequest("/hautau/open",{adr:b},null,function(c,d){a&&a(c,d)})};e.prototype._close=function(b,a){this._executeRequest("/hautau/close",{adr:b},null,function(c,d){a&&a(c,d)})};e.prototype._stop=function(b,a){this._executeRequest("/hautau/stop",{adr:b},null,function(c,d){a&&a(c,d)})};e.prototype._getDriveStates=function(b,a){this._executeRequest("/hautau/drive",{adr:b,state:"show"},null,function(c,d){c?a&&a(c,d):(c={Closed:"yes"==
d.Closed,Opened:"yes"==d.Opened,PowerCutoff:"yes"==d.PowerCutoff,State:"yes"==d.Closed?"closed":"open"},a&&a(null,c))})};e.prototype._getMultiSensorStates=function(b,a){this._executeRequest("/hautau/multisensor",{adr:b,state:"show"},null,function(c,d){c?a&&a(c,d):(d.Temperature=d.Temperature.toFixed(1),a&&a(null,d))})};e.prototype._getSka20cdStates=function(b,a){this._executeRequest("/hautau/ska20cd",{adr:b,state:"show"},null,function(c,d){c?a&&a(c,d):(c={Closed:"yes"==d.Closed,Opened:"yes"==d.Opened,
PowerCutoff:"yes"==d.PowerCutoff,State:"yes"==d.Closed?"closed":"open"},a&&a(null,c))})};e.prototype._getVentraStates=function(b,a){this._executeRequest("/hautau/ventra",{adr:b,state:"show"},null,function(c,d){c?a&&a(c,d):(d.FilterChange="yes"==d.FilterChange,a&&a(null,d))})};e.prototype._setVentraLevel=function(b,a,c){var d=this;a||(a=0);this._executeRequest("/hautau/ventra",{adr:b,level:a},null,function(f,g){if(f)c&&c(f,g);else{if("undefined"!=typeof g.Level&&null!=g.Level){f=(new Date).getTime();
var h=d._statesBuffer[b];h||(d._statesBuffer[b]={states:{},timestamp:f},h=d._statesBuffer[b]);h.states.Level=g.Level}c&&c(null,g)}})};e.prototype._setVentraKeyboard=function(b,a,c){var d=this;this._executeRequest("/hautau/ventra",{adr:b,keyboard:a},null,function(f,g){if(f)c&&c(f,g);else{if("undefined"!=typeof g.Keyboard&&null!=g.Keyboard){f=(new Date).getTime();var h=d._statesBuffer[b];h||(d._statesBuffer[b]={states:{},timestamp:f},h=d._statesBuffer[b]);h.states.Keyboard=g.Keyboard}c&&c(null,g)}})};
e.prototype._getHscdStates=function(b,a){this._executeRequest("/hautau/hscd",{adr:b,state:"show"},null,function(c,d){c?a&&a(c,d):(d.WindowDown="yes"==d.WindowDown,d.WindowClosed="yes"==d.WindowClosed,d.State=d.WindowClosed?"closed":"open",a&&a(null,d))})};e.prototype._setHscdLock=function(b,a,c){var d=this;this._executeRequest("/hautau/hscd",{adr:b,lock:a},null,function(f,g){if(f)c&&c(f,g);else if("undefined"!=typeof g.Lock&&null!=g.Lock){f=(new Date).getTime();var h=d._statesBuffer[b];h||(d._statesBuffer[b]=
{states:{},timestamp:f},h=d._statesBuffer[b]);h.states.Lock=g.Lock;c&&c(null,g)}})};e.prototype._ping=function(b,a){this._executeRequest("/hautau/ping",{adr:b},2E3,a)};e.prototype._executeRequest=function(b,a,c,d){var f=this._fifo.length;this._fifo.push({path:b,params:a,timeout:c,callback:d});0==f&&this._doNextRequest()};e.prototype._doNextRequest=function(){if(0!=this._fifo.length){var b=this._fifo[0],a=this;this._doJsonRequest(b.path,b.params,b.timeout,function(c,d){try{b.callback&&b.callback(c,
d)}catch(f){}a._fifo.splice(0,1);a._doNextRequest()})}};e.prototype._doJsonRequest=function(b,a,c,d){this._doRequest("GET",b,a,c,function(f,g){if(f)d&&d(f);else if(g)try{var h=JSON.parse(g);"ok"!=h.Result?(f=Error(h.Result?h.Result:"result param is empty"),f.code=-3,d&&d(f)):d&&d(null,h)}catch(l){l.code=-2,d&&d(l)}else f=Error("request empty"),f.code=-2,d&&d(f)})};e.prototype._doRequest2=function(b,a,c,d,f){d||(d=this.timeout);var g=this;a="http://"+this.ip+":"+this.port+a;if(c){var h=[],l;for(l in c){var q=
c[l];if("undefined"==typeof q||null==q)q="";h.push(l+"="+encodeURIComponent(q))}a+="?"+h.join("&")}this._logger.log("trace","send "+b+" to url:"+a);var n=f;$.ajax({url:a,type:b,timeout:d,dataType:"text",cache:!0,success:function(k){g._logger.log("trace","http request success:"+k);n&&(n(null,k),n=null)},error:function(k,m){k="http request error:"+(k?k.status:"0")+"-"+m;g._logger.log("trace",k);n&&(k=Error(k),k.code=-1,n(k),n=null)}})};e.prototype._doRequest=function(b,a,c,d,f){d||(d=this.timeout);
var g=this;if(c){var h=[],l;for(l in c){var q=c[l];if("undefined"==typeof q||null==q)q="";h.push(l+"="+encodeURIComponent(q))}a+="?"+h.join("&")}this._logger.log("trace","send "+b+" to url: http://"+this.ip+":"+this.port+a);b={host:this.ip,port:this.port,path:a,method:b,headers:{"Content-Type":'application/json; charset="UTF-8"',"User-Agent":"mediola",Connection:"close"},timeout:d};var n=f,k=require("http").request(b,function(m){m.setEncoding("utf-8");var r="";m.on("data",function(p){r+=p});m.on("end",
function(){g._logger.log("trace","http response "+m.statusCode+": "+r);if(200==m.statusCode)n&&n(null,r);else{var p=Error("http response "+m.statusCode);p.code=-1;n&&n(p)}n=null})});k.on("timeout",function(){g._logger.log("trace","http request timeout");if(n){var m=Error("http request timeout");m.code=-1;n(m);n=null}k.abort()});k.on("error",function(m){g._logger.log("trace","http request error:"+m.message);n&&(n(m),n=null)});k.end()};e.prototype.toJSON=function(){return{sys:"hautau",ip:this.ip,port:this.port}};
e.prototype.equalsTo=function(b){return b&&b instanceof e?this.ip==b.ip&&this.port==b.port:!1};e.parseJSON=function(b){return b.ip?new e(b.ip,b.port):null};return e}();
xnm.aio.hautau.DM=function(){var e=function(a,c){this.code=a;this.message=c;this.stack=Error().stack};e.prototype=Error();e.prototype.name="HautauDMError";e.prototype.code=0;e.ERROR_CODE={DEFAULT:0,INDEX_EXISTS:1,ID_EXISTS:2,INVALID:3,UNKNOW:4,NOT_FOUND:5,IP_EXISTS:6};var b={general:{command:[{type:"enum",name:"open",ref:{value:"open"}},{type:"enum",name:"close",ref:{value:"close"}},{type:"enum",name:"stop",ref:{value:"stop"}}]},outputbox203v:{command:[{type:"enum",name:"open",ref:{value:"open"}},
{type:"enum",name:"close",ref:{value:"close"}},{type:"enum",name:"stop",ref:{value:"stop"}}]},multisensor:{status:[{type:"int",name:"co2",ref:{value:"CO2"}},{type:"float",name:"temperature",ref:{value:"Temperature"}},{type:"int",name:"humidity",ref:{value:"Humidity"}}]},drive:{command:[{type:"enum",name:"open",ref:{value:"open"}},{type:"enum",name:"close",ref:{value:"close"}},{type:"enum",name:"stop",ref:{value:"stop"}}],status:[{type:"enum",name:"power cutoff",ref:{value:"PowerCutoff",options:["true",
"false"]}},{type:"enum",name:"opened",ref:{value:"Opened",options:["true","false"]}},{type:"enum",name:"closed",ref:{value:"Closed",options:["true","false"]}},{type:"enum",name:"state",ref:{value:"State",options:["open","closed"]}}]},ska20cd:{command:[{type:"enum",name:"open",ref:{value:"open"}},{type:"enum",name:"close",ref:{value:"close"}},{type:"enum",name:"stop",ref:{value:"stop"}}],status:[{type:"enum",name:"power cutoff",ref:{value:"PowerCutoff",options:["true","false"]}},{type:"enum",name:"opened",
ref:{value:"Opened",options:["true","false"]}},{type:"enum",name:"closed",ref:{value:"Closed",options:["true","false"]}},{type:"enum",name:"state",ref:{value:"State",options:["open","closed"]}}]},ventra:{command:[{type:"int",name:"set level",ref:{value:"levelTo",ext:"%d",extMeta:"0-3"}},{type:"enum",name:"level up",ref:{value:"levelUp"}},{type:"enum",name:"level down",ref:{value:"levelDown"}}],status:[{type:"enum",name:"error",ref:{value:"Errors",options:"no temperature fan1 fan2 keyboard opened".split(" ")}},
{type:"enum",name:"change filter",ref:{value:"FilterChange",options:["true","false"]}},{type:"int",name:"filter percent",ref:{value:"FilterPercent",extMeta:"0-100"}},{type:"int",name:"level0 runtime",ref:{value:"RuntimeLevel0"}},{type:"int",name:"level1 runtime",ref:{value:"RuntimeLevel1"}},{type:"int",name:"level2 runtime",ref:{value:"RuntimeLevel2"}},{type:"int",name:"level3 runtime",ref:{value:"RuntimeLevel3"}},{type:"int",name:"level",ref:{value:"Level",extMeta:"0-4"}},{type:"enum",name:"keyboard",
ref:{value:"Keyboard",options:["on","off"]}}]},ventra2:{command:[{type:"int",name:"set level",ref:{value:"levelTo",ext:"%d",extMeta:"0-5"}},{type:"enum",name:"level up",ref:{value:"levelUp"}},{type:"enum",name:"level down",ref:{value:"levelDown"}}],status:[{type:"enum",name:"error",ref:{value:"Errors",options:"no temperature fan1 fan2 keyboard opened humidity".split(" ")}},{type:"enum",name:"change filter",ref:{value:"FilterChange",options:["true","false"]}},{type:"int",name:"filter percent",ref:{value:"FilterPercent",
extMeta:"0-100"}},{type:"int",name:"level0 runtime",ref:{value:"RuntimeLevel0"}},{type:"int",name:"level1 runtime",ref:{value:"RuntimeLevel1"}},{type:"int",name:"level2 runtime",ref:{value:"RuntimeLevel2"}},{type:"int",name:"level3 runtime",ref:{value:"RuntimeLevel3"}},{type:"int",name:"level",ref:{value:"Level",extMeta:"0-5"}},{type:"enum",name:"keyboard",ref:{value:"Keyboard",options:["on","off"]}},{type:"float",name:"temperature",ref:{value:"Temperature"}},{type:"int",name:"humidity",ref:{value:"Humidity"}}]},
hscd:{command:[{type:"enum",name:"open",ref:{value:"open"}},{type:"enum",name:"close",ref:{value:"close"}},{type:"enum",name:"stop",ref:{value:"stop"}}],status:[{type:"enum",name:"error",ref:{value:"Errors",options:"no safety current keyboard sw cpu checksum ram watchdog stop safetystop pos speed vars phase".split(" ")}},{type:"enum",name:"window down",ref:{value:"WindowDown",options:["true","false"]}},{type:"enum",name:"window closed",ref:{value:"WindowClosed",options:["true","false"]}},{type:"enum",
name:"window state",ref:{value:"State",options:["open","closed"]}}]},hscdi:{command:[{type:"enum",name:"open",ref:{value:"open"}},{type:"enum",name:"close",ref:{value:"close"}},{type:"enum",name:"stop",ref:{value:"stop"}},{type:"enum",name:"hscd_lockOn",ref:{value:"lockOn"}},{type:"enum",name:"hscd_lockOff",ref:{value:"lockOff"}}],status:[{type:"enum",name:"error",ref:{value:"Errors",options:"no safety current keyboard sw cpu checksum ram watchdog stop safetystop pos speed vars phase".split(" ")}},
{type:"enum",name:"lock",ref:{value:"Lock",options:["on","off"]}},{type:"enum",name:"window down",ref:{value:"WindowDown",options:["true","false"]}},{type:"enum",name:"window closed",ref:{value:"WindowClosed",options:["true","false"]}},{type:"enum",name:"window state",ref:{value:"State",options:["open","closed"]}},{type:"enum",name:"position percent (internorm)",ref:{value:"Position",extMeta:"0-100"}},{type:"enum",name:"number of driving cycles (internorm)",ref:{value:"Cycles",extMeta:"0-10000"}}]}};
return{SYS:"hautau",getGatewayType:function(){return[{sys:this.SYS,name:"HAUTAU WLAN-Box",port:80}]},getGatewayDeviceType:function(){return[{sys:this.SYS,type:0,name:"Rauchmeldezentrale (RAZK)"},{sys:this.SYS,type:1,name:"Multisensor MS"},{sys:this.SYS,type:2,name:"Output Box 230V"},{sys:this.SYS,type:4,name:"LSF"},{sys:this.SYS,type:5,name:"Fensterl\u00fcfter Ventra 301"},{sys:this.SYS,type:6,name:"Primat kompakt"},{sys:this.SYS,type:7,name:"Small Master"},{sys:this.SYS,type:8,name:"Fensterl\u00fcfter Monitor"},
{sys:this.SYS,type:9,name:"Primat kompakt 195"},{sys:this.SYS,type:10,name:"RWA Taster"},{sys:this.SYS,type:11,name:"Rauchmelder"},{sys:this.SYS,type:100,name:"Wlan Box"},{sys:this.SYS,type:101,name:"SKA 20 comfort drive"},{sys:this.SYS,type:102,name:"SM2/EM2 comfort drive"},{sys:this.SYS,type:103,name:"Atrium HS comfort drive"},{sys:this.SYS,type:104,name:"Lamelle"},{sys:this.SYS,type:105,name:"Fensterl\u00fcfter Ventra 302"},{sys:this.SYS,type:106,name:"Neu Primat kompakt 195"},{sys:this.SYS,type:107,
name:"SBS comfort drive"},{sys:this.SYS,type:108,name:"Primat kompakt SOBINCO"}]},createGateway:function(a,c,d){c=e.ERROR_CODE;a?a.ip?d(null,a):d(new e(c.INVALID,"ip is invalid")):d(new e(c.INVALID,"info is invalid"))},updateGateway:function(a,c,d,f){a=e.ERROR_CODE;c?c.ip?f(null,c):f(new e(a.INVALID,"ip is invalid")):f(new e(a.INVALID,"update is invalid"))},deleteGateway:function(a,c,d){d()},createDevice:function(a,c,d){var f=e.ERROR_CODE;if(a)if(a.gateway)if(null==a.address||"undefined"==typeof a.address)d(new e(f.INVALID,
"address is invalid"));else if(null==a.type||"undefined"==typeof a.type)d(new e(f.INVALID,"type is invalid"));else{c=c.data.gateways;var g;for(g=0;g<c.length;g++)if(c[g].index===a.gateway){var h=c[g];break}h?d(null,a):d(new e(f.NOT_FOUND,"gateway with index "+a.gateway+" not exists"))}else d(new e(f.INVALID,"gateway is invalid"));else d(new e(f.INVALID,"info is invalid"))},updateDevice:function(a,c,d){var f=e.ERROR_CODE;if(a)if(a.gateway)if(null==a.address||"undefined"==typeof a.address)d(new e(f.INVALID,
"address is invalid"));else if(null==a.type||"undefined"==typeof a.type)d(new e(f.INVALID,"type is invalid"));else{c=c.data.gateways;var g;for(g=0;g<c.length;g++)if(c[g].index===a.gateway){var h=c[g];break}h?d(null,a):d(new e(f.NOT_FOUND,"gateway with index "+a.gateway+" not exists"))}else d(new e(f.INVALID,"gateway is invalid"));else d(new e(f.INVALID,"info is invalid"))},deleteDevice:function(a,c,d){d()},applyUIFilter:function(a,c){var d=this,f=function(q,n,k){var m=[];q.forEach(function(r){if("root"==
r.type){r=JSON.parse(JSON.stringify(r));var p=f(r.children,n,k);p&&0<p.length&&(r.children=p,m.push(r))}else{p=k.elems;if("*"==p)p=!0;else{for(var t=!1,u=0;u<p.length;u++)if(p[u]==r.type){t=!0;break}p=t}p&&(r=JSON.parse(JSON.stringify(r)),m.push(r))}});return m},g=function(q,n){var k=[],m=d.getCommandStatusMap(q);if(m){var r=[];switch(n.catagory){case "command":m.command&&(r=f(m.command,q,n));break;case "status":m.status&&(r=f(m.status,q,n))}k=k.concat(r)}return k};if(!a.sys)return null;var h=JSON.parse(JSON.stringify(a)),
l=null;switch(c.catagory){case "command":l=g(a,c);h.command=l;break;case "status":l=g(a,c);h.status=l;break;default:return null}return l&&0!=l.length?h:null},getCommandStatusMap:function(a){return a&&"undefined"!=typeof a.type&&null!=a.type?b[a.type]?b[a.type]:(a=xnm.aio.hautau.Gateway.DEVICETYPE_MAP[a.type])?b[a]:null:null}}}();xnm.aio.hautau.RulesManager=function(){};
xnm.aio.hautau.RulesManager.prototype.getDeviceChannels=function(e,b,a){e=[];"drive"!=b&&"ska20cd"!=b&&"hscd"!=b&&"hscdi"!=b||"action"!=a||(e=["state"]);return e};xnm.aio.hautau.RulesManager.prototype.getCommands=function(e,b,a,c){e=[];if(("drive"==b||"ska20cd"==b||"hscd"==b||"hscdi"==b)&&"action"==a)for(b=xnm.aio.hautau.DM.getCommandStatusMap({type:b}).command,a=0;a<b.length;a++)e.push({action:"",id:window.XC_Text[b[a].name],subtype:"command",sys:"hautau",type:"action",value:b[a].ref.value});return e};
xnm.aio.hautau.Handler=function(){var e=function(){};e.prototype.Gateway=xnm.aio.hautau.Gateway;e.prototype.devicemanager=xnm.aio.hautau.DM;e.prototype.RulesManager=xnm.aio.hautau.RulesManager;e.prototype.registModule=function(b){b.register(this.devicemanager.SYS,"hautau")};e.prototype.resolveGateway=function(b){return b?this.Gateway.parseJSON(b):null};e.prototype.getDeviceCommands=function(b,a){b=(b=this.devicemanager.applyUIFilter(b,{catagory:"command",elems:"*"}))?b.command:[];a&&a(null,b)};e.prototype.getDeviceStatus=
function(b,a){b=(b=this.devicemanager.applyUIFilter(b,{catagory:"status",elems:"*"}))?b.status:[];a&&a(null,b)};e.prototype.doCommand=function(b,a,c,d){(b=this.resolveGateway(b))?b.executeCommandCreator(a,c,function(f){d&&d(f)}):d&&d(Error("gateway json format invalid"))};e.prototype.doStatus=function(b,a,c,d,f){(a=this.resolveGateway(a))?a.getStatesCreator(null,[{id:b,device:c,status:d}],function(g,h){g?f&&f(g):f&&f(null,h[0])}):f&&f(Error("device json format invalid"))};e.prototype.getDeviceList=
function(b,a,c){(b=this.resolveGateway(b))?b.listDevices(a,function(d,f){c&&c(d,f)}):c&&c(Error("gateway json format invalid"))};e.prototype.getDeviceCommandList=function(b){};e.prototype.discoverWithTimeout=function(b,a){var c={};require("x.upnp.js").discoverDevicesWithTimeout(b,function(d){if(d.deviceType&&-1!=d.deviceType.indexOf("urn:hautau-de:device:WLAN-Box")){var f=new xnm.aio.hautau.Gateway(d.ip);c[d.ip]||(c[d.ip]=f)}});setTimeout(function(){var d=[],f;for(f in c)d.push(c[f]);a&&a(null,d)},
b)};return e}();"undefined"!=typeof module&&null!=module&&(module.exports=new xnm.aio.hautau.Handler);
