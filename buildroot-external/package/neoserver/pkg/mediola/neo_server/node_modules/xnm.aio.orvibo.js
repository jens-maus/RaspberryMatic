var xnm=xnm||{};xnm.aio=xnm.aio||{},xnm.aio.orvibo=xnm.aio.orvibo||{},xnm.aio.orvibo.Device=function(){this.ip=null,this.port=1e4,this.uuid=null,this.CommandHandler=null;},xnm.aio.orvibo.Device.prototype._sendMessage=function(e,o,i){var t=[104,100,0];t.push(o.length+12),t.push((65280&e)>>8),t.push(255&e);for(var r=this.uuid.replace(/-/g,""),n=0;n<6;n++)t.push(parseInt(r.substr(2*n,2),16));for(n=0;n<o.length;n++)t.push(o[n]);var a=new Buffer(t),s=require("dgram").createSocket("udp4");s.send(a,0,a.length,1e4,this.ip,function(e,o){s.close(),i&&setTimeout(function(){i.call();},100);});},xnm.aio.orvibo.Device.prototype._subscribe=function(e){if(this.uuid&&17==this.uuid.length){for(var o=[32,32,32,32,32,32],i=this.uuid.replace(/-/g,""),t=5;t>=0;t--)o.push(parseInt(i.substr(2*t,2),16));o=o.concat([32,32,32,32,32,32]),this._sendMessage(25452,o,e);}},xnm.aio.orvibo.Socket=function(e,o,i){this.ip=e,this.uuid=o,this.port=i,this.port||(this.port=1e4),this._state="?",this._getStateCallbacksTimeout=null,this._getStateCallbacks=[];},xnm.aio.orvibo.Socket.prototype=new xnm.aio.orvibo.Device(),xnm.aio.orvibo.Socket.prototype.constructor=xnm.aio.orvibo.Socket,xnm.aio.orvibo.Socket.prototype.getState=function(e){var o=this;this._subscribe(function(){setTimeout(function(){e(o._state);},100);});},xnm.aio.orvibo.Socket.prototype.executeCommand=function(e,o,i){var t=this;this._subscribe(function(){var e=[32,32,32,32,32,32,0,0,0,0];if("on"==o)e.push(1);else if("off"==o)e.push(0);else if("toggle"==o)return void setTimeout(function(){"off"==t._state?e.push(1):e.push(0),t._sendMessage(25699,e,function(){t._sendMessage(25699,e,i);});},100);t._sendMessage(25699,e,function(){t._sendMessage(25699,e,i);});});},xnm.aio.orvibo.Socket.prototype.getStates=function(e,o,i){var t=this;this.CommandHandler=e,this.getState(function(e){var r={state:e};o&&t.CommandHandler&&t.CommandHandler.setState?t.CommandHandler.setState(o.id,e):t.CommandHandler&&t.CommandHandler.receivedState&&t.CommandHandler.receivedState("orvibo",t.uuid,r),i&&i(r);});},xnm.aio.orvibo.Socket.prototype.getStateValues=function(e){return e;},xnm.aio.orvibo.AllOne=function(e,o){this.ip=e,this.uuid=o,this._learnedIRCallback=null;},xnm.aio.orvibo.AllOne.prototype=new xnm.aio.orvibo.Device(),xnm.aio.orvibo.AllOne.prototype.constructor=xnm.aio.orvibo.AllOne,xnm.aio.orvibo.AllOne.prototype.learnIR=function(e){var o=this;this._learnedIRCallback=e,this._subscribe(function(){var e=[32,32,32,32,32,32,0,0,0,0,0];o._sendMessage(27763,e,function(){o._sendMessage(27763,e),setTimeout(function(){o._learnedIRCallback&&(o._learnedIRCallback(),o._learnedIRCallback=null);},1e4);});});},xnm.aio.orvibo.AllOne.prototype.sendIR=function(e,o){var i=this;this._subscribe(function(){var t=new Buffer(e,"hex"),r=[32,32,32,32,32,32,0,0,0,0];r.push(Math.floor(255*Math.random())),r.push(Math.floor(255*Math.random())),r.push(Math.floor(255*Math.random()));for(var n=0;n<t.length;n++)r.push(t[n]);i._sendMessage(26979,r,function(){i._sendMessage(26979,r,o);});});},xnm.aio.orvibo.AllOne.prototype.getStates=function(e,o,i){i&&i({});},xnm.aio.orvibo.AllOne.prototype.getStateValues=function(e){return e;},xnm.aio.orvibo.Discovery=function(){this.Devices={},this.callback=null,this._sockets=[];var e=require("os");if(require("dgram"),e&&e.networkInterfaces){var o=e.networkInterfaces();for(var i in o)for(var t=o[i],r=0;r<t.length;r++)this._addDiscoverSocket(1e4,t[r]);}else this._addDiscoverSocket(1e4,null);},xnm.aio.orvibo.Discovery.prototype._getMAC=function(e){for(var o="",i=0;i<5;i++)o+=XC.getHexVal(e[i],2).toUpperCase()+"-";return o+XC.getHexVal(e[i],2).toUpperCase();},xnm.aio.orvibo.Discovery.prototype._receivedData=function(e,o){o=o.toString("hex"),o=new Buffer(o,"hex"),XC.debugf("orvibo received data from "+e+" ("+o.length+")"),41==o.length||42==o.length?(113==o[4]&&97==o[5]&&(41==o.length?this.Devices[e]||(this.Devices[e]=new xnm.aio.orvibo.AllOne(e)):(this.Devices[e]||(this.Devices[e]=new xnm.aio.orvibo.Socket(e)),1==o[41]?this.Devices[e]._state="on":this.Devices[e]._state="off"),this.Devices[e].uuid=this._getMAC(o.slice(7,13))),this.callback&&this.Devices[e]&&this.callback(this.Devices[e])):23==o.length||24==o.length?this.Devices[e]&&(99==o[4]&&108==o[5]||115==o[4]&&102==o[5])&&(1==o[o.length-1]?(this.Devices[e]._state="on",this.Devices[e]instanceof xnm.aio.orvibo.Socket&&this.Devices[e].setState("on")):(this.Devices[e]._state="off",this.Devices[e]instanceof xnm.aio.orvibo.Socket&&this.Devices[e].setState("off")),this.Devices[e].CommandHandler&&this.Devices[e].CommandHandler.receivedState&&this.Devices[e].CommandHandler.receivedState("orvibo",this.Devices[e].uuid,{state:this.Devices[e]._state})):o.length>28&&108==o[4]&&115==o[5]&&(o=(o=o.toString("hex")).substr(48,2)+o.substr(52),this.Devices[e]&&this.Devices[e]._learnedIRCallback&&(this.Devices[e]._learnedIRCallback(o),this.Devices[e]._learnedIRCallback=null));},xnm.aio.orvibo.Discovery.prototype._addDiscoverSocket=function(e,o){var i=require("dgram"),t=this;if(o){if("IPv4"==o.family&&0==o.internal){try{r=i.createSocket({reuseAddr:!0,type:"udp4"});}catch(e){r=i.createSocket("udp4");}r.on("listening",function(){r.setBroadcast(!0);}),r.on("message",function(e,o){t._receivedData(o.address,e);}),r.on("error",function(e){}),r.bind(e,o.address),this._sockets.push(r);}}else{var r;try{r=i.createSocket({reuseAddr:!0,type:"udp4"});}catch(e){r=i.createSocket("udp4");}r.on("message",function(e,o){t._receivedData(o.address,e);}),r.on("error",function(e){}),r.bind(e),this._sockets.push(r);}},xnm.aio.orvibo.Discovery.prototype._sendDiscoveryMessages=function(e,o,i,t){e=new Buffer([104,100,0,6,113,97]);for(var r=0;r<this._sockets.length;r++)this._sockets[r].send(e,0,e.length,1e4,"255.255.255.255");},xnm.aio.orvibo.Discovery.prototype.discoverDevices=function(){this._sendDiscoveryMessages();},xnm.aio.orvibo.Handler=function(){this._Discovery=new xnm.aio.orvibo.Discovery(),this._Discovery.discoverDevices();},xnm.aio.orvibo.Handler.prototype.discoverDevices=function(e){e&&(this._Discovery.callback=e),this._Discovery.discoverDevices();},xnm.aio.orvibo.Handler.prototype.getStateValues=function(e,o){return new xnm.aio.orvibo.Socket().getStateValues(o);},xnm.aio.orvibo.Handler.prototype.getDeviceCommandList=function(e,o){var i=[];return i.push({id:window.XC_Text.on,cmd:"on"}),i.push({id:window.XC_Text.off,cmd:"off"}),i;},xnm.aio.orvibo.Handler.prototype.getDevice=function(e){for(var o in this._Discovery.Devices)if(e.address&&this._Discovery.Devices[o].uuid==e.address)return this._Discovery.Devices[o];return null;},xnm.aio.orvibo.Handler.prototype.Socket=xnm.aio.orvibo.Socket,xnm.aio.orvibo.Handler.prototype.AllOne=xnm.aio.orvibo.AllOne,xnm.aio.orvibo.DMError=function(){var e=function e(_e,o){this.code=_e,this.message=o,this.stack=new Error().stack;};return(e.prototype=new Error()).name="OrviboDmError",e.prototype.code=0,e.ERROR_CODE={DEFAULT:0,INDEX_EXISTS:1,ID_EXISTS:2,INVALID:3,UNKNOW:4,NOT_FOUND:5,IP_EXISTS:6},e;}(),xnm.aio.orvibo.DM={getGatewayType:function getGatewayType(e){var o=[];for(var i in xnm.aio.orvibo)if(xnm.aio.orvibo.hasOwnProperty(i)){var t=xnm.aio.orvibo[i];if(t&&t.DM&&t.DM.getGatewayType){var r=t.DM.getGatewayType(e);r&&(r.constructor===Array?o=o.concat(r):o.push(r));}}return o;},getIPDeviceType:function getIPDeviceType(e,o){var i=[];for(var t in xnm.aio.orvibo)if(xnm.aio.orvibo.hasOwnProperty(t)){var r=xnm.aio.orvibo[t];if(r&&r.DM&&r.DM.getIPDeviceType){var n=r.DM.getIPDeviceType(e,o);n&&i.push(n);}}return i;},_getSystem:function _getSystem(e){for(var o in xnm.aio.orvibo)if(xnm.aio.orvibo.hasOwnProperty(o)){var i=xnm.aio.orvibo[o];if(i&&i.DM&&i.DM.SYS&&i.DM.SYS==e)return i;}return null;},createGateway:function createGateway(e,o,i){var t=xnm.aio.orvibo.DMError,r=xnm.aio.orvibo.DMError.ERROR_CODE;if(e){if(e.sys){var n=this._getSystem(e.sys);n&&n.DM&&n.DM.createGateway?n.DM.createGateway(e,o,i):i&&i(new t(r.INVALID,"no such sys:"+e.sys));}else i&&i(new t(r.INVALID,"sys is invalid"));}else i&&i(new t(r.INVALID,"info is invalid"));},updateGateway:function updateGateway(e,o,i,t){var r=xnm.aio.orvibo.DMError,n=xnm.aio.orvibo.DMError.ERROR_CODE;if(o){if(o.sys){var a=this._getSystem(o.sys);a&&a.DM&&a.DM.updateGateway?a.DM.updateGateway(e,o,i,t):t&&t(new r(n.INVALID,"no such sys:"+o.sys));}else t&&t(new r(n.INVALID,"sys is invalid"));}else t&&t(new r(n.INVALID,"update is invalid"));},deleteGateway:function deleteGateway(e,o,i){var t=xnm.aio.orvibo.DMError,r=xnm.aio.orvibo.DMError.ERROR_CODE;if(e){if(e.sys){var n=this._getSystem(e.sys);n&&n.DM&&n.DM.deleteGateway?n.DM.deleteGateway(e,o,i):i&&i(new t(r.INVALID,"no such sys:"+e.sys));}else i&&i(new t(r.INVALID,"sys is invalid"));}else i&&i();},createDevice:function createDevice(e,o,i){var t=xnm.aio.orvibo.DMError,r=xnm.aio.orvibo.DMError.ERROR_CODE;if(e){if(e.sys){var n=this._getSystem(e.sys);n&&n.DM&&n.DM.createDevice?n.DM.createDevice(e,o,i):i&&i(new t(r.INVALID,"no such sys:"+e.sys));}else i&&i(new t(r.INVALID,"sys is invalid"));}else i&&i(new t(r.INVALID,"info is invalid"));},updateDevice:function updateDevice(e,o,i){var t=xnm.aio.orvibo.DMError,r=xnm.aio.orvibo.DMError.ERROR_CODE;if(e){if(e.sys){var n=this._getSystem(e.sys);n&&n.DM&&n.DM.updateDevice?n.DM.updateDevice(e,o,i):i&&i(new t(r.INVALID,"no such sys:"+e.sys));}else i&&i(new t(r.INVALID,"sys is invalid"));}else i&&i(new t(r.INVALID,"info is invalid"));},deleteDevice:function deleteDevice(e,o,i){var t=xnm.aio.orvibo.DMError,r=xnm.aio.orvibo.DMError.ERROR_CODE;if(e){if(e.sys){var n=this._getSystem(e.sys);n&&n.DM&&n.DM.deleteDevice?n.DM.deleteDevice(e,o,i):i&&i(new t(r.INVALID,"no such sys:"+e.sys));}else i&&i(new t(r.INVALID,"sys is invalid"));}else i&&i();},applyUIFilter:function applyUIFilter(e,o){var i=function i(e,o){if("*"==e)return!0;for(var i=!1,t=0;t<e.length;t++)if(e[t]==o){i=!0;break;}return i;},t=function t(e,o){var t,r=[],n=null;if(e.sys){var a=this._getSystem(e.sys);a&&a.DM&&a.DM.getCommandStatusMap&&(t=a.DM.getCommandStatusMap(e));}return t&&(n=function(e,o,t){var r=[];switch(t.catagory){case"command":e.command&&e.command.forEach(function(e){if(i(t.elems,e.type)){var o=JSON.parse(JSON.stringify(e));r.push(o);}});break;case"status":e.status&&e.status.forEach(function(e){if(i(t.elems,e.type)){var o=JSON.parse(JSON.stringify(e));r.push(o);}});}return r;}(t,0,o),r=r.concat(n)),r;};if(!e.sys)return null;var r=JSON.parse(JSON.stringify(e)),n=null;switch(o.catagory){case"command":n=t.call(this,e,o),r.command=n;break;case"status":n=t.call(this,e,o),r.status=n;break;default:return null;}return n&&0!=n.length?r:null;}},xnm.aio.orvibo.Socket.prototype.executeCommandCreator=function(e,o,i){o&&o.value?this.executeCommand(null,o.value,function(){i&&i();}):i&&i(new Error("command invalid"));},xnm.aio.orvibo.Socket.prototype.getStatesCreator=function(e,o,i){this._getState(function(e){for(var t=[],r=0;r<o.length;r++)if(o[r]&&o[r].id){var n="?";o[r].status&&o[r].status.value&&e&&e[o[r].status.value]&&(n=e[o[r].status.value]),t.push({id:o[r].id,status:n});}i&&i(null,t);});},xnm.aio.orvibo.Socket.prototype.setState=function(e){console.log("set state"),this._getStateCallbacksTimeout&&(clearTimeout(this._getStateCallbacksTimeout),this._getStateCallbacksTimeout=null),this._state=e;var o=this._getStateCallbacks;if(this._getStateCallbacks=[],o)for(var i=0;i<o.length;i++)o[i]&&o[i]({state:this._state});},xnm.aio.orvibo.Socket.prototype._getState=function(e){if(e)if(this._getStateCallbacks||(this._getStateCallbacks=[]),0==this._getStateCallbacks.length){this._getStateCallbacks.push(e);var o=this;this._getStateCallbacksTimeout=setTimeout(function(){console.log("state timeout"),o.setState("?");},1e3),this._subscribe();}else-1==this._getStateCallbacks.indexOf(e)&&this._getStateCallbacks.push(e);},xnm.aio.orvibo.Socket.prototype.toJSON=function(){return{sys:xnm.aio.orvibo.Socket.DM.SYS,ip:this.ip,port:this.port,mac:this.uuid};},xnm.aio.orvibo.Socket.prototype.equalsTo=function(e){return!!e&&e instanceof xnm.aio.orvibo.Socket&&this.ip==e.ip&&this.port==e.port&&this.uuid==e.uuid;},xnm.aio.orvibo.Socket.parseJSON=function(e){if(!e.ip)return null;var o=e.mac;if(!e.mac){var i=require("xnm.aio.orvibo.js");i&&i._Discovery&&i._Discovery.Devices&&(o=i._Discovery.Devices[e.ip]);}return o?new xnm.aio.orvibo.Socket(e.ip,o,e.port):null;},xnm.aio.orvibo.Socket.DM={SYS:"orvibo_socket",MAP:{command:[{type:"enum",name:"on",ref:{value:"on"}},{type:"enum",name:"off",ref:{value:"off"}},{type:"enum",name:"toggle",ref:{value:"toggle"}}],status:[{type:"enum",name:"state",ref:{value:"state",options:["on","off"]}}]},registModule:function registModule(e){e.register(this.SYS,"orvibo");},getIPDeviceType:function getIPDeviceType(){return{sys:this.SYS,name:"ORVIBO WiWo Smart Socket",port:1e4};},createDevice:function createDevice(e,o,i){var t=xnm.aio.orvibo.DMError,r=xnm.aio.orvibo.DMError.ERROR_CODE;e?e.ip?e.mac?i(null,e):i(new t(r.INVALID,"mac is invalid")):i(new t(r.INVALID,"ip is invalid")):i(new t(r.INVALID,"info is invalid"));},updateDevice:function updateDevice(e,o,i){var t=xnm.aio.orvibo.DMError,r=xnm.aio.orvibo.DMError.ERROR_CODE;e?e.ip?e.mac?i(null,e):i(new t(r.INVALID,"mac is invalid")):i(new t(r.INVALID,"ip is invalid")):i(new t(r.INVALID,"info is invalid"));},deleteDevice:function deleteDevice(e,o,i){i();},getCommandStatusMap:function getCommandStatusMap(e){return this.MAP;}},xnm.aio.orvibo.AllOne.prototype.executeCommandCreator=function(e,o,i){if(o&&o.value){if(e&&e.ircodes&&e.ircodes.codes){for(var t,r=0;r<e.ircodes.codes.length;r++){var n=e.ircodes.codes[r];if(n.key==o.value){t=n.code;break;}}t?this.sendIR(t,function(){i&&i();}):i&&i(new Error("no such ir code:"+o.value));}else i&&i(new Error("device has no ir codes"));}else i&&i(new Error("command invalid"));},xnm.aio.orvibo.AllOne.prototype.toJSON=function(){return{sys:xnm.aio.orvibo.AllOne.DM.SYS,ip:this.ip,port:this.port,mac:this.uuid};},xnm.aio.orvibo.AllOne.prototype.equalsTo=function(e){return!!e&&e instanceof xnm.aio.orvibo.AllOne&&this.ip==e.ip&&this.port==e.port&&this.uuid==e.uuid;},xnm.aio.orvibo.AllOne.parseJSON=function(e){if(!e.ip)return null;var o=e.mac;if(!e.mac){var i=require("xnm.aio.orvibo.js");i&&i._Discovery&&i._Discovery.Devices&&(o=i._Discovery.Devices[e.ip]);}if(!o)return null;var t=new xnm.aio.orvibo.AllOne(e.ip,o);return e.port&&parseInt(e.port)>0&&(t.port=parseInt(e.port)),t;},xnm.aio.orvibo.AllOne.DM={SYS:"orvibo_ir",registModule:function registModule(e){e.register(this.SYS,"orvibo");},getGatewayType:function getGatewayType(){return[{sys:this.SYS,name:"NUEVA-IR-BLAST",port:1e4,vendor:"nueva"},{sys:this.SYS,name:"ORVIBO AllOne",port:1e4,vendor:"orvibo"}];},createGateway:function createGateway(e,o,i){var t=xnm.aio.orvibo.DMError,r=xnm.aio.orvibo.DMError.ERROR_CODE;e?e.ip?e.mac?i(null,e):i(new t(r.INVALID,"mac is invalid")):i(new t(r.INVALID,"ip is invalid")):i(new t(r.INVALID,"info is invalid"));},updateGateway:function updateGateway(e,o,i,t){var r=xnm.aio.orvibo.DMError,n=xnm.aio.orvibo.DMError.ERROR_CODE;o?o.ip?t(null,o):t(new r(n.INVALID,"ip is invalid")):t(new r(n.INVALID,"update is invalid"));},deleteGateway:function deleteGateway(e,o,i){i();},createDevice:function createDevice(e,o,i){var t=xnm.aio.orvibo.DMError,r=xnm.aio.orvibo.DMError.ERROR_CODE;if(e.gateway){if(o.data&&o.data.gateways&&0!==o.data.gateways.length){var n,a,s=o.data.gateways;for(n=0;n<s.length;n++)if(s[n].index===e.gateway){a=s[n];break;}a?i(null,e):i(new t(r.NOT_FOUND,"gateway with index "+e.gateway+" not exists"));}else i(new t(r.NOT_FOUND,"gateway with index "+e.gateway+" not exists"));}else i(new t(r.INVALID,"gateway is invalid"));},updateDevice:function updateDevice(e,o,i){var t=xnm.aio.orvibo.DMError,r=xnm.aio.orvibo.DMError.ERROR_CODE;if(e){if(e.gateway){var n,a,s=o.data.gateways;for(n=0;n<s.length;n++)if(s[n].index===e.gateway){a=s[n];break;}a?i(null,e):i(new t(r.NOT_FOUND,"gateway with index "+e.gateway+" not exists"));}else i(new t(r.INVALID,"gateway is invalid"));}else i(new t(r.INVALID,"info is invalid"));},deleteDevice:function deleteDevice(e,o,i){i();},getCommandStatusMap:function getCommandStatusMap(e){var o={command:[]};if(e&&e.ircodes&&e.ircodes.codes){for(var i=0;i<e.ircodes.codes.length;i++){var t=e.ircodes.codes[i];o.command.push({type:"enum",name:t.key,ref:{value:t.key}});}return o;}return null;}},xnm.aio.orvibo.Handler.prototype.devicemanager=xnm.aio.orvibo.DM,xnm.aio.orvibo.Handler.prototype.registModule=function(e){for(var o in xnm.aio.orvibo)if(xnm.aio.orvibo.hasOwnProperty(o)){var i=xnm.aio.orvibo[o];i&&i.DM&&i.DM.registModule&&i.DM.registModule(e);}},xnm.aio.orvibo.Handler.prototype.resolveGateway=function(e){if(!e)return null;if(e.sys===xnm.aio.orvibo.AllOne.DM.SYS){if(!e.ip)return null;this._Discovery.Devices||(this._Discovery.Devices={});var o=this._Discovery.Devices[e.ip];return o||((o=xnm.aio.orvibo.AllOne.parseJSON(e))?(this._Discovery.Devices[e.ip]=o,o):null);}return null;},xnm.aio.orvibo.Handler.prototype.resolveDevice=function(e){if(e.sys===xnm.aio.orvibo.Socket.DM.SYS){if(!e.ip)return null;this._Discovery.Devices||(this._Discovery.Devices={});var o=this._Discovery.Devices[e.ip];return o||((o=xnm.aio.orvibo.Socket.parseJSON(e))?(this._Discovery.Devices[e.ip]=o,o):null);}return null;},xnm.aio.orvibo.Handler.prototype.getDeviceCommands=function(e,o){var i=xnm.aio.orvibo.DM.applyUIFilter(e,{catagory:"command",elems:"*"}),t=i?i.command:[];o&&o(null,t);},xnm.aio.orvibo.Handler.prototype.getDeviceStatus=function(e,o){var i=this.devicemanager.applyUIFilter(e,{catagory:"status",elems:"*"}),t=i?i.status:[];o&&o(null,t);},xnm.aio.orvibo.Handler.prototype.searchDeviceWithTimeout=function(e,o){var i=[];this._Discovery.callback=function(e){for(var o=0;o<i.length;o++)if(i[o]&&i[o].ip==e.ip)return;i.push(e);},this._Discovery.discoverDevices(),setTimeout(function(){o&&o(null,i);},e);},xnm.aio.orvibo.Handler.prototype.searchIRBlastWithTimeout=function(e,o){this.searchDeviceWithTimeout(e,function(e,i){if(e)o&&o(e);else{for(var t=[],r=0;r<i.length;r++)i[r]&&i[r]instanceof xnm.aio.orvibo.AllOne&&t.push(i[r]);o&&o(null,t);}});},xnm.aio.orvibo.Handler.prototype.learnIRCode=function(e,o,i){var t=this.resolveGateway(e);t&&t instanceof xnm.aio.orvibo.AllOne?t.learnIR(function(e){var o=e?null:new Error("learn ir code error");i&&i(o,e);}):i&&i(new Error("gateway json format invalid"));},xnm.aio.orvibo.Handler.prototype.doIRCommand=function(e,o,i,t){var r=this.resolveGateway(e);r&&r instanceof xnm.aio.orvibo.AllOne?r.executeCommandCreator(o,i,t):t&&t(new Error("gateway json format invalid"));},xnm.aio.orvibo.Handler.prototype.searchSocketWithTimeout=function(e,o){this.searchDeviceWithTimeout(e,function(e,i){if(e)o&&o(e);else{for(var t=[],r=0;r<i.length;r++)i[r]&&i[r]instanceof xnm.aio.orvibo.Socket&&t.push(i[r]);o&&o(null,t);}});},xnm.aio.orvibo.Handler.prototype.doSocketCommand=function(e,o,i){var t=this.resolveDevice(e);t?t.executeCommandCreator(e,o,function(e){i&&i(e);}):i&&i(new Error("device json format invalid"));},xnm.aio.orvibo.Handler.prototype.doSocketStatus=function(e,o,i,t){var r=this.resolveDevice(o);if(r){var n=[{id:e,device:o,status:i}];r.getStatesCreator(null,n,function(e,o){e?t&&t(e):t&&t(null,o[0]);});}else t&&t(new Error("device json format invalid"));},"undefined"!=typeof exports&&"undefined"!=typeof module&&module.exports&&(exports=module.exports=new xnm.aio.orvibo.Handler());