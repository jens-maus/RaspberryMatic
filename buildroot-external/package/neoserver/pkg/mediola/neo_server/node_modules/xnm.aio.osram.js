var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(f,e,a){f!=Array.prototype&&f!=Object.prototype&&(f[e]=a.value)};$jscomp.getGlobal=function(f){return"undefined"!=typeof window&&window===f?f:"undefined"!=typeof global&&null!=global?global:f};$jscomp.global=$jscomp.getGlobal(this);$jscomp.SYMBOL_PREFIX="jscomp_symbol_";
$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.Symbol=function(){var f=0;return function(e){return $jscomp.SYMBOL_PREFIX+(e||"")+f++}}();
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var f=$jscomp.global.Symbol.iterator;f||(f=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));"function"!=typeof Array.prototype[f]&&$jscomp.defineProperty(Array.prototype,f,{configurable:!0,writable:!0,value:function(){return $jscomp.arrayIterator(this)}});$jscomp.initSymbolIterator=function(){}};$jscomp.arrayIterator=function(f){var e=0;return $jscomp.iteratorPrototype(function(){return e<f.length?{done:!1,value:f[e++]}:{done:!0}})};
$jscomp.iteratorPrototype=function(f){$jscomp.initSymbolIterator();f={next:f};f[$jscomp.global.Symbol.iterator]=function(){return this};return f};$jscomp.iteratorFromArray=function(f,e){$jscomp.initSymbolIterator();f instanceof String&&(f+="");var a=0,b={next:function(){if(a<f.length){var c=a++;return{value:e(c,f[c]),done:!1}}b.next=function(){return{done:!0,value:void 0}};return b.next()}};b[Symbol.iterator]=function(){return b};return b};
$jscomp.polyfill=function(f,e,a,b){if(e){a=$jscomp.global;f=f.split(".");for(b=0;b<f.length-1;b++){var c=f[b];c in a||(a[c]={});a=a[c]}f=f[f.length-1];b=a[f];e=e(b);e!=b&&null!=e&&$jscomp.defineProperty(a,f,{configurable:!0,writable:!0,value:e})}};$jscomp.polyfill("Array.prototype.keys",function(f){return f?f:function(){return $jscomp.iteratorFromArray(this,function(e){return e})}},"es6","es3");var xnm=xnm||{};xnm.aio=xnm.aio||{};xnm.aio.osram=xnm.aio.osram||{};
xnm.aio.osram.DMError=function(){var f=function(e,a){this.code=e;this.message=a;this.stack=Error().stack};f.prototype=Error();f.prototype.name="OsramDmError";f.prototype.code=0;f.ERROR_CODE={DEFAULT:0,INDEX_EXISTS:1,ID_EXISTS:2,INVALID:3,UNKNOW:4,NOT_FOUND:5,IP_EXISTS:6};return f}();
xnm.aio.osram.Lightify=function(){var f={_arr2str:function(a){for(var b="",c=0,d,e,f;c<a.length&&0!=a[c];)d=a[c],128>d?(b+=String.fromCharCode(d),c++):191<d&&224>d?(e=a[c+1],b+=String.fromCharCode((d&31)<<6|e&63),c+=2):(e=a[c+1],f=a[c+2],b+=String.fromCharCode((d&15)<<12|(e&63)<<6|f&63),c+=3);return b},_hex2arr:function(a){for(var b=[],c=0;c<a.length;c+=2)b.push(parseInt(a.substr(c,2),16));return b},_arr2hex:function(a){for(var b="",c=0;c<a.length;c++){for(var d=a[c].toString(16);2>d.length;)d="0"+
d;b+=d.toUpperCase()}return b}},e=function(a,b,c){this._logger=require("x.logger.js").getLogger("xnm.aio.osram.Lightify");this.uuid=c;this.ip=a;this.port=b;if(!b||0>b)this.port=4E3;e._SB.addBuffer(this);this._socket=null};e.SO_TIMEOUT=5E3;e._SB={_buffer:{},addBuffer:function(a){var b=this.getBuffer(a);b||(b={lightify:a,dataBuffer:"",packetBuffer:[],reqId:0,status:0},this._buffer[a.ip+":"+a.port]=b);return b},getBuffer:function(a){return this._buffer[a.ip+":"+a.port]},_getNextReqId:function(a){a=this.getBuffer(a);
a.reqId+=1;return a.reqId},addPacket:function(a,b,c){var d=this.addBuffer(a),e=this._getNextReqId(a);b.reqId=e;b={reqId:e,frame:b,callback:c,timeout:null};e=d.packetBuffer.length;switch(d.status){case 0:d.packetBuffer.push(b);d.status=1;d.lightify._connect();break;case 1:d.packetBuffer.push(b);break;case 2:d.packetBuffer.push(b);0==e&&this._sendNextPacket(a);break;case 3:c(Error("socket is closing"))}},removePacket:function(a,b){b.timeout&&(clearTimeout(b.timeout),b.timeout=null);if((a=this.getBuffer(a))&&
a.packetBuffer){for(var c=-1,d=0;d<a.packetBuffer.length;d++)if(a.packetBuffer[d]===b){c=d;break}-1!=c&&a.packetBuffer.splice(c,1)}},_sendNextPacket:function(a){var b=this.getBuffer(a);b&&b.packetBuffer&&b.packetBuffer[0]&&this._sendPacket(a,b.packetBuffer[0])},_sendPacket:function(a,b){var c=this.getBuffer(a);if(c&&c.lightify){var d=this;b.timeout=setTimeout(function(){b.timeout=null;d.removePacket(a,b);d._sendNextPacket(a);b.callback&&b.callback(Error("frame response timeout"))},5E3);c.lightify._logger.log("debug",
"send frame:"+JSON.stringify(b.frame));c.lightify._send(b.frame.flag,b.frame.cmd,b.frame.reqId,b.frame.payload)}},_clearPackets:function(a,b){if((a=this.getBuffer(a))&&a.packetBuffer){var c,d=[];for(c=0;c<a.packetBuffer.length;c++)d.push(a.packetBuffer[c]);a.packetBuffer=[];for(c=0;c<d.length;c++)d[c]&&d[c].callback&&(d[c].timeout&&clearTimeout(d[c].timeout),d[c].callback(b),d[c].callback=null)}},_resolveData:function(a){var b=this.getBuffer(a);if(b&&b.dataBuffer&&4<b.dataBuffer.length){var c=parseInt(b.dataBuffer.substr(0,
2),16);c=(parseInt(b.dataBuffer.substr(2,2),16)<<8)+c;if(b.dataBuffer.length>=4+2*c){var d=b.dataBuffer.substr(0,4+2*c);b.dataBuffer=b.dataBuffer.substr(4+2*c);(c=a._hex2frame(d))&&this._onFrame(a,c);b.dataBuffer&&this._resolveData(a)}}},_onFrame:function(a,b){var c=this.getBuffer(a);if(c&&c.packetBuffer){for(var d=null,e=0;e<c.packetBuffer.length;e++)if(c.packetBuffer[e]&&c.packetBuffer[e].reqId==b.reqId){d=c.packetBuffer[e];break}d&&(this.removePacket(a,d),this._sendNextPacket(a),d.callback&&d.callback(null,
b))}},_onSocketConnect:function(a){var b=this.getBuffer(a);b&&(b.status=2,this._sendNextPacket(a))},_onSocketTimeout:function(a){var b=this.getBuffer(a);b&&1==b.status&&(b.status=0,this._clearPackets(a,Error("socket connection timeout")))},_onSocketError:function(a,b){var c=this.getBuffer(a);if(c)switch(c.status){case 0:case 1:case 3:c.status=0;break;case 2:c.status=3,a._close()}this._clearPackets(a,b)},_onSocketClose:function(a){var b=this.getBuffer(a);b&&(b.status=0,this._clearPackets(a,Error("socket closed")))},
_onSocketData:function(a,b){var c=this.getBuffer(a);c&&(c.dataBuffer+=b);this._resolveData(a)}};e.prototype.executeCommandCreator=function(a,b,c){a?b?this._doCommand(a,b,c):c&&c(Error("command is null")):c&&c(Error("device is null"))};e.prototype.executeCommand=function(a,b,c){var d={};6==b.length||8==b.length?(d.value="rgbw",d.ext=b):4==b.length?(d.value="ct",d.ext=parseInt(b)):2==b.length&&0<=parseInt(b)&&100>=parseInt(b)?(d.value="bri",d.ext=b):d.value=b;this.executeCommandCreator(a,d,c)};e.prototype.getStateValues=
function(a,b){a={};b&&(a.state=b.onoff?"on":"off",b.level&&(a.bri=b.level));return a};e.prototype.getStates=function(a,b,c){this.getStatesCreator(a,b,c)};e.prototype.getStatesCreator=function(a,b,c){var d=this;this.CommandHandler=a;this._getAllNodeState(function(a,e){!a&&e&&d._logger.log("debug","get all node state response:"+JSON.stringify(e));var f={};if(e)for(var h=Object.keys(e),k=0;k<h.length;k++)f[h[k]]=d._resolveRawState(e[h[k]]);if(e&&d.CommandHandler&&d.CommandHandler.receivedState)for(var l in e)d.CommandHandler.receivedState("lightify",
l,e[l]);if(b){e=[];for(h=0;h<b.length;h++)(k=b[h])&&k.id&&(l="?",k.device&&k.device.address&&k.status&&k.status.value&&!a&&f&&(f[k.device.address]&&(l=f[k.device.address][k.status.value]),null==l&&"undefined"==typeof l&&(l="?")),e.push({id:k.id,status:l}));c&&c(null,e)}else c&&c(Error("deviceList is null"))})};e.prototype.listNodes=function(a){this._networkListNodes(function(b,c){if(b)a&&a(b);else{b=[];if(c)for(var d=0;d<c.length;d++)if(c[d]&&c[d].id64){var e={type:"light",data:c[d].type,name:c[d].name,
address:c[d].id64};"10"==c[d].type&&(e.type="plug");b.push(e)}a&&a(null,b)}})};e.prototype.listZones=function(a){this._networkListZones(function(b,c){if(b)a&&a(b);else{b=[];if(c)for(var d=0;d<c.length;d++)c[d]&&c[d].id&&b.push({type:"group",data:"00",address:c[d].id,name:c[d].name});a&&a(null,b)}})};e.prototype._doCommand=function(a,b,c){if(a&&b)if(b.value){var d=this;switch(b.value){case "toggle":case "up":case "down":this._getAllNodeState(function(e,f){if(e)c&&c(e);else if(e=f[a.address])switch(b.value){case "toggle":d._doCommand(a,
{value:e.onoff?"off":"on"},function(a,b){c&&c(a,b)});break;case "up":case "down":f=e.level;if("up"==b.value)f=0==e.onoff?10:f+10;else if(0==e.onoff){c&&c(null);break}else f-=10;100<f&&(f=100);0>f&&(f=0);d._doCommand(a,{value:"bri",ext:f},function(a,b){c&&c(a,b)});break;default:c&&c(null)}else c&&c(Error("no such device in network"))});break;case "bri":if(0==parseInt(b.ext)){this._doCommand(a,{value:"bri",ext:1},function(b,e){b?c&&c(b):d._doCommand(a,{value:"off"},function(a,b){c&&c(a,b)})});break}default:this._buildCommandReq(a,
b,function(a,b){a?c&&c(a):(d._logger.log("debug","send command frame:"+JSON.stringify(b)),e._SB.addPacket(d,b,function(a,e){a?(d._logger.log("debug","receive command response error:"+a.message),c&&c(a)):(d._logger.log("debug","receive command response:"+JSON.stringify(e)),(a=d._statusError(e.status))?(d._logger.log("debug","receive command response status error:"+a.message),c&&c(a)):c&&c(null,b))}))})}}else c&&c(Error("command invalid"));else c&&c(Error("invalid parameters"))};e.prototype._getAllNodeState=
function(a){this._networkListNodes(function(b,c){if(b)a&&a(b);else{b={};if(c)for(var d=0;d<c.length;d++)c[d]&&c[d].id64&&(b[c[d].id64]={online:parseInt(c[d].online,16),onoff:parseInt(c[d].onoff,16),level:parseInt(c[d].level,16),colorTemp:parseInt(c[d].cct.substr(2,2)+c[d].cct.substr(0,2),16),red:parseInt(c[d].red,16),green:parseInt(c[d].green,16),blue:parseInt(c[d].blue,16),white:parseInt(c[d].white,16)});a&&a(null,b)}})};e.prototype._networkListNodes=function(a){this._logger.log("debug","send network list node request");
var b=this;e._SB.addPacket(this,{flag:0,cmd:19,payload:[1]},function(c,d){c?(b._logger.log("debug","receive network list node response error:"+c.message),a&&a(c)):(b._logger.log("debug","receive network_list_nodes response:"+JSON.stringify(d)),c=b._statusError(d.status),a&&a(c,d.nodes))})};e.prototype._networkListZones=function(a){this._logger.log("debug","send network list zones request");var b=this;e._SB.addPacket(this,{flag:2,cmd:30,payload:[]},function(c,d){c?(b._logger.log("debug","receive network list zones response error:"+
c.message),a&&a(c)):(b._logger.log("debug","receive network_list_zones response:"+JSON.stringify(d)),c=b._statusError(d.status),a&&a(c,d.zones))})};e.prototype._buildCommandReq=function(a,b,c){if(a&&a.address&&b&&b.value){var d=!1;4==a.address.length&&(d=!0);var e=d?2:0;switch(b.value){case "on":case "off":a=a.address;d&&(a+="000000000000");a=f._hex2arr(a);a.push("on"==b.value?1:0);d=50;break;case "bri":if(null==b.ext||"undefined"==typeof b.ext){c(Error("command invalid"));return}e|=128;b=parseInt(b.ext);
100<b&&(b=100);0>b&&(b=0);a=a.address;d&&(a+="000000000000");a=f._hex2arr(a);a.push(b);a=a.concat([1,0]);d=49;break;case "ct":if(null==b.ext||"undefined"==typeof b.ext){c(Error("command invalid"));return}e|=128;b=parseInt(b.ext);2E3>b&&(b=2E3);a=a.address;d&&(a+="000000000000");a=f._hex2arr(a);a.push(b&255);a.push(b>>8&255);a=a.concat([1,0]);d=51;break;case "rgbwS":case "rgbw":if(!b.ext){c(Error("command invalid"));return}b=f._hex2arr(b.ext);4>b.length&&b.push(0);4<b.length&&(b=b.slice(0,4));a=a.address;
d&&(a+="000000000000");a=f._hex2arr(a);a=a.concat(b);a=a.concat([1,0]);d=54;break;case "effect":if(!b.ext){c(Error("command invalid"));return}a=a.address;d&&(a+="000000000000");a=f._hex2arr(a);if("none"==b.ext)a.push(0),a=a.concat([0,0]);else if("colorloop"==b.ext)a.push(1),a=a.concat([15,0]);else{c(Error("command invalid"));return}d=55;break;default:c(Error("unknow command:"+b.value),null);return}c(null,{flag:e,cmd:d,payload:a})}else c(Error("build command req parameters invalid"))};e.prototype._resolveRawState=
function(a){var b=a.red.toString(16);2!=b.length&&(b="0"+b);var c=a.green.toString(16);2!=c.length&&(c="0"+c);var d=a.blue.toString(16);2!=d.length&&(d="0"+d);var e=a.white.toString(16);2!=e.length&&(e="0"+e);return{power:a.onoff?"on":"off",bri:a.onoff?a.level:0,ct:a.colorTemp,rgbw:(b+c+d+e).toUpperCase()}};e.prototype._statusError=function(a){var b=null;switch(a){case 16:case 17:case 18:case 21:case 255:b=Error("error code:"+a)}return b};e.prototype._buildFrame=function(a,b,c,d){var e=[],f=6+d.length;
e.push(f&255);e.push(f>>8&255);e.push(a);e.push(b);e.push(c&255);e.push(c>>8&255);e.push(c>>16&255);e.push(c>>24&255);return e=e.concat(d)};e.prototype._connect=function(){this._logger.log("trace","connect");var a=this,b=!1,c=require("net").connect({port:this.port,host:this.ip});c.setTimeout(e.SO_TIMEOUT);c.setEncoding("hex");c.on("connect",function(){a._logger.log("trace","connect to lightify:"+a.ip);b=!0;a._socket=c;e._SB._onSocketConnect(a,c)});c.on("data",function(b){a._logger.log("trace","receive from lightify:"+
a.ip+" data:"+b);e._SB._onSocketData(a,b)});c.on("error",function(c){b?a._logger.log("trace","lightify:"+a.ip+" error:"+c.message):a._logger.log("trace","lightify:"+a.ip+" connection error:"+c.message);e._SB._onSocketError(a,c)});c.on("timeout",function(){b?a._logger.log("trace","hub:"+a.ip+" data timeout"):a._logger.log("trace","lightify:"+a.ip+" connection timeout");e._SB._onSocketTimeout(a)});c.on("close",function(){a._logger.log("trace","hub:"+a.ip+" close socket");e._SB._onSocketClose(a)});c._doConnect&&
"function"==typeof c._doConnect&&c._doConnect()};e.prototype._send=function(a,b,c,d,e){a=this._buildFrame(a,b,c,d);this._sendRaw(a,function(a){e&&e(a,c)})};e.prototype._sendRaw=function(a,b){this._logger.log("trace","send to lightify:"+this.ip+" data:"+f._arr2hex(a));this._socket.write(new Buffer(a));b&&b()};e.prototype._close=function(){this._logger.log("trace","close");this._socket&&this._socket.end()};e.prototype._hex2frame=function(a){var b=f._hex2arr(a);if(6>(b[1]<<8)+b[0])return null;a={flag:b[2],
cmd:b[3]};a.reqId=b[4]+(b[5]<<8)+(b[6]<<16)+(b[7]<<24);a.payload=b.slice(8);a.valid=!1;switch(a.cmd){case 19:if(3<=a.payload.length&&(a.valid=!0,a.status=a.payload[0],a.num=a.payload[1]+(a.payload[2]<<8),a.nodes=[],0<a.num))for(b=0;b<a.num&&!(a.payload.length<3+50*(b+1));b++){var c=a.payload.slice(3+50*b,3+50*(b+1)),d={};d.id16=f._arr2hex(c.slice(0,2));d.id64=f._arr2hex(c.slice(2,10));d.type=f._arr2hex(c.slice(10,11));d.majorVer=f._arr2hex(c.slice(11,12));d.minorVer=f._arr2hex(c.slice(12,13));d.patchVer=
f._arr2hex(c.slice(13,14));d.buildVer=f._arr2hex(c.slice(14,15));d.online=f._arr2hex(c.slice(15,16));d.groupMember=f._arr2hex(c.slice(16,18));d.onoff=f._arr2hex(c.slice(18,19));d.level=f._arr2hex(c.slice(19,20));d.cct=f._arr2hex(c.slice(20,22));d.red=f._arr2hex(c.slice(22,23));d.green=f._arr2hex(c.slice(23,24));d.blue=f._arr2hex(c.slice(24,25));d.white=f._arr2hex(c.slice(25,26));d.name=c.slice(26,42);d.name=f._arr2str(d.name);a.nodes.push(d)}break;case 30:if(3<=a.payload.length&&(a.valid=!0,a.status=
a.payload[0],a.num=a.payload[1]+(a.payload[2]<<8),a.zones=[],0<a.num))for(b=0;b<a.num&&!(a.payload.length<3+18*(b+1));b++)c={},c.id=a.payload.slice(3+18*b,18*b+5),c.id=f._arr2hex(c.id),c.name=a.payload.slice(18*b+5,18*b+21),c.name=f._arr2str(c.name),a.zones.push(c);break;case 49:case 50:case 51:case 54:case 55:12<=a.payload.length&&(a.valid=!0,a.status=a.payload[0],a.result=a.payload.slice(3));break;case 98:13<=a.payload.length&&(a.valid=!0,a.status=a.payload[0],a.num=a.payload[1]+(a.payload[2]<<
8),a.result=a.payload.slice(3,12),a.onoff=a.payload[12]);break;case 104:13<=a.payload.length&&(a.valid=!0,a.status=a.payload[0],a.num=a.payload[1]+(a.payload[2]<<8),a.result=a.payload.slice(3,12),a.online=a.payload[12],a.onoff=a.payload[13],a.level=a.payload[14],a.colorTemp=a.payload[15]+(a.payload[16]<<8),a.red=a.payload[17],a.green=a.payload[18],a.blue=a.payload[19],a.white=a.payload[20]);break;default:a.valid=!0}return a};e.prototype.toJSON=function(){return{sys:xnm.aio.osram.Lightify.DM.SYS,ip:this.ip,
port:this.port,uuid:this.uuid}};e.prototype.equalsTo=function(a){return a&&a instanceof e?this.ip==a.ip&&this.port==a.port:!1};e.parseJSON=function(a){return a.ip?new e(a.ip,a.port):null};e.discoveryWithTimeout=function(a,b){var c=require("x.mdns.js");c.clearRecordBuffer();c.discoverServiceWithTimeout("_http._tcp.local",a,function(a,c){if(a)b&&b(a);else{for(var d=[],f=0;f<c.length;f++){var h=c[f];if(h.target&&h.ip&&0<h.ip.length&&0==h.target.indexOf("Lightify")){var m=h.target.substr(9);m=m.replace(".local",
"");h=new e(h.ip[0]);h.uuid=m;d.push(h)}}b&&b(a,d)}})};return e}();
xnm.aio.osram.Lightify.DM=function(){var f=xnm.aio.osram.DMError,e=xnm.aio.osram.DMError.ERROR_CODE,a=function(a,c,d){if(a)if(a.gateway)if(a.type)if(null==a.data||"undefined"==typeof a.data)d(new f(e.INVALID,"data is invalid"));else if(c.data&&c.data.gateways&&0!==c.data.gateways.length){c=c.data.gateways;var b;for(b=0;b<c.length;b++)if(c[b].index===a.gateway){var k=c[b];break}k?d():d(new f(e.NOT_FOUND,"gateway with index "+a.gateway+" not exists"))}else d(new f(e.NOT_FOUND,"gateway with index "+
a.gateway+" not exists"));else d(new f(e.INVALID,"type is invalid"));else d(new f(e.INVALID,"gateway is invalid"));else d(new f(e.INVALID,"info is invalid"))};return{SYS:"lightify",MAP:{onoff:{command:[{type:"enum",name:"toggle",ref:{value:"toggle"}},{type:"enum",name:"off",ref:{value:"off"}},{type:"enum",name:"on",ref:{value:"on"}}],status:[{type:"enum",name:"power",ref:{value:"power",options:["on","off"]}}]},dimmable:{command:[{type:"enum",name:"up",ref:{value:"up"}},{type:"enum",name:"down",ref:{value:"down"}},
{type:"int",name:"brightness",ref:{value:"bri",ext:"%d",extMeta:"0-100"}}],status:[{type:"int",name:"brightness",ref:{value:"bri",extMeta:"0-100"}}]},colortemp:{command:[{type:"int",name:"color temperature",ref:{value:"ct",ext:"%d",extMeta:"2700-6500",scale:"38"}}],status:[{type:"int",name:"color temperature",ref:{value:"ct",extMeta:"2700-6500",scale:"38"}}]},colorlight:{command:[{type:"string",name:"rgbw color",ref:{value:"rgbwS",ext:"%s"}},{type:"rgbw",name:"rgbw color",ref:{value:"rgbw",ext:"%s"}},
{type:"enum",name:"effect",ref:{value:"effect",ext:"%e",extMeta:["none","colorloop"]}}],status:[{type:"rgbw",name:"rgbw color",ref:{value:"rgbw"}}]},extendcolor:{},group:{command:[{type:"int",name:"do scene",ref:{value:"doScene",ext:"%d"}}]}},registModule:function(a){a.register(this.SYS,"osram")},getGatewayType:function(){return{sys:this.SYS,name:"OSRAM LIGHTIFY / LEDvance Gateway",port:4E3}},getGatewayDeviceType:function(){var a={sys:this.SYS,type:"light",name:"Light",subtypes:[]};a.subtypes.push({id:"OnOff Light",
data:1});a.subtypes.push({id:"Color Dimmer Light",data:2});a.subtypes.push({id:"Dimmer Light",data:4});a.subtypes.push({id:"Color Light",data:8});a.subtypes.push({id:"Extended Color Light",data:10});return[a,{sys:this.SYS,type:"group",name:"Group"}]},createGateway:function(a,c,d){a?a.ip?d(null,a):d(new f(e.INVALID,"ip is invalid")):d(new f(e.INVALID,"info is invalid"))},updateGateway:function(a,c,d,h){c?c.ip?h(null,c):h(new f(e.INVALID,"ip is invalid")):h(new f(e.INVALID,"update is invalid"))},deleteGateway:function(a,
c,d){d()},createDevice:function(b,c,d){a(b,c,function(a){d(a,b)})},updateDevice:function(b,c,d){a(b,c,function(a){d(a,b)})},deleteDevice:function(a,c,d){d(null,a)},getCommandStatusMap:function(a){var c=function(a){return JSON.parse(JSON.stringify(a))};if(!a)return null;var b={command:[],status:[]},e=0;if("light"==a.type||"plug"==a.type)e=10,null!=a.data&&"undefined"!=typeof a.data&&(e=parseInt(a.data,16));switch(e){case 0:b.command=b.command.concat(c(this.MAP.group.command));b.command=b.command.concat(c(this.MAP.colorlight.command));
b.command=b.command.concat(c(this.MAP.colortemp.command));b.command.push(c(this.MAP.dimmable.command[2]));b.command.push(c(this.MAP.onoff.command[1]));b.command.push(c(this.MAP.onoff.command[2]));break;case 10:case 8:b.command=b.command.concat(c(this.MAP.colorlight.command)),b.status=b.status.concat(c(this.MAP.colorlight.status));case 2:a=c(this.MAP.colortemp.command);var f=c(this.MAP.colortemp.status);if(10==e){for(var g=0;g<a.length;g++)a[g]&&a[g].ref&&"ct"==a[g].ref.value&&(a[g].ref.extMeta="2000-6500",
a[g].ref.scale="15");for(g=0;g<f.length;g++)f[g]&&f[g].ref&&"ct"==f[g].ref.value&&(a[g].ref.extMeta="2000-6500",a[g].ref.scale="15")}b.command=b.command.concat(a);b.status=b.status.concat(f);case 4:b.command=b.command.concat(c(this.MAP.dimmable.command)),b.status=b.status.concat(c(this.MAP.dimmable.status));case 1:case 16:b.command=b.command.concat(c(this.MAP.onoff.command)),b.status=b.status.concat(c(this.MAP.onoff.status))}0==e&&delete b.status;return b}}}();
xnm.aio.osram.DM=function(){var f=xnm.aio.osram.DMError,e=xnm.aio.osram.DMError.ERROR_CODE;return{getGatewayType:function(){var a=[],b;for(b in xnm.aio.osram)if(xnm.aio.osram.hasOwnProperty(b)){var c=xnm.aio.osram[b];c&&c.DM&&c.DM.getGatewayType&&(c=c.DM.getGatewayType())&&a.push(c)}return a},getGatewayDeviceType:function(a){var b=[],c;for(c in xnm.aio.osram)if(xnm.aio.osram.hasOwnProperty(c)){var d=xnm.aio.osram[c];d&&d.DM&&d.DM.getGatewayDeviceType&&(d=d.DM.getGatewayDeviceType(a))&&(Array.isArray(d)?
b=b.concat(d):b.push(d))}return b},getIPDeviceType:function(a,b){var c=[],d;for(d in xnm.aio.osram)if(xnm.aio.osram.hasOwnProperty(d)){var e=xnm.aio.osram[d];e&&e.DM&&e.DM.getIPDeviceType&&(e=e.DM.getIPDeviceType(a,b))&&c.push(e)}return c},_getSystem:function(a){for(var b in xnm.aio.osram)if(xnm.aio.osram.hasOwnProperty(b)){var c=xnm.aio.osram[b];if(c&&c.DM&&c.DM.SYS&&c.DM.SYS==a)return c}return null},_checkSystemMethod:function(a,b,c){if(a)if(a.sys){var d=this._getSystem(a.sys);d&&d.DM&&d.DM[b]?
c&&c(null,d):c&&c(new f(e.INVALID,"no such sys:"+a.sys))}else c&&c(new f(e.INVALID,"sys is invalid"));else c&&c(new f(e.INVALID,"info is invalid"))},createGateway:function(a,b,c){this._checkSystemMethod(a,"createGateway",function(d,e){d?c&&c(d):e.DM.createGateway(a,b,c)})},updateGateway:function(a,b,c,d){this._checkSystemMethod(b,"updateGateway",function(e,f){e?d&&d(e):f.DM.updateGateway(a,b,c,d)})},deleteGateway:function(a,b,c){this._checkSystemMethod(a,"deleteGateway",function(d,e){d?c&&c(d):e.DM.deleteGateway(a,
b,c)})},createDevice:function(a,b,c){this._checkSystemMethod(a,"createDevice",function(d,e){d?c&&c(d):e.DM.createDevice(a,b,c)})},updateDevice:function(a,b,c){this._checkSystemMethod(a,"updateDevice",function(d,e){d?c&&c(d):e.DM.updateDevice(a,b,c)})},deleteDevice:function(a,b,c){this._checkSystemMethod(a,"deleteDevice",function(d,e){d?c&&c(d):e.DM.deleteDevice(a,b,c)})},applyUIFilter:function(a,b){var c=function(a,b){if("*"==a)return!0;for(var c=!1,d=0;d<a.length;d++)if(a[d]==b){c=!0;break}return c},
d=function(a,b,d){var e=[];switch(d.catagory){case "command":a.command&&a.command.forEach(function(a){c(d.elems,a.type)&&(a=JSON.parse(JSON.stringify(a)),e.push(a))});break;case "status":a.status&&a.status.forEach(function(a){c(d.elems,a.type)&&(a=JSON.parse(JSON.stringify(a)),e.push(a))})}return e},e=function(a,b){var c=[],e;if(a.sys){var f=this._getSystem(a.sys);f&&f.DM&&f.DM.getCommandStatusMap&&(e=f.DM.getCommandStatusMap(a))}e&&(a=d(e,a,b),c=c.concat(a));return c};if(!a.sys)return null;var f=
JSON.parse(JSON.stringify(a)),g=null;switch(b.catagory){case "command":g=e.call(this,a,b);f.command=g;break;case "status":g=e.call(this,a,b);f.status=g;break;default:return null}return g&&0!=g.length?f:null}}}();
xnm.aio.osram.Handler=function(){var f=function(){};f.prototype.devicemanager=xnm.aio.osram.DM;f.prototype.Lightify=xnm.aio.osram.Lightify;f.prototype.registModule=function(e){for(var a in xnm.aio.osram)if(xnm.aio.osram.hasOwnProperty(a)){var b=xnm.aio.osram[a];b&&b.DM&&b.DM.registModule&&b.DM.registModule(e)}};f.prototype.getStateValues=function(e,a){return(new xnm.aio.osram.Lightify).getStateValues(e,a)};f.prototype.resolveGateway=function(e){switch(e.sys){case xnm.aio.osram.Lightify.DM.SYS:return xnm.aio.osram.Lightify.parseJSON(e);
default:return null}};f.prototype.getDeviceCommands=function(e,a){e=(e=xnm.aio.osram.DM.applyUIFilter(e,{catagory:"command",elems:"*"}))?e.command:[];a&&a(null,e)};f.prototype.getDeviceCommandList=function(e,a){var b=[];if("color-light"==e.data||"ext-color-light"==e.data||"group"==e.data)a||b.push({id:window.XC_Text.colorvalue,cmd:"colorvalue"});b.push({id:window.XC_Text.on,cmd:"on"});b.push({id:window.XC_Text.off,cmd:"off"});if(("dimmer"==e.data||"color-temp-dimmer"==e.data||"color-light"==e.data||
"ext-color-light"==e.data||"group"==e.data)&&!a)for(var c=0;100>=c;c+=5)b.push({id:window.XC_Text.dimTo+c+"%",cmd:""+c});if(("color-temp-dimmer"==e.data||"color-light"==e.data||"ext-color-light"==e.data||"group"==e.data)&&!a)for(e=2700;6500>=e;e+=380)b.push({id:window.XC_Text.colortemp+e,cmd:""+e});return b};f.prototype.getDeviceStatus=function(e,a){e=(e=xnm.aio.osram.DM.applyUIFilter(e,{catagory:"status",elems:"*"}))?e.status:[];a&&a(null,e)};f.prototype.doCommand=function(e,a,b,c){(e=this.resolveGateway(e))?
e.executeCommandCreator(a,b,function(a){c&&c(a)}):c&&c(Error("gateway json format invalid"))};f.prototype.doStatus=function(e,a,b,c,d){(a=this.resolveGateway(a))?a.getStatesCreator(null,[{id:e,device:b,status:c}],function(a,b){a?d&&d(a):d&&d(null,b[0])}):d&&d(Error("gateway json format invalid"))};f.prototype.searchLightifyWithTimeout=function(e,a){xnm.aio.osram.Lightify.discoveryWithTimeout(e,a)};f.prototype.getDeviceList=function(e,a){var b=this.resolveGateway(e);b?b instanceof xnm.aio.osram.Lightify?
b.listNodes(function(c,d){c?a&&a(c):b.listZones(function(b,c){b?a&&a(b):(b={lights:d,groups:c},a&&a(null,b))})}):a&&a(Error("gateway do not support get device list")):a&&a(Error("gateway json format invalid"))};return f}();"undefined"!=typeof module&&null!=module&&(module.exports=new xnm.aio.osram.Handler);
