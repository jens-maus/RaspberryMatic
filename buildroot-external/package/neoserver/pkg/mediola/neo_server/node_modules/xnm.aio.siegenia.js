var xnm=xnm||{};xnm.aio=xnm.aio||{};xnm.aio.siegenia=xnm.aio.siegenia||{};
xnm.aio.siegenia._Session=function(){var a=function(b){this._logger=require("x.logger.js").getLogger("xnm.aio.siegenia._Session");this.ip=b.ip;this.port=b.port;this.user=b.user;this.password=b.password;this._state=0;this._startCallbacks=[];this._autoClose=!1;this._idleTO=this._keepAliveIV=this._connectionTO=this._socket=null;this._reqID=0;this._requests=[];this._deviceParam=this._dataCallback=this._monitor=null};a.prototype.setDataCallback=function(b){this._dataCallback=b};a.prototype.start=function(b){if(this._state==
a.STATE.ESTABLISHED)b&&b(null,this);else if("undefined"!=typeof b&&null!=b&&-1==this._startCallbacks.indexOf(b)&&this._startCallbacks.push(b),this._state==a.STATE.IDLE){this._logger.log("trace","start session "+this.ip);var c=this;this._state=a.STATE.CONNECT;this._connect(function(b){if(b){c._state=a.STATE.IDLE;for(var e=0;e<c._startCallbacks.length;e++){var f=c._startCallbacks[e];f&&f(b)}c._startCallbacks=[]}else c._state=a.STATE.LOGIN,c._login(function(b){var d=c._startCallbacks;c._startCallbacks=
[];b?c.stop():(c._state=a.STATE.ESTABLISHED,c._keepAliveIV=setInterval(function(){c._keepAlive()},5E3),c._autoClose&&(c._idleTO=setTimeout(function(){c.stop()},6E4)));for(var e=0;e<d.length;e++){var f=d[e];f&&f(b)}})})}};a.prototype.stop=function(b){this._state!=a.STATE.IDLE&&(this._logger.log("trace","stop session "+this.ip),this._onSessionClose());b&&b()};a.prototype.send=function(b,a){if(this._autoClose&&this._idleTO){var d=this;clearTimeout(this._idleTO);this._idleTO=setTimeout(function(){d.stop()},
6E4)}this._logger.log("trace","send data:"+JSON.stringify(b)+" to "+this.ip);this._sendReq(b,a)};a.prototype._connect=function(b){var a=this,d=b;this._connectionTO=setTimeout(function(){d&&(d(Error("connection timeout")),d=null)},2E3);var e=require("websocket").createWebSocket("wss://"+this.ip+"/WebSocket");e.onclose=function(){d?(a._connectionTO&&(clearTimeout(a._connectionTO),a._connectionTO=null),d(Error("connection failed")),d=null):a._onWsClose()};e.onerror=function(b){d?(clearTimeout(a._connectionTO),
a._connectionTO=null,d(Error(b)),d=null):a._onWsError(Error(b))};e.onmessage=function(b){a._onWsData(b)};e.onopen=function(){a._socket=e;a._connectionTO&&(clearTimeout(a._connectionTO),a._connectionTO=null);d&&(d(),d=null)};e.open()};a.prototype._login=function(b){var c=this;this._state=a.STATE.LOGIN;this._logger.log("trace","login with user:"+this.user+" password:"+this.password);this._sendReq({command:"login",user:this.user,password:this.password,long_life:!0},function(a,e){a?(c._logger.log("warn",
"login error:"+a.message),b&&b(a)):e&&"ok"==e.status?b&&b():(c._logger.log("warn","login failed:"+(e?e.status:"login response invalid")),a=Error(e?e.status:"login response invalid"),a.code=401,b&&b(a))})};a.prototype._keepAlive=function(b){this._sendReq({id:512,command:"keepAlive",extend_session:!1},function(b,a){})};a.prototype._sendReq=function(b,a){b.id||(this._reqID++,512<=this._reqID&&(this._reqID=1),b.id=this._reqID);var d=this,e={req:b,callback:a,to:setTimeout(function(){var b=d._requests.indexOf(e);
-1!=b&&d._requests.splice(b,1);a(Error("request timeout"))},2E3)};this._requests.push(e);this._socket.sendJSON(b)};a.prototype._onSessionClose=function(b){if(this._state!=a.STATE.IDLE){this._logger.log("trace","session closed "+this.ip);this._state=a.STATE.IDLE;b||(b=Error("session stopped"));this._socket&&(this._socket.close(),this._socket=null);this._connectionTO&&(clearTimeout(this._connectionTO),this._connectionTO=null);this._keepAliveIV&&(clearInterval(this._keepAliveIV),this._keepAliveIV=null);
var c,d;if(this._startCallbacks)for(d=this._startCallbacks,this._startCallbacks=[],c=0;c<d.length;c++){var e=d[c];e&&e(b)}if(this._requests)for(d=this._requests,this._requests=[],c=0;c<d.length;c++)if(e=d[c])e.to&&clearTimeout(e.to),e.callback&&e.callback(b);this._deviceParam=this._dataCallback=null;if("undefined"!=typeof this._monitor&&null!=this._monitor)this._monitor.onClose()}};a.prototype._onWsData=function(b){this._logger.log("trace","receive data:"+b+" from "+this.ip);try{var c=JSON.parse(b);
if(c){b=-1;for(var d=null,e=0;e<this._requests.length;e++){var f=this._requests[e];f&&f.req&&f.req.id==c.id&&("getDeviceParams"==f.req.command&&(this._deviceParam=c.data),d=f.callback,b=e,f.to&&clearTimeout(f.to))}-1!=b&&this._requests.splice(b,1);"update"==c.status&&"deviceParams"==c.command&&c.data&&(this._deviceParam||(this._deviceParam={}),this._deepMerge(this._deviceParam,c.data));if("undefined"!=typeof this._monitor&&null!=this._monitor&&this._state==a.STATE.ESTABLISHED&&512!=c.id)this._monitor.onData(c,
this._deviceParam);d&&d(null,c);this._state==a.STATE.ESTABLISHED&&512!=c.id&&this._dataCallback&&this._dataCallback(c,this._deviceParam)}}catch(g){}};a.prototype._onWsError=function(b){this._logger.log("warn","websocket "+this.ip+" error:"+(b?b.message:""));this._onSessionClose(b)};a.prototype._onWsClose=function(){this._logger.log("trace","websocket "+this.ip+" closed");this._socket=null;this._onSessionClose(Error("socket closed"))};a.prototype._deepMerge=function(b,a){if(!b)return a;if(!a)return b;
for(var d in a)a.hasOwnProperty(d)&&(this._isObject(a[d])?this._deepMerge(b[d],a[d]):b[d]=a[d]);return b};a.prototype._isObject=function(b){return b&&"object"===typeof b&&!Array.isArray(b)};a.STATE={IDLE:0,CONNECT:1,LOGIN:2,ESTABLISHED:3};return a}();
xnm.aio.siegenia._SessionMonitor=function(){var a=function(b){this._logger=require("x.logger.js").getLogger("xnm.aio.siegenia._SessionMonitor");this._device=b;this._callbacks=[];this._session=null;this._running=!1;this._autoRestartTO=null};a.prototype.addCallback=function(b){b&&-1==this._callbacks.indexOf(b)&&this._callbacks.push(b)};a.prototype.start=function(b){if(this._autoRestartTO)this._logger.log("trace","start monitor (restarting):"+this._device.ip),b&&b();else{this._logger.log("trace","start monitor:"+
this._device.ip);var a=this;this._running=!0;xnm.aio.siegenia._SessionManager.startSession(this._device,function(d,e){d?(a._session=null,a._logger.log("warn","start monitor "+a._device.ip+" error:"+d.message+" code:"+d.code),a._running?(a._restart(d.code?120:30),b&&b(null,a)):b&&b(d)):(a._session=e,a._session._monitor=a,a._session.send({command:"getDeviceParams"},function(){}),b&&b(null,a))})}};a.prototype.stop=function(b){this._logger.log("trace","stop monitor:"+this._device.ip);this._autoRestartTO&&
(clearTimeout(this._autoRestartTO),this._autoRestartTO=null);this._running=!1;var a=xnm.aio.siegenia._SessionManager.getSession(this._device.ip);a?(a._monitor=null,a.stop(function(){b&&b()})):b&&b()};a.prototype._restart=function(b){this._logger.log("trace","restart monitor "+this._device.ip+" in "+b+"sec");var a=this;this._autoRestartTO=setTimeout(function(){a._running&&(a._logger.log("trace","restart monitor "+a._device.ip),a._autoRestartTO=null,a.start())},1E3*b)};a.prototype.onClose=function(){this._session=
null;this._running&&this._restart()};a.prototype.onData=function(b,a){this._logger.log("trace","receive data:"+JSON.stringify(b));for(var d=0;d<this._callbacks.length;d++)this._callbacks[d](b,a)};return a}();
xnm.aio.siegenia._SessionManager={_sessions:{},_monitors:{},getSession:function(a){return this._sessions[a]},setSession:function(a,b){this._sessions[a]=b},startSession:function(a,b){if(a&&a.ip){var c=a.ip,d=this.getSession(c);if("undefined"==typeof d||null==d)d=new xnm.aio.siegenia._Session(a),this.setSession(c,d);d.start(function(a){b&&b(a,d)})}else b&&b(Error("ws device invalid"))},stopSession:function(a,b){if(a&&a.ip){var c=this.getSession(a.ip);("undefined"==typeof c||null==c)&&b&&b();c.stop(function(a){b&&
b(a)})}else b&&b(Error("ws device invalid"))},startMonitorSession:function(a,b,c){if(a&&a.ip){var d=a.ip;if(this._monitors[d])this._monitors[d].addCallback(b);else{a=new xnm.aio.siegenia._SessionMonitor(a);a.addCallback(b);var e=this;a.start(function(b,a){b?c&&c(b):e._monitors[d]=a})}}else c&&c(Error("ws device invalid"))},stopMonitorSession:function(a,b){console.log("=======>","stop monitor session");if(a&&a.ip){var c=a.ip;if(this._monitors[c]){var d=this;this._monitors[c].stop(function(){d._monitors[c]=
null;b&&b()})}else b&&b()}else b&&b(Error("ws device invalid"))}};xnm.aio.siegenia._IQONTROLStateCallbacks={};
xnm.aio.siegenia.WSDevice=function(){var a=function(){this.ip=null;this.port=443;this.user="user";this.password="0000";this._serial=this._subvariant=this._variant=this._type=this._data=null};a.prototype.CONNECTION_ERROR=513;a.prototype.connect=function(b){var a=this;xnm.aio.siegenia._SessionManager.startSession(this,function(d,e){d?b&&b(d):(a._session=e,b&&b(null,e))})};a.prototype.send=function(a,c,d){a?a.send(c,function(a,b){a?d&&d(a):b&&"ok"==b.status?d&&d(null,b.data):d&&d(Error(b?b.status:"response invalid"))}):
d&&d(Error("session invalid"))};a.prototype.disconnect=function(a){xnm.aio.siegenia._SessionManager.stopSession(this,function(c){a&&a(c)})};a.prototype.startMonitoring=function(a,c){var d=this;xnm.aio.siegenia._SessionManager.startMonitorSession(this,function(c,f){var g=d._resolveData(c,f);g&&a(g)},function(a){c&&c(a)})};a.prototype._resolveData=function(a,c){var d=null;a&&512!=a.id&&a.data&&!a.data.token&&c&&(d=this.computeStates(c));return d};a.prototype.toJSON=function(){return{sys:"siegenia",
ip:this.ip,port:this.port,username:this.user,password:this.password,data:this._data,type:this._type,variant:this._variant,subvariant:this._subvariant,serial:this._serial}};a.prototype.equalsTo=function(a){return a&&a instanceof xnm.aio.siegenia.WSDevice?this.ip==a.ip&&this.port==a.port:!1};return a}();
xnm.aio.siegenia.Genius=function(a,b,c,d,e){this.ip=a;b&&(this.user=b);c&&(this.password=c);e&&(this.port=e);this.type="B";d&&(this.type=d);var f=this;this._dataCallback=function(a,b){var c=f._resolveData(a,b),d=xnm.aio.siegenia._IQONTROLStateCallbacks[f.ip];c&&d&&d.id&&d.ch&&f._doStateCallback(d.id,d.ch,c)}};xnm.aio.siegenia.Genius.prototype=new xnm.aio.siegenia.WSDevice;xnm.aio.siegenia.Genius.prototype.constructor=xnm.aio.siegenia.Genius;xnm.aio.siegenia.Genius.prototype.CMD_GETDEVICE=256;
xnm.aio.siegenia.Genius.prototype.CMD_KEEPALIVE=257;xnm.aio.siegenia.Genius.prototype.CMD_GETPARAMS=258;xnm.aio.siegenia.Genius.prototype.CMD_OPEN=259;xnm.aio.siegenia.Genius.prototype.CMD_CLOSE=260;xnm.aio.siegenia.Genius.prototype.CMD_SETDAYMODE=261;xnm.aio.siegenia.Genius.prototype.CMD_SETNIGHTMODE=262;xnm.aio.siegenia.Genius.prototype.CMD_IMPULSE_ON=263;xnm.aio.siegenia.Genius.prototype.CMD_IMPULSE_OFF=264;xnm.aio.siegenia.Genius.prototype.CMD_SETIMPULSE=265;
xnm.aio.siegenia.Genius.prototype.CMD_SETTIMER=266;xnm.aio.siegenia.Genius.prototype.CMD_POSITION1=267;xnm.aio.siegenia.Genius.prototype.CMD_POSITION2=268;xnm.aio.siegenia.Genius.prototype.CMD_LOCK=269;xnm.aio.siegenia.Genius.prototype.CMD_STOPTIMER=270;xnm.aio.siegenia.Genius.prototype.CMD_STOP=271;xnm.aio.siegenia.Genius.prototype.CMD_STARTTIMER=272;xnm.aio.siegenia.Genius.prototype.CMD_WING1_OPEN=273;xnm.aio.siegenia.Genius.prototype.CMD_WING1_CLOSE=274;
xnm.aio.siegenia.Genius.prototype.CMD_WING1_POSITION1=275;xnm.aio.siegenia.Genius.prototype.CMD_WING1_POSITION2=276;xnm.aio.siegenia.Genius.prototype.CMD_WING1_STOP=277;xnm.aio.siegenia.Genius.prototype.CMD_WING1_LOCK=278;xnm.aio.siegenia.Genius.prototype.CMD_WING2_OPEN=279;xnm.aio.siegenia.Genius.prototype.CMD_WING2_CLOSE=280;xnm.aio.siegenia.Genius.prototype.CMD_WING2_STOP=281;xnm.aio.siegenia.Genius.prototype.CMD_WING2_LOCK=282;xnm.aio.siegenia.Genius.prototype.CMD_SET_STOPOVER=288;
xnm.aio.siegenia.Genius.prototype.CMD_OPEN_TO_TURN=289;xnm.aio.siegenia.Genius.prototype.CMD_SILENT_ON=290;xnm.aio.siegenia.Genius.prototype.CMD_SILENT_OFF=291;
xnm.aio.siegenia.Genius.prototype.execute=function(a,b,c){var d=this,e=null;if(a==this.CMD_KEEPALIVE)e={command:"keepAlive",extend_session:!1};else if(a==this.CMD_GETDEVICE)e={command:"getDevice"};else if(a==this.CMD_GETPARAMS)e={command:"getDeviceParams"};else if(a==this.CMD_OPEN)e={command:"setDeviceParams"},e.params="axxentDK"==this.type?{openclose:"OPEN"}:"axxentHSA"==this.type?{openclose:{0:"OPEN"}}:"axxentHSA2"==this.type?{openclose:{0:"OPEN",1:"OPEN"}}:{relais1:!0};else if(a==this.CMD_CLOSE)if(e=
{command:"setDeviceParams"},"axxentDK"==this.type)e.params={openclose:"CLOSE"};else if("axxentHSA"==this.type)e.params={openclose:{0:"CLOSE_WO_LOCK"}};else{if("axxentHSA2"==this.type){this.execute(this.CMD_WING1_CLOSE,null,function(a,b){a?c&&c(a,b):d.execute(d.CMD_WING2_CLOSE,null,function(a,b){c&&c(a,b)})});return}e.params="mh10"==this.type?{relais2:!0}:{relais1:!1}}else if(a==this.CMD_OPEN_TO_TURN)e={command:"setDeviceParams"},"axxentDK"==this.type&&(e.params={openclose:"OPEN_TO_TURN"});else if(a==
this.CMD_STOP)e={command:"setDeviceParams",params:{stop:!0}},"axxentHSA"==this.type&&(e.params={stop:{0:"true"}}),"axxentHSA2"==this.type&&(e.params={stop:{0:"true",1:"true"}});else if(a==this.CMD_LOCK){if(e={command:"setDeviceParams",params:{openclose:"CLOSE"}},"axxentHSA"==this.type||"axxentHSA2"==this.type)e.params={openclose:{0:"CLOSE"}}}else if(a==this.CMD_POSITION1)e={command:"setDeviceParams",params:{openclose:{0:"STOP_OVER"}}};else if(a==this.CMD_POSITION2)e={command:"setDeviceParams",params:{openclose:{0:"GAP_VENT"}}};
else if(a==this.CMD_SETDAYMODE)e={command:"setDeviceParams",params:{relais2:!0}};else if(a==this.CMD_SETNIGHTMODE)e={command:"setDeviceParams",params:{relais2:!1}};else if(a==this.CMD_IMPULSE_ON)e={command:"setDeviceParams",params:{impulse:!0}};else if(a==this.CMD_IMPULSE_OFF)e={command:"setDeviceParams",params:{impulse:!1}};else if(a==this.CMD_SETIMPULSE)e={command:"setDeviceParams",params:{impulseduration:b}};else if(a==this.CMD_SETTIMER){a=b.indexOf(":");var f=0,g=b;-1!=a&&(f=b.substr(0,a),g=b.substr(a+
1));f=parseInt(f);g=parseInt(g);e={command:"setDeviceParams",params:{timer:{duration:{hour:f,minute:g}}}}}else a==this.CMD_STOPTIMER?e={command:"setDeviceParams",params:{timer:{enabled:!1}}}:a==this.CMD_STARTTIMER?e={command:"setDeviceParams",params:{timer:{enabled:!0}}}:a==this.CMD_WING1_OPEN?e={command:"setDeviceParams",params:{openclose:{0:"OPEN"}}}:a==this.CMD_WING1_CLOSE?e={command:"setDeviceParams",params:{openclose:{0:"CLOSE_WO_LOCK"}}}:a==this.CMD_WING1_STOP?e={command:"setDeviceParams",params:{stop:{0:!0}}}:
a==this.CMD_WING1_POSITION1?e={command:"setDeviceParams",params:{openclose:{0:"STOP_OVER"}}}:a==this.CMD_WING1_POSITION2?e={command:"setDeviceParams",params:{openclose:{0:"GAP_VENT"}}}:a==this.CMD_WING1_LOCK?e={command:"setDeviceParams",params:{openclose:{0:"CLOSE"}}}:a==this.CMD_WING2_OPEN?e={command:"setDeviceParams",params:{openclose:{1:"OPEN"}}}:a==this.CMD_WING2_CLOSE?e={command:"setDeviceParams",params:{openclose:{1:"CLOSE_WO_LOCK"}}}:a==this.CMD_WING2_STOP?e={command:"setDeviceParams",params:{stop:{1:!0}}}:
a==this.CMD_WING2_LOCK?e={command:"setDeviceParams",params:{openclose:{1:"CLOSE"}}}:a==this.CMD_SET_STOPOVER?(f=Math.round(parseInt(b)/10),3>f&&(f=3),e={command:"setDeviceParams",params:{stopover:f}}):a==this.CMD_SILENT_ON?e={command:"setDeviceParams",params:{silent_state:!0}}:a==this.CMD_SILENT_OFF&&(e={command:"setDeviceParams",params:{silent_state:!1}});e?(d=this,this.connect(function(a,b){a?(a.code=d.CONNECTION_ERROR,c&&c(a)):(b.setDataCallback(d._dataCallback),d.send(b,e,function(a,b){setTimeout(function(){c&&
c(a,b)},250)}))})):c&&c(Error("no such command"))};xnm.aio.siegenia.Genius.prototype.getDevice=function(a){this.execute(this.CMD_GETDEVICE,null,function(b,c){a&&a(b,c)})};xnm.aio.siegenia.Genius.prototype.getState=function(a){this.execute(this.CMD_GETPARAMS,null,function(b,c){a&&a(b,c)})};
xnm.aio.siegenia.Genius.prototype.executeCommand=function(a,b,c){var d=a=null;"keepAlive"==b?a=this.CMD_KEEPALIVE:"nightmode"==b?a=this.CMD_SETNIGHTMODE:"daymode"==b?a=this.CMD_SETDAYMODE:"open"==b?a=this.CMD_OPEN:"close"==b?a=this.CMD_CLOSE:"open_to_turn"==b?a=this.CMD_OPEN_TO_TURN:"stop"==b?a=this.CMD_STOP:"position1"==b?a=this.CMD_POSITION1:"position2"==b?a=this.CMD_POSITION2:"lock"==b?a=this.CMD_LOCK:"impulseOn"==b?a=this.CMD_IMPULSE_ON:"impulseOff"==b?a=this.CMD_IMPULSE_OFF:"startTimer"==b?a=
this.CMD_STARTTIMER:"stopTimer"==b?a=this.CMD_STOPTIMER:"setImpulse"==b.substr(0,10)?(b=b.replace(/setImpulse/g,""),a=this.CMD_SETIMPULSE,d=parseInt(b),0>d?d=0:86400<d&&(d=86400)):"wing1open"==b?a=this.CMD_WING1_OPEN:"wing1close"==b?a=this.CMD_WING1_CLOSE:"wing1stop"==b?a=this.CMD_WING1_STOP:"wing1lock"==b?a=this.CMD_WING1_LOCK:"wing1position1"==b?a=this.CMD_WING1_POSITION1:"wing1position2"==b?a=this.CMD_WING1_POSITION2:"wing2open"==b?a=this.CMD_WING2_OPEN:"wing2close"==b?a=this.CMD_WING2_CLOSE:"wing2stop"==
b?a=this.CMD_WING2_STOP:"wing2lock"==b?a=this.CMD_WING2_LOCK:"silentOn"==b?a=this.CMD_SILENT_ON:"silentOff"==b?a=this.CMD_SILENT_OFF:"setTimer"==b.substr(0,8)?(a=this.CMD_SETTIMER,d=b=b.replace(/setTimer/g,"")):"setStopover"==b.substr(0,11)&&(a=this.CMD_SET_STOPOVER,d=b=b.replace(/setStopover/g,""));a?this.execute(a,d,function(a,b){c(a,b)}):c&&c()};
xnm.aio.siegenia.Genius.prototype.computeStates=function(a){var b={};"mh10"==this.type&&(1==a.relais1?b.state="open":1==a.relais2&&(b.state="closed"));"mh10"!=this.type&&(0==a.relais1?b.state="closed":1==a.relais1&&(b.state="open"));if("axxentDK"==this.type)b.state="OPEN"==a.state?"open":"CLOSED"==a.state?"closed":"MOVING"==a.state?"moving":a.state.toLowerCase(),b.silent_state=1==a.silent_state?"on":"off";else if("axxentHSA"==this.type&&a.states)switch(a.states["0"]){case "OPEN":b.state="open";break;
case "CLOSED_WO_LOCK":b.state="closed";break;case "CLOSED":b.state="locked";break;case "GAP_VENT":b.state="gap";break;case "STOP_OVER":b.state="stopover";break;case "STOPPED":b.state="stop";break;case "MOVING":b.state="moving"}else if("axxentHSA2"==this.type&&a.states){switch(a.states["0"]){case "OPEN":b.wing1state="open";break;case "CLOSED_WO_LOCK":b.wing1state="closed";break;case "CLOSED":b.wing1state="locked";break;case "GAP_VENT":b.wing1state="gap";break;case "STOP_OVER":b.wing1state="stopover";
break;case "STOPPED":b.wing1state="stop";break;case "MOVING":b.wing1state="moving"}switch(a.states["1"]){case "OPEN":b.wing2state="open";break;case "CLOSED_WO_LOCK":b.wing2state="closed";break;case "CLOSED":b.wing2state="locked";break;case "GAP_VENT":b.wing2state="gap";break;case "STOP_OVER":b.wing2state="stopover";break;case "STOPPED":b.wing2state="stop";break;case "MOVING":b.wing2state="moving"}}else"B"==this.type&&(1==a.relais2?b.mode="day":0==a.relais2&&(b.mode="night"),"night"==b.mode&&"closed"==
b.state&&(b.state="locked"));"undefined"!=typeof a.stopover&&null!=a.stopover&&(b.stopover=10*parseInt(a.stopover));b.maxStopover=a.max_stopover;a.timer&&(1==a.timer.enabled?b.timerEnabled="enabled":0==a.timer.enabled&&(b.timerEnabled="disabled"),a.timer.duration&&(b.duration=(10>a.timer.duration.hour?"0":"")+a.timer.duration.hour+":"+(10>a.timer.duration.minute?"0":"")+a.timer.duration.minute,b.durationM=60*parseInt(a.timer.duration.hour)+parseInt(a.timer.duration.minute)),a.timer.remainingtime&&
(b.remainingTime=(10>a.timer.remainingtime.hour?"0":"")+a.timer.remainingtime.hour+":"+(10>a.timer.remainingtime.minute?"0":"")+a.timer.remainingtime.minute,b.remainingTimeM=60*parseInt(a.timer.remainingtime.hour)+parseInt(a.timer.remainingtime.minute)));"mh10"!=this.type&&(1==a.impulse?b.impulse="enabled":0==a.impulse&&(b.impulse="disabled"),void 0!=a.impulseduration&&(b.impulseduration=a.impulseduration));a.warnings&&(b.warnings=a.warnings);return b};
xnm.aio.siegenia.Genius.prototype.getStates=function(a,b,c){var d=this;b&&b.id&&a&&(xnm.aio.siegenia._IQONTROLStateCallbacks[this.ip]={id:b?b.id:null,ch:a});this.getState(function(e,f){var g=null;e?g={error:e.message}:f&&(g=d.computeStates(f));g&&d._doStateCallback(b?b.id:null,a,g);c&&g&&c(g)})};xnm.aio.siegenia.Genius.prototype.getStateValues=function(a){return a};
xnm.aio.siegenia.Genius.prototype._doStateCallback=function(a,b,c){c.error||(c.error="");if(a&&b&&b.setState){c.state&&b.setState(a,c.state);for(var d in c)"state"!=d&&"warnings"!=d?b.setState(a+":"+d,c[d]):"warnings"==d&&c[d]&&b.setState(a+":warnings",c[d].toString())}else b&&b.receivedState&&b.receivedState("siegenia",this.ip,c)};
xnm.aio.siegenia.Genius.prototype.executeCommandCreator=function(a,b,c){if(b&&b.value){var d=b.value;switch(d){case "setImpulse":case "setTimer":case "setStopover":if("undefined"==typeof b.ext||null==b.ext){c&&c(Error("command ext invalid"));return}d+=b.ext}this.executeCommand(a,d,function(a){c&&c(a)})}else c&&c(Error("command value is empty"))};
xnm.aio.siegenia.Genius.prototype.getStatesCreator=function(a,b,c){var d=this;this._getState(function(a,f){if(f){var g=null;a?g={error:a.message}:f&&(g=d.computeStates(f));for(var l=[],h=0;h<b.length;h++){var k=b[h];if(k&&k.id&&k.status&&k.status.value){var m=g[k.status.value];"undefined"!=typeof m&&null!=m&&l.push({id:k.id,status:m})}}c&&c(null,l)}else c&&c(Error("get state error"))})};
xnm.aio.siegenia.Genius.prototype.getSingleDeviceStatesCreator=function(a,b,c,d){var e=this;this._getState(function(a,b){if(b){var c=null;a?c={error:a.message}:b&&(c=e.computeStates(b));d&&d(null,c)}else d&&d(Error("get state error"))})};xnm.aio.siegenia.Genius.prototype._getState=function(a){var b=this;this.connect(function(c,d){c?(c.code=b.CONNECTION_ERROR,a&&a(c)):d&&d._deviceParam?a&&a(null,d._deviceParam):b.send(d,{command:"getDeviceParams"},function(b,c){setTimeout(function(){a&&a(b,c)},250)})})};
xnm.aio.siegenia.AEROPAC=function(a,b,c,d,e){this.ip=a;b&&(this.user=b);c&&(this.password=c);e&&(this.port=e);this.type="aeropac";d&&(this.type=d);this.CommandHandler=null;var f=this;this._dataCallback=function(a,b){var c=f._resolveData(a,b),d=xnm.aio.siegenia._IQONTROLStateCallbacks[f.ip];c&&d&&d.id&&d.ch&&f._doStateCallback(d.id,d.ch,c)}};xnm.aio.siegenia.AEROPAC.prototype=new xnm.aio.siegenia.WSDevice;xnm.aio.siegenia.AEROPAC.prototype.constructor=xnm.aio.siegenia.Genius;
xnm.aio.siegenia.AEROPAC.prototype.CMD_KEEPALIVE=257;xnm.aio.siegenia.AEROPAC.prototype.CMD_GETPARAMS=258;xnm.aio.siegenia.AEROPAC.prototype.CMD_GETSTATE=259;xnm.aio.siegenia.AEROPAC.prototype.CMD_ON=260;xnm.aio.siegenia.AEROPAC.prototype.CMD_OFF=261;xnm.aio.siegenia.AEROPAC.prototype.CMD_SETFANLEVEL=262;xnm.aio.siegenia.AEROPAC.prototype.CMD_AUTOMODE_ON=263;xnm.aio.siegenia.AEROPAC.prototype.CMD_AUTOMODE_OFF=264;xnm.aio.siegenia.AEROPAC.prototype.CMD_SETFANPOWER=265;
xnm.aio.siegenia.AEROPAC.prototype.CMD_SETAUTOFANPOWER=266;xnm.aio.siegenia.AEROPAC.prototype.CMD_SETFANMODE_IN=267;xnm.aio.siegenia.AEROPAC.prototype.CMD_SETFANMODE_OUT=268;xnm.aio.siegenia.AEROPAC.prototype.CMD_SETFANMODE_INOUT=269;xnm.aio.siegenia.AEROPAC.prototype.CMD_SETFANMODE_INOUT_WRG=270;xnm.aio.siegenia.AEROPAC.prototype.CMD_SETSENSORSENSITIVITY=271;xnm.aio.siegenia.AEROPAC.prototype.CMD_SETTIMER=272;xnm.aio.siegenia.AEROPAC.prototype.CMD_STOPTIMER=273;
xnm.aio.siegenia.AEROPAC.prototype.CMD_STARTTIMER=274;xnm.aio.siegenia.AEROPAC.prototype.CMD_SET_DAILYTIMER=275;xnm.aio.siegenia.AEROPAC.prototype.CMD_START_DAILYTIMER=276;xnm.aio.siegenia.AEROPAC.prototype.CMD_STOP_DAILYTIMER=277;xnm.aio.siegenia.AEROPAC.prototype.CMD_LEDS_ON=278;xnm.aio.siegenia.AEROPAC.prototype.CMD_LEDS_OFF=279;xnm.aio.siegenia.AEROPAC.prototype.CMD_ADD_TIMER=280;xnm.aio.siegenia.AEROPAC.prototype.CMD_DELETE_TIMER=281;xnm.aio.siegenia.AEROPAC.prototype.CMD_UPDATE_TIMER=288;
xnm.aio.siegenia.AEROPAC.prototype.execute=function(a,b,c){var d=null;if(a==this.CMD_KEEPALIVE)d={command:"keepAlive",extend_session:!1};else if(a==this.CMD_GETPARAMS)d={command:"getDeviceParams"};else if(a==this.CMD_GETSTATE)d={command:"getDeviceState"};else if(a==this.CMD_ON)d={command:"setDeviceParams",params:{devicestate:{deviceactive:!0}}};else if(a==this.CMD_OFF)d={command:"setDeviceParams",params:{devicestate:{deviceactive:!1}}};else if(a==this.CMD_LEDS_ON)d={command:"setDeviceParams",params:{leds:!0}};
else if(a==this.CMD_LEDS_OFF)d={command:"setDeviceParams",params:{leds:!1}};else if(a==this.CMD_SETFANLEVEL)d={command:"setDeviceParams",params:{devicestate:{deviceactive:!0},fanlevel:b}};else if(a==this.CMD_SETFANPOWER)d={command:"setDeviceParams",params:{devicestate:{deviceactive:!0},fanpower:b}};else if(a==this.CMD_SETAUTOFANPOWER)d={command:"setDeviceParams",params:{automode_maxairflow:b}};else if(a==this.CMD_SETSENSORSENSITIVITY)d={command:"setDeviceParams",params:{automode_co2sensity:b}};else if(a==
this.CMD_AUTOMODE_ON)d={command:"setDeviceParams",params:{automode:!0}};else if(a==this.CMD_AUTOMODE_OFF)d={command:"setDeviceParams",params:{automode:!1}};else if(a==this.CMD_SETFANMODE_IN)d={command:"setDeviceParams",params:{fanmode:"IN"}};else if(a==this.CMD_SETFANMODE_OUT)d={command:"setDeviceParams",params:{fanmode:"OUT"}};else if(a==this.CMD_SETFANMODE_INOUT)d={command:"setDeviceParams",params:{fanmode:"IN_OUT"}};else if(a==this.CMD_SETFANMODE_INOUT_WRG)d={command:"setDeviceParams",params:{fanmode:"IN_OUT_WRG"}};
else if(a==this.CMD_SETTIMER){a=-1;var e=b,f=0;b.indexOf&&(a=b.indexOf(":"));-1!=a&&(e=b.substr(0,a),f=b.substr(a+1));e=parseInt(e);f=parseInt(f);d={command:"setDeviceParams",params:{timer:{duration:{hour:e,minute:f}}}}}else a==this.CMD_STOPTIMER?d={command:"setDeviceParams",params:{timer:{enabled:!1}}}:a==this.CMD_STARTTIMER?d={command:"setDeviceParams",params:{timer:{enabled:!0}}}:a==this.CMD_SET_DAILYTIMER?(a=b.indexOf(":"),e=b,f=0,-1!=a&&(e=b.substr(0,a),f=b.substr(a+1)),e=parseInt(e),f=parseInt(f),
d={command:"setDeviceParams",params:{timer:{poweron_time:{hour:e,minute:f}}}}):a==this.CMD_START_DAILYTIMER?d={command:"setDeviceParams",params:{timer:{repeat:!0}}}:a==this.CMD_STOP_DAILYTIMER?d={command:"setDeviceParams",params:{timer:{repeat:!1}}}:a==this.CMD_ADD_TIMER?d={command:"setDeviceParams",params:{timer:b}}:a==this.CMD_DELETE_TIMER?d={command:"setDeviceParams",params:{timer:b}}:a==this.CMD_UPDATE_TIMER&&(d={command:"setDeviceParams",params:{timer:b}});if(d){var g=this;this.connect(function(a,
b){a?(a.code=g.CONNECTION_ERROR,c&&c(a)):(b.setDataCallback(g._dataCallback),g.send(b,d,function(a,b){setTimeout(function(){c&&c(a,b)},250)}))})}else c&&c(Error("no such command"))};xnm.aio.siegenia.AEROPAC.prototype.getState=function(a){this.execute(this.CMD_GETPARAMS,null,function(b,c){a&&a(b,c)})};
xnm.aio.siegenia.AEROPAC.prototype.executeCommand=function(a,b,c){var d=a=null;"keepAlive"==b?a=this.CMD_KEEPALIVE:"on"==b?a=this.CMD_ON:"off"==b?a=this.CMD_OFF:"ledsOn"==b?a=this.CMD_LEDS_ON:"ledsOff"==b?a=this.CMD_LEDS_OFF:"automodeOn"==b?a=this.CMD_AUTOMODE_ON:"automodeOff"==b?a=this.CMD_AUTOMODE_OFF:"fanmodeIn"==b?a=this.CMD_SETFANMODE_IN:"fanmodeOut"==b?a=this.CMD_SETFANMODE_OUT:"fanmodeInOut"==b?a=this.CMD_SETFANMODE_INOUT:"fanmodeInOutWRG"==b?a=this.CMD_SETFANMODE_INOUT_WRG:"startTimer"==b?
a=this.CMD_STARTTIMER:"stopTimer"==b?a=this.CMD_STOPTIMER:0==b.indexOf("setTimer")?(a=this.CMD_SETTIMER,b=b.replace(/setTimer/g,""),-1!=b.indexOf(":")?d=b:(d=parseInt(b),1>d&&(d=1),18<d&&(d=18))):"startDailyPowerOn"==b?a=this.CMD_START_DAILYTIMER:"stopDailyPowerOn"==b?a=this.CMD_STOP_DAILYTIMER:0==b.indexOf("setDailyPowerOn")?(a=this.CMD_SET_DAILYTIMER,d=b=b.replace(/setDailyPowerOn/g,"")):(0==b.indexOf("setTo")?(a=this.CMD_SETFANPOWER,b=b.replace(/setTo/g,"")):0==b.indexOf("setAutoTo")?(a=this.CMD_SETAUTOFANPOWER,
b=b.replace(/setAutoTo/g,"")):0==b.indexOf("setSensorTo")&&(a=this.CMD_SETSENSORSENSITIVITY,b=b.replace(/setSensorTo/g,"")),d=parseInt(b),"aerotube"==this.type?(15>d&&(d=15),100<d&&(d=100)):"aerovital"==this.type?(0>d&&(d=0),100<d&&(d=100)):"aeromatVT"==this.type?(a=this.CMD_SETFANPOWER,0==d&&(d=1),100<d&&(d=100)):(a=this.CMD_SETFANLEVEL,7<d&&(d=7)));a?this.execute(a,d,function(a,b){c(a,b)}):c&&c()};
xnm.aio.siegenia.AEROPAC.prototype.computeStates=function(a){var b={},b={};1==a.automode?b.automode="on":0==a.automode&&(b.automode="off");"undefined"!=typeof a.airquality&&null!=a.airquality&&(b.airquality=""+a.airquality);void 0!=a.fanpower&&(b.fanpower="aerotube"==this.type?(a.fanpower/100*45).toFixed(1):"aerovital"==this.type?(a.fanpower/100*60).toFixed(1):(a.fanpower/100*21).toFixed(1),b.state=0==a.fanpower?1==b.automode?"on":"off":"on");void 0!=a.fanlevel&&(b.fanlevel=""+a.fanlevel,b.state=
0==a.fanlevel?"off":"on");a.devicestate&&void 0!=a.devicestate.deviceactive&&(b.state=1==a.devicestate.deviceactive?"on":"off");a.automode_maxairflow&&("aerotube"==this.type?b.autoairflow=(a.automode_maxairflow/100*45).toFixed(1):"aerovital"==this.type&&(b.autoairflow=(a.automode_maxairflow/100*60).toFixed(1)));void 0!=a.automode_co2sensity&&(b.autosensitivity=""+a.automode_co2sensity);void 0!=a.fanmode&&(b.fanmode=a.fanmode.toLowerCase());if(a.timer){b.activeTimer=a.timer.activetimer;var c=[];a.timer.timer_valid>>
7&1&&c.push(1);a.timer.timer_valid>>6&1&&c.push(2);a.timer.timer_valid>>5&1&&c.push(3);a.timer.timer_valid>>4&1&&c.push(4);a.timer.timer_valid>>3&1&&c.push(5);b.validTimers=c;1==a.timer.enabled?b.timerEnabled="enabled":0==a.timer.enabled&&(b.timerEnabled="disabled");a.timer.remainingtime&&(b.remainingTimeM=60*parseInt(a.timer.remainingtime.hour)+parseInt(a.timer.remainingtime.minute),b.remainingTime=10>a.timer.remainingtime.minute?a.timer.remainingtime.hour+":0"+a.timer.remainingtime.minute:a.timer.remainingtime.hour+
":"+a.timer.remainingtime.minute);1==a.timer.repeat?b.dailyPowerOnEnabled="enabled":0==a.timer.repeat&&(b.dailyPowerOnEnabled="disabled");var d;a.timer.poweron_time&&(c=a.timer.poweron_time.hour+"",2>c.length&&(c="0"+c),d=a.timer.poweron_time.minute+"",2>d.length&&(d="0"+d),b.dailyPowerOnTime=c+":"+d);a.timer.duration&&(c=a.timer.duration.hour+"",2>c.length&&(c="0"+c),d=a.timer.duration.minute+"",2>d.length&&(d="0"+d),b.duration=c+":"+d,b.durationH=parseInt(a.timer.duration.hour))}if(a.list_timers){b.timers=
[];for(var e=0;e<a.list_timers.length;e++){var f=a.list_timers[e],g=f;"object"==typeof f.duration&&(c=f.duration.hour+"",2>c.length&&(c="0"+c),d=f.duration.minute+"",2>d.length&&(d="0"+d),g.duration=c+":"+d);"object"==typeof f.poweron_time&&(c=f.poweron_time.hour+"",2>c.length&&(c="0"+c),d=f.poweron_time.minute+"",2>d.length&&(d="0"+d),g.poweron_time=c+":"+d);for(g.poweron_weekday=f.poweron_weekday.toString(2);7>g.poweron_weekday.length;)g.poweron_weekday="0"+g.poweron_weekday;b.timers.push(g)}}a.airbase&&
(a.airbase.humidity||a.airbase.temperature)&&(a.airbase.temperature&&a.airbase.temperature.indoor&&(b.indoorTemp=a.airbase.temperature.indoor.toFixed(1)),a.airbase.temperature&&a.airbase.temperature.outdoor&&(b.outdoorTemp=a.airbase.temperature.outdoor.toFixed(1)),a.airbase.humidity&&a.airbase.humidity.indoor&&(b.indoorHum=a.airbase.humidity.indoor.toFixed(1)),a.airbase.humidity&&a.airbase.humidity.outdoor&&(b.outdoorHum=a.airbase.humidity.outdoor.toFixed(1)));"undefined"!=typeof a.leds&&null!=a.leds&&
(b.leds=a.leds?"on":"off");a.warnings&&(b.warnings=a.warnings);return b};xnm.aio.siegenia.AEROPAC.prototype.getStates=function(a,b,c){var d=this;b&&b.id&&a&&(xnm.aio.siegenia._IQONTROLStateCallbacks[this.ip]={id:b?b.id:null,ch:a});this.getState(function(e,f){var g=null;e?g={error:e.message}:f&&(d.state=f,g=d.computeStates(f));g&&d._doStateCallback(b?b.id:null,a,g);c&&g&&c(g)})};xnm.aio.siegenia.AEROPAC.prototype.getStateValues=function(a){return a};
xnm.aio.siegenia.AEROPAC.prototype._doStateCallback=function(a,b,c){c.error||(c.error="");if(a&&b&&b.setState){c.state&&b.setState(a,c.state);for(var d in c)"state"!=d&&"warnings"!=d?b.setState(a+":"+d,c[d]):"warnings"==d&&c[d]&&b.setState(a+":warnings",c[d].toString())}else b&&b.receivedState&&b.receivedState("siegenia",this.ip,c)};
xnm.aio.siegenia.AEROPAC.prototype.addTimer=function(a,b){if(a.duration){var c=a.duration.split(":")[0],d=a.duration.split(":")[1];a.duration={hour:parseInt(c),minute:parseInt(d)}}a.poweron_time&&(c=a.poweron_time.split(":")[0],d=a.poweron_time.split(":")[1],a.poweron_time={hour:parseInt(c),minute:parseInt(d)});a.poweron_weekday&&(a.poweron_weekday=parseInt(a.poweron_weekday,2));this.execute(this.CMD_ADD_TIMER,a,b)};
xnm.aio.siegenia.AEROPAC.prototype.deleteTimer=function(a,b){a.timer_id?this.execute(this.CMD_DELETE_TIMER,{timer_delete:!0,timer_id:a.timer_id},b):b&&b(Error("no timer id"))};
xnm.aio.siegenia.AEROPAC.prototype.updateTimer=function(a,b){if(a.timer_id){if(a.duration){var c=a.duration.split(":")[0],d=a.duration.split(":")[1];a.duration={hour:parseInt(c),minute:parseInt(d)}}a.poweron_time&&(c=a.poweron_time.split(":")[0],d=a.poweron_time.split(":")[1],a.poweron_time={hour:parseInt(c),minute:parseInt(d)});a.poweron_weekday&&(a.poweron_weekday=parseInt(a.poweron_weekday,2));this.execute(this.CMD_UPDATE_TIMER,a,b)}else b&&b(Error("no timer id"))};
xnm.aio.siegenia.AEROPAC.prototype.executeCommandCreator=function(a,b,c){if(b&&b.value){var d=b.value,e;switch(d){case "setTo":if("undefined"==typeof b.ext||null==b.ext){c&&c(Error("command ext invalid"));return}e=parseInt(b.ext);"aeromatVT"==this.type&&(e=Math.round(parseInt(b.ext)/21*100));"aerovital"==this.type&&(e=Math.round(parseInt(b.ext)/60*100));"aerotube"==this.type&&(e=Math.round(parseInt(b.ext)/45*100));d+=e;break;case "setAutoTo":if("undefined"==typeof b.ext||null==b.ext){c&&c(Error("command ext invalid"));
return}e=parseInt(b.ext);"aerovital"==this.type&&(e=Math.round(parseInt(b.ext)/60*100));"aerotube"==this.type&&(e=Math.round(parseInt(b.ext)/45*100));d+=e;break;case "setSensorTo":if("undefined"==typeof b.ext||null==b.ext){c&&c(Error("command ext invalid"));return}e=parseInt(b.ext);d+=e;break;case "setTimer":case "setDailyPowerOn":if("undefined"==typeof b.ext||null==b.ext){c&&c(Error("command ext invalid"));return}e=b.ext;d+=e}this.executeCommand(a,d,function(a){c&&c(a)})}else c&&c(Error("command value is empty"))};
xnm.aio.siegenia.AEROPAC.prototype.getStatesCreator=function(a,b,c){var d=this;this._getState(function(a,f){if(f){var g=null;a?g={error:a.message}:f&&(g=d.computeStates(f));for(var l=[],h=0;h<b.length;h++){var k=b[h];if(k&&k.id&&k.status&&k.status.value){var m=g[k.status.value];"undefined"!=typeof m&&null!=m&&l.push({id:k.id,status:m})}}c&&c(null,l)}else c&&c(Error("get state error"))})};
xnm.aio.siegenia.AEROPAC.prototype.getSingleDeviceStatesCreator=function(a,b,c,d){var e=this;this._getState(function(a,b){if(b){var c=null;a?c={error:a.message}:b&&(c=e.computeStates(b));d&&d(null,c)}else d&&d(Error("get state error"))})};xnm.aio.siegenia.AEROPAC.prototype._getState=function(a){var b=this;this.connect(function(c,d){c?(c.code=b.CONNECTION_ERROR,a&&a(c)):d&&d._deviceParam?a&&a(null,d._deviceParam):b.send(d,{command:"getDeviceParams"},function(b,c){setTimeout(function(){a&&a(b,c)},250)})})};
xnm.aio.siegenia.RulesManager=function(){};
xnm.aio.siegenia.RulesManager.prototype.getOperations=function(a,b,c,d){c||(c="trigger");d||(d="state");a=[];if("sensoair"==b)b={trigger:[window.XC_Text["<="],window.XC_Text[">="]],condition:[window.XC_Text["<="],window.XC_Text[">="]]},"airquality"==d&&(a.push({id:b[c][0],value:"<="}),a.push({id:b[c][1],value:">="}));else if("geniusA"==b||"geniusB"==b||"aeropac"==b)b={trigger:window.XC_Text.changesto,condition:window.XC_Text.is},a.push({id:b[c],value:"="});else if("mh10"==b||"axxentHSA"==b||"axxentHSA2"==
b||"axxentDK"==b)b={trigger:window.XC_Text.changesto,condition:window.XC_Text.is},a.push({id:b[c],value:"="});else if("aeromatVT"==b||"aerovital"==b)b={trigger:[window.XC_Text["<="],window.XC_Text[">="],window.XC_Text.changesto],condition:[window.XC_Text["<="],window.XC_Text[">="],window.XC_Text.is]},"indoorHum"==d||"outdoorHum"==d||"outdoorTemp"==d||"indoorTemp"==d||"airquality"==d?(a.push({id:b[c][0],value:"<="}),a.push({id:b[c][1],value:">="})):"state"!=d&&"automode"!=d&&"fanmode"!=d&&"warning"!=
d||a.push({id:b[c][2],value:"="});else if("aerotube"==b)if(b={trigger:[window.XC_Text["<="],window.XC_Text[">="],window.XC_Text.changesto],condition:[window.XC_Text["<="],window.XC_Text[">="],window.XC_Text.is]},"fanmode"==d||"automode"==d||"state"==d||"warning"==d)a.push({id:b[c][2],value:"="});else if("fanpower"==d|"autoairflow"==d||"indoorTemp"==d||"indoorHum"==d)a.push({id:b[c][0],value:"<="}),a.push({id:b[c][1],value:">="});return a};
xnm.aio.siegenia.RulesManager.prototype.getDeviceChannels=function(a,b,c){a=[];if("sensoair"==b){if("trigger"==c||"condition"==c)a=["airquality"]}else if("geniusB"==b)"trigger"==c?a=["mode","state"]:"condition"==c?a=["mode","state"]:"action"==c&&(a=["state"]);else if("geniusA"==b)"action"==c&&(a=["state"]);else if("axxentDK"==b||"axxentHSA"==b||"axxentHSA2"==b)"trigger"==c?a=["state","warning"]:"condition"==c?a=["state"]:"action"==c&&(a=["state"]);else if("mh10"==b)"trigger"==c?a=["state"]:"condition"==
c?a=["state"]:"action"==c&&(a=["state"]);else if("aeropac"==b)"trigger"==c?a=["state","warning"]:"condition"==c?a=["state"]:"action"==c&&(a=["state"]);else if("aerotube"==b)"trigger"==c?a="indoorHum indoorTemp autoairflow fanpower automode fanmode state warning".split(" "):"condition"==c?a="indoorHum indoorTemp autoairflow fanpower automode fanmode state".split(" "):"action"==c&&(a=["state"]);else if("aeromatVT"==b||"aerovital"==b)"trigger"==c?(a="automode indoorHum outdoorHum outdoorTemp indoorTemp airquality state warning".split(" "),
"aerovital"==b&&(a="fanmode automode indoorHum outdoorHum outdoorTemp indoorTemp airquality state warning".split(" "))):"condition"==c?(a="automode indoorHum outdoorHum outdoorTemp indoorTemp airquality state".split(" "),"aerovital"==b&&(a="fanmode automode indoorHum outdoorHum outdoorTemp indoorTemp airquality state".split(" "))):"action"==c&&(a=["state"]);return a};
xnm.aio.siegenia.RulesManager.prototype.getCommands=function(a,b,c,d){a=[];if("sensoair"==b)"trigger"!=c&&"condition"!=c||"airquality"!=d||a.push({id:"?",value:"?",hysteresis:!0,status:"airquality",type:"device.status",sys:"siegenia"});else if("geniusA"==b||"axxentDK"==b||"axxentHSA"==b)if("action"==c)a.push({id:window.XC_Text.open.toLowerCase(),value:"open",action:"",sys:"siegenia",subtype:"command",type:"action"}),a.push({id:window.XC_Text.close.toLowerCase(),value:"close",action:"",sys:"siegenia",
subtype:"command",type:"action"}),"axxentHSA"==b&&(a.push({id:window.XC_Text.lock.toLowerCase(),value:"lock",action:"",sys:"siegenia",subtype:"command",type:"action"}),a.push({id:window.XC_Text.open_gap,value:"position1",action:"",sys:"siegenia",subtype:"command",type:"action"}),a.push({id:window.XC_Text.open_to_position,value:"position2",action:"",sys:"siegenia",subtype:"command",type:"action"}),a.push({id:window.XC_Text.activate_timer10,value:"startTimer",action:"",sys:"siegenia",subtype:"command",
type:"action"}),a.push({id:window.XC_Text.deactivate_timer10,value:"stopTimer",action:"",sys:"siegenia",subtype:"command",type:"action"})),"axxentDK"==b&&(a.push({id:window.XC_Text.automode_on.toLowerCase(),value:"automodeOn",action:"",sys:"siegenia",subtype:"command",type:"action"}),a.push({id:window.XC_Text.automode_off.toLowerCase(),value:"automodeOff",action:"",sys:"siegenia",subtype:"command",type:"action"}));else{if("condition"==c||"trigger"==c)"axxentDK"!=b&&"axxentHSA"!=b&&"geniusA"!=b||"state"!=
d?"axxentDK"==b&&"trigger"==c&&"warning"==d&&a.push({id:window.XC_Text.CLOSE_FAILED,value:"CLOSE_FAILED",hysteresis:!1,status:"warning",type:"device.status",sys:"siegenia"}):(a.push({id:window.XC_Text.opened.toLowerCase(),value:"open",hysteresis:!1,status:"state",type:"device.status",sys:"siegenia"}),a.push({id:window.XC_Text.closed.toLowerCase(),value:"closed",hysteresis:!1,status:"state",type:"device.status",sys:"siegenia"}),"axxentHSA"==b&&(a.push({id:window.XC_Text.stop.toLowerCase(),value:"stop",
hysteresis:!1,status:"state",type:"device.status",sys:"siegenia"}),a.push({id:window.XC_Text.locked.toLowerCase(),value:"locked",hysteresis:!1,status:"state",type:"device.status",sys:"siegenia"}),a.push({id:window.XC_Text.gap_vent,value:"gap",hysteresis:!1,status:"state",type:"device.status",sys:"siegenia"}),"trigger"==c&&a.push({id:window.XC_Text.ENGINE_OVERHEATING,value:"ENGINE_OVERHEATING",hysteresis:!1,status:"warning",type:"device.status",sys:"siegenia"})))}else if("axxentHSA2"==b)if("action"==
c)a.push({id:window.XC_Text.wing1open,value:"wing1open",action:"",sys:"siegenia",subtype:"command",type:"action"}),a.push({id:window.XC_Text.wing2open,value:"wing2open",action:"",sys:"siegenia",subtype:"command",type:"action"}),a.push({id:window.XC_Text.close_wing1,value:"wing1close",action:"",sys:"siegenia",subtype:"command",type:"action"}),a.push({id:window.XC_Text.close_wing2,value:"wing2close",action:"",sys:"siegenia",subtype:"command",type:"action"}),a.push({id:window.XC_Text.stop_wing1,value:"wing1stop",
hysteresis:!1,status:"state",type:"device.status",sys:"siegenia"}),a.push({id:window.XC_Text.stop_wing2,value:"wing2stop",hysteresis:!1,status:"state",type:"device.status",sys:"siegenia"}),a.push({id:window.XC_Text.lock.toLowerCase(),value:"wing1lock",action:"",sys:"siegenia",subtype:"command",type:"action"}),a.push({id:window.XC_Text.open_gap,value:"wing1position1",action:"",sys:"siegenia",subtype:"command",type:"action"}),a.push({id:window.XC_Text.open_to_position,value:"wing1position2",action:"",
sys:"siegenia",subtype:"command",type:"action"}),a.push({id:window.XC_Text.activate_timer10,value:"startTimer",action:"",sys:"siegenia",subtype:"command",type:"action"}),a.push({id:window.XC_Text.deactivate_timer10,value:"stopTimer",action:"",sys:"siegenia",subtype:"command",type:"action"});else{if("condition"==c||"trigger"==c)"state"==d?(a.push({id:window.XC_Text.opened.toLowerCase(),value:"open",hysteresis:!1,status:"state",type:"device.status",sys:"siegenia"}),a.push({id:window.XC_Text.closed.toLowerCase(),
value:"closed",hysteresis:!1,status:"state",type:"device.status",sys:"siegenia"}),a.push({id:window.XC_Text.locked.toLowerCase(),value:"locked",hysteresis:!1,status:"state",type:"device.status",sys:"siegenia"}),a.push({id:window.XC_Text.gap_vent,value:"gap",hysteresis:!1,status:"state",type:"device.status",sys:"siegenia"})):"warning"==d&&"trigger"==c&&a.push({id:window.XC_Text.ENGINE_OVERHEATING,value:"ENGINE_OVERHEATING",hysteresis:!1,status:"warning",type:"device.status",sys:"siegenia"})}else if("geniusB"==
b)"action"==c?(a.push({id:window.XC_Text.open.toLowerCase(),value:"open",action:"",sys:"siegenia",subtype:"command",type:"action"}),a.push({id:window.XC_Text.close.toLowerCase(),value:"close",action:"",sys:"siegenia",subtype:"command",type:"action"}),a.push({id:window.XC_Text.in_day_mode,value:"daymode",action:window.XC_Text.action_switch,sys:"siegenia",subtype:"command",type:"action"}),a.push({id:window.XC_Text.in_night_mode,value:"nightmode",action:window.XC_Text.action_switch,sys:"siegenia",subtype:"command",
type:"action"})):"condition"!=c&&"trigger"!=c||"state"!=d?"condition"==c&&"mode"==d?(a.push({id:window.XC_Text.in_day_mode,value:"day",hysteresis:!1,status:"mode",type:"device.status",sys:"siegenia"}),a.push({id:window.XC_Text.in_night_mode,value:"night",hysteresis:!1,status:"mode",type:"device.status",sys:"siegenia"})):"trigger"==c&&"mode"==d&&(a.push({id:window.XC_Text.day_mode,value:"day",hysteresis:!1,status:"mode",type:"device.status",sys:"siegenia"}),a.push({id:window.XC_Text.night_mode,value:"night",
hysteresis:!1,status:"mode",type:"device.status",sys:"siegenia"})):(a.push({id:window.XC_Text.opened.toLowerCase(),value:"open",hysteresis:!1,status:"state",type:"device.status",sys:"siegenia"}),a.push({id:window.XC_Text.closed.toLowerCase(),value:"closed",hysteresis:!1,status:"state",type:"device.status",sys:"siegenia"}),a.push({id:window.XC_Text.locked.toLowerCase(),value:"locked",hysteresis:!1,status:"state",type:"device.status",sys:"siegenia"}));else if("mh10"==b)"action"==c?(a.push({id:window.XC_Text.open.toLowerCase(),
value:"open",action:"",sys:"siegenia",subtype:"command",type:"action"}),a.push({id:window.XC_Text.close.toLowerCase(),value:"close",action:"",sys:"siegenia",subtype:"command",type:"action"}),a.push({id:window.XC_Text.stop.toLowerCase(),value:"stop",action:"",sys:"siegenia",subtype:"command",type:"action"})):"condition"==c&&"state"==d&&(a.push({id:window.XC_Text.opened.toLowerCase(),value:"open",hysteresis:!1,status:"state",type:"device.status",sys:"siegenia"}),a.push({id:window.XC_Text.closed.toLowerCase(),
value:"close",hysteresis:!1,status:"state",type:"device.status",sys:"siegenia"}));else if("aeropac"==b)"action"==c?(a.push({id:window.XC_Text.on.toLowerCase(),value:"on",action:window.XC_Text.action_switch,sys:"siegenia",subtype:"command",type:"action"}),a.push({id:window.XC_Text.off.toLowerCase(),value:"off",action:window.XC_Text.action_switch,sys:"siegenia",subtype:"command",type:"action"})):"trigger"!=c&&"condition"!=c||"state"!=d?"trigger"==c&&"warning"==d&&a.push({id:window.XC_Text.REPLACE_AIRFILTER,
value:"REPLACE_AIRFILTER",hysteresis:!1,status:"warning",type:"device.status",sys:"siegenia"}):(a.push({id:window.XC_Text.switchedon.toLowerCase(),value:"on",hysteresis:!1,status:"state",type:"device.status",sys:"siegenia"}),a.push({id:window.XC_Text.switchedoff.toLowerCase(),value:"off",hysteresis:!1,status:"state",type:"device.status",sys:"siegenia"}));else if("aeromatVT"==b)if("action"==c)for(a.push({id:window.XC_Text.on.toLowerCase(),value:"on",action:window.XC_Text.action_switch,sys:"siegenia",
subtype:"command",type:"action"}),a.push({id:window.XC_Text.off.toLowerCase(),value:"off",action:window.XC_Text.action_switch,sys:"siegenia",subtype:"command",type:"action"}),a.push({id:window.XC_Text.automode_on,value:"automodeOn",action:window.XC_Text.action_switch,sys:"siegenia",subtype:"command",type:"action"}),a.push({id:window.XC_Text.automode_off,value:"automodeOff",action:window.XC_Text.action_switch,sys:"siegenia",subtype:"command",type:"action"}),b=0;21>b;b++)c=10*Math.round(b/21*100)/10,
a.push({id:b+1+" m3/h ",value:"setTo"+c,action:window.XC_Text.action_switch,sys:"siegenia",subtype:"command",type:"action"});else"trigger"!=c&&"condition"!=c||"state"!=d?"trigger"!=c&&"condition"!=c||"automode"!=d?"trigger"!=c&&"condition"!=c||"indoorHum"!=d?"trigger"!=c&&"condition"!=c||"outdoorHum"!=d?"trigger"!=c&&"condition"!=c||"indoorTemp"!=d?"trigger"!=c&&"condition"!=c||"outdoorTemp"!=d?"trigger"!=c&&"condition"!=c||"airquality"!=d?"trigger"==c&&"warning"==d&&(a.push({id:window.XC_Text.REPLACE_AIRFILTER,
value:"REPLACE_AIRFILTER",hysteresis:!1,status:"warning",type:"device.status",sys:"siegenia"}),a.push({id:window.XC_Text.FROST_PROTECTION,value:"FROST_PROTECTION",hysteresis:!1,status:"warning",type:"device.status",sys:"siegenia"})):a.push({id:"?",value:"?",hysteresis:!0,status:"airquality",type:"device.status",sys:"siegenia"}):a.push({id:"?",value:"?",hysteresis:!0,status:"outdoorTemp",type:"device.status",sys:"siegenia"}):a.push({id:"?",value:"?",hysteresis:!0,status:"indoorTemp",type:"device.status",
sys:"siegenia"}):a.push({id:"?",value:"?",hysteresis:!0,status:"outdoorHum",type:"device.status",sys:"siegenia"}):a.push({id:"?",value:"?",hysteresis:!0,status:"indoorHum",type:"device.status",sys:"siegenia"}):(a.push({id:window.XC_Text.switchedon.toLowerCase(),value:"on",hysteresis:!1,status:"automode",type:"device.status",sys:"siegenia"}),a.push({id:window.XC_Text.switchedoff.toLowerCase(),value:"off",hysteresis:!1,status:"automode",type:"device.status",sys:"siegenia"})):(a.push({id:window.XC_Text.switchedon.toLowerCase(),
value:"on",hysteresis:!1,status:"state",type:"device.status",sys:"siegenia"}),a.push({id:window.XC_Text.switchedoff.toLowerCase(),value:"off",hysteresis:!1,status:"state",type:"device.status",sys:"siegenia"}));else if("aerotube"==b)if("action"==c){a.push({id:window.XC_Text.on.toLowerCase(),value:"on",action:window.XC_Text.action_switch,sys:"siegenia",subtype:"command",type:"action"});a.push({id:window.XC_Text.off.toLowerCase(),value:"off",action:window.XC_Text.action_switch,sys:"siegenia",subtype:"command",
type:"action"});a.push({id:window.XC_Text.automode_on,value:"automodeOn",action:window.XC_Text.action_switch,sys:"siegenia",subtype:"command",type:"action"});a.push({id:window.XC_Text.automode_off,value:"automodeOff",action:window.XC_Text.action_switch,sys:"siegenia",subtype:"command",type:"action"});a.push({id:window.XC_Text.fanmode_in,value:"fanmodeIn",action:window.XC_Text.action_switch,sys:"siegenia",subtype:"command",type:"action"});a.push({id:window.XC_Text.fanmode_out,value:"fanmodeOut",action:window.XC_Text.action_switch,
sys:"siegenia",subtype:"command",type:"action"});a.push({id:window.XC_Text.fanmode_inout,value:"fanmodeInOut",action:window.XC_Text.action_switch,sys:"siegenia",subtype:"command",type:"action"});for(b=7;45>b;b++)c=10*Math.round(b/45*100)/10,a.push({id:window.XC_Text.fan_power+" "+(b+1)+" m3/h",value:"setTo"+c,action:window.XC_Text.action_switch,sys:"siegenia",subtype:"command",type:"action"});for(b=7;45>b;b++)c=10*Math.round(b/45*100)/10,a.push({id:window.XC_Text.auto_fan_power+" "+(b+1)+" m3/h",
value:"setAutoTo"+c,action:window.XC_Text.action_switch,sys:"siegenia",subtype:"command",type:"action"})}else"trigger"==c&&"warning"==d?a.push({id:window.XC_Text.REPLACE_AIRFILTER,value:"REPLACE_AIRFILTER",hysteresis:!1,status:"warning",type:"device.status",sys:"siegenia"}):"trigger"!=c&&"condition"!=c||"fanmode"!=d?"trigger"!=c&&"condition"!=c||"automode"!=d?"trigger"!=c&&"condition"!=c||"fanpower"!=d?"trigger"!=c&&"condition"!=c||"autoairflow"!=d?"trigger"!=c&&"condition"!=c||"indoorTemp"!=d?"trigger"!=
c&&"condition"!=c||"indoorHum"!=d||a.push({id:"?",value:"?",hysteresis:!0,status:"indoorHum",type:"device.status",sys:"siegenia"}):a.push({id:"?",value:"?",hysteresis:!0,status:"indoorTemp",type:"device.status",sys:"siegenia"}):a.push({id:"?",value:"?",hysteresis:!0,status:"autoairflow",type:"device.status",sys:"siegenia"}):a.push({id:"?",value:"?",hysteresis:!0,status:"fanpower",type:"device.status",sys:"siegenia"}):(a.push({id:window.XC_Text.switchedon.toLowerCase(),value:"on",hysteresis:!1,status:"automode",
type:"device.status",sys:"siegenia"}),a.push({id:window.XC_Text.switchedoff.toLowerCase(),value:"off",hysteresis:!1,status:"automode",type:"device.status",sys:"siegenia"})):(a.push({id:window.XC_Text.fanmode_in,value:"in",hysteresis:!1,status:"fanmode",type:"device.status",sys:"siegenia"}),a.push({id:window.XC_Text.fanmode_out,value:"out",hysteresis:!1,status:"fanmode",type:"device.status",sys:"siegenia"}),a.push({id:window.XC_Text.fanmode_inout,value:"in_out",hysteresis:!1,status:"fanmode",type:"device.status",
sys:"siegenia"}));else if("aerovital"==b)if("action"==c){a.push({id:window.XC_Text.on.toLowerCase(),value:"on",action:window.XC_Text.action_switch,sys:"siegenia",subtype:"command",type:"action"});a.push({id:window.XC_Text.off.toLowerCase(),value:"off",action:window.XC_Text.action_switch,sys:"siegenia",subtype:"command",type:"action"});a.push({id:window.XC_Text.automode_on,value:"automodeOn",action:window.XC_Text.action_switch,sys:"siegenia",subtype:"command",type:"action"});a.push({id:window.XC_Text.automode_off,
value:"automodeOff",action:window.XC_Text.action_switch,sys:"siegenia",subtype:"command",type:"action"});a.push({id:window.XC_Text.fanmode_in.toLowerCase(),value:"fanmodeIn",action:window.XC_Text.action_switch,sys:"siegenia",subtype:"command",type:"action"});a.push({id:window.XC_Text.fanmode_out,value:"fanmodeOut",action:window.XC_Text.action_switch,sys:"siegenia",subtype:"command",type:"action"});a.push({id:window.XC_Text.fanmode_inout,value:"fanmodeInOut",action:window.XC_Text.action_switch,sys:"siegenia",
subtype:"command",type:"action"});a.push({id:window.XC_Text.fanmode_inout_wrg,value:"fanmodeInOutWRG",action:window.XC_Text.action_switch,sys:"siegenia",subtype:"command",type:"action"});for(b=0;60>b;b++)c=10*Math.round(b/60*100)/10,a.push({id:window.XC_Text.fan_power+" "+(b+1)+" m3/h",value:"setTo"+c,action:window.XC_Text.action_switch,sys:"siegenia",subtype:"command",type:"action"});for(b=0;60>b;b++)c=10*Math.round(b/60*100)/10,a.push({id:window.XC_Text.auto_fan_power+" "+(b+1)+" m3/h",value:"setAutoTo"+
c,action:window.XC_Text.action_switch,sys:"siegenia",subtype:"command",type:"action"});for(b=0;100>b;b+=5)a.push({id:window.XC_Text.auto_fan_power+" Sensor "+(b+1)+" m3/h",value:"setSensorTo"+b,action:window.XC_Text.action_switch,sys:"siegenia",subtype:"command",type:"action"})}else"trigger"!=c&&"condition"!=c||"state"!=d?"trigger"!=c&&"condition"!=c||"automode"!=d?"trigger"!=c&&"condition"!=c||"indoorHum"!=d?"trigger"!=c&&"condition"!=c||"outdoorHum"!=d?"trigger"!=c&&"condition"!=c||"indoorTemp"!=
d?"trigger"!=c&&"condition"!=c||"outdoorTemp"!=d?"trigger"!=c&&"condition"!=c||"airquality"!=d?"trigger"==c&&"warning"==d&&(a.push({id:window.XC_Text.REPLACE_AIRFILTER,value:"REPLACE_AIRFILTER",hysteresis:!1,status:"warning",type:"device.status",sys:"siegenia"}),a.push({id:window.XC_Text.FROST_PROTECTION,value:"FROST_PROTECTION",hysteresis:!1,status:"warning",type:"device.status",sys:"siegenia"})):a.push({id:"?",value:"?",hysteresis:!0,status:"airquality",type:"device.status",sys:"siegenia"}):a.push({id:"?",
value:"?",hysteresis:!0,status:"outdoorTemp",type:"device.status",sys:"siegenia"}):a.push({id:"?",value:"?",hysteresis:!0,status:"indoorTemp",type:"device.status",sys:"siegenia"}):a.push({id:"?",value:"?",hysteresis:!0,status:"outdoorHum",type:"device.status",sys:"siegenia"}):a.push({id:"?",value:"?",hysteresis:!0,status:"indoorHum",type:"device.status",sys:"siegenia"}):(a.push({id:window.XC_Text.switchedon.toLowerCase(),value:"on",hysteresis:!1,status:"automode",type:"device.status",sys:"siegenia"}),
a.push({id:window.XC_Text.switchedoff.toLowerCase(),value:"off",hysteresis:!1,status:"automode",type:"device.status",sys:"siegenia"})):(a.push({id:window.XC_Text.switchedon.toLowerCase(),value:"on",hysteresis:!1,status:"state",type:"device.status",sys:"siegenia"}),a.push({id:window.XC_Text.switchedoff.toLowerCase(),value:"off",hysteresis:!1,status:"state",type:"device.status",sys:"siegenia"}));return a};
xnm.aio.siegenia.DM=function(){var a=function(a,c){this.code=a;this.message=c;this.stack=Error().stack};a.prototype=Error();a.prototype.name="SiegeniaDMError";a.prototype.code=0;a.ERROR_CODE={DEFAULT:0,INDEX_EXISTS:1,ID_EXISTS:2,INVALID:3,UNKNOW:4,NOT_FOUND:5,IP_EXISTS:6};return{SYS:"siegenia",MAP:{geniusA:{command:[{type:"enum",name:"open",ref:{value:"open"}},{type:"enum",name:"close",ref:{value:"close"}}],status:[{type:"enum",name:"state",ref:{value:"state",options:["open","closed"]}},{type:"string",
name:"warnings",ref:{value:"warnings",ext:"%s"}}],ipevt:[{type:"enum",name:"state",ref:{value:"state",options:["open","closed"]}}]},aOpener:{command:[{type:"enum",name:"open",ref:{value:"open"}},{type:"enum",name:"close",ref:{value:"close"}},{type:"enum",name:"impulse on",ref:{value:"impulseOn"}},{type:"enum",name:"impulse off",ref:{value:"impulseOff"}},{type:"int",name:"set impulse duration",ref:{value:"setImpulse",ext:"%d",extMeta:"1-86400",unit:"s"}}],status:[{type:"enum",name:"state",ref:{value:"state",
options:["open","closed"]}},{type:"enum",name:"impulse",ref:{value:"impulse",options:["enabled","disabled"]}},{type:"int",name:"impulse duration",ref:{value:"impulseduration",ext:"%d",extMeta:"1-86400",unit:"s"}},{type:"string",name:"warnings",ref:{value:"warnings",ext:"%s"}}]},axxentDK:{command:[{type:"enum",name:"open",ref:{value:"open"}},{type:"enum",name:"close",ref:{value:"close"}},{type:"enum",name:"open to turn",ref:{value:"open_to_turn"}},{type:"enum",name:"silent on",ref:{value:"silentOn"}},
{type:"enum",name:"silent off",ref:{value:"silentOff"}},{type:"enum",name:"activate timer",ref:{value:"startTimer"}},{type:"int",name:"set timer",ref:{value:"setTimer",ext:"%d",extMeta:"1-60",unit:"min"}},{type:"enum",name:"deactivate timer",ref:{value:"stopTimer"}}],status:[{type:"enum",name:"state",ref:{value:"state",options:["open","closed","moving","turning_position"]}},{type:"enum",name:"silent state",ref:{value:"silent_state",options:["on","off"]}},{type:"enum",name:"timer enabled",ref:{value:"timerEnabled",
options:["enabled","disabled"]}},{type:"int",name:"timer duration",ref:{value:"durationM",ext:"%d",unit:"min"}},{type:"int",name:"timer remain",ref:{value:"remainingTimeM",ext:"%d",unit:"min"}},{type:"string",name:"warnings",ref:{value:"warnings",ext:"%s"}}],ipevt:[{type:"enum",name:"state",ref:{value:"state",options:["open","closed","moving","turning_position"]}},{type:"enum",name:"warning",ref:{value:"warning",options:["CLOSE_FAILED"]}}]},axxentHSA:{command:[{type:"enum",name:"open",ref:{value:"open"}},
{type:"enum",name:"close",ref:{value:"close"}},{type:"enum",name:"stop",ref:{value:"stop"}},{type:"enum",name:"lock",ref:{value:"lock"}},{type:"enum",name:"open to stopover",ref:{value:"position1"}},{type:"enum",name:"open gap",ref:{value:"position2"}},{type:"enum",name:"activate timer",ref:{value:"startTimer"}},{type:"int",name:"set timer",ref:{value:"setTimer",ext:"%d",extMeta:"1-60",unit:"min"}},{type:"enum",name:"deactivate timer",ref:{value:"stopTimer"}},{type:"int",name:"set stopover",ref:{value:"setStopover",
ext:"%d",unit:"cm"}}],status:[{type:"enum",name:"state",ref:{value:"state",options:"open closed locked gap stopover stop moving".split(" ")}},{type:"enum",name:"timer enabled",ref:{value:"timerEnabled",options:["enabled","disabled"]}},{type:"int",name:"timer duration",ref:{value:"durationM",ext:"%d",unit:"min"}},{type:"int",name:"timer remain",ref:{value:"remainingTimeM",ext:"%d",unit:"min"}},{type:"int",name:"stopover",ref:{value:"stopover",ext:"%d",unit:"cm"}},{type:"string",name:"warnings",ref:{value:"warnings",
ext:"%s"}}],ipevt:[{type:"enum",name:"state",ref:{value:"state",options:"open closed locked gap stopover stop moving".split(" ")}},{type:"enum",name:"warning",ref:{value:"warning",options:["ENGINE_OVERHEATING"]}}]},axxentHSA2:{command:[{type:"enum",name:"open",ref:{value:"open"}},{type:"enum",name:"close",ref:{value:"close"}},{type:"enum",name:"stop",ref:{value:"stop"}},{type:"enum",name:"lock",ref:{value:"lock"}},{type:"enum",name:"open to stopover",ref:{value:"position1"}},{type:"enum",name:"open gap",
ref:{value:"position2"}},{type:"enum",name:"sash 1 stop",ref:{value:"wing1stop"}},{type:"enum",name:"sash 1 open",ref:{value:"wing1open"}},{type:"enum",name:"sash 1 close",ref:{value:"wing1close"}},{type:"enum",name:"sash 1 open to stopover",ref:{value:"wing1position1"}},{type:"enum",name:"sash 1 open gap",ref:{value:"wing1position2"}},{type:"enum",name:"sash 2 stop",ref:{value:"wing2stop"}},{type:"enum",name:"sash 2 open",ref:{value:"wing2open"}},{type:"enum",name:"sash 2 close",ref:{value:"wing2close"}},
{type:"enum",name:"activate timer",ref:{value:"startTimer"}},{type:"int",name:"set timer",ref:{value:"setTimer",ext:"%d",extMeta:"1-60",unit:"min"}},{type:"enum",name:"deactivate timer",ref:{value:"stopTimer"}},{type:"int",name:"set stopover",ref:{value:"setStopover",ext:"%d",unit:"cm"}}],status:[{type:"enum",name:"1. sash state",ref:{value:"wing1state",options:"open closed locked gap stopover stop moving".split(" ")}},{type:"enum",name:"2. sash state",ref:{value:"wing2state",options:"open closed locked gap stopover stop moving".split(" ")}},
{type:"enum",name:"timer enabled",ref:{value:"timerEnabled",options:["enabled","disabled"]}},{type:"int",name:"timer duration",ref:{value:"durationM",ext:"%d",unit:"min"}},{type:"int",name:"timer remain",ref:{value:"remainingTimeM",ext:"%d",unit:"min"}},{type:"int",name:"stopover",ref:{value:"stopover",ext:"%d",unit:"cm"}},{type:"string",name:"warnings",ref:{value:"warnings",ext:"%s"}}],ipevt:[{type:"enum",name:"1. sash state",ref:{value:"wing1state",options:"open closed locked gap stopover stop moving".split(" ")}},
{type:"enum",name:"2. sash state",ref:{value:"wing2state",options:"open closed locked gap stopover stop moving".split(" ")}},{type:"enum",name:"warning",ref:{value:"warning",options:["ENGINE_OVERHEATING"]}}]},geniusB:{command:[{type:"enum",name:"open",ref:{value:"open"}},{type:"enum",name:"close",ref:{value:"close"}},{type:"enum",name:"day",ref:{value:"daymode"}},{type:"enum",name:"night",ref:{value:"nightmode"}},{type:"enum",name:"impulse on",ref:{value:"impulseOn"}},{type:"enum",name:"impulse off",
ref:{value:"impulseOff"}},{type:"int",name:"set impulse duration",ref:{value:"setImpulse",ext:"%d",extMeta:"1-86400",unit:"s"}}],status:[{type:"enum",name:"state",ref:{value:"state",options:["open","closed","locked"]}},{type:"enum",name:"mode",ref:{value:"mode",options:["day","night"]}},{type:"enum",name:"impulse",ref:{value:"impulse",options:["enabled","disabled"]}},{type:"int",name:"impulse duration",ref:{value:"impulseduration",ext:"%d",extMeta:"1-86400",unit:"s"}}],ipevt:[{type:"enum",name:"state",
ref:{value:"state",options:["open","closed","locked"]}},{type:"enum",name:"mode",ref:{value:"mode",options:["day","night"]}}]},mh10:{command:[{type:"enum",name:"open",ref:{value:"open"}},{type:"enum",name:"close",ref:{value:"close"}},{type:"enum",name:"stop",ref:{value:"stop"}}],status:[{type:"enum",name:"state",ref:{value:"state",options:["open","closed"]}},{type:"string",name:"warnings",ref:{value:"warnings",ext:"%s"}}]},aeropac:{command:[{type:"enum",name:"on",ref:{value:"on"}},{type:"enum",name:"off",
ref:{value:"off"}},{type:"enum",name:"activate timer",ref:{value:"startTimer"}},{type:"int",name:"set timer",ref:{value:"setTimer",ext:"%d",extMeta:"1-18",unit:"hour"}},{type:"enum",name:"deactivate timer",ref:{value:"stopTimer"}},{type:"enum",name:"activate daily power on",ref:{value:"startDailyPowerOn"}},{type:"enum",name:"deactivate daily power on",ref:{value:"stopDailyPowerOn"}},{type:"string",name:"set daily power on time",ref:{value:"setDailyPowerOn",ext:"%s"}},{type:"int",name:"set fan level",
ref:{value:"setTo",ext:"%d",extMeta:"1-7"}}],status:[{type:"enum",name:"state",ref:{value:"state",options:["on","off"]}},{type:"int",name:"fan level",ref:{value:"fanlevel"}},{type:"int",name:"timer duration",ref:{value:"durationH",ext:"%d",unit:"hour"}},{type:"int",name:"timer remain",ref:{value:"remainingTimeM",ext:"%d",unit:"min"}},{type:"string",name:"time remain text",ref:{value:"remainingTime"}},{type:"enum",name:"timer enabled",ref:{value:"timerEnabled",options:["enabled","disabled"]}},{type:"string",
name:"daily power on time",ref:{value:"dailyPowerOnTime"}},{type:"enum",name:"daily power on enabled",ref:{value:"dailyPowerOnEnabled",options:["enabled","disabled"]}},{type:"string",name:"warnings",ref:{value:"warnings",ext:"%s"}}],ipevt:[{type:"enum",name:"state",ref:{value:"state",options:["on","off"]}},{type:"enum",name:"warning",ref:{value:"warning",options:["REPLACE_AIRFILTER"]}}]},aeromatVT:{command:[{type:"enum",name:"on",ref:{value:"on"}},{type:"enum",name:"off",ref:{value:"off"}},{type:"enum",
name:"automode on",ref:{value:"automodeOn"}},{type:"enum",name:"automode off",ref:{value:"automodeOff"}},{type:"int",name:"set fan power",ref:{value:"setTo",ext:"%d",extMeta:"0-21",unit:"m3/h"}}],status:[{type:"enum",name:"state",ref:{value:"state",options:["on","off"]}},{type:"enum",name:"automode",ref:{value:"automode",options:["on","off"]}},{type:"float",name:"fan power",ref:{value:"fanpower"}},{type:"int",name:"air quality",ref:{value:"airquality"}},{type:"float",name:"indoor temperature",ref:{value:"indoorTemp"}},
{type:"float",name:"outdoor temperature",ref:{value:"outdoorTemp"}},{type:"float",name:"indoor humidity",ref:{value:"indoorHum"}},{type:"float",name:"outdoor humidity",ref:{value:"outdoorHum"}},{type:"string",name:"warnings",ref:{value:"warnings",ext:"%s"}}],ipevt:[{type:"enum",name:"state",ref:{value:"state",options:["on","off"]}},{type:"enum",name:"automode",ref:{value:"automode",options:["on","off"]}},{type:"int",name:"air quality",ref:{value:"airquality"}},{type:"float",name:"indoor temperature",
ref:{value:"indoorTemp"}},{type:"float",name:"outdoor temperature",ref:{value:"outdoorTemp"}},{type:"float",name:"indoor humidity",ref:{value:"indoorHum"}},{type:"float",name:"outdoor humidity",ref:{value:"outdoorHum"}},{type:"enum",name:"warning",ref:{value:"warning",options:["REPLACE_AIRFILTER","FROST_PROTECTION"]}}]},aerotube:{command:[{type:"enum",name:"on",ref:{value:"on"}},{type:"enum",name:"off",ref:{value:"off"}},{type:"enum",name:"automode on",ref:{value:"automodeOn"}},{type:"enum",name:"automode off",
ref:{value:"automodeOff"}},{type:"enum",name:"fan mode in",ref:{value:"fanmodeIn"}},{type:"enum",name:"fan mode out",ref:{value:"fanmodeOut"}},{type:"enum",name:"fan mode in-out",ref:{value:"fanmodeInOut"}},{type:"int",name:"set fan power",ref:{value:"setTo",ext:"%d",extMeta:"7-45",unit:"m3/h"}},{type:"int",name:"auto max fan power",ref:{value:"setAutoTo",ext:"%d",extMeta:"7-45",unit:"m3/h"}}],status:[{type:"enum",name:"state",ref:{value:"state",options:["on","off"]}},{type:"enum",name:"fan mode",
ref:{value:"fanmode",options:["in","out","in_out"]}},{type:"enum",name:"automode",ref:{value:"automode",options:["on","off"]}},{type:"float",name:"fan power",ref:{value:"fanpower"}},{type:"float",name:"auto max fan power",ref:{value:"autoairflow"}},{type:"float",name:"indoor temperature",ref:{value:"indoorTemp"}},{type:"float",name:"indoor humidity",ref:{value:"indoorHum"}},{type:"string",name:"warnings",ref:{value:"warnings",ext:"%s"}}],ipevt:[{type:"enum",name:"state",ref:{value:"state",options:["on",
"off"]}},{type:"enum",name:"fan mode",ref:{value:"fanmode",options:["in","out","in_out"]}},{type:"enum",name:"automode",ref:{value:"automode",options:["on","off"]}},{type:"float",name:"fan power",ref:{value:"fanpower"}},{type:"float",name:"auto max fan power",ref:{value:"autoairflow"}},{type:"float",name:"indoor temperature",ref:{value:"indoorTemp"}},{type:"float",name:"indoor humidity",ref:{value:"indoorHum"}},{type:"enum",name:"warning",ref:{value:"warning",options:["REPLACE_AIRFILTER"]}}]},aerovital:{command:[{type:"enum",
name:"on",ref:{value:"on"}},{type:"enum",name:"off",ref:{value:"off"}},{type:"enum",name:"automode on",ref:{value:"automodeOn"}},{type:"enum",name:"automode off",ref:{value:"automodeOff"}},{type:"enum",name:"fanmode in",ref:{value:"fanmodeIn"}},{type:"enum",name:"fanmode out",ref:{value:"fanmodeOut"}},{type:"enum",name:"fanmode in/out",ref:{value:"fanmodeInOut"}},{type:"enum",name:"fanmode in/out (wrg)",ref:{value:"fanmodeInOutWRG"}},{type:"int",name:"set fan power",ref:{value:"setTo",ext:"%d",extMeta:"0-60",
unit:"m3/h"}},{type:"int",name:"auto max fan power",ref:{value:"setAutoTo",ext:"%d",extMeta:"9-60",unit:"m3/h"}},{type:"int",name:"auto sensor sensitivity",ref:{value:"setSensorTo",ext:"%d",extMeta:"0-100"}}],status:[{type:"enum",name:"state",ref:{value:"state",options:["on","off"]}},{type:"enum",name:"automode",ref:{value:"automode",options:["on","off"]}},{type:"float",name:"fan power",ref:{value:"fanpower"}},{type:"enum",name:"fan mode",ref:{value:"fanmode",options:["in","out","in_out","in_out_wrg",
"auto"]}},{type:"float",name:"auto max fan power",ref:{value:"autoairflow"}},{type:"int",name:"auto sensor sensitivity",ref:{value:"autosensitivity"}},{type:"int",name:"air quality",ref:{value:"airquality"}},{type:"float",name:"indoor temperature",ref:{value:"indoorTemp"}},{type:"float",name:"outdoor temperature",ref:{value:"outdoorTemp"}},{type:"float",name:"indoor humidity",ref:{value:"indoorHum"}},{type:"float",name:"outdoor humidity",ref:{value:"outdoorHum"}},{type:"string",name:"warnings",ref:{value:"warnings",
ext:"%s"}}],ipevt:[{type:"enum",name:"state",ref:{value:"state",options:["on","off"]}},{type:"enum",name:"automode",ref:{value:"automode",options:["on","off"]}},{type:"int",name:"air quality",ref:{value:"airquality"}},{type:"float",name:"indoor temperature",ref:{value:"indoorTemp"}},{type:"float",name:"outdoor temperature",ref:{value:"outdoorTemp"}},{type:"float",name:"indoor humidity",ref:{value:"indoorHum"}},{type:"float",name:"outdoor humidity",ref:{value:"outdoorHum"}},{type:"enum",name:"warning",
ref:{value:"warning",options:["REPLACE_AIRFILTER","FROST_PROTECTION"]}}]},sensoair:{command:[{type:"enum",name:"leds on",ref:{value:"ledsOn"}},{type:"enum",name:"leds off",ref:{value:"ledsOff"}}],status:[{type:"enum",name:"leds",ref:{value:"leds",options:["on","off"]}},{type:"int",name:"airquality",ref:{value:"airquality",extMeta:"1-7"}},{type:"string",name:"warnings",ref:{value:"warnings",ext:"%s"}}],ipevt:[{type:"int",name:"airquality",ref:{value:"airquality"}}]}},registModule:function(a){a.register(this.SYS,
"SIEGENIA Comfort")},getIPDeviceType:function(){return[{sys:this.SYS,name:"AEROPAC",data:"aeropac",model:1,variant:0,subvariant:0,port:443},{sys:this.SYS,name:"AEROMAT VT",data:"aeromatVT",model:2,variant:0,subvariant:0,port:443},{sys:this.SYS,name:"DRIVE axxent DK",data:"axxentDK",model:3,variant:0,subvariant:0,port:443},{sys:this.SYS,name:"DRIVE axxent MH",data:"axxentDK",model:3,variant:1,subvariant:0,port:443},{sys:this.SYS,name:"SENSOAIR",data:"sensoair",model:4,variant:0,subvariant:0,port:443},
{sys:this.SYS,name:"AEROVITAL Ambience",data:"aerovital",model:5,variant:0,subvariant:0,port:443},{sys:this.SYS,name:"MHS400 Schema A",data:"axxentHSA",model:6,variant:1,subvariant:0,port:443},{sys:this.SYS,name:"DRIVE axxent HSA Schema A",data:"axxentHSA",model:6,variant:1,subvariant:1,port:443},{sys:this.SYS,name:"MHS400 Schema C",data:"geniusB",model:6,variant:2,subvariant:0,port:443},{sys:this.SYS,name:"DRIVE axxent HSA Schema C",data:"axxentHSA2",model:6,variant:2,subvariant:1,port:443},{sys:this.SYS,
name:"MSA",data:"geniusB",model:6,variant:3,subvariant:0,port:443},{sys:this.SYS,name:"MSA HiFinity",data:"geniusB",model:6,variant:3,subvariant:1,port:443},{sys:this.SYS,name:"MSA Sapa",data:"geniusB",model:6,variant:3,subvariant:2,port:443},{sys:this.SYS,name:"MSA Keller",data:"geniusB",model:6,variant:3,subvariant:3,port:443},{sys:this.SYS,name:"AEROTUBE",data:"aerotube",model:8,variant:0,subvariant:0,port:443},{sys:this.SYS,name:"Universal",data:"axxentHSA",model:10,variant:0,subvariant:0,port:443},
{sys:this.SYS,name:"A-opener",data:"aOpener",model:10,variant:1,subvariant:0,port:443},{sys:this.SYS,name:"GENIUS A",data:"geniusA",model:10,variant:2,subvariant:0,port:443},{sys:this.SYS,name:"GENIUS B",data:"geniusB",model:10,variant:3,subvariant:0,port:443},{sys:this.SYS,name:"MH10",data:"mh10",model:10,variant:4,subvariant:0,port:443}]},createDevice:function(b,c,d){c=a.ERROR_CODE;b?b.ip?b.data?d(null,b):d(new a(c.INVALID,"data is invalid")):d(new a(c.INVALID,"ip is invalid")):d(new a(c.INVALID,
"info is invalid"))},updateDevice:function(b,c,d){c=a.ERROR_CODE;b?b.ip?b.data?d(null,b):d(new a(c.INVALID,"data is invalid")):d(new a(c.INVALID,"ip is invalid")):d(new a(c.INVALID,"info is invalid"))},deleteDevice:function(a,c,d){d()},applyUIFilter:function(a,c,d){var e=function(a,b){if("*"==a)return!0;for(var c=!1,d=0;d<a.length;d++)if(a[d]==b){c=!0;break}return c},f=function(a,b,c){var d=[];switch(c.catagory){case "command":a.command&&a.command.forEach(function(a){e(c.elems,a.type)&&(a=JSON.parse(JSON.stringify(a)),
d.push(a))});break;case "status":a.status&&a.status.forEach(function(a){e(c.elems,a.type)&&(a=JSON.parse(JSON.stringify(a)),d.push(a))})}return d},g=function(a,b){var c=[],e=null;if(e=xnm.aio.siegenia.DM.getCommandStatusMap(a,d))e=f(e,a,b),c=c.concat(e);return c};if(!a.sys)return null;var l=JSON.parse(JSON.stringify(a)),h=null;switch(c.catagory){case "command":h=g(a,c);l.command=h;break;case "status":h=g(a,c);l.status=h;break;default:return null}return h&&0!=h.length?l:null},applyIPEventFilter:function(a,
c){var d=xnm.aio.siegenia.DM.getCommandStatusMap(a);if(!d)return null;var e=JSON.parse(JSON.stringify(a));e.ipevt=d.ipevt;return e},getCommandStatusMap:function(a){return a&&a.data?this.MAP[a.data]:null}}}();
xnm.aio.siegenia.Handler=function(){var a=function(){this._logger=require("x.logger.js").getLogger("xnm.aio.siegenia.Handler");var a=this;this._discoverCallbacks=[];this._mdnsCallback=function(c,d){a._findSiegeniaDevice(c,d)};this._discoverTO=null;this._discoverRunning=!1};a.prototype.SessionManager=xnm.aio.siegenia._SessionManager;a.prototype.getStateValues=function(a,c){return"genius"==a.type?(new xnm.aio.siegenia.Genius).getStateValues(c):"aeropac"==a.type?(new xnm.aio.siegenia.AEROPAC).getStateValues(c):
{}};a.prototype.getDeviceStatesList=function(a){var c=[];"geniusA"==a.data?c.push({type:"enum",name:"state",ref:{value:"state",options:["open","closed"]}}):"geniusB"==a.data?(c.push({type:"enum",name:"state",ref:{value:"state",options:["open","closed","locked"]}}),c.push({type:"enum",name:"mode",ref:{value:"mode",options:["day","night"]}})):"axxentDK"==a.data?(c.push({type:"enum",name:"state",ref:{value:"state",options:["open","closed","moving","turning_position"]}}),c.push({type:"enum",name:"silent state",
ref:{value:"silent_state",options:["on","off"]}}),c.push({type:"enum",name:"timerEnabled",ref:{value:"timerEnabled",options:["enabled","disabled"]}}),c.push({type:"string",name:"remainingTime",ref:{value:"remainingTime"}})):"axxentHSA"==a.data?(c.push({type:"enum",name:"state",ref:{value:"state",options:"open closed locked gap stopover stop moving".split(" ")}}),c.push({type:"enum",name:"timerEnabled",ref:{value:"timerEnabled",options:["enabled","disabled"]}}),c.push({type:"string",name:"remainingTime",
ref:{value:"remainingTime"}})):"axxentHSA2"==a.data?(c.push({type:"enum",name:"1. wing state",ref:{value:"wing1state",options:"open closed locked gap stopover stop moving".split(" ")}}),c.push({type:"enum",name:"2. wing state",ref:{value:"wing2state",options:"open closed locked gap stopover stop moving".split(" ")}}),c.push({type:"enum",name:"timerEnabled",ref:{value:"timerEnabled",options:["enabled","disabled"]}}),c.push({type:"string",name:"remainingTime",ref:{value:"remainingTime"}})):"mh10"!=
a.data&&("aeropac"==a.data?(c.push({type:"enum",name:"state",ref:{value:"state",options:["on","off"]}}),c.push({type:"int",name:"fanlevel",ref:{value:"fanlevel"}}),c.push({type:"string",name:"timeRemaining",ref:{value:"timeRemaining"}}),c.push({type:"enum",name:"timerEnabled",ref:{value:"timerEnabled",options:["enabled","disabled"]}}),c.push({type:"string",name:"dailyPowerOnTime",ref:{value:"dailyPowerOnTime"}}),c.push({type:"enum",name:"dailyPowerOnEnabled",ref:{value:"dailyPowerOnEnabled",options:["enabled",
"disabled"]}})):"aeromatVT"==a.data?(c.push({type:"enum",name:"state",ref:{value:"state",options:["on","off"]}}),c.push({type:"enum",name:"automode",ref:{value:"automode",options:["on","off"]}}),c.push({type:"float",name:"fanpower",ref:{value:"fanpower"}}),c.push({type:"int",name:"airquality",ref:{value:"airquality"}}),c.push({type:"float",name:"indoorTemp",ref:{value:"indoorTemp"}}),c.push({type:"float",name:"outdoorTemp",ref:{value:"outdoorTemp"}}),c.push({type:"float",name:"indoorHum",ref:{value:"indoorHum"}}),
c.push({type:"float",name:"outdoorHum",ref:{value:"outdoorHum"}})):"aerotube"==a.data?(c.push({type:"enum",name:"state",ref:{value:"state",options:["on","off"]}}),c.push({type:"enum",name:"fanmode",ref:{value:"fanmode",options:["in","out","in_out"]}}),c.push({type:"enum",name:"automode",ref:{value:"automode",options:["on","off"]}}),c.push({type:"float",name:"fanpower",ref:{value:"fanpower"}}),c.push({type:"float",name:"autoairflow",ref:{value:"autoairflow"}}),c.push({type:"float",name:"indoorTemp",
ref:{value:"indoorTemp"}}),c.push({type:"float",name:"indoorHum",ref:{value:"indoorHum"}})):"aerovital"==a.data?(c.push({type:"enum",name:"state",ref:{value:"state",options:["on","off"]}}),c.push({type:"enum",name:"fanmode",ref:{value:"fanmode",options:["in","out","in_out","in_out_wrg"]}}),c.push({type:"enum",name:"automode",ref:{value:"automode",options:["on","off"]}}),c.push({type:"float",name:"fanpower",ref:{value:"fanpower"}}),c.push({type:"float",name:"autoairflow",ref:{value:"autoairflow"}}),
c.push({type:"int",name:"autosensitivity",ref:{value:"autosensitivity"}}),c.push({type:"float",name:"indoorTemp",ref:{value:"indoorTemp"}}),c.push({type:"float",name:"outdoorTemp",ref:{value:"outdoorTemp"}}),c.push({type:"float",name:"indoorHum",ref:{value:"indoorHum"}}),c.push({type:"float",name:"outdoorHum",ref:{value:"outdoorHum"}}),c.push({type:"int",name:"airquality",ref:{value:"airquality"}})):"sensoair"==a.data&&(c.push({type:"enum",name:"leds",ref:{value:"leds",options:["on","off"]}}),c.push({type:"int",
name:"airquality",ref:{value:"airquality"}})));c.push({type:"array",name:"warnings",ref:{value:"warnings"}});return c};a.prototype.getDeviceCommandList=function(a,c){var d=[];if("geniusA"==a.data||"axxentDK"==a.data||"axxentHSA"==a.data||"aOpener"==a.data||"axxentHSA2"==a.data)d.push({id:window.XC_Text.open,cmd:"open"}),d.push({id:window.XC_Text.close,cmd:"close"}),"axxentHSA"==a.data&&(d.push({id:window.XC_Text.stop,cmd:"stop"}),d.push({id:window.XC_Text.lock,cmd:"lock"}),d.push({id:window.XC_Text.open_gap,
cmd:"position1"}),d.push({id:window.XC_Text.open_to_position,cmd:"position2"}),d.push({id:window.XC_Text.activate_timer10,cmd:"setTimer10"}),d.push({id:window.XC_Text.deactivate_timer10,cmd:"stopTimer"}),d.push({id:window.XC_Text.activate_timer,cmd:"startTimer"}),d.push({id:window.XC_Text.set_timer,cmd:"setTimer"}),d.push({id:window.XC_Text.deactivate_timer,cmd:"stopTimer"}),d.push({id:window.XC_Text.set_stopover,cmd:"setStopover"})),"axxentHSA2"==a.data&&(d.push({id:window.XC_Text.stop,cmd:"stop"}),
d.push({id:window.XC_Text.open,cmd:"open"}),d.push({id:window.XC_Text.lock,cmd:"lock"}),d.push({id:window.XC_Text.open_gap,cmd:"position1"}),d.push({id:window.XC_Text.open_to_position,cmd:"position2"}),d.push({id:window.XC_Text.stop,cmd:"wing1stop"}),d.push({id:window.XC_Text.open,cmd:"wing1open"}),d.push({id:window.XC_Text.close,cmd:"wing1close"}),d.push({id:window.XC_Text.open_gap,cmd:"wing1position1"}),d.push({id:window.XC_Text.open_to_position,cmd:"wing1position2"}),d.push({id:window.XC_Text.stop,
cmd:"wing2stop"}),d.push({id:window.XC_Text.open,cmd:"wing2open"}),d.push({id:window.XC_Text.close,cmd:"wing2close"}),d.push({id:window.XC_Text.activate_timer10,cmd:"setTimer10"}),d.push({id:window.XC_Text.deactivate_timer10,cmd:"stopTimer"}),d.push({id:window.XC_Text.activate_timer,cmd:"startTimer"}),d.push({id:window.XC_Text.set_timer,cmd:"setTimer"}),d.push({id:window.XC_Text.deactivate_timer,cmd:"stopTimer"})),"axxentDK"==a.data&&(d.push({id:window.XC_Text.open_to_turn,cmd:"open_to_turn"}),d.push({id:window.XC_Text.silent_on,
cmd:"silentOn"}),d.push({id:window.XC_Text.silent_off,cmd:"silentOff"}),d.push({id:window.XC_Text.automode_on,cmd:"automodeOn"}),d.push({id:window.XC_Text.automode_off,cmd:"automodeOff"}),d.push({id:window.XC_Text.activate_timer,cmd:"startTimer"}),d.push({id:window.XC_Text.set_timer,cmd:"setTimer"}),d.push({id:window.XC_Text.deactivate_timer,cmd:"stopTimer"}));else if("geniusB"==a.data)d.push({id:window.XC_Text.open,cmd:"open"}),d.push({id:window.XC_Text.close,cmd:"close"}),d.push({id:window.XC_Text.day,
cmd:"daymode"}),d.push({id:window.XC_Text.night,cmd:"nightmode"});else if("mh10"==a.data)d.push({id:window.XC_Text.open,cmd:"open"}),d.push({id:window.XC_Text.close,cmd:"close"}),d.push({id:window.XC_Text.stop,cmd:"stop"});else if("aeropac"==a.data){d.push({id:window.XC_Text.on,cmd:"on"});d.push({id:window.XC_Text.off,cmd:"off"});d.push({id:window.XC_Text.activate_timer10,cmd:"startTimer"});d.push({id:window.XC_Text.deactivate_timer10,cmd:"stopTimer"});d.push({id:window.XC_Text.set_timer,cmd:"setTimer"});
d.push({id:window.XC_Text.activate_daily,cmd:"startDailyPowerOn"});d.push({id:window.XC_Text.deactivate_daily,cmd:"stopDailyPowerOn"});d.push({id:window.XC_Text.set_daily,cmd:"setDailyPowerOn"});for(var e=1;18>=e;e++)d.push({id:window.XC_Text.activate_timer10+" "+e,cmd:"setTimer"+e});for(e=1;7>=e;e++)d.push({id:window.XC_Text.fan_power+" "+e,cmd:"setTo"+e})}else if("aeromatVT"==a.data)for(d.push({id:window.XC_Text.on,cmd:"on"}),d.push({id:window.XC_Text.off,cmd:"off"}),d.push({id:window.XC_Text.automode_on,
cmd:"automodeOn"}),d.push({id:window.XC_Text.automode_off,cmd:"automodeOff"}),e=0;21>e;e++){var f=10*Math.round(e/21*100)/10;d.push({id:window.XC_Text.fan_power+" "+(e+1)+" m3/h",cmd:"setTo"+f})}else if("aerotube"==a.data){d.push({id:window.XC_Text.on,cmd:"on"});d.push({id:window.XC_Text.off,cmd:"off"});d.push({id:window.XC_Text.automode_on,cmd:"automodeOn"});d.push({id:window.XC_Text.automode_off,cmd:"automodeOff"});d.push({id:window.XC_Text.fanmode_in,cmd:"fanmodeIn"});d.push({id:window.XC_Text.fanmode_out,
cmd:"fanmodeOut"});d.push({id:window.XC_Text.fanmode_inout,cmd:"fanmodeInOut"});for(e=7;45>e;e++)f=10*Math.round(e/45*100)/10,d.push({id:window.XC_Text.fan_power+" "+(e+1)+" m3/h",cmd:"setTo"+f});for(e=7;45>e;e++)f=10*Math.round(e/45*100)/10,d.push({id:window.XC_Text.auto_fan_power+" "+(e+1)+" m3/h",cmd:"setAutoTo"+f})}else if("aerovital"==a.data){d.push({id:window.XC_Text.on,cmd:"on"});d.push({id:window.XC_Text.off,cmd:"off"});d.push({id:window.XC_Text.automode_on,cmd:"automodeOn"});d.push({id:window.XC_Text.automode_off,
cmd:"automodeOff"});d.push({id:window.XC_Text.fanmode_in,cmd:"fanmodeIn"});d.push({id:window.XC_Text.fanmode_out,cmd:"fanmodeOut"});d.push({id:window.XC_Text.fanmode_inout,cmd:"fanmodeInOut"});d.push({id:window.XC_Text.fanmode_inout_wrg,cmd:"fanmodeInOutWRG"});for(e=0;60>e;e++)f=10*Math.round(e/60*100)/10,d.push({id:window.XC_Text.fan_power+" "+(e+1)+" m3/h",cmd:"setTo"+f});for(e=0;60>e;e++)f=10*Math.round(e/60*100)/10,d.push({id:window.XC_Text.auto_fan_power+" "+(e+1)+" m3/h",cmd:"setAutoTo"+f});
for(e=0;100>e;e+=5)d.push({id:window.XC_Text.auto_fan_power+" "+(e+1)+" m3/h",cmd:"setSensorTo"+e})}else"sensoair"==a.data&&(d.push({id:window.XC_Text.ledsOn,cmd:"ledsOn"}),d.push({id:window.XC_Text.ledsOff,cmd:"ledsOff"}));return d};a.prototype.getDevice=function(a){return"geniusA"==a.data?new this.Genius(a.address,"user",a.pwd,"A"):"geniusB"==a.data?new this.Genius(a.address,"user",a.pwd,"B"):"mh10"==a.data?new this.Genius(a.address,"user",a.pwd,"mh10"):"axxentDK"==a.data?new this.Genius(a.address,
"user",a.pwd,"axxentDK"):"axxentHSA"==a.data?new this.Genius(a.address,"user",a.pwd,"axxentHSA"):"axxentHSA2"==a.data?new this.Genius(a.address,"user",a.pwd,"axxentHSA2"):"aOpener"==a.data?new this.Genius(a.address,"user",a.pwd,"aOpener"):"aeropac"==a.data?new this.AEROPAC(a.address,"user",a.pwd,"aeropac"):"aeromatVT"==a.data?new this.AEROPAC(a.address,"user",a.pwd,"aeromatVT"):"aerotube"==a.data?new this.AEROPAC(a.address,"user",a.pwd,"aerotube"):"aerovital"==a.data?new this.AEROPAC(a.address,"user",
a.pwd,"aerovital"):"sensoair"==a.data?new this.AEROPAC(a.address,"user",a.pwd,"sensoair"):null};a.prototype.Genius=xnm.aio.siegenia.Genius;a.prototype.AEROPAC=xnm.aio.siegenia.AEROPAC;a.prototype.RulesManager=xnm.aio.siegenia.RulesManager;a.prototype.discoveryStart=function(a){a&&-1==this._discoverCallbacks.indexOf(a)&&this._discoverCallbacks.push(a);require("x.mdns.js").discoverService("_siegenia._tcp.local",this._mdnsCallback)};a.prototype.discoveryStop=function(a){a&&(a=this._discoverCallbacks.indexOf(a),
-1!=a&&(XC.debugf("stop siegenia discovery with the correct callback"),this._discoverCallbacks.splice(a,1)));require("x.mdns.js").stopDiscover("_siegenia._tcp.local",this._mdnsCallback)};a.prototype._findSiegeniaDevice=function(a,c){var d;if(a)for(f=0;f<this._discoverCallbacks.length;f++)(g=this._discoverCallbacks[f])&&g(a,d);else if(c){this._logger.log("trace","receive mdns response:"+JSON.stringify(c));g=f=null;if(c.ip&&c.ip[0]&&c.domain&&c.info){1==c.info.model?f="aeropac":2==c.info.model?f="aeromatVT":
3==c.info.model?f="axxentDK":4==c.info.model?f="sensoair":5==c.info.model?f="aerovital":6==c.info.model?(1==c.info.variant&&0==c.info.subvariant?(f="axxentHSA",g="MHS400 Schema A"):1==c.info.variant&&1==c.info.subvariant?(f="axxentHSA",g="DRIVE axxent HSA Schema A"):2==c.info.variant&&1==c.info.subvariant&&(f="axxentHSA2",g="DRIVE axxent HSA Schema C"),f||(f="geniusB")):8==c.info.model?f="aerotube":10==c.info.model&&(1==c.info.variant?(f="aOpener",g="A-opener"):2==c.info.variant?(f="geniusA",g="GENIUS A"):
3==c.info.variant?(f="geniusB",g="GENIUS B"):4==c.info.variant&&(f="mh10",g="MH10"),f||(f="axxentHSA"));d=c.domain.split(".")[0];var e=c.ip[0];d={sys:"siegenia",ip:e,port:443,username:"user",password:null,data:f,model:c.info.model,variant:c.info.variant,subvariant:c.info.subvariant,serial:c.info.serial,address:e,name:d,subtype:g}}if(d){this._logger.log("trace","find siegenia device:"+JSON.stringify(d));for(var f=0;f<this._discoverCallbacks.length;f++){var g=this._discoverCallbacks[f];g&&g(a,d)}}}};
a.prototype.devicemanager=xnm.aio.siegenia.DM;a.prototype.registModule=function(a){a.register(this.devicemanager.SYS,"siegenia")};a.prototype.resolveDevice=function(a){if(!a||!a.ip||!a.data)return null;var c=null,d,e;switch(a.data){case "geniusA":case "geniusB":case "mh10":case "axxentDK":case "axxentHSA":case "axxentHSA2":case "aOpener":d=this.Genius;e=a.data;"geniusA"==a.data?e="A":"geniusB"==a.data&&(e="B");break;case "aeropac":case "aeromatVT":case "aerotube":case "aerovital":case "sensoair":d=
this.AEROPAC,e=a.data}d&&e&&(c=new d(a.ip,a.username,a.password,e,a.port));c&&(c._data=a.data,c._type=a.type,c._variant=a.variant,c._subvariant=a.subvariant,c._serial=a.serial);return c};a.prototype.getDeviceCommands=function(a,c){var d=this.devicemanager.applyUIFilter(a,{catagory:"command",elems:"*"}),d=d?d.command:[];c&&c(null,d)};a.prototype.getDeviceStatus=function(a,c){var d=this.devicemanager.applyUIFilter(a,{catagory:"status",elems:"*"}),d=d?d.status:[];c&&c(null,d)};a.prototype.doCommand=
function(a,c,d){var e=this.resolveDevice(a);e?e.executeCommandCreator(a,c,function(a){d&&d(a)}):d&&d(Error("device json format invalid"))};a.prototype.doStatus=function(a,c,d,e){var f=this.resolveDevice(c);f?f.getStatesCreator(null,[{id:a,device:c,status:d}],function(a,b){a?e&&e(a):e&&e(null,b[0])}):e&&e(Error("device json format invalid"))};a.prototype.discoverWithTimeout=function(a,c){if(!this._discoverRunning){var d={},e=function(a,b){!a&&b&&b.ip&&!d[b.ip]&&(d[b.ip]=b)},f=this;this.discoveryStart(e);
this._discoverTO=setTimeout(function(){f.discoveryStop(e);var a=[],b;for(b in d)d.hasOwnProperty(b)&&a.push(d[b]);c&&c(null,a)},a)}};return a}();"undefined"!=typeof exports&&"undefined"!=typeof module&&module.exports&&(exports=module.exports=new xnm.aio.siegenia.Handler);
