var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.findInternal=function(e,a,c){e instanceof String&&(e=String(e));for(var b=e.length,d=0;d<b;d++){var f=e[d];if(a.call(c,f,d,e))return{i:d,v:f}}return{i:-1,v:void 0}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;$jscomp.ISOLATE_POLYFILLS=!1;$jscomp.FORCE_POLYFILL_PROMISE=!1;$jscomp.FORCE_POLYFILL_PROMISE_WHEN_NO_UNHANDLED_REJECTION=!1;
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(e,a,c){if(e==Array.prototype||e==Object.prototype)return e;e[a]=c.value;return e};$jscomp.getGlobal=function(e){e=["object"==typeof globalThis&&globalThis,e,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global];for(var a=0;a<e.length;++a){var c=e[a];if(c&&c.Math==Math)return c}throw Error("Cannot find global object");};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.IS_SYMBOL_NATIVE="function"===typeof Symbol&&"symbol"===typeof Symbol("x");$jscomp.TRUST_ES6_POLYFILLS=!$jscomp.ISOLATE_POLYFILLS||$jscomp.IS_SYMBOL_NATIVE;$jscomp.polyfills={};$jscomp.propertyToPolyfillSymbol={};$jscomp.POLYFILL_PREFIX="$jscp$";var $jscomp$lookupPolyfilledValue=function(e,a){var c=$jscomp.propertyToPolyfillSymbol[a];if(null==c)return e[a];c=e[c];return void 0!==c?c:e[a]};
$jscomp.polyfill=function(e,a,c,b){a&&($jscomp.ISOLATE_POLYFILLS?$jscomp.polyfillIsolated(e,a,c,b):$jscomp.polyfillUnisolated(e,a,c,b))};$jscomp.polyfillUnisolated=function(e,a,c,b){c=$jscomp.global;e=e.split(".");for(b=0;b<e.length-1;b++){var d=e[b];if(!(d in c))return;c=c[d]}e=e[e.length-1];b=c[e];a=a(b);a!=b&&null!=a&&$jscomp.defineProperty(c,e,{configurable:!0,writable:!0,value:a})};
$jscomp.polyfillIsolated=function(e,a,c,b){var d=e.split(".");e=1===d.length;b=d[0];b=!e&&b in $jscomp.polyfills?$jscomp.polyfills:$jscomp.global;for(var f=0;f<d.length-1;f++){var h=d[f];if(!(h in b))return;b=b[h]}d=d[d.length-1];c=$jscomp.IS_SYMBOL_NATIVE&&"es6"===c?b[d]:null;a=a(c);null!=a&&(e?$jscomp.defineProperty($jscomp.polyfills,d,{configurable:!0,writable:!0,value:a}):a!==c&&(void 0===$jscomp.propertyToPolyfillSymbol[d]&&($jscomp.propertyToPolyfillSymbol[d]=$jscomp.IS_SYMBOL_NATIVE?$jscomp.global.Symbol(d):
$jscomp.POLYFILL_PREFIX+d),$jscomp.defineProperty(b,$jscomp.propertyToPolyfillSymbol[d],{configurable:!0,writable:!0,value:a})))};$jscomp.polyfill("Array.prototype.find",function(e){return e?e:function(a,c){return $jscomp.findInternal(this,a,c).v}},"es6","es3");
$jscomp.checkStringArgs=function(e,a,c){if(null==e)throw new TypeError("The 'this' value for String.prototype."+c+" must not be null or undefined");if(a instanceof RegExp)throw new TypeError("First argument to String.prototype."+c+" must not be a regular expression");return e+""};
$jscomp.polyfill("String.prototype.repeat",function(e){return e?e:function(a){var c=$jscomp.checkStringArgs(this,null,"repeat");if(0>a||1342177279<a)throw new RangeError("Invalid count value");a|=0;for(var b="";a;)if(a&1&&(b+=c),a>>>=1)c+=c;return b}},"es6","es3");var xnm=xnm||{};xnm.aio=xnm.aio||{};xnm.aio.sonos=xnm.aio.sonos||{};
xnm.aio.sonos.Master=function(){var e=function(){this._logger="undefined"!=typeof require&&require?require("x.logger.js").getLogger("xnm.aio.sonos.Master"):{log:{}};this._searchCB=[];this._autoSearchTimeout=null;this._tmpPlayers={};this._players={};this._mediaServer={};this._currentZone=this._topology=null;this._discovery=new xnm.aio.sonos.Discovery(this);this.search(null)};e.prototype.getBufferedPlayers=function(){var a=[],c;for(c in this._players)if(this._players.hasOwnProperty(c)){var b=this._players[c];
b&&!b.dummy&&b.player&&a.push(b.player)}return a};e.prototype.getBufferedMediaServers=function(){var a=[],c;for(c in this._mediaServer)this._mediaServer.hasOwnProperty(c)&&a.push(this._mediaServer[c]);for(c in this._players)if(this._players.hasOwnProperty(c)){var b=this._players[c];b&&b.player&&b.player._server&&(b.player._server._sonosServer=!0,a.push(b.player._server))}return a};e.prototype.search=function(a){var c=this._searchCB.length;a&&-1==this._searchCB.indexOf(a)&&this._searchCB.push(a);if(0==
c){this._autoSearchTimeout&&(clearTimeout(this._autoSearchTimeout),this._autoSearchTimeout=null);this._search();var b=this;setTimeout(function(){b._autoSearchTimeout=setTimeout(function(){b._logger.log("trace","auto search timeout, search again");b.search(null)},3E4);var d=b._searchCB;b._searchCB=[];d.forEach(function(f){f&&f()})},5E3)}};e.prototype._search=function(){for(var a in this._players)if(this._players.hasOwnProperty(a)){var c=this._players[a];5<=c.missCount?delete this._players[a]:c.missCount++}this._mediaServer=
{};this._discovery.search(null)};e.prototype.findPlayer=function(a){var c=a.uuid;if(c){var b=this._players[c];b||(this._players[c]={missCount:0,dummy:!1},b=this._players[c]);if(b.player)b.player.setIP(a.ip),b.player.setPort(a.port);else{c=new xnm.aio.sonos.Player(a.ip,a.port,a.uuid,a.name);var d,f;if(a.embeddedDevices)for(var h=0;h<a.embeddedDevices.length;h++){var g=a.embeddedDevices[h];g&&"urn:schemas-upnp-org:device:MediaServer:1"==g.deviceType?f=g:g&&"urn:schemas-upnp-org:device:MediaRenderer:1"==
g.deviceType&&(d=g)}c._device=a;c._renderer=d;c._server=f;b.player=c}b.dummy=!1;b.missCount=0;var l=this;b.player.getZoneGroupState(function(k,m,p){!k&&m&&p&&l._updateTopology(m)})}};e.prototype.findMediaServer=function(a){var c=a.uuid;c&&(this._mediaServer[c]=a)};e.prototype.getCurrentZone=function(a){if(this._currentZone)a&&a(null,this._currentZone);else{var c=this;this.search(function(b){b?a&&a(b):this._currentZone?c.getCurrentZone(a):a&&a(Error("no current zone"))})}};e.prototype.setCurrentZone=
function(a,c){if(this._topology){var b=null,d;for(d in this._topology){var f=this._topology[d];if(f&&f.id==a){b=f;break}}b&&b.coordinator?(a=this._players[b.coordinator])?(this._currentZone=JSON.parse(JSON.stringify(b)),this._currentZone.player=a.player,c&&c()):c&&c(Error("no such player")):c&&c(Error("no such zone"))}else{var h=this;this.search(function(g){g?c&&c(g):this._topology?h.setCurrentZone(c):c&&c(Error("no player found"))})}};e.prototype.getZones=function(a){var c=this,b=this.getBufferedPlayers();
b&&0!=b.length?a&&a(null,this._topology):this.search(function(d,f){d?a&&a(d):f&&0!=f.length?c.getZones(a):a&&a(Error("find no sonos player"))})};e.prototype.getPlayer=function(a){if("master"==a.type)return this;if(!a.uuid){if(!a.ip)return null;for(b in this._players)if(this._players.hasOwnProperty(b)){var c=this._players[b];if(c&&c.player&&c.player.getIP()==a.ip)return c.player}if(this._tmpPlayers[a.ip])return this._tmpPlayers[a.ip];var b=new xnm.aio.sonos.Player(a.ip,a.port,a.uuid,a.name);return this._tmpPlayers[a.ip]=
b}if((b=this._players[a.uuid])&&b.player)return b.player;if(!a.ip)return null;b=new xnm.aio.sonos.Player(a.ip,a.port,a.uuid,a.name);this._players[a.uuid]={missCount:0,dummy:!0,player:b};return b};e.prototype._updateTopology=function(a){this._topology||(this._topology={});var c=this;a.forEach(function(g){g&&g.id&&(c._topology[g.id]=g)});for(var b,d=0;d<a.length;d++)if((b=a[d])&&b.coordinator){var f=this._players[b.coordinator];if(f&&f.player&&!this._currentZone){this._currentZone=JSON.parse(JSON.stringify(b));
this._currentZone.player=f.player;return}}for(var h=0;h<a.length;h++)if((b=a[d])&&b.coordinator&&(f=this._players[b.coordinator])&&f.player){this._currentZone=JSON.parse(JSON.stringify(b));this._currentZone.player=f.player;break}};e.prototype.executeCommandCreator=function(a,c,b){if(this._currentZone)this._currentZone.player.executeCommandCreator(a,c,b);else{var d=this;this.search(function(f){f?b&&b(f):d._currentZone?d._currentZone.player.executeCommandCreator(a,c,b):b&&b(f)})}};e.prototype.getStatesCreator=
function(a,c,b){if(this._currentZone)this._currentZone.player.getStatesCreator(a,c,b);else{var d=this;this.search(function(f){f?b&&b(f):d._currentZone?d._currentZone.player.getStatesCreator(a,c,b):b&&b(null,[])})}};e.prototype.play=function(a,c,b){if(this._currentZone)this._currentZone.player.playObject(a,c,b);else{var d=this;this.search(function(f){f?b&&b(f):d._currentZone?d._currentZone.player.playObject(a,c,b):b&&b(f)})}};e.prototype.addToQueueAndPlay=function(a,c,b){if(this._currentZone)this._currentZone.player.addToQueueAndPlay(a,
c,b);else{var d=this;this.search(function(f){f?b&&b(f):d._currentZone?d._currentZone.player.addToQueueAndPlay(a,c,b):b&&b(f)})}};e.prototype.addToQueue=function(a,c,b){if(this._currentZone)this._currentZone.player.addToQueue(a,c,b);else{var d=this;this.search(function(f){f?b&&b(f):d._currentZone?d._currentZone.player.addToQueue(a,c,b):b&&b(f)})}};e.prototype.replaceQueueAndPlay=function(a,c,b){if(this._currentZone)this._currentZone.player.replaceQueueAndPlay(a,c,b);else{var d=this;this.search(function(f){f?
b&&b(f):d._currentZone?d._currentZone.player.replaceQueueAndPlay(a,c,b):b&&b(f)})}};e.prototype.browser=function(a,c,b,d,f){if(this._currentZone)this._currentZone.player.browser(a,c,b,d,f);else{var h=this;this.search(function(g){g?f&&f(g):h._currentZone?h._currentZone.player.browser(a,c,b,d,f):f&&f(g)})}};e.prototype.clearQueue=function(a,c){if(this._currentZone)this._currentZone.player.clearQueue(c);else{var b=this;this.search(function(d){d?c&&c(d):b._currentZone?b._currentZone.player.clearQueue(a,
c):c&&c(d)})}};e.prototype.toJSON=function(){return{sys:"sonos",type:"master",ip:"xxxxxx",port:0,uuid:"master"}};e.prototype.equalsTo=function(a){return a&&a instanceof e?!0:!1};return e}();
xnm.aio.sonos.Player=function(){var e=function(a,c,b,d){var f=require("x.logger.js");this._logger=f?f.getLogger("xnm.aio.sonos.Player"):{log:function(){}};this.ip=a;this.port=c;if(!c||0>c)this.port=1400;this.uuid=b;this.name=d;this.zoneName=null;this.ip&&this.port&&(this._device=this._getDevice(this.ip,this.port,this.uuid,this.name),this._renderer=this._getRenderer(this.ip,this.port,this.uuid),this._server=this._getServer(this.ip,this.port,this.uuid));this.CommandHandler=null};e.prototype.PLAY_MODE=
"NORMAL REPEAT_ALL REPEAT_ONE SHUFFLE_NOREPEAT SHUFFLE SHUFFLE_REPEAT_ONE".split(" ");e.prototype.zoneGroupTopology={type:"urn:schemas-upnp-org:service:ZoneGroupTopology:1",url:"/ZoneGroupTopology/Control"};e.prototype.groupManagement={type:"urn:schemas-upnp-org:service:GroupManagement:1",url:"/GroupManagement/Control"};e.prototype._getDevice=function(a,c,b,d){var f=new (require("x.upnp.js").Device);f.init(a,c,b,null);f.name=d;return f};e.prototype._getRenderer=function(a,c,b){if(!a&&this._renderer)return this._renderer;
var d=new (require("x.upnp.js").MediaRenderer);d.init(a,c,b,{avTransport:{type:"urn:schemas-upnp-org:service:AVTransport:1",url:"/MediaRenderer/AVTransport/Control"},connectionManager:{type:"urn:schemas-upnp-org:service:ConnectionManager:1",url:"/MediaRenderer/ConnectionManager/Control"},renderingControl:{type:"urn:schemas-upnp-org:service:RenderingControl:1",url:"/MediaRenderer/RenderingControl/Control"},groupRenderingControl:{type:"urn:schemas-upnp-org:service:GroupRenderingControl:1",url:"/MediaRenderer/GroupRenderingControl/Control"},
queue:{type:"urn:schemas-sonos-com:service:Queue:1",url:"/MediaRenderer/Queue/Control"}});return d};e.prototype._getServer=function(a,c,b){var d=new (require("x.upnp.js").MediaServer);d.init(a,c,b,{contentDirectory:{type:"urn:schemas-upnp-org:service:ContentDirectory:1",url:"/MediaServer/ContentDirectory/Control"},connectionManager:{type:"urn:schemas-upnp-org:service:ConnectionManager:1",url:"/MediaServer/ConnectionManager/Control"}});return d};e.prototype.play=function(a){this._getRenderer().play(a)};
e.prototype.pause=function(a){this._getRenderer().pause(a)};e.prototype.stop=function(a){this._getRenderer().stop(a)};e.prototype.previous=function(a){this._getRenderer().previous(a)};e.prototype.next=function(a){this._getRenderer().next(a)};e.prototype.mute=function(a){this._getRenderer().mute(a)};e.prototype.unmute=function(a){this._getRenderer().unmute(a)};e.prototype.isMuted=function(a){this._getRenderer().isMuted(a)};e.prototype.getVolume=function(a){this._getRenderer().getVolume(a)};e.prototype.setVolume=
function(a,c){this._getRenderer().setVolume(a,c)};e.prototype.getPlayState=function(a){this._getRenderer().getPlayState(a)};e.prototype.getInfo=function(a){this._getRenderer().getInfo(a)};e.prototype.playItem=function(a,c){this._getRenderer().playItem(a,c)};e.prototype.playPlaylist=function(){var a=require("x.upnp.js"),c=this._getRenderer();var b='<u:SetAVTransportURI xmlns:u="urn:schemas-upnp-org:service:AVTransport:1"><InstanceID>0</InstanceID><CurrentURI>x-rincon-queue:'+(c.uuid+"#0</CurrentURI><CurrentURIMetaData></CurrentURIMetaData>");
b+="</u:SetAVTransportURI>";(new a.SOAPRequest).doRequest(c.getURL(c.AVTransport),'"urn:schemas-upnp-org:service:AVTransport:1#SetAVTransportURI"',b,function(d){c.play()})};e.prototype.getPlaylist=function(a){a=require("x.upnp.js");var c=this._getRenderer();(new a.SOAPRequest).doRequest(c.getURL("/MediaServer/ContentDirectory/Control"),'"urn:schemas-upnp-org:service:ContentDirectory:1#Browse"','<u:Browse xmlns:u="urn:schemas-upnp-org:service:ContentDirectory:1"><ObjectID>Q:0</ObjectID><BrowseFlag>BrowseDirectChildren</BrowseFlag><Filter>dc:title,res,dc:creator,upnp:artist,upnp:album,upnp:albumArtURI</Filter><StartingIndex>{0}</StartingIndex><RequestedCount>{1}</RequestedCount><SortCriteria></SortCriteria></u:Browse>',
function(b){var d=[];b=c._parseSOAPResponse(b,!0);(b=$($.parseXML(b)))&&b.find("item").each(function(){$(this);d.push(c._parseItemMetaData($(this)))})})};e.prototype.clearPlaylist=function(a){var c=require("x.upnp.js"),b=this._getRenderer();(new c.SOAPRequest).doRequest(b.getURL(b.AVTransport),'"urn:schemas-upnp-org:service:AVTransport:1#RemoveAllTracksFromQueue"','<u:RemoveAllTracksFromQueue xmlns:u="urn:schemas-upnp-org:service:AVTransport:1"><InstanceID>0</InstanceID></u:RemoveAllTracksFromQueue>',
function(d){a&&a()})};e.prototype.addToPlaylist=function(a,c){var b=require("x.upnp.js"),d=this._getRenderer();a='<u:AddURIToQueue xmlns:u="urn:schemas-upnp-org:service:AVTransport:1"><InstanceID>0</InstanceID><EnqueuedURI>'+(a+"</EnqueuedURI><EnqueuedURIMetaData></EnqueuedURIMetaData><DesiredFirstTrackNumberEnqueued>0</DesiredFirstTrackNumberEnqueued><EnqueueAsNext>1</EnqueueAsNext></u:AddURIToQueue>");(new b.SOAPRequest).doRequest(d.getURL(d.AVTransport),'"urn:schemas-upnp-org:service:AVTransport:1#AddURIToQueue"',
a,function(f){c&&c()})};e.prototype.setPlaylist=function(a,c){if(0<a.length){var b=a.pop(),d=this;this.addToPlaylist(b.url,function(){d.setPlaylist(a,c)})}else c&&c()};e.prototype.executeCommand=function(a,c,b){var d=this;a=!0;"play"==c?this.play():"pause"==c?this.pause():"stop"==c?this.stop():"previous"==c?this.previous():"next"==c?this.next():"toggleMute"==c?(a=!1,this.isMuted(function(f){f?d.mute(!1):d.mute(!0);b&&setTimeout(function(){b()},200)})):(a=!1,this.setVolume(Math.floor(parseInt(c)),
function(){b&&setTimeout(function(){b()},200)}));a&&b&&setTimeout(function(){b()},200)};e.prototype.getStates=function(a,c,b){var d=this;this.CommandHandler=a;this.getVolume(function(f){d.isMuted(function(h){d.getPlayState(function(g){var l={volume:f,muted:h,state:g};c&&d.CommandHandler&&d.CommandHandler.setState?(d.CommandHandler.setState(c.id+":volume",f),d.CommandHandler.setState(c.id+":muted",h),d.CommandHandler.setState(c.id+":state",g)):d.CommandHandler&&d.CommandHandler.receivedState&&d.CommandHandler.receivedState("sonos",
d.ip,l);d.getInfo(function(k){var m={artist:"",title:""};"PLAYING"==g&&(m.artist=k.artist?k.artist:"?",m.title=k.title?k.title:"?");d.CommandHandler&&d.CommandHandler.receivedState&&d.CommandHandler.receivedState("sonos",d.ip,m);b&&(l.title=m.title,l.artist=m.artist,b(l))})})})})};e.prototype.getStateValues=function(a){return a};e.prototype.getIP=function(){return this._device?this._device.ip:null};e.prototype.setIP=function(a){this._device&&(this._device.ip=a);this._renderer&&(this._renderer.ip=
a);this._server&&(this._server.ip=a)};e.prototype.getPort=function(){return this._device?this._device.port:null};e.prototype.setPort=function(a){this._device&&(this._device.port=a);this._renderer&&(this._renderer.port=a);this._server&&(this._server.port=a)};e.prototype.getUUID=function(){return this._device?this._device.uuid:null};e.prototype.getName=function(){return this._device?this._device.name:null};e.prototype.executeCommandCreator=function(a,c,b){c&&c.value?this._executeCommand(c.value,c.ext,
function(d){b&&b(d)},c):b&&b(Error("command value is empty"))};e.prototype.getStatesCreator=function(a,c,b){a=[];for(var d=this,f=0;f<c.length;f++){var h=c[f];if(h&&h.id&&h.status&&h.status.value){var g=null;switch(h.status.value){case "muted":g="MUTE";break;case "volume":g="VOLUME";break;case "groupMuted":g="GROUP_MUTE";break;case "groupVolume":g="GROUP_VOLUME";break;case "shuffle":case "repeat":g="PLAY_MODE";break;case "loudness":g="LOUDNESS";break;case "bass":g="BASS";break;case "treble":g="TREBLE";
break;case "balance":g="BALANCE";break;case "playState":g="PLAY_STATE";break;case "duration":case "durationS":case "position":case "positionS":case "artist":case "title":case "album":g="PLAY_INFO"}g&&-1==a.indexOf(g)&&a.push(g)}}this._getStates(a,function(l,k){l&&d._logger.log("trace","["+d.ip+":"+d.port+"]get states error:"+l.stack);if(k){l=[];for(var m=0;m<c.length;m++){var p=c[m];if(p&&p.id){var n="?";if(p.status)switch(p.status.value){case "muted":null!=k.muted&&"undefined"!=typeof k.muted&&(n=
k.muted);break;case "volume":null!=k.volume&&"undefined"!=typeof k.volume&&(n=k.volume);break;case "groupMuted":null!=k.groupMuted&&"undefined"!=typeof k.groupMuted&&(n=k.groupMuted);break;case "groupVolume":null!=k.groupVolume&&"undefined"!=typeof k.groupVolume&&(n=k.groupVolume);break;case "shuffle":k.playMode&&k.playMode.shuffle&&(n=k.playMode.shuffle);break;case "repeat":k.playMode&&k.playMode.repeat&&(n=k.playMode.repeat);break;case "loudness":k.loudness&&(n=k.loudness);break;case "bass":null!=
k.bass&&"undefined"!=typeof k.bass&&(n=k.bass);break;case "treble":null!=k.treble&&"undefined"!=typeof k.treble&&(n=k.treble);break;case "balance":null!=k.balance&&"undefined"!=typeof k.balance&&(n=k.balance);break;case "playState":k.transportState&&(n=k.transportState);break;case "duration":k.playInfo&&k.playInfo.duration&&(n=k.playInfo.duration);break;case "durationS":k.playInfo&&"undefined"!=typeof k.playInfo.durationSec&&null!=k.playInfo.durationSec&&(n=k.playInfo.durationSec);break;case "position":k.playInfo&&
k.playInfo.position&&(n=k.playInfo.position);break;case "positionS":k.playInfo&&"undefined"!=typeof k.playInfo.positionSec&&null!=k.playInfo.positionSec&&(n=k.playInfo.positionSec);break;case "artist":n=k.playInfo&&k.playInfo.trackMetaData&&k.playInfo.trackMetaData.artist?k.playInfo.trackMetaData.artist:"";break;case "title":n=k.playInfo&&k.playInfo.trackMetaData&&k.playInfo.trackMetaData.title?k.playInfo.trackMetaData.title:"";break;case "album":n=k.playInfo&&k.playInfo.trackMetaData&&k.playInfo.trackMetaData.album?
k.playInfo.trackMetaData.album:""}l.push({id:p.id,status:n})}}b&&b(null,l)}else b&&b(Error("get state error"))})};e.prototype._executeCommand=function(a,c,b,d){if(this._renderer)switch(a){case "play":this._renderer.play(b);break;case "pause":this._renderer.pause(b);break;case "stop":this._renderer.stop(b);break;case "previous":this._renderer.previous(b);break;case "next":this._renderer.next(b);break;case "mute":this._renderer.mute(b);break;case "unmute":this._renderer.unmute(b);break;case "toggleMute":this._renderer.toggleMute(b);
break;case "volume":if("undefined"==typeof c||null==c){b&&b(Error("volume value invalid"));break}this._renderer.setVolume(c,b);break;case "volumeUp":this.volumeUp(b);break;case "volumeDown":this.volumeDown(b);break;case "shuffleOn":this.shuffleOn(b);break;case "shuffleOff":this.shuffleOff(b);break;case "shuffleToggle":this.shuffleToggle(b);break;case "repeatOff":this.repeatOff(b);break;case "repeatAll":this.repeatAll(b);break;case "repeatOne":this.repeatOne(b);break;case "repeatSwitch":this.repeatSwitch(b);
break;case "groupVolume":if("undefined"==typeof c||null==c){b&&b(Error("volume value invalid"));break}this.setGroupVolume(c,b);break;case "groupVolumeUp":this.groupVolumeUp(b);break;case "groupVolumeDown":this.groupVolumeDown(b);break;case "groupMute":this.groupMute(b);break;case "groupUnmute":this.groupUnmute(b);break;case "groupToggleMute":this.groupToggleMute(b);break;case "loudnessOn":this.activateLoudness(b);break;case "loudnessOff":this.deactivateLoudness(b);break;case "toggleLoudness":this.toggleLoudness(b);
break;case "bass":if("undefined"==typeof c||null==c){b&&b(Error("volume value invalid"));break}this.setBass(c,b);break;case "bassUp":this.bassUp(b);break;case "bassDown":this.bassDown(b);break;case "treble":if("undefined"==typeof c||null==c){b&&b(Error("volume value invalid"));break}this.setTreble(c,b);break;case "trebleUp":this.trebleUp(b);break;case "trebleDown":this.trebleDown(b);break;case "balance":if("undefined"==typeof c||null==c){b&&b(Error("volume value invalid"));break}this.setBalance(c,
b);break;case "balanceLeft":this.balanceToLeft(b);break;case "balanceRight":this.balanceToRight(b);break;case "seekTo":if("undefined"==typeof c||null==c){b&&b(Error("seek value invalid"));break}this._renderer.seekRelTimeSec(c,b);break;case "playLineIn":this.playLineIn(b);break;case "playUrl":if("undefined"==typeof c||null==c){b&&b(Error("playUrl url invalid"));break}this.playUrl(c,b);break;default:b&&b(Error("unknown command"))}else b&&b(Error("renderer not initialized"))};e.prototype._getStates=
function(a,c){if(this._renderer)if(a&&0!=a.length){var b=function(){f--;0==f&&c&&c(null,d)},d={},f=a.length;-1!=a.indexOf("PLAY_STATE")&&this._renderer.getPlayState(function(h,g){h||(d.transportState=g);b()});-1!=a.indexOf("PLAY_INFO")&&this.getPlayInfo(function(h,g){h||(d.playInfo=g);b()});-1!=a.indexOf("MUTE")&&this._renderer.isMuted(function(h,g){h||(d.muted=g);b()});-1!=a.indexOf("VOLUME")&&this._renderer.getVolume(function(h,g){h||(d.volume=g);b()});-1!=a.indexOf("PLAY_MODE")&&this.getPlayMode(function(h,
g){h||(d.playMode=g);b()});-1!=a.indexOf("GROUP_MUTE")&&this.isGroupMuted(function(h,g){h||(d.groupMuted=g);b()});-1!=a.indexOf("GROUP_VOLUME")&&this.getGroupVolume(function(h,g){h||(d.groupVolume=g);b()});-1!=a.indexOf("BALANCE")&&this.getBalance(function(h,g){h||(d.balance=g);b()});-1!=a.indexOf("BASS")&&this.getBass(function(h,g){h||(d.bass=g);b()});-1!=a.indexOf("TREBLE")&&this.getTeble(function(h,g){h||(d.treble=g);b()});-1!=a.indexOf("LOUDNESS")&&this.isLoudnessActive(function(h,g){h||(d.loudness=
g?"on":"off");b()})}else c&&c(null,{});else c&&c(Error("renderer not initialized"))};e.prototype.playUrl=function(a,c){if(a){var b=this;this._renderer._setAVTransportURI(0,a,null,function(d){d?c&&c(d):b._renderer.play(c)})}else c&&c(Error("url is null"))};e.prototype.addUrlToQueueAndPlayThenDelete=function(a,c,b){if(a){c||(c=30);var d=this;this._addURItoQueue(0,a,null,0,!0,function(f,h){f?b&&b(f):h&&"undefined"!=typeof h.firstTrackNumberEnqueued&&null!=h.firstTrackNumberEnqueued?d._renderer.seekTrack(h.firstTrackNumberEnqueued,
function(g){g?b&&b(g):d._renderer.play(function(l){l?b&&b(l):setTimeout(function(){d._removeAllTracks(0,0,function(k){b&&b(k)})},1E3*c)})}):b&&b(Error("result format invalid"))})}else b&&b(Error("url is null"))};e.prototype.playObject=function(a,c,b){if(a&&c&&c["class"]&&c.id){var d=this;a.browseMetaData(c.id,function(f,h){f?b&&b(f):c.res&&c.res.url?d._renderer.playResource({url:c.res.url},h.result,b):b&&b(Error("resource url invalid"))})}else b&&b(Error("play obj invalid"))};e.prototype.addToQueueAndPlay=
function(a,c,b){if(a&&c&&c.res&&c.res.url&&c.id){var d=this;c.parentID&&"Q:"==c.parentID.substr(0,2)?this.playFromQueue(a,c,b):a.browseMetaData(c.id,function(f,h){f?b&&b(f):h&&h.meta&&h.meta.res&&"x-sonosapi-stream"==h.meta.res.substr(0,17)?d._renderer.playResource({url:h.meta.res},h.meta.resMD,b):d._addURI(0,0,c.res.url,h.result,0,!0,function(g,l){g?b&&b(g):l&&"undefined"!=typeof l.firstTrackNumberEnqueued&&null!=l.firstTrackNumberEnqueued?d._renderer.seekTrack(l.firstTrackNumberEnqueued,function(k){k?
d.playQueue(b):d._renderer.play(b)}):b&&b(Error("result format invalid"))})})}else b&&b(Error("play obj invalid"))};e.prototype.playQueue=function(a){var c=this;this._renderer._setAVTransportURI(0,"x-rincon-queue:"+this._renderer.uuid+"#0",null,function(b){b?a&&a(b):c._renderer.play(a)})};e.prototype.playFromQueue=function(a,c,b){if(c.id)if(a=c.id.indexOf("/"),-1==a)b&&b(Error("queue object id is invalid"));else{var d=this;c=c.id.substr(a+1);this._renderer.seekTrack(c,function(f){f?d.playQueue(b):
d._renderer.play(b)})}else b&&b(Error("queue object id is null"))};e.prototype.addToQueue=function(a,c,b){if(a&&c&&c.res&&c.res.url&&c.id){var d=this;a.browseMetaData(c.id,function(f,h){f?b&&b(f):d._addURI(0,0,c.res.url,h.result,0,!0,b)})}else b&&b(Error("play obj invalid"))};e.prototype.replaceQueueAndPlay=function(a,c,b){if(a&&c&&c.res&&c.res.url&&c.id){var d=this;a.browseMetaData(c.id,function(f,h){f?b&&b(f):d._removeAllTracks(0,0,function(g){g?b&&b(g):d._addURI(0,0,c.res.url,h.result,0,!0,function(l,
k){l?b&&b(l):k&&"undefined"!=typeof k.firstTrackNumberEnqueued&&null!=k.firstTrackNumberEnqueued?d._renderer.seekTrack(k.firstTrackNumberEnqueued,function(m){m?b&&b(m):d._renderer.play(b)}):b&&b(Error("result format invalid"))})})})}else b&&b(Error("play obj invalid"))};e.prototype.browser=function(a,c,b,d,f){a?(c||(c=0),b||(b=0),d||(d=0),a.browseChildren(c,b,d,null,function(h,g,l){if(!h&&g)for(var k=0;k<g.length;k++)g[k]&&(g[k].id&&"Q:"==g[k].id.substr(0,2)&&"Q:"==g[k].parentID&&g[k].res&&delete g[k].res,
g[k].albumArtURI&&"http://"!=g[k].albumArtURI.substr(0,7)&&(g[k].albumArtURI="http://"+a.ip+":"+a.port+g[k].albumArtURI),g[k].info&&g[k].info.albumArtURI&&"http://"!=g[k].info.albumArtURI.substr(0,7)&&(g[k].info.albumArtURI="http://"+a.ip+":"+a.port+g[k].info.albumArtURI));f&&f(h,g,l)})):f&&f(Error("play obj invalid"))};e.prototype.getZoneGroupState=function(a){var c=this;this._getZoneGroupState(function(b,d){if(b)a&&a(b);else if(d&&d.zoneGroupState){b=!1;for(var f=0;f<d.zoneGroupState.length;f++){var h=
d.zoneGroupState[f];h&&h.coordinator==c.getUUID()&&(b=!0);for(var g=0;g<h.members.length;g++){var l=h.members[g];l&&l.uuid==c.getUUID()&&l.name&&(c.zoneName=l.name)}}a&&a(null,d.zoneGroupState,b)}else a&&a(Error("unknow zone group state"))})};e.prototype.getZoneGroupState=function(a){var c=this;this._getZoneGroupState(function(b,d){if(b)a&&a(b);else if(d&&d.zoneGroupState){b=!1;for(var f=0;f<d.zoneGroupState.length;f++){var h=d.zoneGroupState[f];h&&h.coordinator==c.getUUID()&&(b=!0);for(var g=0;g<
h.members.length;g++){var l=h.members[g];l&&l.uuid==c.getUUID()&&l.name&&(c.zoneName=l.name)}}a&&a(null,d.zoneGroupState,b)}else a&&a(Error("unknow zone group state"))})};e.prototype.playLineIn=function(a){var c=this.getUUID();c?this._renderer.playResource({url:"x-rincon-stream:"+c},"",a):a&&a(Error("no uuid"))};e.prototype.clearQueue=function(a,c){var b=0;"Q:1"==a&&(b=1);this._removeAllTracks(b,0,c)};e.prototype.volumeUp=function(a){this._setRelativeVolume(0,"Master",5,a)};e.prototype.volumeDown=
function(a){this._setRelativeVolume(0,"Master",-5,a)};e.prototype.getPlayInfo=function(a){if(this._renderer){var c=function(l){h--;l?a&&a(l):0==h&&(b&&"x-sonosapi-stream"==b.substr(0,17)&&d&&f&&f.trackMetaData&&(d["class"]&&(f.trackMetaData["class"]=d["class"]),d.title&&(f.trackMetaData.title=d.title),f.trackMetaData.streamContent&&(f.trackMetaData.artist=f.trackMetaData.streamContent)),f&&f.trackMetaData&&f.trackMetaData.creator&&!f.trackMetaData.artist&&(f.trackMetaData.artist=f.trackMetaData.creator),
a&&a(null,f))},b,d,f,h=2,g=this;this._renderer.getPlayInfo(function(l,k){!l&&k&&(k.trackMetaData&&k.trackMetaData.albumArtURI&&"http://"!=k.trackMetaData.albumArtURI.substr(0,7)&&(k.trackMetaData.albumArtURI="http://"+g._renderer.ip+":"+g._renderer.port+k.trackMetaData.albumArtURI),f=k);c&&c(l);l&&(c=null)});this._renderer.getMediaInfo(function(l,k){!l&&k&&(b=k.currentURI,d=k.currentURIMetaData);c&&c(l);l&&(c=null)})}else a&&a(Error("renderer not initialized"))};e.prototype.getMediaInfo=function(a){this._renderer?
this._renderer.getMediaInfo(function(c,b){a&&a(c,b)}):a&&a(Error("renderer not initialized"))};e.prototype.getPlayMode=function(a){if(this._renderer){var c=this;this._renderer.getPlayMode(function(b,d){b?a&&a(b):a&&a(null,c._parsePlayMode(d))})}else a&&a(Error("renderer not initialized"))};e.prototype.setPlayMode=function(a,c){this._renderer?(a=this._buildPlayMode(a),this._renderer.setPlayMode(a,c)):c&&c(Error("renderer not initialized"))};e.prototype._parsePlayMode=function(a){switch(a){case "NORMAL":return{shuffle:"off",
repeat:"off"};case "REPEAT_ALL":return{shuffle:"off",repeat:"all"};case "REPEAT_ONE":return{shuffle:"off",repeat:"one"};case "SHUFFLE_NOREPEAT":return{shuffle:"on",repeat:"off"};case "SHUFFLE":return{shuffle:"on",repeat:"all"};case "SHUFFLE_REPEAT_ONE":return{shuffle:"on",repeat:"one"};default:return{shuffle:"off",repeat:"off"}}};e.prototype._buildPlayMode=function(a){var c=a.shuffle;a=a.repeat;c||(c="off");a||(a="off");return"off"==c&&"off"==a?"NORMAL":"off"==c&&"all"==a?"REPEAT_ALL":"off"==c&&"one"==
a?"REPEAT_ONE":"on"==c&&"off"==a?"SHUFFLE_NOREPEAT":"on"==c&&"all"==a?"SHUFFLE":"on"==c&&"one"==a?"SHUFFLE_REPEAT_ONE":"NORMAL"};e.prototype.isGroupMuted=function(a){this._getGroupMute(0,function(c,b){c?a&&a(c):a&&a(null,"1"==b.currentMute)})};e.prototype.groupMute=function(a){this._setGroupMute(0,!0,function(c,b){c?a&&a(c):a&&a(null,"1"==b.currentMute)})};e.prototype.groupUnmute=function(a){this._setGroupMute(0,!1,function(c,b){c?a&&a(c):a&&a(null,"1"==b.currentMute)})};e.prototype.groupToggleMute=
function(a){var c=this;this.isGroupMuted(function(b,d){b?a&&a(b):d?c.groupUnmute(a):c.groupMute(a)})};e.prototype.getGroupVolume=function(a){this._getGroupVolume(0,function(c,b){c?a&&a(c):a&&a(null,parseInt(b.currentVolume))})};e.prototype.setGroupVolume=function(a,c){a=parseInt(a);0>a&&(a=0);100<a&&(a=100);this._setGroupVolume(0,a,c)};e.prototype.groupVolumeUp=function(a){this._setRelativeGroupVolume(0,5,a)};e.prototype.groupVolumeDown=function(a){this._setRelativeGroupVolume(0,-5,a)};e.prototype.getBalance=
function(a){if(this._renderer){var c=100,b=100,d=2,f=function(h){d--;h?a&&a(h):0==d&&a&&a(null,b-c)};this._renderer._getVolume(0,"LF",function(h,g){!h&&g&&(c=parseInt(g.volume));f&&f(h);h&&(f=null)});this._renderer._getVolume(0,"RF",function(h,g){!h&&g&&(b=parseInt(g.volume));f&&f(h);h&&(f=null)})}else a&&a(Error("renderer not initialized"))};e.prototype.setBalance=function(a,c){a=parseInt(a);100<a&&(a=100);-100>a&&(a=-100);var b=100,d=100;0>a?d=a+100:0<a&&(b=100-a);var f=2,h=function(g){f--;g?c&&
c(g):0==f&&c&&c()};this._renderer._setVolume(0,"LF",b,function(g){h&&h(g);g&&(h=null)});this._renderer._setVolume(0,"RF",d,function(g){h&&h(g);g&&(h=null)})};e.prototype.balanceToLeft=function(a){var c=this;this.getBalance(function(b,d){b?a&&a(b):(d=parseInt(d),c.setBalance(d-5,a))})};e.prototype.balanceToRight=function(a){var c=this;this.getBalance(function(b,d){b?a&&a(b):(d=parseInt(d),c.setBalance(d+5,a))})};e.prototype.getBass=function(a){this._getBass(0,function(c,b){c?a&&a(c):a&&a(null,parseInt(b.currentBase))})};
e.prototype.setBass=function(a,c){a=parseInt(a);10<a&&(a=10);-10>a&&(a=-10);this._setBass(0,a,c)};e.prototype.bassUp=function(a){var c=this;this.getBass(function(b,d){b?a&&a(b):(d=parseInt(d),c.setBass(d+1,a))})};e.prototype.bassDown=function(a){var c=this;this.getBass(function(b,d){b?a&&a(b):(d=parseInt(d),c.setBass(d-1,a))})};e.prototype.getTeble=function(a){this._getTreble(0,function(c,b){c?a&&a(c):a&&a(null,parseInt(b.currentTreble))})};e.prototype.setTreble=function(a,c){a=parseInt(a);10<a&&
(a=10);-10>a&&(a=-10);this._setTreble(0,a,c)};e.prototype.trebleUp=function(a){var c=this;this.getTeble(function(b,d){b?a&&a(b):(d=parseInt(d),c.setTreble(d+1,a))})};e.prototype.trebleDown=function(a){var c=this;this.getTeble(function(b,d){b?a&&a(b):(d=parseInt(d),c.setTreble(d-1,a))})};e.prototype.isLoudnessActive=function(a){this._getLoudness(0,"Master",function(c,b){c?a&&a(c):a&&a(null,"1"==b.currentLoudness)})};e.prototype.activateLoudness=function(a){this._setLoudness(0,"Master",!0,a)};e.prototype.deactivateLoudness=
function(a){this._setLoudness(0,"Master",!1,a)};e.prototype.toggleLoudness=function(a){var c=this;this.isLoudnessActive(function(b,d){b?a&&a(b):d?c.deactivateLoudness(a):c.activateLoudness(a)})};e.prototype.shuffleOn=function(a){if(this._renderer){var c=this;this.getPlayMode(function(b,d){b?a&&a(b):(d.shuffle="on",c.setPlayMode(d,a))})}else a&&a(Error("renderer not initialized"))};e.prototype.shuffleOff=function(a){if(this._renderer){var c=this;this.getPlayMode(function(b,d){b?a&&a(b):(d.shuffle=
"off",c.setPlayMode(d,a))})}else a&&a(Error("renderer not initialized"))};e.prototype.shuffleToggle=function(a){if(this._renderer){var c=this;this.getPlayMode(function(b,d){b?a&&a(b):(d.shuffle="on"==d.shuffle?"off":"on",c.setPlayMode(d,a))})}else a&&a(Error("renderer not initialized"))};e.prototype.repeatOff=function(a){if(this._renderer){var c=this;this.getPlayMode(function(b,d){b?a&&a(b):(d.repeat="off",c.setPlayMode(d,a))})}else a&&a(Error("renderer not initialized"))};e.prototype.repeatOne=function(a){if(this._renderer){var c=
this;this.getPlayMode(function(b,d){b?a&&a(b):(d.repeat="one",c.setPlayMode(d,a))})}else a&&a(Error("renderer not initialized"))};e.prototype.repeatAll=function(a){if(this._renderer){var c=this;this.getPlayMode(function(b,d){b?a&&a(b):(d.repeat="all",c.setPlayMode(d,a))})}else a&&a(Error("renderer not initialized"))};e.prototype.repeatSwitch=function(a){if(this._renderer){var c=this;this.getPlayMode(function(b,d){b?a&&a(b):(d.repeat="off"==d.repeat?"all":"all"==d.repeat?"one":"off",c.setPlayMode(d,
a))})}else a&&a(Error("renderer not initialized"))};e.prototype._setRelativeVolume=function(a,c,b,d){this._renderer?this._renderer._doSOAPRequest(this._renderer.getURL(this._renderer.renderingControl.url),this._renderer.renderingControl.type,"SetRelativeVolume",{InstanceID:a,Channel:c,Adjustment:b},function(f,h){f?d&&d(f):(f={},h=h.find("NewVolume"),0<h.length&&(f.newVolume=$(h[0]).text()),d&&d(null,f))}):d&&d(Error("renderer not initialized"))};e.prototype._getGroupMute=function(a,c){this._renderer?
this._renderer._doSOAPRequest(this._renderer.getURL(this._renderer.groupRenderingControl.url),this._renderer.groupRenderingControl.type,"GetGroupMute",{InstanceID:a},function(b,d){b?c&&c(b):(b={},d=d.find("CurrentMute"),0<d.length&&(b.currentMute=$(d[0]).text()),c&&c(null,b))}):c&&c(Error("renderer not initialized"))};e.prototype._setGroupMute=function(a,c,b){this._renderer?this._renderer._doSOAPRequest(this._renderer.getURL(this._renderer.groupRenderingControl.url),this._renderer.groupRenderingControl.type,
"SetGroupMute",{InstanceID:a,DesiredMute:c?"True":"False"},b):b&&b(Error("renderer not initialized"))};e.prototype._getGroupVolume=function(a,c){this._renderer?this._renderer._doSOAPRequest(this._renderer.getURL(this._renderer.groupRenderingControl.url),this._renderer.groupRenderingControl.type,"GetGroupVolume",{InstanceID:a},function(b,d){b?c&&c(b):(b={},d=d.find("CurrentVolume"),0<d.length&&(b.currentVolume=$(d[0]).text()),c&&c(null,b))}):c&&c(Error("renderer not initialized"))};e.prototype._setGroupVolume=
function(a,c,b){this._renderer?this._renderer._doSOAPRequest(this._renderer.getURL(this._renderer.groupRenderingControl.url),this._renderer.groupRenderingControl.type,"SetGroupVolume",{InstanceID:a,DesiredVolume:c},b):b&&b(Error("renderer not initialized"))};e.prototype._setRelativeGroupVolume=function(a,c,b){this._renderer?this._renderer._doSOAPRequest(this._renderer.getURL(this._renderer.groupRenderingControl.url),this._renderer.groupRenderingControl.type,"SetRelativeGroupVolume",{InstanceID:a,
Adjustment:c},function(d,f){d?b&&b(d):(d={},f=f.find("NewVolume"),0<f.length&&(d.newVolume=$(f[0]).text()),b&&b(null,d))}):b&&b(Error("renderer not initialized"))};e.prototype._getBass=function(a,c){this._renderer?this._renderer._doSOAPRequest(this._renderer.getURL(this._renderer.renderingControl.url),this._renderer.renderingControl.type,"GetBass",{InstanceID:a},function(b,d){b?c&&c(b):(b={},d=d.find("CurrentBass"),0<d.length&&(b.currentBase=$(d[0]).text()),c&&c(null,b))}):c&&c(Error("renderer not initialized"))};
e.prototype._setBass=function(a,c,b){this._renderer?this._renderer._doSOAPRequest(this._renderer.getURL(this._renderer.renderingControl.url),this._renderer.renderingControl.type,"SetBass",{InstanceID:a,DesiredBass:c},b):b&&b(Error("renderer not initialized"))};e.prototype._getTreble=function(a,c){this._renderer?this._renderer._doSOAPRequest(this._renderer.getURL(this._renderer.renderingControl.url),this._renderer.renderingControl.type,"GetTreble",{InstanceID:a},function(b,d){b?c&&c(b):(b={},d=d.find("CurrentTreble"),
0<d.length&&(b.currentTreble=$(d[0]).text()),c&&c(null,b))}):c&&c(Error("renderer not initialized"))};e.prototype._setTreble=function(a,c,b){this._renderer?this._renderer._doSOAPRequest(this._renderer.getURL(this._renderer.renderingControl.url),this._renderer.renderingControl.type,"SetTreble",{InstanceID:a,DesiredTreble:c},b):b&&b(Error("renderer not initialized"))};e.prototype._getLoudness=function(a,c,b){this._renderer?this._renderer._doSOAPRequest(this._renderer.getURL(this._renderer.renderingControl.url),
this._renderer.renderingControl.type,"GetLoudness",{InstanceID:a,Channel:c},function(d,f){d?b&&b(d):(d={},f=f.find("CurrentLoudness"),0<f.length&&(d.currentLoudness=$(f[0]).text()),b&&b(null,d))}):b&&b(Error("renderer not initialized"))};e.prototype._setLoudness=function(a,c,b,d){this._renderer?this._renderer._doSOAPRequest(this._renderer.getURL(this._renderer.renderingControl.url),this._renderer.renderingControl.type,"SetLoudness",{InstanceID:a,Channel:c,DesiredLoudness:b?"True":"False"},d):d&&d(Error("renderer not initialized"))};
e.prototype._getZoneGroupState=function(a){if(this._renderer){var c=this;this._renderer._doSOAPRequest(this._renderer.getURL(this.zoneGroupTopology.url),this.zoneGroupTopology.type,"GetZoneGroupState",null,function(b,d){if(b)a&&a(b);else{b={};d=d.find("ZoneGroupState");if(0<d.length)if(d=$(d[0]).text())try{var f=$($.parseXML(d));b.zoneGroupStateRaw=f;b.zoneGroupState=c._parseZoneGroupState(f)}catch(h){a&&a(h);return}else b.zoneGroupStateRaw="",b.zoneGroupState=null;a&&a(null,b)}})}else a&&a(Error("renderer not initialized"))};
e.prototype._parseZoneGroupState=function(a){var c=[];a.find("ZoneGroup").each(function(){var b=$(this),d=b.attr("ID"),f=b.attr("Coordinator");if(d&&f){var h={id:d,coordinator:f,members:[]};b.find("ZoneGroupMember").each(function(){var g=$(this),l=g.attr("UUID");g=g.attr("ZoneName");l&&g&&h.members.push({uuid:l,name:g})});c.push(h)}});return c};e.prototype._addURItoQueue=function(a,c,b,d,f,h){this._renderer?this._renderer._doSOAPRequest(this._renderer.getURL(this._renderer.avTransport.url),this._renderer.avTransport.type,
"AddURIToQueue",{InstanceID:a,EnqueuedURI:c,EnqueuedURIMetaData:b,DesiredFirstTrackNumberEnqueued:d,EnqueueAsNext:f?"True":"False"},function(g,l){if(g)h&&h(g);else{g={};var k=l.find("FirstTrackNumberEnqueued");0<k.length&&(g.firstTrackNumberEnqueued=$(k[0]).text());k=l.find("NumTracksAdded");0<k.length&&(g.numTracksAdded=$(k[0]).text());k=l.find("NewQueueLength");0<k.length&&(g.newQueueLength=$(k[0]).text());h&&h(null,g)}}):h&&h(Error("renderer not initialized"))};e.prototype._addURI=function(a,c,
b,d,f,h,g){this._renderer?this._renderer._doSOAPRequest(this._renderer.getURL(this._renderer.queue.url),this._renderer.queue.type,"AddURI",{QueueID:a,UpdateID:c,EnqueuedURI:b,EnqueuedURIMetaData:d,DesiredFirstTrackNumberEnqueued:f,EnqueueAsNext:h?"True":"False"},function(l,k){if(l)g&&g(l);else{l={};var m=k.find("FirstTrackNumberEnqueued");0<m.length&&(l.firstTrackNumberEnqueued=$(m[0]).text());m=k.find("NumTracksAdded");0<m.length&&(l.numTracksAdded=$(m[0]).text());m=k.find("NewQueueLength");0<m.length&&
(l.newQueueLength=$(m[0]).text());g&&g(null,l)}}):g&&g(Error("renderer not initialized"))};e.prototype._removeAllTracks=function(a,c,b){this._renderer?this._renderer._doSOAPRequest(this._renderer.getURL(this._renderer.queue.url),this._renderer.queue.type,"RemoveAllTracks",{QueueID:a,UpdateID:c},function(d,f){d?b&&b(d):(d={},f=f.find("NewUpdateID"),0<f.length&&(d.newUpdateID=$(f[0]).text()),b&&b(null,d))}):b&&b(Error("renderer not initialized"))};e.prototype.toJSON=function(){return{sys:xnm.aio.sonos.DM.SYS,
type:"play",ip:this.getIP(),port:this.getPort(),uuid:this.getUUID(),model:this._renderer?this._renderer.modelName:null,name:this.getName(),zoneName:this.zoneName}};e.prototype.equalsTo=function(a){return a&&a instanceof e?this.getIP()==a.getIP()&&this.getPort()==a.getPort():!1};e.parseJSON=function(a){return a.ip&&a.port?new e(a.ip,a.port,a.uuid,a.name):null};return e}();
xnm.aio.sonos.Discovery=function(){var e=function(a){this._logger="undefined"!=typeof require&&require?require("x.logger.js").getLogger("xnm.aio.sonos.Discovery"):{log:{}};this._upnpCB=null;this._listener=a};e.prototype.search=function(){if(!this._upnpCB){var a=this;this._upnpCB=function(b){a._findUpnpDevice(b)}}var c=require("x.upnp.js").getDiscoveryService();c.addCallback("upnp:rootdevice",this._upnpCB);c.discoverTarget("upnp:rootdevice")};e.prototype._findUpnpDevice=function(a){if(a)switch(a.deviceType){case "urn:schemas-upnp-org:device:ZonePlayer:1":this._logger.log("trace",
"find sonos player");this._listener&&this._listener.findPlayer(a);break;case "urn:schemas-upnp-org:device:MediaServer:1":this._logger.log("trace","find media server:"+a.name+" @"+a.ip),this._listener&&this._listener.findMediaServer(a)}};return e}();
xnm.aio.sonos.DM=function(){var e={master:{command:[{type:"enum",name:"play",ref:{value:"play"}},{type:"enum",name:"pause",ref:{value:"pause"}},{type:"enum",name:"stop",ref:{value:"stop"}},{type:"enum",name:"previous",ref:{value:"previous"}},{type:"enum",name:"next",ref:{value:"next"}},{type:"enum",name:"shuffle on",ref:{value:"shuffleOn"}},{type:"enum",name:"shuffle off",ref:{value:"shuffleOff"}},{type:"enum",name:"toggle shuffle",ref:{value:"shuffleToggle"}},{type:"enum",name:"repeat off",ref:{value:"repeatOff"}},
{type:"enum",name:"repeat all",ref:{value:"repeatAll"}},{type:"enum",name:"repeat one",ref:{value:"repeatOne"}},{type:"enum",name:"switch repeat",ref:{value:"repeatSwitch"}},{type:"int",name:"group volume",ref:{value:"groupVolume",ext:"%d",extMeta:"0-100"}},{type:"enum",name:"group volume up",ref:{value:"groupVolumeUp"}},{type:"enum",name:"group volume down",ref:{value:"groupVolumeDown"}},{type:"enum",name:"group mute",ref:{value:"groupMute"}},{type:"enum",name:"group unmute",ref:{value:"groupUnmute"}},
{type:"enum",name:"group toggle mute",ref:{value:"groupToggleMute"}},{type:"enum",name:"loudness on",ref:{value:"loudnessOn"}},{type:"enum",name:"loudness off",ref:{value:"loudnessOff"}},{type:"enum",name:"toggle loudness",ref:{value:"toggleLoudness"}},{type:"int",name:"set bass",ref:{value:"bass",ext:"%d",extMeta:"-10-10"}},{type:"enum",name:"bass up",ref:{value:"bassUp"}},{type:"enum",name:"bass down",ref:{value:"bassDown"}},{type:"int",name:"set treble",ref:{value:"treble",ext:"%d",extMeta:"-10-10"}},
{type:"enum",name:"treble up",ref:{value:"trebleUp"}},{type:"enum",name:"treble down",ref:{value:"trebleDown"}},{type:"int",name:"set balance",ref:{value:"balance",ext:"%d",extMeta:"-100-100",scale:"5"}},{type:"enum",name:"balance to left",ref:{value:"balanceLeft"}},{type:"enum",name:"balance to right",ref:{value:"balanceRight"}},{type:"int",name:"seek to (seconds)",ref:{value:"seekTo",value_t:"seekToSeconds",ext:"%d"}}],status:[{type:"enum",name:"group muted",ref:{value:"groupMuted",options:["true",
"false"]}},{type:"int",name:"group volume",ref:{value:"groupVolume",extMeta:"0-100"}},{type:"enum",name:"shuffle state",ref:{value:"shuffle",options:["on","off"]}},{type:"enum",name:"repeat state",ref:{value:"repeat",options:["off","one","all"]}},{type:"enum",name:"loudness state",ref:{value:"loudness",options:["off","on"]}},{type:"int",name:"bass",ref:{value:"bass",extMeta:"-10-10"}},{type:"int",name:"treble",ref:{value:"treble",extMeta:"-10-10"}},{type:"int",name:"balance",ref:{value:"balance",
extMeta:"-100-100"}},{type:"string",name:"play state",ref:{value:"playState",options:"STOPPED PLAYING TRANSITIONING PAUSED_PLAYBACK PAUSED_RECORDING RECORDING NO_MEDIA_PRESENT".split(" ")}},{type:"string",name:"track duration",ref:{value:"duration"}},{type:"int",name:"track duration (seconds)",ref:{value:"durationS"}},{type:"string",name:"track position",ref:{value:"position"}},{type:"int",name:"track position (seconds)",ref:{value:"positionS"}},{type:"string",name:"artist",ref:{value:"artist"}},
{type:"string",name:"title",ref:{value:"title"}},{type:"string",name:"album",ref:{value:"album"}}]},play:{command:[{type:"enum",name:"play",ref:{value:"play"}},{type:"enum",name:"pause",ref:{value:"pause"}},{type:"enum",name:"stop",ref:{value:"stop"}},{type:"enum",name:"previous",ref:{value:"previous"}},{type:"enum",name:"next",ref:{value:"next"}},{type:"enum",name:"toggle mute",ref:{value:"toggleMute"}},{type:"enum",name:"mute",ref:{value:"mute"}},{type:"enum",name:"unmute",ref:{value:"unmute"}},
{type:"int",name:"volume",ref:{value:"volume",ext:"%d",extMeta:"0-100"}},{type:"enum",name:"volume up",ref:{value:"volumeUp"}},{type:"enum",name:"volume down",ref:{value:"volumeDown"}},{type:"enum",name:"shuffle on",ref:{value:"shuffleOn"}},{type:"enum",name:"shuffle off",ref:{value:"shuffleOff"}},{type:"enum",name:"toggle shuffle",ref:{value:"shuffleToggle"}},{type:"enum",name:"repeat off",ref:{value:"repeatOff"}},{type:"enum",name:"repeat all",ref:{value:"repeatAll"}},{type:"enum",name:"repeat one",
ref:{value:"repeatOne"}},{type:"enum",name:"switch repeat",ref:{value:"repeatSwitch"}},{type:"int",name:"group volume",ref:{value:"groupVolume",ext:"%d",extMeta:"0-100"}},{type:"enum",name:"group volume up",ref:{value:"groupVolumeUp"}},{type:"enum",name:"group volume down",ref:{value:"groupVolumeDown"}},{type:"enum",name:"group mute",ref:{value:"groupMute"}},{type:"enum",name:"group unmute",ref:{value:"groupUnmute"}},{type:"enum",name:"group toggle mute",ref:{value:"groupToggleMute"}},{type:"enum",
name:"loudness on",ref:{value:"loudnessOn"}},{type:"enum",name:"loudness off",ref:{value:"loudnessOff"}},{type:"enum",name:"toggle loudness",ref:{value:"toggleLoudness"}},{type:"int",name:"set bass",ref:{value:"bass",ext:"%d",extMeta:"-10-10"}},{type:"enum",name:"bass up",ref:{value:"bassUp"}},{type:"enum",name:"bass down",ref:{value:"bassDown"}},{type:"int",name:"set treble",ref:{value:"treble",ext:"%d",extMeta:"-10-10"}},{type:"enum",name:"treble up",ref:{value:"trebleUp"}},{type:"enum",name:"treble down",
ref:{value:"trebleDown"}},{type:"int",name:"set balance",ref:{value:"balance",ext:"%d",extMeta:"-100-100",scale:"5"}},{type:"enum",name:"balance to left",ref:{value:"balanceLeft"}},{type:"enum",name:"balance to right",ref:{value:"balanceRight"}},{type:"int",name:"seek to (seconds)",ref:{value:"seekTo",value_t:"seekToSeconds",ext:"%d"}},{type:"enum",name:"play line-in",ref:{value:"playLineIn"}},{type:"string",name:"play url",ref:{value:"playUrl",ext:"%s"}},{type:"audio",name:"play audio",ref:{value:"playAudio",
ext:"%s"}}],status:[{type:"enum",name:"muted",ref:{value:"muted",options:["true","false"]}},{type:"int",name:"volume",ref:{value:"volume",extMeta:"0-100"}},{type:"enum",name:"group muted",ref:{value:"groupMuted",options:["true","false"]}},{type:"int",name:"group volume",ref:{value:"groupVolume",extMeta:"0-100"}},{type:"enum",name:"shuffle state",ref:{value:"shuffle",options:["on","off"]}},{type:"enum",name:"repeat state",ref:{value:"repeat",options:["off","one","all"]}},{type:"enum",name:"loudness state",
ref:{value:"loudness",options:["off","on"]}},{type:"int",name:"bass",ref:{value:"bass",extMeta:"-10-10"}},{type:"int",name:"treble",ref:{value:"treble",extMeta:"-10-10"}},{type:"int",name:"balance",ref:{value:"balance",extMeta:"-100-100"}},{type:"enum",name:"play state",ref:{value:"playState",options:"STOPPED PLAYING TRANSITIONING PAUSED_PLAYBACK PAUSED_RECORDING RECORDING NO_MEDIA_PRESENT".split(" ")}},{type:"string",name:"track duration",ref:{value:"duration"}},{type:"int",name:"track duration (seconds)",
ref:{value:"durationS"}},{type:"string",name:"track position",ref:{value:"position"}},{type:"int",name:"track position (seconds)",ref:{value:"positionS"}},{type:"string",name:"artist",ref:{value:"artist"}},{type:"string",name:"title",ref:{value:"title"}},{type:"string",name:"album",ref:{value:"album"}}]}},a=function(c,b){this.code=c;this.message=b;this.stack=Error().stack};a.prototype=Error();a.prototype.name="SonosDMError";a.prototype.code=0;a.ERROR_CODE={DEFAULT:0,INDEX_EXISTS:1,ID_EXISTS:2,INVALID:3,
UNKNOW:4,NOT_FOUND:5,IP_EXISTS:6};return{SYS:"sonos",getIPDeviceType:function(){return[{sys:this.SYS,name:"Sonos Player",port:1400}]},createDevice:function(c,b,d){b=a.ERROR_CODE;c?c.type?c.ip?d(null,c):d(new a(b.INVALID,"ip is invalid")):d(new a(b.INVALID,"type is invalid")):d(new a(b.INVALID,"info is invalid"))},updateDevice:function(c,b,d){b=a.ERROR_CODE;c?c.type?c.ip?d(null,c):d(new a(b.INVALID,"ip is invalid")):d(new a(b.INVALID,"type is invalid")):d(new a(b.INVALID,"info is invalid"))},deleteDevice:function(c,
b,d){d()},applyUIFilter:function(c,b,d){var f=function(m,p){if("*"==m)return!0;for(var n=!1,q=0;q<m.length;q++)if(m[q]==p){n=!0;break}return n},h=function(m,p,n){var q=[];switch(n.catagory){case "command":m.command&&m.command.forEach(function(r){f(n.elems,r.type)&&(r=JSON.parse(JSON.stringify(r)),q.push(r))});break;case "status":m.status&&m.status.forEach(function(r){f(n.elems,r.type)&&(r=JSON.parse(JSON.stringify(r)),q.push(r))})}return q},g=function(m,p){var n=[],q=xnm.aio.sonos.DM.getCommandStatusMap(m,
d);q&&(m=h(q,m,p),n=n.concat(m));return n};if(!c.sys)return null;var l=JSON.parse(JSON.stringify(c)),k=null;switch(b.catagory){case "command":k=g(c,b);l.command=k;break;case "status":k=g(c,b);l.status=k;break;default:return null}return k&&0!=k.length?l:null},getCommandStatusMap:function(c,b){return c.type?e[c.type]:null},applySmartWidgetFilter:function(c,b,d,f,h){d={"%balance%":{value:"balance",ext:"%d",extMeta:"-100-100",scale:"5"},"%bass%":{value:"bass",ext:"%d",extMeta:"-10-10"},"%next%":{value:"next"},
"%pause%":{value:"pause"},"%play%":{value:"play"},"%previous%":{value:"previous"},"%seekTo%":{value:"seekTo",value_t:"seekToSeconds",ext:"%d"},"%shuffleToggle%":{value:"shuffleToggle"},"%stop%":{value:"stop"},"%treble%":{value:"treble",ext:"%d",extMeta:"-10-10"}};var g={"%balanceState%":{value:"balance",extMeta:"-100-100"},"%bassState%":{value:"bass",extMeta:"-10-10"},"%durationState%":{value:"durationS"},"%durationStringState%":{value:"duration"},"%playState%":{value:"playState",options:"STOPPED PLAYING TRANSITIONING PAUSED_PLAYBACK PAUSED_RECORDING RECORDING NO_MEDIA_PRESENT".split(" ")},
"%positionState%":{value:"positionS"},"%shuffleState%":{value:"shuffle",options:["on","off"]},"%trebleState%":{value:"treble",extMeta:"-10-10"}};"master"===b.type?(d["%toggleMute%"]={value:"groupToggleMute"},d["%volume%"]={value:"groupVolume",ext:"%d",extMeta:"0-100"},g["%mutedState%"]={value:"groupMuted",options:["true","false"]},g["%volumeState%"]={value:"groupVolume",extMeta:"0-100"}):(d["%toggleMute%"]={value:"toggleMute"},d["%volume%"]={value:"volume",ext:"%d",extMeta:"0-100"},g["%mutedState%"]=
{value:"muted",options:["true","false"]},g["%volumeState%"]={value:"volume",extMeta:"0-100"});return c._injectToSmartWidgetTemplate(f,["media"],h,d,g,null)}}}();
xnm.aio.sonos.Handler=function(){var e=function(){this.detectedPlayers={};this._master=new xnm.aio.sonos.Master};e.prototype.discoverPlayers=function(a){var c=require("x.upnp.js");if(c){var b=this;c.discoverDevices(function(d){if("sonos"==d.type){var f=new xnm.aio.sonos.Player(d.ip,1400,d.uuid,d.name);b.detectedPlayers[d.uuid]=f;a(f)}})}};e.prototype.getStateValues=function(a,c){return(new xnm.aio.sonos.Player).getStateValues(c)};e.prototype.getDeviceCommandList=function(a,c){a=[];a.push({id:window.XC_Text.pplay,
cmd:"play"});a.push({id:window.XC_Text.ppause,cmd:"pause"});if(!c)for(a.push({id:window.XC_Text.pstop,cmd:"stop"}),c=0;100>=c;c+=5)a.push({id:window.XC_Text.volume+" "+c+"%",cmd:""+c});return a};e.prototype.getDevice=function(a){return new xnm.aio.sonos.Player(a.address,a.port)};e.prototype.devicemanager=xnm.aio.sonos.DM;e.prototype.Player=xnm.aio.sonos.Player;e.prototype.registModule=function(a){a.register(xnm.aio.sonos.DM.SYS,"sonos")};e.prototype.resolveDevice=function(a){return a?this._master.getPlayer(a):
null};e.prototype.getDeviceCommands=function(a,c){a=(a=xnm.aio.sonos.DM.applyUIFilter(a,{catagory:"command",elems:"*"}))?a.command:[];c&&c(null,a)};e.prototype.getDeviceStatus=function(a,c){a=(a=xnm.aio.sonos.DM.applyUIFilter(a,{catagory:"status",elems:"*"}))?a.status:[];c&&c(null,a)};e.prototype.doCommand=function(a,c,b){var d=this.resolveDevice(a);d?d.executeCommandCreator(a,c,function(f){b&&b(f)}):b&&b(Error("device json format invalid"))};e.prototype.doStatus=function(a,c,b,d){var f=this.resolveDevice(c);
f?f.getStatesCreator(null,[{id:a,device:c,status:b}],function(h,g){h?d&&d(h):d&&d(null,g[0])}):d&&d(Error("device json format invalid"))};e.prototype.discoverWithTimeout=function(a,c){var b=this;this._master.search(function(){for(var d=b._master.getBufferedPlayers(),f=[],h=0;h<d.length;h++)f.push(d[h]);f.push(b._master);c&&c(null,f)})};e.prototype.getPlayer=function(a,c){if(a&&a.uuid&&a.type)if("master"==a.type)c&&c(null,this._master);else{var b=this._master.getPlayer(a.uuid);if(b)c&&c(null,b);else{var d=
this;this._master.search(function(){b=d._master.getPlayer(a.uuid);c&&c(null,b)})}}else c&&c(Error("device json invalid"))};e.prototype.getMediaServer=function(a){var c=this._master.getBufferedMediaServers();if(0==c.length){var b=this;this._master.search(function(){a&&a(null,b._master.getBufferedMediaServers())})}else a&&a(null,c)};return e}();"undefined"!=typeof exports&&"undefined"!=typeof module&&module.exports&&(exports=module.exports=new xnm.aio.sonos.Handler);
