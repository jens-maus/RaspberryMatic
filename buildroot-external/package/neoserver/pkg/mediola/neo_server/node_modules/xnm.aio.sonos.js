var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.findInternal=function(d,a,b){d instanceof String&&(d=String(d));for(var c=d.length,e=0;e<c;e++){var f=d[e];if(a.call(b,f,e,d))return{i:e,v:f}}return{i:-1,v:void 0}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(d,a,b){d!=Array.prototype&&d!=Object.prototype&&(d[a]=b.value)};
$jscomp.getGlobal=function(d){return"undefined"!=typeof window&&window===d?d:"undefined"!=typeof global&&null!=global?global:d};$jscomp.global=$jscomp.getGlobal(this);$jscomp.polyfill=function(d,a,b,c){if(a){b=$jscomp.global;d=d.split(".");for(c=0;c<d.length-1;c++){var e=d[c];e in b||(b[e]={});b=b[e]}d=d[d.length-1];c=b[d];a=a(c);a!=c&&null!=a&&$jscomp.defineProperty(b,d,{configurable:!0,writable:!0,value:a})}};
$jscomp.polyfill("Array.prototype.find",function(d){return d?d:function(a,b){return $jscomp.findInternal(this,a,b).v}},"es6","es3");$jscomp.checkStringArgs=function(d,a,b){if(null==d)throw new TypeError("The 'this' value for String.prototype."+b+" must not be null or undefined");if(a instanceof RegExp)throw new TypeError("First argument to String.prototype."+b+" must not be a regular expression");return d+""};
$jscomp.polyfill("String.prototype.repeat",function(d){return d?d:function(a){var b=$jscomp.checkStringArgs(this,null,"repeat");if(0>a||1342177279<a)throw new RangeError("Invalid count value");a|=0;for(var c="";a;)if(a&1&&(c+=b),a>>>=1)b+=b;return c}},"es6","es3");var xnm=xnm||{};xnm.aio=xnm.aio||{};xnm.aio.sonos=xnm.aio.sonos||{};
xnm.aio.sonos.Master=function(){var d=function(){this._logger="undefined"!=typeof require&&require?require("x.logger.js").getLogger("xnm.aio.sonos.Master"):{log:{}};this._searchCB=[];this._autoSearchTimeout=null;this._tmpPlayers={};this._players={};this._mediaServer={};this._currentZone=this._topology=null;this._discovery=new xnm.aio.sonos.Discovery(this);this.search(null)};d.prototype.getBufferedPlayers=function(){var a=[],b;for(b in this._players)if(this._players.hasOwnProperty(b)){var c=this._players[b];
c&&!c.dummy&&c.player&&a.push(c.player)}return a};d.prototype.getBufferedMediaServers=function(){var a=[],b;for(b in this._mediaServer)this._mediaServer.hasOwnProperty(b)&&a.push(this._mediaServer[b]);for(b in this._players)if(this._players.hasOwnProperty(b)){var c=this._players[b];c&&c.player&&c.player._server&&(c.player._server._sonosServer=!0,a.push(c.player._server))}return a};d.prototype.search=function(a){var b=this._searchCB.length;a&&-1==this._searchCB.indexOf(a)&&this._searchCB.push(a);if(0==
b){this._autoSearchTimeout&&(clearTimeout(this._autoSearchTimeout),this._autoSearchTimeout=null);this._search();var c=this;setTimeout(function(){c._autoSearchTimeout=setTimeout(function(){c._logger.log("trace","auto search timeout, search again");c.search(null)},3E4);var a=c._searchCB;c._searchCB=[];a.forEach(function(a){a&&a()})},5E3)}};d.prototype._search=function(){for(var a in this._players)if(this._players.hasOwnProperty(a)){var b=this._players[a];5<=b.missCount?delete this._players[a]:b.missCount++}this._mediaServer=
{};this._discovery.search(null)};d.prototype.findPlayer=function(a){var b=a.uuid;if(b){var c=this._players[b];c||(this._players[b]={missCount:0,dummy:!1},c=this._players[b]);if(c.player)c.player.setIP(a.ip),c.player.setPort(a.port);else{b=new xnm.aio.sonos.Player(a.ip,a.port,a.uuid,a.name);var e,d;if(a.embeddedDevices)for(var g=0;g<a.embeddedDevices.length;g++){var h=a.embeddedDevices[g];h&&"urn:schemas-upnp-org:device:MediaServer:1"==h.deviceType?d=h:h&&"urn:schemas-upnp-org:device:MediaRenderer:1"==
h.deviceType&&(e=h)}b._device=a;b._renderer=e;b._server=d;c.player=b}c.dummy=!1;c.missCount=0;var k=this;c.player.getZoneGroupState(function(a,c,b){!a&&c&&b&&k._updateTopology(c)})}};d.prototype.findMediaServer=function(a){var b=a.uuid;b&&(this._mediaServer[b]=a)};d.prototype.getCurrentZone=function(a){if(this._currentZone)a&&a(null,this._currentZone);else{var b=this;this.search(function(c){c?a&&a(c):this._currentZone?b.getCurrentZone(a):a&&a(Error("no current zone"))})}};d.prototype.setCurrentZone=
function(a,b){if(this._topology){var c=null,e;for(e in this._topology){var d=this._topology[e];if(d&&d.id==a){c=d;break}}c&&c.coordinator?(a=this._players[c.coordinator])?(this._currentZone=JSON.parse(JSON.stringify(c)),this._currentZone.player=a.player,b&&b()):b&&b(Error("no such player")):b&&b(Error("no such zone"))}else{var g=this;this.search(function(a){a?b&&b(a):this._topology?g.setCurrentZone(b):b&&b(Error("no player found"))})}};d.prototype.getZones=function(a){var b=this,c=this.getBufferedPlayers();
c&&0!=c.length?a&&a(null,this._topology):this.search(function(c,d){c?a&&a(c):d&&0!=d.length?b.getZones(a):a&&a(Error("find no sonos player"))})};d.prototype.getPlayer=function(a){if("master"==a.type)return this;if(!a.uuid){if(!a.ip)return null;for(c in this._players)if(this._players.hasOwnProperty(c)){var b=this._players[c];if(b&&b.player&&b.player.getIP()==a.ip)return b.player}if(this._tmpPlayers[a.ip])return this._tmpPlayers[a.ip];var c=new xnm.aio.sonos.Player(a.ip,a.port,a.uuid,a.name);return this._tmpPlayers[a.ip]=
c}if((c=this._players[a.uuid])&&c.player)return c.player;if(!a.ip)return null;c=new xnm.aio.sonos.Player(a.ip,a.port,a.uuid,a.name);this._players[a.uuid]={missCount:0,dummy:!0,player:c};return c};d.prototype._updateTopology=function(a){this._topology||(this._topology={});var b=this;a.forEach(function(a){a&&a.id&&(b._topology[a.id]=a)});for(var c,e=0;e<a.length;e++)if((c=a[e])&&c.coordinator){var d=this._players[c.coordinator];if(d&&d.player&&!this._currentZone){this._currentZone=JSON.parse(JSON.stringify(c));
this._currentZone.player=d.player;return}}for(var g=0;g<a.length;g++)if((c=a[e])&&c.coordinator&&(d=this._players[c.coordinator])&&d.player){this._currentZone=JSON.parse(JSON.stringify(c));this._currentZone.player=d.player;break}};d.prototype.executeCommandCreator=function(a,b,c){if(this._currentZone)this._currentZone.player.executeCommandCreator(a,b,c);else{var e=this;this.search(function(d){d?c&&c(d):e._currentZone?e._currentZone.player.executeCommandCreator(a,b,c):c&&c(d)})}};d.prototype.getStatesCreator=
function(a,b,c){if(this._currentZone)this._currentZone.player.getStatesCreator(a,b,c);else{var e=this;this.search(function(d){d?c&&c(d):e._currentZone?e._currentZone.player.getStatesCreator(a,b,c):c&&c(null,[])})}};d.prototype.play=function(a,b,c){if(this._currentZone)this._currentZone.player.playObject(a,b,c);else{var e=this;this.search(function(d){d?c&&c(d):e._currentZone?e._currentZone.player.playObject(a,b,c):c&&c(d)})}};d.prototype.addToQueueAndPlay=function(a,b,c){if(this._currentZone)this._currentZone.player.addToQueueAndPlay(a,
b,c);else{var e=this;this.search(function(d){d?c&&c(d):e._currentZone?e._currentZone.player.addToQueueAndPlay(a,b,c):c&&c(d)})}};d.prototype.addToQueue=function(a,b,c){if(this._currentZone)this._currentZone.player.addToQueue(a,b,c);else{var e=this;this.search(function(d){d?c&&c(d):e._currentZone?e._currentZone.player.addToQueue(a,b,c):c&&c(d)})}};d.prototype.replaceQueueAndPlay=function(a,b,c){if(this._currentZone)this._currentZone.player.replaceQueueAndPlay(a,b,c);else{var e=this;this.search(function(d){d?
c&&c(d):e._currentZone?e._currentZone.player.replaceQueueAndPlay(a,b,c):c&&c(d)})}};d.prototype.browser=function(a,b,c,e,d){if(this._currentZone)this._currentZone.player.browser(a,b,c,e,d);else{var f=this;this.search(function(h){h?d&&d(h):f._currentZone?f._currentZone.player.browser(a,b,c,e,d):d&&d(h)})}};d.prototype.clearQueue=function(a,b){if(this._currentZone)this._currentZone.player.clearQueue(b);else{var c=this;this.search(function(e){e?b&&b(e):c._currentZone?c._currentZone.player.clearQueue(a,
b):b&&b(e)})}};d.prototype.toJSON=function(){return{sys:"sonos",type:"master",ip:"xxxxxx",port:0,uuid:"master"}};d.prototype.equalsTo=function(a){return a&&a instanceof d?!0:!1};return d}();
xnm.aio.sonos.Player=function(){var d=function(a,b,c,e){var d=require("x.logger.js");this._logger=d?d.getLogger("xnm.aio.sonos.Player"):{log:function(){}};this.ip=a;this.port=b;if(!b||0>b)this.port=1400;this.uuid=c;this.name=e;this.zoneName=null;this.ip&&this.port&&(this._device=this._getDevice(this.ip,this.port,this.uuid,this.name),this._renderer=this._getRenderer(this.ip,this.port,this.uuid),this._server=this._getServer(this.ip,this.port,this.uuid));this.CommandHandler=null};d.prototype.PLAY_MODE=
"NORMAL REPEAT_ALL REPEAT_ONE SHUFFLE_NOREPEAT SHUFFLE SHUFFLE_REPEAT_ONE".split(" ");d.prototype.zoneGroupTopology={type:"urn:schemas-upnp-org:service:ZoneGroupTopology:1",url:"/ZoneGroupTopology/Control"};d.prototype.groupManagement={type:"urn:schemas-upnp-org:service:GroupManagement:1",url:"/GroupManagement/Control"};d.prototype._getDevice=function(a,b,c,e){var d=new (require("x.upnp.js").Device);d.init(a,b,c,null);d.name=e;return d};d.prototype._getRenderer=function(a,b,c){if(!a&&this._renderer)return this._renderer;
var e=new (require("x.upnp.js").MediaRenderer);e.init(a,b,c,{avTransport:{type:"urn:schemas-upnp-org:service:AVTransport:1",url:"/MediaRenderer/AVTransport/Control"},connectionManager:{type:"urn:schemas-upnp-org:service:ConnectionManager:1",url:"/MediaRenderer/ConnectionManager/Control"},renderingControl:{type:"urn:schemas-upnp-org:service:RenderingControl:1",url:"/MediaRenderer/RenderingControl/Control"},groupRenderingControl:{type:"urn:schemas-upnp-org:service:GroupRenderingControl:1",url:"/MediaRenderer/GroupRenderingControl/Control"},
queue:{type:"urn:schemas-sonos-com:service:Queue:1",url:"/MediaRenderer/Queue/Control"}});return e};d.prototype._getServer=function(a,b,c){var e=new (require("x.upnp.js").MediaServer);e.init(a,b,c,{contentDirectory:{type:"urn:schemas-upnp-org:service:ContentDirectory:1",url:"/MediaServer/ContentDirectory/Control"},connectionManager:{type:"urn:schemas-upnp-org:service:ConnectionManager:1",url:"/MediaServer/ConnectionManager/Control"}});return e};d.prototype.play=function(a){this._getRenderer().play(a)};
d.prototype.pause=function(a){this._getRenderer().pause(a)};d.prototype.stop=function(a){this._getRenderer().stop(a)};d.prototype.previous=function(a){this._getRenderer().previous(a)};d.prototype.next=function(a){this._getRenderer().next(a)};d.prototype.mute=function(a){this._getRenderer().mute(a)};d.prototype.unmute=function(a){this._getRenderer().unmute(a)};d.prototype.isMuted=function(a){this._getRenderer().isMuted(a)};d.prototype.getVolume=function(a){this._getRenderer().getVolume(a)};d.prototype.setVolume=
function(a,b){this._getRenderer().setVolume(a,b)};d.prototype.getPlayState=function(a){this._getRenderer().getPlayState(a)};d.prototype.getInfo=function(a){this._getRenderer().getInfo(a)};d.prototype.playItem=function(a,b){this._getRenderer().playItem(a,b)};d.prototype.playPlaylist=function(){var a=require("x.upnp.js"),b=this._getRenderer();var c='<u:SetAVTransportURI xmlns:u="urn:schemas-upnp-org:service:AVTransport:1"><InstanceID>0</InstanceID>'+("<CurrentURI>x-rincon-queue:"+b.uuid+"#0</CurrentURI><CurrentURIMetaData></CurrentURIMetaData>");
c+="</u:SetAVTransportURI>";(new a.SOAPRequest).doRequest(b.getURL(b.AVTransport),'"urn:schemas-upnp-org:service:AVTransport:1#SetAVTransportURI"',c,function(a){b.play()})};d.prototype.getPlaylist=function(a){a=require("x.upnp.js");var b=this._getRenderer();(new a.SOAPRequest).doRequest(b.getURL("/MediaServer/ContentDirectory/Control"),'"urn:schemas-upnp-org:service:ContentDirectory:1#Browse"','<u:Browse xmlns:u="urn:schemas-upnp-org:service:ContentDirectory:1"><ObjectID>Q:0</ObjectID><BrowseFlag>BrowseDirectChildren</BrowseFlag><Filter>dc:title,res,dc:creator,upnp:artist,upnp:album,upnp:albumArtURI</Filter><StartingIndex>{0}</StartingIndex><RequestedCount>{1}</RequestedCount><SortCriteria></SortCriteria></u:Browse>',
function(a){var c=[];a=b._parseSOAPResponse(a,!0);(a=$($.parseXML(a)))&&a.find("item").each(function(){$(this);c.push(b._parseItemMetaData($(this)))})})};d.prototype.clearPlaylist=function(a){var b=require("x.upnp.js"),c=this._getRenderer();(new b.SOAPRequest).doRequest(c.getURL(c.AVTransport),'"urn:schemas-upnp-org:service:AVTransport:1#RemoveAllTracksFromQueue"','<u:RemoveAllTracksFromQueue xmlns:u="urn:schemas-upnp-org:service:AVTransport:1"><InstanceID>0</InstanceID></u:RemoveAllTracksFromQueue>',
function(c){a&&a()})};d.prototype.addToPlaylist=function(a,b){var c=require("x.upnp.js"),e=this._getRenderer();a='<u:AddURIToQueue xmlns:u="urn:schemas-upnp-org:service:AVTransport:1"><InstanceID>0</InstanceID>'+("<EnqueuedURI>"+a+"</EnqueuedURI>")+"<EnqueuedURIMetaData></EnqueuedURIMetaData><DesiredFirstTrackNumberEnqueued>0</DesiredFirstTrackNumberEnqueued><EnqueueAsNext>1</EnqueueAsNext></u:AddURIToQueue>";(new c.SOAPRequest).doRequest(e.getURL(e.AVTransport),'"urn:schemas-upnp-org:service:AVTransport:1#AddURIToQueue"',
a,function(a){b&&b()})};d.prototype.setPlaylist=function(a,b){if(0<a.length){var c=a.pop(),e=this;this.addToPlaylist(c.url,function(){e.setPlaylist(a,b)})}else b&&b()};d.prototype.executeCommand=function(a,b,c){var e=this;a=!0;"play"==b?this.play():"pause"==b?this.pause():"stop"==b?this.stop():"previous"==b?this.previous():"next"==b?this.next():"toggleMute"==b?(a=!1,this.isMuted(function(a){a?e.mute(!1):e.mute(!0);c&&setTimeout(function(){c()},200)})):(a=!1,this.setVolume(Math.floor(parseInt(b)),
function(){c&&setTimeout(function(){c()},200)}));a&&c&&setTimeout(function(){c()},200)};d.prototype.getStates=function(a,b,c){var e=this;this.CommandHandler=a;this.getVolume(function(a){e.isMuted(function(d){e.getPlayState(function(h){var g={volume:a,muted:d,state:h};b&&e.CommandHandler&&e.CommandHandler.setState?(e.CommandHandler.setState(b.id+":volume",a),e.CommandHandler.setState(b.id+":muted",d),e.CommandHandler.setState(b.id+":state",h)):e.CommandHandler&&e.CommandHandler.receivedState&&e.CommandHandler.receivedState("sonos",
e.ip,g);e.getInfo(function(a){var b={artist:"",title:""};"PLAYING"==h&&(b.artist=a.artist?a.artist:"?",b.title=a.title?a.title:"?");e.CommandHandler&&e.CommandHandler.receivedState&&e.CommandHandler.receivedState("sonos",e.ip,b);c&&(g.title=b.title,g.artist=b.artist,c(g))})})})})};d.prototype.getStateValues=function(a){return a};d.prototype.getIP=function(){return this._device?this._device.ip:null};d.prototype.setIP=function(a){this._device&&(this._device.ip=a);this._renderer&&(this._renderer.ip=
a);this._server&&(this._server.ip=a)};d.prototype.getPort=function(){return this._device?this._device.port:null};d.prototype.setPort=function(a){this._device&&(this._device.port=a);this._renderer&&(this._renderer.port=a);this._server&&(this._server.port=a)};d.prototype.getUUID=function(){return this._device?this._device.uuid:null};d.prototype.getName=function(){return this._device?this._device.name:null};d.prototype.executeCommandCreator=function(a,b,c){b&&b.value?this._executeCommand(b.value,b.ext,
function(a){c&&c(a)},b):c&&c(Error("command value is empty"))};d.prototype.getStatesCreator=function(a,b,c){a=[];for(var e=this,d=0;d<b.length;d++){var g=b[d];if(g&&g.id&&g.status&&g.status.value){var h=null;switch(g.status.value){case "muted":h="MUTE";break;case "volume":h="VOLUME";break;case "groupMuted":h="GROUP_MUTE";break;case "groupVolume":h="GROUP_VOLUME";break;case "shuffle":case "repeat":h="PLAY_MODE";break;case "loudness":h="LOUDNESS";break;case "bass":h="BASS";break;case "treble":h="TREBLE";
break;case "balance":h="BALANCE";break;case "playState":h="PLAY_STATE";break;case "duration":case "durationS":case "position":case "positionS":case "artist":case "title":case "album":h="PLAY_INFO"}h&&-1==a.indexOf(h)&&a.push(h)}}this._getStates(a,function(a,d){a&&e._logger.log("trace","["+e.ip+":"+e.port+"]get states error:"+a.stack);if(d){a=[];for(var h=0;h<b.length;h++){var g=b[h];if(g&&g.id){var f="?";if(g.status)switch(g.status.value){case "muted":null!=d.muted&&"undefined"!=typeof d.muted&&(f=
d.muted);break;case "volume":null!=d.volume&&"undefined"!=typeof d.volume&&(f=d.volume);break;case "groupMuted":null!=d.groupMuted&&"undefined"!=typeof d.groupMuted&&(f=d.groupMuted);break;case "groupVolume":null!=d.groupVolume&&"undefined"!=typeof d.groupVolume&&(f=d.groupVolume);break;case "shuffle":d.playMode&&d.playMode.shuffle&&(f=d.playMode.shuffle);break;case "repeat":d.playMode&&d.playMode.repeat&&(f=d.playMode.repeat);break;case "loudness":d.loudness&&(f=d.loudness);break;case "bass":null!=
d.bass&&"undefined"!=typeof d.bass&&(f=d.bass);break;case "treble":null!=d.treble&&"undefined"!=typeof d.treble&&(f=d.treble);break;case "balance":null!=d.balance&&"undefined"!=typeof d.balance&&(f=d.balance);break;case "playState":d.transportState&&(f=d.transportState);break;case "duration":d.playInfo&&d.playInfo.duration&&(f=d.playInfo.duration);break;case "durationS":d.playInfo&&"undefined"!=typeof d.playInfo.durationSec&&null!=d.playInfo.durationSec&&(f=d.playInfo.durationSec);break;case "position":d.playInfo&&
d.playInfo.position&&(f=d.playInfo.position);break;case "positionS":d.playInfo&&"undefined"!=typeof d.playInfo.positionSec&&null!=d.playInfo.positionSec&&(f=d.playInfo.positionSec);break;case "artist":f=d.playInfo&&d.playInfo.trackMetaData&&d.playInfo.trackMetaData.artist?d.playInfo.trackMetaData.artist:"";break;case "title":f=d.playInfo&&d.playInfo.trackMetaData&&d.playInfo.trackMetaData.title?d.playInfo.trackMetaData.title:"";break;case "album":f=d.playInfo&&d.playInfo.trackMetaData&&d.playInfo.trackMetaData.album?
d.playInfo.trackMetaData.album:""}a.push({id:g.id,status:f})}}c&&c(null,a)}else c&&c(Error("get state error"))})};d.prototype._executeCommand=function(a,b,c,d){if(this._renderer)switch(a){case "play":this._renderer.play(c);break;case "pause":this._renderer.pause(c);break;case "stop":this._renderer.stop(c);break;case "previous":this._renderer.previous(c);break;case "next":this._renderer.next(c);break;case "mute":this._renderer.mute(c);break;case "unmute":this._renderer.unmute(c);break;case "toggleMute":this._renderer.toggleMute(c);
break;case "volume":if("undefined"==typeof b||null==b){c&&c(Error("volume value invalid"));break}this._renderer.setVolume(b,c);break;case "volumeUp":this.volumeUp(c);break;case "volumeDown":this.volumeDown(c);break;case "shuffleOn":this.shuffleOn(c);break;case "shuffleOff":this.shuffleOff(c);break;case "shuffleToggle":this.shuffleToggle(c);break;case "repeatOff":this.repeatOff(c);break;case "repeatAll":this.repeatAll(c);break;case "repeatOne":this.repeatOne(c);break;case "repeatSwitch":this.repeatSwitch(c);
break;case "groupVolume":if("undefined"==typeof b||null==b){c&&c(Error("volume value invalid"));break}this.setGroupVolume(b,c);break;case "groupVolumeUp":this.groupVolumeUp(c);break;case "groupVolumeDown":this.groupVolumeDown(c);break;case "groupMute":this.groupMute(c);break;case "groupUnmute":this.groupUnmute(c);break;case "groupToggleMute":this.groupToggleMute(c);break;case "loudnessOn":this.activateLoudness(c);break;case "loudnessOff":this.deactivateLoudness(c);break;case "toggleLoudness":this.toggleLoudness(c);
break;case "bass":if("undefined"==typeof b||null==b){c&&c(Error("volume value invalid"));break}this.setBass(b,c);break;case "bassUp":this.bassUp(c);break;case "bassDown":this.bassDown(c);break;case "treble":if("undefined"==typeof b||null==b){c&&c(Error("volume value invalid"));break}this.setTreble(b,c);break;case "trebleUp":this.trebleUp(c);break;case "trebleDown":this.trebleDown(c);break;case "balance":if("undefined"==typeof b||null==b){c&&c(Error("volume value invalid"));break}this.setBalance(b,
c);break;case "balanceLeft":this.balanceToLeft(c);break;case "balanceRight":this.balanceToRight(c);break;case "seekTo":if("undefined"==typeof b||null==b){c&&c(Error("seek value invalid"));break}this._renderer.seekRelTimeSec(b,c);break;case "playLineIn":this.playLineIn(c);break;case "playUrl":if("undefined"==typeof b||null==b){c&&c(Error("playUrl url invalid"));break}this.playUrl(b,c);break;default:c&&c(Error("unknown command"))}else c&&c(Error("renderer not initialized"))};d.prototype._getStates=
function(a,b){if(this._renderer)if(a&&0!=a.length){var c=function(){f--;0==f&&b&&b(null,d)},d={},f=a.length;-1!=a.indexOf("PLAY_STATE")&&this._renderer.getPlayState(function(a,b){a||(d.transportState=b);c()});-1!=a.indexOf("PLAY_INFO")&&this.getPlayInfo(function(a,b){a||(d.playInfo=b);c()});-1!=a.indexOf("MUTE")&&this._renderer.isMuted(function(a,b){a||(d.muted=b);c()});-1!=a.indexOf("VOLUME")&&this._renderer.getVolume(function(a,b){a||(d.volume=b);c()});-1!=a.indexOf("PLAY_MODE")&&this.getPlayMode(function(a,
b){a||(d.playMode=b);c()});-1!=a.indexOf("GROUP_MUTE")&&this.isGroupMuted(function(a,b){a||(d.groupMuted=b);c()});-1!=a.indexOf("GROUP_VOLUME")&&this.getGroupVolume(function(a,b){a||(d.groupVolume=b);c()});-1!=a.indexOf("BALANCE")&&this.getBalance(function(a,b){a||(d.balance=b);c()});-1!=a.indexOf("BASS")&&this.getBass(function(a,b){a||(d.bass=b);c()});-1!=a.indexOf("TREBLE")&&this.getTeble(function(a,b){a||(d.treble=b);c()});-1!=a.indexOf("LOUDNESS")&&this.isLoudnessActive(function(a,b){a||(d.loudness=
b?"on":"off");c()})}else b&&b(null,{});else b&&b(Error("renderer not initialized"))};d.prototype.playUrl=function(a,b){if(a){var c=this;this._renderer._setAVTransportURI(0,a,null,function(a){a?b&&b(a):c._renderer.play(b)})}else b&&b(Error("url is null"))};d.prototype.addUrlToQueueAndPlayThenDelete=function(a,b,c){if(a){b||(b=30);var d=this;this._addURItoQueue(0,a,null,0,!0,function(a,e){a?c&&c(a):e&&"undefined"!=typeof e.firstTrackNumberEnqueued&&null!=e.firstTrackNumberEnqueued?d._renderer.seekTrack(e.firstTrackNumberEnqueued,
function(a){a?c&&c(a):d._renderer.play(function(a){a?c&&c(a):setTimeout(function(){d._removeAllTracks(0,0,function(a){c&&c(a)})},1E3*b)})}):c&&c(Error("result format invalid"))})}else c&&c(Error("url is null"))};d.prototype.playObject=function(a,b,c){if(a&&b&&b["class"]&&b.id){var d=this;a.browseMetaData(b.id,function(a,e){a?c&&c(a):b.res&&b.res.url?d._renderer.playResource({url:b.res.url},e.result,c):c&&c(Error("resource url invalid"))})}else c&&c(Error("play obj invalid"))};d.prototype.addToQueueAndPlay=
function(a,b,c){if(a&&b&&b.res&&b.res.url&&b.id){var d=this;b.parentID&&"Q:"==b.parentID.substr(0,2)?this.playFromQueue(a,b,c):a.browseMetaData(b.id,function(a,e){a?c&&c(a):e&&e.meta&&e.meta.res&&"x-sonosapi-stream"==e.meta.res.substr(0,17)?d._renderer.playResource({url:e.meta.res},e.meta.resMD,c):d._addURI(0,0,b.res.url,e.result,0,!0,function(a,b){a?c&&c(a):b&&"undefined"!=typeof b.firstTrackNumberEnqueued&&null!=b.firstTrackNumberEnqueued?d._renderer.seekTrack(b.firstTrackNumberEnqueued,function(a){a?
d.playQueue(c):d._renderer.play(c)}):c&&c(Error("result format invalid"))})})}else c&&c(Error("play obj invalid"))};d.prototype.playQueue=function(a){var b=this;this._renderer._setAVTransportURI(0,"x-rincon-queue:"+this._renderer.uuid+"#0",null,function(c){c?a&&a(c):b._renderer.play(a)})};d.prototype.playFromQueue=function(a,b,c){if(b.id)if(a=b.id.indexOf("/"),-1==a)c&&c(Error("queue object id is invalid"));else{var d=this;b=b.id.substr(a+1);this._renderer.seekTrack(b,function(a){a?d.playQueue(c):
d._renderer.play(c)})}else c&&c(Error("queue object id is null"))};d.prototype.addToQueue=function(a,b,c){if(a&&b&&b.res&&b.res.url&&b.id){var d=this;a.browseMetaData(b.id,function(a,e){a?c&&c(a):d._addURI(0,0,b.res.url,e.result,0,!0,c)})}else c&&c(Error("play obj invalid"))};d.prototype.replaceQueueAndPlay=function(a,b,c){if(a&&b&&b.res&&b.res.url&&b.id){var d=this;a.browseMetaData(b.id,function(a,e){a?c&&c(a):d._removeAllTracks(0,0,function(a){a?c&&c(a):d._addURI(0,0,b.res.url,e.result,0,!0,function(a,
b){a?c&&c(a):b&&"undefined"!=typeof b.firstTrackNumberEnqueued&&null!=b.firstTrackNumberEnqueued?d._renderer.seekTrack(b.firstTrackNumberEnqueued,function(a){a?c&&c(a):d._renderer.play(c)}):c&&c(Error("result format invalid"))})})})}else c&&c(Error("play obj invalid"))};d.prototype.browser=function(a,b,c,d,f){a?(b||(b=0),c||(c=0),d||(d=0),a.browseChildren(b,c,d,null,function(c,b,d){if(!c&&b)for(var e=0;e<b.length;e++)b[e]&&(b[e].id&&"Q:"==b[e].id.substr(0,2)&&"Q:"==b[e].parentID&&b[e].res&&delete b[e].res,
b[e].albumArtURI&&"http://"!=b[e].albumArtURI.substr(0,7)&&(b[e].albumArtURI="http://"+a.ip+":"+a.port+b[e].albumArtURI),b[e].info&&b[e].info.albumArtURI&&"http://"!=b[e].info.albumArtURI.substr(0,7)&&(b[e].info.albumArtURI="http://"+a.ip+":"+a.port+b[e].info.albumArtURI));f&&f(c,b,d)})):f&&f(Error("play obj invalid"))};d.prototype.getZoneGroupState=function(a){var b=this;this._getZoneGroupState(function(c,d){if(c)a&&a(c);else if(d&&d.zoneGroupState){c=!1;for(var e=0;e<d.zoneGroupState.length;e++){var g=
d.zoneGroupState[e];g&&g.coordinator==b.getUUID()&&(c=!0);for(var h=0;h<g.members.length;h++){var k=g.members[h];k&&k.uuid==b.getUUID()&&k.name&&(b.zoneName=k.name)}}a&&a(null,d.zoneGroupState,c)}else a&&a(Error("unknow zone group state"))})};d.prototype.getZoneGroupState=function(a){var b=this;this._getZoneGroupState(function(c,d){if(c)a&&a(c);else if(d&&d.zoneGroupState){c=!1;for(var e=0;e<d.zoneGroupState.length;e++){var g=d.zoneGroupState[e];g&&g.coordinator==b.getUUID()&&(c=!0);for(var h=0;h<
g.members.length;h++){var k=g.members[h];k&&k.uuid==b.getUUID()&&k.name&&(b.zoneName=k.name)}}a&&a(null,d.zoneGroupState,c)}else a&&a(Error("unknow zone group state"))})};d.prototype.playLineIn=function(a){var b=this.getUUID();b?this._renderer.playResource({url:"x-rincon-stream:"+b},"",a):a&&a(Error("no uuid"))};d.prototype.clearQueue=function(a,b){var c=0;"Q:1"==a&&(c=1);this._removeAllTracks(c,0,b)};d.prototype.volumeUp=function(a){this._setRelativeVolume(0,"Master",5,a)};d.prototype.volumeDown=
function(a){this._setRelativeVolume(0,"Master",-5,a)};d.prototype.getPlayInfo=function(a){if(this._renderer){var b=function(b){g--;b?a&&a(b):0==g&&(c&&"x-sonosapi-stream"==c.substr(0,17)&&d&&f&&f.trackMetaData&&(d["class"]&&(f.trackMetaData["class"]=d["class"]),d.title&&(f.trackMetaData.title=d.title),f.trackMetaData.streamContent&&(f.trackMetaData.artist=f.trackMetaData.streamContent)),f&&f.trackMetaData&&f.trackMetaData.creator&&!f.trackMetaData.artist&&(f.trackMetaData.artist=f.trackMetaData.creator),
a&&a(null,f))},c,d,f,g=2,h=this;this._renderer.getPlayInfo(function(a,c){!a&&c&&(c.trackMetaData&&c.trackMetaData.albumArtURI&&"http://"!=c.trackMetaData.albumArtURI.substr(0,7)&&(c.trackMetaData.albumArtURI="http://"+h._renderer.ip+":"+h._renderer.port+c.trackMetaData.albumArtURI),f=c);b&&b(a);a&&(b=null)});this._renderer.getMediaInfo(function(a,e){!a&&e&&(c=e.currentURI,d=e.currentURIMetaData);b&&b(a);a&&(b=null)})}else a&&a(Error("renderer not initialized"))};d.prototype.getMediaInfo=function(a){this._renderer?
this._renderer.getMediaInfo(function(b,c){a&&a(b,c)}):a&&a(Error("renderer not initialized"))};d.prototype.getPlayMode=function(a){if(this._renderer){var b=this;this._renderer.getPlayMode(function(c,d){c?a&&a(c):a&&a(null,b._parsePlayMode(d))})}else a&&a(Error("renderer not initialized"))};d.prototype.setPlayMode=function(a,b){this._renderer?(a=this._buildPlayMode(a),this._renderer.setPlayMode(a,b)):b&&b(Error("renderer not initialized"))};d.prototype._parsePlayMode=function(a){switch(a){case "NORMAL":return{shuffle:"off",
repeat:"off"};case "REPEAT_ALL":return{shuffle:"off",repeat:"all"};case "REPEAT_ONE":return{shuffle:"off",repeat:"one"};case "SHUFFLE_NOREPEAT":return{shuffle:"on",repeat:"off"};case "SHUFFLE":return{shuffle:"on",repeat:"all"};case "SHUFFLE_REPEAT_ONE":return{shuffle:"on",repeat:"one"};default:return{shuffle:"off",repeat:"off"}}};d.prototype._buildPlayMode=function(a){var b=a.shuffle;a=a.repeat;b||(b="off");a||(a="off");return"off"==b&&"off"==a?"NORMAL":"off"==b&&"all"==a?"REPEAT_ALL":"off"==b&&"one"==
a?"REPEAT_ONE":"on"==b&&"off"==a?"SHUFFLE_NOREPEAT":"on"==b&&"all"==a?"SHUFFLE":"on"==b&&"one"==a?"SHUFFLE_REPEAT_ONE":"NORMAL"};d.prototype.isGroupMuted=function(a){this._getGroupMute(0,function(b,c){b?a&&a(b):a&&a(null,"1"==c.currentMute)})};d.prototype.groupMute=function(a){this._setGroupMute(0,!0,function(b,c){b?a&&a(b):a&&a(null,"1"==c.currentMute)})};d.prototype.groupUnmute=function(a){this._setGroupMute(0,!1,function(b,c){b?a&&a(b):a&&a(null,"1"==c.currentMute)})};d.prototype.groupToggleMute=
function(a){var b=this;this.isGroupMuted(function(c,d){c?a&&a(c):d?b.groupUnmute(a):b.groupMute(a)})};d.prototype.getGroupVolume=function(a){this._getGroupVolume(0,function(b,c){b?a&&a(b):a&&a(null,parseInt(c.currentVolume))})};d.prototype.setGroupVolume=function(a,b){a=parseInt(a);0>a&&(a=0);100<a&&(a=100);this._setGroupVolume(0,a,b)};d.prototype.groupVolumeUp=function(a){this._setRelativeGroupVolume(0,5,a)};d.prototype.groupVolumeDown=function(a){this._setRelativeGroupVolume(0,-5,a)};d.prototype.getBalance=
function(a){if(this._renderer){var b=100,c=100,d=2,f=function(e){d--;e?a&&a(e):0==d&&a&&a(null,c-b)};this._renderer._getVolume(0,"LF",function(a,c){!a&&c&&(b=parseInt(c.volume));f&&f(a);a&&(f=null)});this._renderer._getVolume(0,"RF",function(a,b){!a&&b&&(c=parseInt(b.volume));f&&f(a);a&&(f=null)})}else a&&a(Error("renderer not initialized"))};d.prototype.setBalance=function(a,b){a=parseInt(a);100<a&&(a=100);-100>a&&(a=-100);var c=100,d=100;0>a?d=a+100:0<a&&(c=100-a);var f=2,g=function(a){f--;a?b&&
b(a):0==f&&b&&b()};this._renderer._setVolume(0,"LF",c,function(a){g&&g(a);a&&(g=null)});this._renderer._setVolume(0,"RF",d,function(a){g&&g(a);a&&(g=null)})};d.prototype.balanceToLeft=function(a){var b=this;this.getBalance(function(c,d){c?a&&a(c):(d=parseInt(d),b.setBalance(d-5,a))})};d.prototype.balanceToRight=function(a){var b=this;this.getBalance(function(c,d){c?a&&a(c):(d=parseInt(d),b.setBalance(d+5,a))})};d.prototype.getBass=function(a){this._getBass(0,function(b,c){b?a&&a(b):a&&a(null,parseInt(c.currentBase))})};
d.prototype.setBass=function(a,b){a=parseInt(a);10<a&&(a=10);-10>a&&(a=-10);this._setBass(0,a,b)};d.prototype.bassUp=function(a){var b=this;this.getBass(function(c,d){c?a&&a(c):(d=parseInt(d),b.setBass(d+1,a))})};d.prototype.bassDown=function(a){var b=this;this.getBass(function(c,d){c?a&&a(c):(d=parseInt(d),b.setBass(d-1,a))})};d.prototype.getTeble=function(a){this._getTreble(0,function(b,c){b?a&&a(b):a&&a(null,parseInt(c.currentTreble))})};d.prototype.setTreble=function(a,b){a=parseInt(a);10<a&&
(a=10);-10>a&&(a=-10);this._setTreble(0,a,b)};d.prototype.trebleUp=function(a){var b=this;this.getTeble(function(c,d){c?a&&a(c):(d=parseInt(d),b.setTreble(d+1,a))})};d.prototype.trebleDown=function(a){var b=this;this.getTeble(function(c,d){c?a&&a(c):(d=parseInt(d),b.setTreble(d-1,a))})};d.prototype.isLoudnessActive=function(a){this._getLoudness(0,"Master",function(b,c){b?a&&a(b):a&&a(null,"1"==c.currentLoudness)})};d.prototype.activateLoudness=function(a){this._setLoudness(0,"Master",!0,a)};d.prototype.deactivateLoudness=
function(a){this._setLoudness(0,"Master",!1,a)};d.prototype.toggleLoudness=function(a){var b=this;this.isLoudnessActive(function(c,d){c?a&&a(c):d?b.deactivateLoudness(a):b.activateLoudness(a)})};d.prototype.shuffleOn=function(a){if(this._renderer){var b=this;this.getPlayMode(function(c,d){c?a&&a(c):(d.shuffle="on",b.setPlayMode(d,a))})}else a&&a(Error("renderer not initialized"))};d.prototype.shuffleOff=function(a){if(this._renderer){var b=this;this.getPlayMode(function(c,d){c?a&&a(c):(d.shuffle=
"off",b.setPlayMode(d,a))})}else a&&a(Error("renderer not initialized"))};d.prototype.shuffleToggle=function(a){if(this._renderer){var b=this;this.getPlayMode(function(c,d){c?a&&a(c):(d.shuffle="on"==d.shuffle?"off":"on",b.setPlayMode(d,a))})}else a&&a(Error("renderer not initialized"))};d.prototype.repeatOff=function(a){if(this._renderer){var b=this;this.getPlayMode(function(c,d){c?a&&a(c):(d.repeat="off",b.setPlayMode(d,a))})}else a&&a(Error("renderer not initialized"))};d.prototype.repeatOne=function(a){if(this._renderer){var b=
this;this.getPlayMode(function(c,d){c?a&&a(c):(d.repeat="one",b.setPlayMode(d,a))})}else a&&a(Error("renderer not initialized"))};d.prototype.repeatAll=function(a){if(this._renderer){var b=this;this.getPlayMode(function(c,d){c?a&&a(c):(d.repeat="all",b.setPlayMode(d,a))})}else a&&a(Error("renderer not initialized"))};d.prototype.repeatSwitch=function(a){if(this._renderer){var b=this;this.getPlayMode(function(c,d){c?a&&a(c):(d.repeat="off"==d.repeat?"all":"all"==d.repeat?"one":"off",b.setPlayMode(d,
a))})}else a&&a(Error("renderer not initialized"))};d.prototype._setRelativeVolume=function(a,b,c,d){this._renderer?this._renderer._doSOAPRequest(this._renderer.getURL(this._renderer.renderingControl.url),this._renderer.renderingControl.type,"SetRelativeVolume",{InstanceID:a,Channel:b,Adjustment:c},function(a,c){a?d&&d(a):(a={},c=c.find("NewVolume"),0<c.length&&(a.newVolume=$(c[0]).text()),d&&d(null,a))}):d&&d(Error("renderer not initialized"))};d.prototype._getGroupMute=function(a,b){this._renderer?
this._renderer._doSOAPRequest(this._renderer.getURL(this._renderer.groupRenderingControl.url),this._renderer.groupRenderingControl.type,"GetGroupMute",{InstanceID:a},function(a,d){a?b&&b(a):(a={},d=d.find("CurrentMute"),0<d.length&&(a.currentMute=$(d[0]).text()),b&&b(null,a))}):b&&b(Error("renderer not initialized"))};d.prototype._setGroupMute=function(a,b,c){this._renderer?this._renderer._doSOAPRequest(this._renderer.getURL(this._renderer.groupRenderingControl.url),this._renderer.groupRenderingControl.type,
"SetGroupMute",{InstanceID:a,DesiredMute:b?"True":"False"},c):c&&c(Error("renderer not initialized"))};d.prototype._getGroupVolume=function(a,b){this._renderer?this._renderer._doSOAPRequest(this._renderer.getURL(this._renderer.groupRenderingControl.url),this._renderer.groupRenderingControl.type,"GetGroupVolume",{InstanceID:a},function(a,d){a?b&&b(a):(a={},d=d.find("CurrentVolume"),0<d.length&&(a.currentVolume=$(d[0]).text()),b&&b(null,a))}):b&&b(Error("renderer not initialized"))};d.prototype._setGroupVolume=
function(a,b,c){this._renderer?this._renderer._doSOAPRequest(this._renderer.getURL(this._renderer.groupRenderingControl.url),this._renderer.groupRenderingControl.type,"SetGroupVolume",{InstanceID:a,DesiredVolume:b},c):c&&c(Error("renderer not initialized"))};d.prototype._setRelativeGroupVolume=function(a,b,c){this._renderer?this._renderer._doSOAPRequest(this._renderer.getURL(this._renderer.groupRenderingControl.url),this._renderer.groupRenderingControl.type,"SetRelativeGroupVolume",{InstanceID:a,
Adjustment:b},function(a,b){a?c&&c(a):(a={},b=b.find("NewVolume"),0<b.length&&(a.newVolume=$(b[0]).text()),c&&c(null,a))}):c&&c(Error("renderer not initialized"))};d.prototype._getBass=function(a,b){this._renderer?this._renderer._doSOAPRequest(this._renderer.getURL(this._renderer.renderingControl.url),this._renderer.renderingControl.type,"GetBass",{InstanceID:a},function(a,d){a?b&&b(a):(a={},d=d.find("CurrentBass"),0<d.length&&(a.currentBase=$(d[0]).text()),b&&b(null,a))}):b&&b(Error("renderer not initialized"))};
d.prototype._setBass=function(a,b,c){this._renderer?this._renderer._doSOAPRequest(this._renderer.getURL(this._renderer.renderingControl.url),this._renderer.renderingControl.type,"SetBass",{InstanceID:a,DesiredBass:b},c):c&&c(Error("renderer not initialized"))};d.prototype._getTreble=function(a,b){this._renderer?this._renderer._doSOAPRequest(this._renderer.getURL(this._renderer.renderingControl.url),this._renderer.renderingControl.type,"GetTreble",{InstanceID:a},function(a,d){a?b&&b(a):(a={},d=d.find("CurrentTreble"),
0<d.length&&(a.currentTreble=$(d[0]).text()),b&&b(null,a))}):b&&b(Error("renderer not initialized"))};d.prototype._setTreble=function(a,b,c){this._renderer?this._renderer._doSOAPRequest(this._renderer.getURL(this._renderer.renderingControl.url),this._renderer.renderingControl.type,"SetTreble",{InstanceID:a,DesiredTreble:b},c):c&&c(Error("renderer not initialized"))};d.prototype._getLoudness=function(a,b,c){this._renderer?this._renderer._doSOAPRequest(this._renderer.getURL(this._renderer.renderingControl.url),
this._renderer.renderingControl.type,"GetLoudness",{InstanceID:a,Channel:b},function(a,b){a?c&&c(a):(a={},b=b.find("CurrentLoudness"),0<b.length&&(a.currentLoudness=$(b[0]).text()),c&&c(null,a))}):c&&c(Error("renderer not initialized"))};d.prototype._setLoudness=function(a,b,c,d){this._renderer?this._renderer._doSOAPRequest(this._renderer.getURL(this._renderer.renderingControl.url),this._renderer.renderingControl.type,"SetLoudness",{InstanceID:a,Channel:b,DesiredLoudness:c?"True":"False"},d):d&&d(Error("renderer not initialized"))};
d.prototype._getZoneGroupState=function(a){if(this._renderer){var b=this;this._renderer._doSOAPRequest(this._renderer.getURL(this.zoneGroupTopology.url),this.zoneGroupTopology.type,"GetZoneGroupState",null,function(c,d){if(c)a&&a(c);else{c={};d=d.find("ZoneGroupState");if(0<d.length)if(d=$(d[0]).text())try{var e=$($.parseXML(d));c.zoneGroupStateRaw=e;c.zoneGroupState=b._parseZoneGroupState(e)}catch(g){a&&a(g);return}else c.zoneGroupStateRaw="",c.zoneGroupState=null;a&&a(null,c)}})}else a&&a(Error("renderer not initialized"))};
d.prototype._parseZoneGroupState=function(a){var b=[];a.find("ZoneGroup").each(function(){var a=$(this),d=a.attr("ID"),f=a.attr("Coordinator");if(d&&f){var g={id:d,coordinator:f,members:[]};a.find("ZoneGroupMember").each(function(){var a=$(this),b=a.attr("UUID");a=a.attr("ZoneName");b&&a&&g.members.push({uuid:b,name:a})});b.push(g)}});return b};d.prototype._addURItoQueue=function(a,b,c,d,f,g){this._renderer?this._renderer._doSOAPRequest(this._renderer.getURL(this._renderer.avTransport.url),this._renderer.avTransport.type,
"AddURIToQueue",{InstanceID:a,EnqueuedURI:b,EnqueuedURIMetaData:c,DesiredFirstTrackNumberEnqueued:d,EnqueueAsNext:f?"True":"False"},function(a,b){if(a)g&&g(a);else{a={};var c=b.find("FirstTrackNumberEnqueued");0<c.length&&(a.firstTrackNumberEnqueued=$(c[0]).text());c=b.find("NumTracksAdded");0<c.length&&(a.numTracksAdded=$(c[0]).text());c=b.find("NewQueueLength");0<c.length&&(a.newQueueLength=$(c[0]).text());g&&g(null,a)}}):g&&g(Error("renderer not initialized"))};d.prototype._addURI=function(a,b,
c,d,f,g,h){this._renderer?this._renderer._doSOAPRequest(this._renderer.getURL(this._renderer.queue.url),this._renderer.queue.type,"AddURI",{QueueID:a,UpdateID:b,EnqueuedURI:c,EnqueuedURIMetaData:d,DesiredFirstTrackNumberEnqueued:f,EnqueueAsNext:g?"True":"False"},function(a,b){if(a)h&&h(a);else{a={};var c=b.find("FirstTrackNumberEnqueued");0<c.length&&(a.firstTrackNumberEnqueued=$(c[0]).text());c=b.find("NumTracksAdded");0<c.length&&(a.numTracksAdded=$(c[0]).text());c=b.find("NewQueueLength");0<c.length&&
(a.newQueueLength=$(c[0]).text());h&&h(null,a)}}):h&&h(Error("renderer not initialized"))};d.prototype._removeAllTracks=function(a,b,c){this._renderer?this._renderer._doSOAPRequest(this._renderer.getURL(this._renderer.queue.url),this._renderer.queue.type,"RemoveAllTracks",{QueueID:a,UpdateID:b},function(a,b){a?c&&c(a):(a={},b=b.find("NewUpdateID"),0<b.length&&(a.newUpdateID=$(b[0]).text()),c&&c(null,a))}):c&&c(Error("renderer not initialized"))};d.prototype.toJSON=function(){return{sys:xnm.aio.sonos.DM.SYS,
type:"play",ip:this.getIP(),port:this.getPort(),uuid:this.getUUID(),model:this._renderer?this._renderer.modelName:null,name:this.getName(),zoneName:this.zoneName}};d.prototype.equalsTo=function(a){return a&&a instanceof d?this.getIP()==a.getIP()&&this.getPort()==a.getPort():!1};d.parseJSON=function(a){return a.ip&&a.port?new d(a.ip,a.port,a.uuid,a.name):null};return d}();
xnm.aio.sonos.Discovery=function(){var d=function(a){this._logger="undefined"!=typeof require&&require?require("x.logger.js").getLogger("xnm.aio.sonos.Discovery"):{log:{}};this._upnpCB=null;this._listener=a};d.prototype.search=function(){if(!this._upnpCB){var a=this;this._upnpCB=function(b){a._findUpnpDevice(b)}}var b=require("x.upnp.js").getDiscoveryService();b.addCallback("upnp:rootdevice",this._upnpCB);b.discoverTarget("upnp:rootdevice")};d.prototype._findUpnpDevice=function(a){if(a)switch(a.deviceType){case "urn:schemas-upnp-org:device:ZonePlayer:1":this._logger.log("trace",
"find sonos player");this._listener&&this._listener.findPlayer(a);break;case "urn:schemas-upnp-org:device:MediaServer:1":this._logger.log("trace","find media server:"+a.name+" @"+a.ip),this._listener&&this._listener.findMediaServer(a)}};return d}();
xnm.aio.sonos.DM=function(){var d={master:{command:[{type:"enum",name:"play",ref:{value:"play"}},{type:"enum",name:"pause",ref:{value:"pause"}},{type:"enum",name:"stop",ref:{value:"stop"}},{type:"enum",name:"previous",ref:{value:"previous"}},{type:"enum",name:"next",ref:{value:"next"}},{type:"enum",name:"shuffle on",ref:{value:"shuffleOn"}},{type:"enum",name:"shuffle off",ref:{value:"shuffleOff"}},{type:"enum",name:"toggle shuffle",ref:{value:"shuffleToggle"}},{type:"enum",name:"repeat off",ref:{value:"repeatOff"}},
{type:"enum",name:"repeat all",ref:{value:"repeatAll"}},{type:"enum",name:"repeat one",ref:{value:"repeatOne"}},{type:"enum",name:"switch repeat",ref:{value:"repeatSwitch"}},{type:"int",name:"group volume",ref:{value:"groupVolume",ext:"%d",extMeta:"0-100"}},{type:"enum",name:"group volume up",ref:{value:"groupVolumeUp"}},{type:"enum",name:"group volume down",ref:{value:"groupVolumeDown"}},{type:"enum",name:"group mute",ref:{value:"groupMute"}},{type:"enum",name:"group unmute",ref:{value:"groupUnmute"}},
{type:"enum",name:"group toggle mute",ref:{value:"groupToggleMute"}},{type:"enum",name:"loudness on",ref:{value:"loudnessOn"}},{type:"enum",name:"loudness off",ref:{value:"loudnessOff"}},{type:"enum",name:"toggle loudness",ref:{value:"toggleLoudness"}},{type:"int",name:"set bass",ref:{value:"bass",ext:"%d",extMeta:"-10-10"}},{type:"enum",name:"bass up",ref:{value:"bassUp"}},{type:"enum",name:"bass down",ref:{value:"bassDown"}},{type:"int",name:"set treble",ref:{value:"treble",ext:"%d",extMeta:"-10-10"}},
{type:"enum",name:"treble up",ref:{value:"trebleUp"}},{type:"enum",name:"treble down",ref:{value:"trebleDown"}},{type:"int",name:"set balance",ref:{value:"balance",ext:"%d",extMeta:"-100-100",scale:"5"}},{type:"enum",name:"balance to left",ref:{value:"balanceLeft"}},{type:"enum",name:"balance to right",ref:{value:"balanceRight"}},{type:"int",name:"seek to (seconds)",ref:{value:"seekTo",ext:"%d"}}],status:[{type:"enum",name:"group muted",ref:{value:"groupMuted",options:["true","false"]}},{type:"int",
name:"group volume",ref:{value:"groupVolume",extMeta:"0-100"}},{type:"enum",name:"shuffle state",ref:{value:"shuffle",options:["on","off"]}},{type:"enum",name:"repeat state",ref:{value:"repeat",options:["off","one","all"]}},{type:"enum",name:"loudness state",ref:{value:"loudness",options:["off","on"]}},{type:"int",name:"bass",ref:{value:"bass",extMeta:"-10-10"}},{type:"int",name:"treble",ref:{value:"treble",extMeta:"-10-10"}},{type:"int",name:"balance",ref:{value:"balance",extMeta:"-100-100"}},{type:"string",
name:"play state",ref:{value:"playState",options:"STOPPED PLAYING TRANSITIONING PAUSED_PLAYBACK PAUSED_RECORDING RECORDING NO_MEDIA_PRESENT".split(" ")}},{type:"string",name:"track duration",ref:{value:"duration"}},{type:"int",name:"track duration (seconds)",ref:{value:"durationS"}},{type:"string",name:"track position",ref:{value:"position"}},{type:"int",name:"track position (seconds)",ref:{value:"positionS"}},{type:"string",name:"artist",ref:{value:"artist"}},{type:"string",name:"title",ref:{value:"title"}},
{type:"string",name:"album",ref:{value:"album"}}]},play:{command:[{type:"enum",name:"play",ref:{value:"play"}},{type:"enum",name:"pause",ref:{value:"pause"}},{type:"enum",name:"stop",ref:{value:"stop"}},{type:"enum",name:"previous",ref:{value:"previous"}},{type:"enum",name:"next",ref:{value:"next"}},{type:"enum",name:"toggle mute",ref:{value:"toggleMute"}},{type:"enum",name:"mute",ref:{value:"mute"}},{type:"enum",name:"unmute",ref:{value:"unmute"}},{type:"int",name:"volume",ref:{value:"volume",ext:"%d",
extMeta:"0-100"}},{type:"enum",name:"volume up",ref:{value:"volumeUp"}},{type:"enum",name:"volume down",ref:{value:"volumeDown"}},{type:"enum",name:"shuffle on",ref:{value:"shuffleOn"}},{type:"enum",name:"shuffle off",ref:{value:"shuffleOff"}},{type:"enum",name:"toggle shuffle",ref:{value:"shuffleToggle"}},{type:"enum",name:"repeat off",ref:{value:"repeatOff"}},{type:"enum",name:"repeat all",ref:{value:"repeatAll"}},{type:"enum",name:"repeat one",ref:{value:"repeatOne"}},{type:"enum",name:"switch repeat",
ref:{value:"repeatSwitch"}},{type:"int",name:"group volume",ref:{value:"groupVolume",ext:"%d",extMeta:"0-100"}},{type:"enum",name:"group volume up",ref:{value:"groupVolumeUp"}},{type:"enum",name:"group volume down",ref:{value:"groupVolumeDown"}},{type:"enum",name:"group mute",ref:{value:"groupMute"}},{type:"enum",name:"group unmute",ref:{value:"groupUnmute"}},{type:"enum",name:"group toggle mute",ref:{value:"groupToggleMute"}},{type:"enum",name:"loudness on",ref:{value:"loudnessOn"}},{type:"enum",
name:"loudness off",ref:{value:"loudnessOff"}},{type:"enum",name:"toggle loudness",ref:{value:"toggleLoudness"}},{type:"int",name:"set bass",ref:{value:"bass",ext:"%d",extMeta:"-10-10"}},{type:"enum",name:"bass up",ref:{value:"bassUp"}},{type:"enum",name:"bass down",ref:{value:"bassDown"}},{type:"int",name:"set treble",ref:{value:"treble",ext:"%d",extMeta:"-10-10"}},{type:"enum",name:"treble up",ref:{value:"trebleUp"}},{type:"enum",name:"treble down",ref:{value:"trebleDown"}},{type:"int",name:"set balance",
ref:{value:"balance",ext:"%d",extMeta:"-100-100",scale:"5"}},{type:"enum",name:"balance to left",ref:{value:"balanceLeft"}},{type:"enum",name:"balance to right",ref:{value:"balanceRight"}},{type:"int",name:"seek to (seconds)",ref:{value:"seekTo",ext:"%d"}},{type:"enum",name:"play line-in",ref:{value:"playLineIn"}},{type:"string",name:"play url",ref:{value:"playUrl",ext:"%s"}},{type:"audio",name:"play audio",ref:{value:"playAudio",ext:"%s"}}],status:[{type:"enum",name:"muted",ref:{value:"muted",options:["true",
"false"]}},{type:"int",name:"volume",ref:{value:"volume",extMeta:"0-100"}},{type:"enum",name:"group muted",ref:{value:"groupMuted",options:["true","false"]}},{type:"int",name:"group volume",ref:{value:"groupVolume",extMeta:"0-100"}},{type:"enum",name:"shuffle state",ref:{value:"shuffle",options:["on","off"]}},{type:"enum",name:"repeat state",ref:{value:"repeat",options:["off","one","all"]}},{type:"enum",name:"loudness state",ref:{value:"loudness",options:["off","on"]}},{type:"int",name:"bass",ref:{value:"bass",
extMeta:"-10-10"}},{type:"int",name:"treble",ref:{value:"treble",extMeta:"-10-10"}},{type:"int",name:"balance",ref:{value:"balance",extMeta:"-100-100"}},{type:"enum",name:"play state",ref:{value:"playState",options:"STOPPED PLAYING TRANSITIONING PAUSED_PLAYBACK PAUSED_RECORDING RECORDING NO_MEDIA_PRESENT".split(" ")}},{type:"string",name:"track duration",ref:{value:"duration"}},{type:"int",name:"track duration (seconds)",ref:{value:"durationS"}},{type:"string",name:"track position",ref:{value:"position"}},
{type:"int",name:"track position (seconds)",ref:{value:"positionS"}},{type:"string",name:"artist",ref:{value:"artist"}},{type:"string",name:"title",ref:{value:"title"}},{type:"string",name:"album",ref:{value:"album"}}]}},a=function(a,c){this.code=a;this.message=c;this.stack=Error().stack};a.prototype=Error();a.prototype.name="SonosDMError";a.prototype.code=0;a.ERROR_CODE={DEFAULT:0,INDEX_EXISTS:1,ID_EXISTS:2,INVALID:3,UNKNOW:4,NOT_FOUND:5,IP_EXISTS:6};return{SYS:"sonos",getIPDeviceType:function(){return[{sys:this.SYS,
name:"Sonos Player",port:1400}]},createDevice:function(b,c,d){c=a.ERROR_CODE;b?b.type?b.ip?d(null,b):d(new a(c.INVALID,"ip is invalid")):d(new a(c.INVALID,"type is invalid")):d(new a(c.INVALID,"info is invalid"))},updateDevice:function(b,c,d){c=a.ERROR_CODE;b?b.type?b.ip?d(null,b):d(new a(c.INVALID,"ip is invalid")):d(new a(c.INVALID,"type is invalid")):d(new a(c.INVALID,"info is invalid"))},deleteDevice:function(a,c,d){d()},applyUIFilter:function(a,c,d){var b=function(a,b){if("*"==a)return!0;for(var c=
!1,d=0;d<a.length;d++)if(a[d]==b){c=!0;break}return c},e=function(a,c,d){var e=[];switch(d.catagory){case "command":a.command&&a.command.forEach(function(a){b(d.elems,a.type)&&(a=JSON.parse(JSON.stringify(a)),e.push(a))});break;case "status":a.status&&a.status.forEach(function(a){b(d.elems,a.type)&&(a=JSON.parse(JSON.stringify(a)),e.push(a))})}return e},h=function(a,b){var c=[],f=xnm.aio.sonos.DM.getCommandStatusMap(a,d);f&&(a=e(f,a,b),c=c.concat(a));return c};if(!a.sys)return null;var k=JSON.parse(JSON.stringify(a)),
l=null;switch(c.catagory){case "command":l=h(a,c);k.command=l;break;case "status":l=h(a,c);k.status=l;break;default:return null}return l&&0!=l.length?k:null},getCommandStatusMap:function(a,c){return a.type?d[a.type]:null}}}();
xnm.aio.sonos.Handler=function(){var d=function(){this.detectedPlayers={};this._master=new xnm.aio.sonos.Master};d.prototype.discoverPlayers=function(a){var b=require("x.upnp.js");if(b){var c=this;b.discoverDevices(function(b){if("sonos"==b.type){var d=new xnm.aio.sonos.Player(b.ip,1400,b.uuid,b.name);c.detectedPlayers[b.uuid]=d;a(d)}})}};d.prototype.getStateValues=function(a,b){return(new xnm.aio.sonos.Player).getStateValues(b)};d.prototype.getDeviceCommandList=function(a,b){a=[];a.push({id:window.XC_Text.pplay,
cmd:"play"});a.push({id:window.XC_Text.ppause,cmd:"pause"});if(!b)for(a.push({id:window.XC_Text.pstop,cmd:"stop"}),b=0;100>=b;b+=5)a.push({id:window.XC_Text.volume+" "+b+"%",cmd:""+b});return a};d.prototype.getDevice=function(a){return new xnm.aio.sonos.Player(a.address,a.port)};d.prototype.devicemanager=xnm.aio.sonos.DM;d.prototype.Player=xnm.aio.sonos.Player;d.prototype.registModule=function(a){a.register(xnm.aio.sonos.DM.SYS,"sonos")};d.prototype.resolveDevice=function(a){return a?this._master.getPlayer(a):
null};d.prototype.getDeviceCommands=function(a,b){a=(a=xnm.aio.sonos.DM.applyUIFilter(a,{catagory:"command",elems:"*"}))?a.command:[];b&&b(null,a)};d.prototype.getDeviceStatus=function(a,b){a=(a=xnm.aio.sonos.DM.applyUIFilter(a,{catagory:"status",elems:"*"}))?a.status:[];b&&b(null,a)};d.prototype.doCommand=function(a,b,c){var d=this.resolveDevice(a);d?d.executeCommandCreator(a,b,function(a){c&&c(a)}):c&&c(Error("device json format invalid"))};d.prototype.doStatus=function(a,b,c,d){var e=this.resolveDevice(b);
e?e.getStatesCreator(null,[{id:a,device:b,status:c}],function(a,b){a?d&&d(a):d&&d(null,b[0])}):d&&d(Error("device json format invalid"))};d.prototype.discoverWithTimeout=function(a,b){var c=this;this._master.search(function(){for(var a=c._master.getBufferedPlayers(),d=[],g=0;g<a.length;g++)d.push(a[g]);d.push(c._master);b&&b(null,d)})};d.prototype.getPlayer=function(a,b){if(a&&a.uuid&&a.type)if("master"==a.type)b&&b(null,this._master);else{var c=this._master.getPlayer(a.uuid);if(c)b&&b(null,c);else{var d=
this;this._master.search(function(){c=d._master.getPlayer(a.uuid);b&&b(null,c)})}}else b&&b(Error("device json invalid"))};d.prototype.getMediaServer=function(a){var b=this._master.getBufferedMediaServers();if(0==b.length){var c=this;this._master.search(function(){a&&a(null,c._master.getBufferedMediaServers())})}else a&&a(null,b)};return d}();"undefined"!=typeof exports&&"undefined"!=typeof module&&module.exports&&(exports=module.exports=new xnm.aio.sonos.Handler);
