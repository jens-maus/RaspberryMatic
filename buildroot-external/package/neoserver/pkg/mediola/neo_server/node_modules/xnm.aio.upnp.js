var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.findInternal=function(f,b,a){f instanceof String&&(f=String(f));for(var c=f.length,d=0;d<c;d++){var e=f[d];if(b.call(a,e,d,f))return{i:d,v:e}}return{i:-1,v:void 0}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;$jscomp.ISOLATE_POLYFILLS=!1;$jscomp.FORCE_POLYFILL_PROMISE=!1;$jscomp.FORCE_POLYFILL_PROMISE_WHEN_NO_UNHANDLED_REJECTION=!1;
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(f,b,a){if(f==Array.prototype||f==Object.prototype)return f;f[b]=a.value;return f};$jscomp.getGlobal=function(f){f=["object"==typeof globalThis&&globalThis,f,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global];for(var b=0;b<f.length;++b){var a=f[b];if(a&&a.Math==Math)return a}throw Error("Cannot find global object");};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.IS_SYMBOL_NATIVE="function"===typeof Symbol&&"symbol"===typeof Symbol("x");$jscomp.TRUST_ES6_POLYFILLS=!$jscomp.ISOLATE_POLYFILLS||$jscomp.IS_SYMBOL_NATIVE;$jscomp.polyfills={};$jscomp.propertyToPolyfillSymbol={};$jscomp.POLYFILL_PREFIX="$jscp$";var $jscomp$lookupPolyfilledValue=function(f,b){var a=$jscomp.propertyToPolyfillSymbol[b];if(null==a)return f[b];a=f[a];return void 0!==a?a:f[b]};
$jscomp.polyfill=function(f,b,a,c){b&&($jscomp.ISOLATE_POLYFILLS?$jscomp.polyfillIsolated(f,b,a,c):$jscomp.polyfillUnisolated(f,b,a,c))};$jscomp.polyfillUnisolated=function(f,b,a,c){a=$jscomp.global;f=f.split(".");for(c=0;c<f.length-1;c++){var d=f[c];if(!(d in a))return;a=a[d]}f=f[f.length-1];c=a[f];b=b(c);b!=c&&null!=b&&$jscomp.defineProperty(a,f,{configurable:!0,writable:!0,value:b})};
$jscomp.polyfillIsolated=function(f,b,a,c){var d=f.split(".");f=1===d.length;c=d[0];c=!f&&c in $jscomp.polyfills?$jscomp.polyfills:$jscomp.global;for(var e=0;e<d.length-1;e++){var g=d[e];if(!(g in c))return;c=c[g]}d=d[d.length-1];a=$jscomp.IS_SYMBOL_NATIVE&&"es6"===a?c[d]:null;b=b(a);null!=b&&(f?$jscomp.defineProperty($jscomp.polyfills,d,{configurable:!0,writable:!0,value:b}):b!==a&&(void 0===$jscomp.propertyToPolyfillSymbol[d]&&($jscomp.propertyToPolyfillSymbol[d]=$jscomp.IS_SYMBOL_NATIVE?$jscomp.global.Symbol(d):
$jscomp.POLYFILL_PREFIX+d),$jscomp.defineProperty(c,$jscomp.propertyToPolyfillSymbol[d],{configurable:!0,writable:!0,value:b})))};$jscomp.polyfill("Array.prototype.find",function(f){return f?f:function(b,a){return $jscomp.findInternal(this,b,a).v}},"es6","es3");var xnm=xnm||{};xnm.aio=xnm.aio||{};xnm.aio.upnp=xnm.aio.upnp||{};
xnm.aio.upnp.Player=function(){var f=function(b){this._logger="undefined"!=typeof require&&require?require("x.logger.js").getLogger("xnm.aio.bose.SoundTouch"):{log:{}};this._renderer=null;b&&b.ip&&b.port&&b.uuid&&b.avTransport&&b.renderingControl&&(this._renderer=this._getRenderer(b.ip,b.port,b.uuid,b.avTransport,b.renderingControl))};f.prototype.getIP=function(){return this._renderer?this._renderer.ip:null};f.prototype.setIP=function(b){this._renderer&&(this._renderer.ip=b)};f.prototype.getPort=
function(){return this._renderer?this._renderer.port:null};f.prototype.setPort=function(b){this._renderer&&(this._renderer.port=b)};f.prototype.getUUID=function(){return this._renderer?this._renderer.uuid:null};f.prototype.getPlayInfo=function(b){this._renderer?this._renderer.getPlayInfo(function(a,c){b&&b(a,c)}):b&&b(Error("no renderer"))};f.prototype.play=function(b,a,c){if(b&&a&&a["class"]&&a.id)if(this._renderer){var d=this;b.browseMetaData(a.id,function(e,g){e?c&&c(e):0!=a["class"].indexOf("object.container")||
a.res&&a.res.url?a.res&&a.res.url?d._renderer.playResource({url:a.res.url},g.result,c):c&&c(Error("resource url invalid")):b.uuid?d._renderer.playContainer({containerID:a.id,server_uuid:b.uuid},g.result,c):c&&c(Error("media server uuid invalid"))})}else c&&c(Error("renderer not inited"));else c&&c(Error("play obj invalid"))};f.prototype.browser=function(b,a,c,d,e){b?(a||(a=0),c||(c=0),d||(d=0),b.browseChildren(a,c,d,null,function(g,l,h){e&&e(g,l,h)})):e&&e(Error("play obj invalid"))};f.prototype.executeCommandCreator=
function(b,a,c){a&&a.value?this._executeCommand(a.value,a.ext,function(d){c&&c(d)}):c&&c(Error("command value is empty"))};f.prototype.getStatesCreator=function(b,a,c){this._getStates(function(d,e){if(d)c&&c(d);else{d=[];for(var g=0;g<a.length;g++){var l=a[g];if(l&&l.id&&l.status){var h="?";switch(l.status.value){case "power":case "muted":case "volume":case "repeatMode":case "shuffleMode":case "playState":case "durationS":case "positionS":case "bass":h=e[l.status.value];break;case "artist":case "title":case "album":case "radio":(h=
e[l.status.value])||(h="")}if("undefined"==typeof h||null==h)h="?";d.push({id:l.id,status:h})}}c&&c(null,d)}})};f.prototype._executeCommand=function(b,a,c){if(this._renderer){var d=this;switch(b){case "play":this._clickKey("PLAY",c);break;case "pause":this._clickKey("PAUSE",c);break;case "tooglePlay":this._clickKey("PLAY_PAUSE",c);break;case "stop":this._clickKey("STOP",c);break;case "previous":this._clickKey("PREV_TRACK",c);break;case "next":this._clickKey("NEXT_TRACK",c);break;case "togglePower":this._clickKey("POWER",
c);break;case "toggleMute":this._clickKey("MUTE",c);break;case "volumeUp":this._clickKey("VOLUME_UP",c);break;case "volumeDown":this._clickKey("VOLUME_DOWN",c);break;case "setVolume":if("undefined"==typeof a||null==a){c&&c(Error("volume value invalid"));break}a=parseInt(a);100<a&&(a=100);0>a&&(a=0);this._setVolume(a,c);break;case "thumbUp":this._clickKey("THUMBS_UP",c);break;case "thumbDown":this._clickKey("THUMBS_DOWN",c);break;case "bookmark":this._clickKey("BOOKMARK",c);break;case "preset":if(!a){c&&
c(Error("preset value invalid"));break}this._clickKey("PRESET_"+a,c);break;case "shuffleOn":this._clickKey("SHUFFLE_ON",c);break;case "shuffleOff":this._clickKey("SHUFFLE_OFF",c);break;case "toggleShuffle":this._getNowPlaying(function(h,k){h?c&&c(h):k&&k.shuffleSetting?(h="SHUFFLE_ON","SHUFFLE_ON"==k.shuffleSetting&&(h="SHUFFLE_OFF"),d._clickKey(h,c)):c&&c(Error("no shuffle setting"))});break;case "setRepeatMode":if(!a){c&&c(Error("play mode value invalid"));break}this._clickKey(a,c);break;case "addFav":this._clickKey("ADD_FAVORITE",
c);break;case "removeFav":this._clickKey("REMOVE_FAVORITE",c);break;case "bassUp":case "bassDown":if("undefined"==typeof a||null==a){c&&c(Error("seek value invalid"));break}this._getBass(function(h,k){if(h)c&&c(h);else if(k&&"undefined"!=typeof k.actualbass&&null!=k.actualbass){h=k.actualbass;h="bassUp"==b?h+1:h-1;if(this.bass&&(e=this.bass.indexOf("-",1),-1!=e)){k=this.bass.substring(0,e);var m=this.bass.substr(e+1);k=parseInt(k);m=parseInt(m);h<k&&(h=k);h>m&&(h=m)}d._setBass(h,c)}else c&&c(Error("no bass info"))});
break;case "setBass":if("undefined"==typeof a||null==a){c&&c(Error("volume value invalid"));break}a=parseInt(a);if(this.bass){var e=this.bass.indexOf("-",1);if(-1!=e){var g=this.bass.substring(0,e),l=this.bass.substr(e+1);g=parseInt(g);l=parseInt(l);a<g&&(a=g);a>l&&(a=l)}}this._setBass(a,c);break;default:b&&"select:"==b.substr(0,7)?(g=b.substr(7),e=g.indexOf("@"),a=g.substring(0,e),g=g.substr(e+1),d._setSource(a,g,c)):c&&c(Error("unknown command"))}}else c&&c(Error("renderer not initialized"))};f.prototype._getStates=
function(b){var a=function(){d--;0==d&&b&&b(null,c)},c={},d=3;this._getBass(function(e,g){!e&&g&&(c.bass=g.actualbass);a()});this._getVolume(function(e,g){!e&&g&&(c.volume=g.actualvolume,c.muted=g.muteenabled);a()});this._getNowPlaying(function(e,g){!e&&g&&(c.power="STANDBY"==g.source?"off":"on",g.repeatSetting&&(c.repeatMode=g.repeatSetting),g.shuffleSetting&&(c.shuffleMode=g.shuffleSetting),g.playStatus&&(c.playState=g.playStatus),g.duration&&(c.durationS=g.duration),g.position&&(c.positionS=g.position),
g.position&&(c.positionS=g.position),g.track&&(c.title=g.track),g.stationName&&(c.radio=g.stationName),g.artist&&(c.artist=g.artist),g.album&&(c.album=g.album));a()})};f.prototype._getRenderer=function(b,a,c,d,e){var g=require("xnm.aio.upnp.js");if(g.discovery&&g.discovery._player&&(g=g.discovery._player[c])&&g._renderer)return g._renderer;g=new (require("x.upnp.js").MediaRenderer);g.init(b,a,c,{avTransport:d,renderingControl:e});return g};f.prototype._clickKey=function(b,a){var c=this;this._pressKey(b,
function(d){d?a&&a(d):c._releaseKey(b,function(e){a&&a(e)})})};f.prototype._getInfo=function(b){var a=this;this._sendRequest("GET","/info",null,function(c,d){c?b&&b(c):(c=d.find("info"))&&c[0]?(c=$(c[0]),a.mac=c.attr("deviceID"),(c=c.find("name"))&&c[0]&&(a.name=$(c[0]).text()),b&&b(null,{name:a.name,mac:a.mac})):b&&b(Error("get info xml invalid"))})};f.prototype._pressKey=function(b,a){this._sendRequest("POST","/key",'<key state="press" sender="Gabbo">'+b+"</key>",a)};f.prototype._releaseKey=function(b,
a){this._sendRequest("POST","/key",'<key state="release" sender="Gabbo">'+b+"</key>",a)};f.prototype._getSources=function(b){var a=this;this._sendRequest("GET","/sources",null,function(c,d){if(c)b&&b(c);else{var e=[];d.find("sourceItem").each(function(){var g=$(this);e.push({source:g.attr("source"),sourceAccount:g.attr("sourceAccount")?g.attr("sourceAccount"):null,isLocal:g.attr("isLocal"),name:g.text()?g.text():null})});a.sources=e;b&&b(null,e)}})};f.prototype._setSource=function(b,a,c){b='<ContentItem source="'+
b+'"';a&&(b+=' sourceAccount="'+a+'"');this._sendRequest("POST","/select",b+"></ContentItem>",c)};f.prototype._setBass=function(b,a){this._sendRequest("POST","/bass","<bass>"+b+"</bass>",a)};f.prototype._getBass=function(b){this._sendRequest("GET","/bass",null,function(a,c){if(a)b&&b(a);else{var d={},e=c.find("targetbass");e&&e[0]&&(d.targetbass=parseInt($(e[0]).text()));(e=c.find("actualbass"))&&e[0]&&(d.actualbass=parseInt($(e[0]).text()));b&&b(a,d)}})};f.prototype._getBassCap=function(b){var a=
this;this._sendRequest("GET","/bassCapabilities",null,function(c,d){if(c)b&&b(c);else if((c=d.find("bassAvailable"))&&c[0])if((c=$(c[0]).text())&&"false"!=c.toLowerCase()){c=0;var e=d.find("bassMin");e&&e[0]&&(c=$(e[0]).text());e=100;(d=d.find("bassMax"))&&d[0]&&(e=$(d[0]).text());a.bass=c+"-"+e;b&&b(null,{bass:a.bass})}else b&&b(null,null);else b&&b(Error("get bass cap xml invalid"))})};f.prototype._getZone=function(b){this._sendRequest("GET","/getZone",null,function(a,c){if(a)b&&b(a);else{var d=
{};if((a=c.find("zone"))&&a[0]){c=$(a[0]).attr("master");if(!c){b&&b(null,d);return}d.master=c}$(a[0]).find("member").each(function(){var e=$(this),g=e.attr("ipaddress");e=e.text();g&&e&&(d.members||(d.members={}),d.members[e]=g)});b&&b(null,d)}})};f.prototype._setZone=function(b,a,c){b='<zone master="'+b+'" senderIPAddress="0.0.0.0">';for(var d in a)a.hasOwnProperty(d)&&a[d]&&(b+='<member ipaddress="'+a[d]+'">'+d+"</member>");this._sendRequest("POST","/setZone",b+"</zone>",c)};f.prototype._getVolume=
function(b){this._sendRequest("GET","/volume",null,function(a,c){if(a)b&&b(a);else{var d={},e=c.find("targetvolume");e&&e[0]&&(d.targetvolume=parseInt($(e[0]).text()));(e=c.find("actualvolume"))&&e[0]&&(d.actualvolume=parseInt($(e[0]).text()));(e=c.find("muteenabled"))&&e[0]&&(d.muteenabled=$(e[0]).text());b&&b(a,d)}})};f.prototype._setVolume=function(b,a){this._sendRequest("POST","/volume","<volume>"+b+"</volume>",a)};f.prototype._getNowPlaying=function(b){this._sendRequest("GET","/now_playing",
null,function(a,c){if(a)b&&b(a);else{a={};var d=c.find("nowPlaying");if(d&&d[0]){var e=$(d[0]).getAttributes();a=JSON.parse(JSON.stringify(e))}(d=c.find("ContentItem"))&&d[0]&&(e=$(d[0]).getAttributes(),a.content=JSON.parse(JSON.stringify(e)),(e=$(d[0]).find("itemName"))&&e[0]&&(a.content.itemName=$(e[0]).text()));(d=c.find("track"))&&d[0]&&(a.track=$(d[0]).text());(d=c.find("artist"))&&d[0]&&(a.artist=$(d[0]).text());(d=c.find("album"))&&d[0]&&(a.album=$(d[0]).text());(d=c.find("stationName"))&&
d[0]&&(a.stationName=$(d[0]).text());(d=c.find("art"))&&d[0]&&(a.artImageStatus=$(d[0]).attr("artImageStatus"),a.art=$(d[0]).text());(d=c.find("playStatus"))&&d[0]&&(a.playStatus=$(d[0]).text());(d=c.find("description"))&&d[0]&&(a.description=$(d[0]).text());(d=c.find("stationLocation"))&&d[0]&&(a.description=$(d[0]).text());(d=c.find("time"))&&d[0]&&(a.duration=$(d[0]).attr("total"),a.position=$(d[0]).text());(d=c.find("shuffleSetting"))&&d[0]&&(a.shuffleSetting=$(d[0]).text());(d=c.find("repeatSetting"))&&
d[0]&&(a.repeatSetting=$(d[0]).text());b&&b(null,a)}})};f.prototype._sendRequest=function(b,a,c,d){this._doRequest(this.getIP(),8090,b,a,c,function(e,g){if(e)d&&d(e);else try{var l=$($.parseXML(g)),h=l.find("error");if(h&&h[0]){var k=$(h[0]),m=k.text(),r=k.attr("name");d&&d(Error(m+":"+r))}else d&&d(null,l)}catch(n){d&&d(n)}})};f.prototype._doRequest=function(b,a,c,d,e,g){var l=this;b="http://"+b+":"+a+d;this._logger.log("trace","send "+c+" to url:"+b);e&&this._logger.log("trace","with data "+e);
var h=g;g={url:b,type:c,timeout:2E3,contentType:"text/xml",dataType:"text",cache:!0,success:function(k){l._logger.log("trace","http request success:"+k);h&&(h(null,k),h=null)},error:function(k,m){k="http request error:"+(k?k.status:"0")+"-"+m;l._logger.log("trace",k);h&&(h(Error(k)),h=null)}};"post"==c.toLowerCase()&&e&&(g.data=e);$.ajax(g)};f.prototype.toJSON=function(){return{sys:"upnp",ip:this.getIP(),port:this.getPort(),uuid:this.getUUID(),name:this._renderer?this._renderer.name:null,model:this._renderer?
this._renderer.modelName:null,modelDescription:this._renderer?this._renderer.modelDescription:null,manufacturer:this._renderer?this._renderer.manufacturer:null,avTransport:this._renderer?this._renderer.avTransport:null,renderingControl:this._renderer?this._renderer.renderingControl:null,connectionManager:this._renderer?this._renderer.connectionManager:null}};f.prototype.equalsTo=function(b){return b&&b instanceof SoundTouch?this.getIP()==b.getIP()&&this.getPort()==b.getPort():!1};return f}();
xnm.aio.upnp.InMemoryPlayList=function(){return function(){}}();
xnm.aio.upnp.Discovery=function(){var f=function(){this._logger="undefined"!=typeof require&&require?require("x.logger.js").getLogger("xnm.aio.bose.Discovery"):{log:{}};this._upnpCB=null;this._mediaServer={};this._player={};this._searchCB=[];this._autoSearchTimeout=null;this.search(null)};f.prototype.getBufferedPlayer=function(b){return this._player[b]};f.prototype.getBufferedPlayers=function(){var b=[],a;for(a in this._player)this._player.hasOwnProperty(a)&&b.push(this._player[a]);return b};f.prototype.getBufferedMediaServers=
function(){var b=[],a;for(a in this._mediaServer)this._mediaServer.hasOwnProperty(a)&&b.push(this._mediaServer[a]);return b};f.prototype.search=function(b){var a=this._searchCB.length;b&&-1==this._searchCB.indexOf(b)&&this._searchCB.push(b);if(0==a){this._autoSearchTimeout&&(clearTimeout(this._autoSearchTimeout),this._autoSearchTimeout=null);this._search();var c=this;setTimeout(function(){c._autoSearchTimeout=setTimeout(function(){c._logger.log("trace","auto search timeout, search again");c.search(null)},
6E4);var d=c._searchCB;c._searchCB=[];d.forEach(function(e){e&&e()})},5E3)}};f.prototype._search=function(){if(!this._upnpCB){var b=this;this._upnpCB=function(c){b._findUpnpDevice(c)}}this._mediaServer={};this._player={};var a=require("x.upnp.js").getDiscoveryService();a.addCallback("upnp:rootdevice",this._upnpCB);a.discoverTarget("upnp:rootdevice")};f.prototype._findUpnpDevice=function(b){if(b){var a=b.uuid;switch(b.deviceType){case "urn:schemas-upnp-org:device:MediaServer:1":this._logger.log("trace",
"find media server:"+b.name+" @"+b.ip);this._mediaServer[a]=b;break;case "urn:schemas-upnp-org:device:MediaRenderer:1":this._logger.log("trace","find media renderer:"+b.name+" @"+b.ip);var c=new xnm.aio.upnp.Player;c._renderer=b;this._player[a]=c}}};return f}();
xnm.aio.upnp.DM=function(){var f={command:[{type:"enum",name:"play",ref:{value:"play"}},{type:"enum",name:"pause",ref:{value:"pause"}},{type:"enum",name:"paly/pause",ref:{value:"tooglePlay"}},{type:"enum",name:"stop",ref:{value:"stop"}},{type:"enum",name:"previous",ref:{value:"previous"}},{type:"enum",name:"next",ref:{value:"next"}},{type:"enum",name:"toggle power",ref:{value:"togglePower"}},{type:"enum",name:"toggle mute",ref:{value:"toggleMute"}},{type:"enum",name:"volume up",ref:{value:"volumeUp"}},
{type:"enum",name:"volume down",ref:{value:"volumeDown"}},{type:"int",name:"set volume",ref:{value:"setVolume",ext:"%d",extMeta:"0-100"}},{type:"enum",name:"thumb up",ref:{value:"thumbUp"}},{type:"enum",name:"thumb down",ref:{value:"thumbDown"}},{type:"enum",name:"bookmark",ref:{value:"bookmark"}},{type:"enum",name:"preset",ref:{value:"preset",ext:"%e",extMeta:"123456".split("")}},{type:"enum",name:"shuffle on",ref:{value:"shuffleOn"}},{type:"enum",name:"shuffle off",ref:{value:"shuffleOff"}},{type:"enum",
name:"toggle shuffle",ref:{value:"toggleShuffle"}},{type:"enum",name:"set repeat mode",ref:{value:"setRepeatMode",ext:"%e",extMeta:["REPEAT_OFF","REPEAT_ONE","REPEAT_ALL"]}},{type:"enum",name:"add to favorite",ref:{value:"addFav"}},{type:"enum",name:"remove from favorite",ref:{value:"removeFav"}}],status:[{type:"enum",name:"power",ref:{value:"power",options:["on","off"]}},{type:"enum",name:"muted",ref:{value:"muted",options:["true","false"]}},{type:"int",name:"volume",ref:{value:"volume",extMeta:"0-100"}},
{type:"enum",name:"repeat mode",ref:{value:"repeatMode",options:["REPEAT_OFF","REPEAT_ONE","REPEAT_ALL"]}},{type:"enum",name:"shuffle mode",ref:{value:"shuffleMode",options:["SHUFFLE_ON","SHUFFLE_OFF"]}},{type:"string",name:"play state",ref:{value:"playState",options:["PLAY_STATE","PAUSE_STATE","STOP_STATE","BUFFERING_STATE","INVALID_PLAY_STATUS"]}},{type:"int",name:"track duration (seconds)",ref:{value:"durationS"}},{type:"int",name:"track position (seconds)",ref:{value:"positionS"}},{type:"string",
name:"radio station",ref:{value:"radio"}},{type:"string",name:"artist",ref:{value:"artist"}},{type:"string",name:"title",ref:{value:"title"}},{type:"string",name:"album",ref:{value:"album"}}]},b=function(a,c){this.code=a;this.message=c;this.stack=Error().stack};b.prototype=Error();b.prototype.name="UpnpDMError";b.prototype.code=0;b.ERROR_CODE={DEFAULT:0,INDEX_EXISTS:1,ID_EXISTS:2,INVALID:3,UNKNOW:4,NOT_FOUND:5,IP_EXISTS:6};return{SYS:"upnp",getIPDeviceType:function(){return[{sys:this.SYS,name:"UPnP/DLNA Player"}]},
createDevice:function(a,c,d){c=b.ERROR_CODE;a?a.type?a.ip?a.port?a.uuid?d(null,a):d(new b(c.INVALID,"uuid is invalid")):d(new b(c.INVALID,"port is invalid")):d(new b(c.INVALID,"ip is invalid")):d(new b(c.INVALID,"type is invalid")):d(new b(c.INVALID,"info is invalid"))},updateDevice:function(a,c,d){c=b.ERROR_CODE;a?a.type?a.ip?a.port?a.uuid?d(null,a):d(new b(c.INVALID,"uuid is invalid")):d(new b(c.INVALID,"port is invalid")):d(new b(c.INVALID,"ip is invalid")):d(new b(c.INVALID,"type is invalid")):
d(new b(c.INVALID,"info is invalid"))},deleteDevice:function(a,c,d){d()},applyUIFilter:function(a,c,d){var e=function(m,r){if("*"==m)return!0;for(var n=!1,p=0;p<m.length;p++)if(m[p]==r){n=!0;break}return n},g=function(m,r,n){var p=[];switch(n.catagory){case "command":m.command&&m.command.forEach(function(q){e(n.elems,q.type)&&(q=JSON.parse(JSON.stringify(q)),p.push(q))});break;case "status":m.status&&m.status.forEach(function(q){e(n.elems,q.type)&&(q=JSON.parse(JSON.stringify(q)),p.push(q))})}return p},
l=function(m,r){var n=[],p=xnm.aio.bose.DM.getCommandStatusMap(m,d);p&&(m=g(p,m,r),n=n.concat(m));return n};if(!a.sys)return null;var h=JSON.parse(JSON.stringify(a)),k=null;switch(c.catagory){case "command":k=l(a,c);h.command=k;break;case "status":k=l(a,c);h.status=k;break;default:return null}return k&&0!=k.length?h:null},getCommandStatusMap:function(a,c){var d=JSON.parse(JSON.stringify(f));a&&a.bass&&(d.command.push({type:"enum",name:"bass up",ref:{value:"bassUp"}}),d.command.push({type:"enum",name:"bass down",
ref:{value:"bassDown"}}),d.command.push({type:"int",name:"set bass",ref:{value:"setBass",ext:"%d",extMeta:a.bass}}),d.status.push({type:"int",name:"bass",ref:{value:"bass",extMeta:a.bass}}));a&&a.sources&&a.sources.forEach(function(e){if(e&&"true"==e.isLocal){var g=e.source;e.name&&(g=e.name);var l=e.sourceAccount?e.sourceAccount:"";e.source&&d.command.push({type:"enum",name:"select "+g,ref:{value:"select:"+e.source+"@"+l}})}});return d}}}();
xnm.aio.upnp.Handler=function(){var f=function(){this.discovery=new xnm.aio.upnp.Discovery};f.prototype.devicemanager=xnm.aio.upnp.DM;f.prototype.Player=xnm.aio.upnp.Player;f.prototype.registModule=function(b){b.register(xnm.aio.upnp.DM.SYS,"upnp")};f.prototype.resolveDevice=function(b){if(!b)return null;var a=null;b.uuid&&(a=this.discovery.getBufferedPlayer(b));return a?a:b.ip&&b.port&&b.uuid&&b.avTransport&&b.renderingControl?new xnm.aio.upnp.Player(b):null};f.prototype.getDeviceCommands=function(b,
a){b=(b=this.devicemanager.applyUIFilter(b,{catagory:"command",elems:"*"}))?b.command:[];a&&a(null,b)};f.prototype.getDeviceStatus=function(b,a){b=(b=this.devicemanager.applyUIFilter(b,{catagory:"status",elems:"*"}))?b.status:[];a&&a(null,b)};f.prototype.doCommand=function(b,a,c){var d=this.resolveDevice(b);d?d.executeCommandCreator(b,a,function(e){c&&c(e)}):c&&c(Error("device json format invalid"))};f.prototype.doStatus=function(b,a,c,d){var e=this.resolveDevice(a);e?e.getStatesCreator(null,[{id:b,
device:a,status:c}],function(g,l){g?d&&d(g):d&&d(null,l[0])}):d&&d(Error("device json format invalid"))};f.prototype.discover=function(b){var a=this;this.discovery.search(function(){b&&b(null,a.discovery.getBufferedPlayers())})};f.prototype.getPlayer=function(b,a){if(b&&b.uuid){var c=this.discovery.getBufferedPlayer(b.uuid);if(c)a&&a(null,c);else{var d=this;this.discovery.search(function(){c=d.discovery.getBufferedPlayer(b.uuid);a&&a(null,c)})}}else a&&a(Error("device json invalid"))};f.prototype.getMediaServer=
function(b){var a=this.discovery.getBufferedMediaServers();if(0==a.length){var c=this;this.discovery.search(function(){b&&b(null,c.discovery.getBufferedMediaServers())})}else b&&b(null,a)};return f}();"undefined"!=typeof exports&&"undefined"!=typeof module&&module.exports&&(exports=module.exports=new xnm.aio.upnp.Handler);
