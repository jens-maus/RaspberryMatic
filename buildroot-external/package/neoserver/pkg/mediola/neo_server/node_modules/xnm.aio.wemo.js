var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.findInternal=function(e,a,b){e instanceof String&&(e=String(e));for(var d=e.length,c=0;c<d;c++){var f=e[c];if(a.call(b,f,c,e))return{i:c,v:f}}return{i:-1,v:void 0}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;$jscomp.ISOLATE_POLYFILLS=!1;$jscomp.FORCE_POLYFILL_PROMISE=!1;$jscomp.FORCE_POLYFILL_PROMISE_WHEN_NO_UNHANDLED_REJECTION=!1;
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(e,a,b){if(e==Array.prototype||e==Object.prototype)return e;e[a]=b.value;return e};$jscomp.getGlobal=function(e){e=["object"==typeof globalThis&&globalThis,e,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global];for(var a=0;a<e.length;++a){var b=e[a];if(b&&b.Math==Math)return b}throw Error("Cannot find global object");};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.IS_SYMBOL_NATIVE="function"===typeof Symbol&&"symbol"===typeof Symbol("x");$jscomp.TRUST_ES6_POLYFILLS=!$jscomp.ISOLATE_POLYFILLS||$jscomp.IS_SYMBOL_NATIVE;$jscomp.polyfills={};$jscomp.propertyToPolyfillSymbol={};$jscomp.POLYFILL_PREFIX="$jscp$";var $jscomp$lookupPolyfilledValue=function(e,a){var b=$jscomp.propertyToPolyfillSymbol[a];if(null==b)return e[a];b=e[b];return void 0!==b?b:e[a]};
$jscomp.polyfill=function(e,a,b,d){a&&($jscomp.ISOLATE_POLYFILLS?$jscomp.polyfillIsolated(e,a,b,d):$jscomp.polyfillUnisolated(e,a,b,d))};$jscomp.polyfillUnisolated=function(e,a,b,d){b=$jscomp.global;e=e.split(".");for(d=0;d<e.length-1;d++){var c=e[d];if(!(c in b))return;b=b[c]}e=e[e.length-1];d=b[e];a=a(d);a!=d&&null!=a&&$jscomp.defineProperty(b,e,{configurable:!0,writable:!0,value:a})};
$jscomp.polyfillIsolated=function(e,a,b,d){var c=e.split(".");e=1===c.length;d=c[0];d=!e&&d in $jscomp.polyfills?$jscomp.polyfills:$jscomp.global;for(var f=0;f<c.length-1;f++){var h=c[f];if(!(h in d))return;d=d[h]}c=c[c.length-1];b=$jscomp.IS_SYMBOL_NATIVE&&"es6"===b?d[c]:null;a=a(b);null!=a&&(e?$jscomp.defineProperty($jscomp.polyfills,c,{configurable:!0,writable:!0,value:a}):a!==b&&(void 0===$jscomp.propertyToPolyfillSymbol[c]&&($jscomp.propertyToPolyfillSymbol[c]=$jscomp.IS_SYMBOL_NATIVE?$jscomp.global.Symbol(c):
$jscomp.POLYFILL_PREFIX+c),$jscomp.defineProperty(d,$jscomp.propertyToPolyfillSymbol[c],{configurable:!0,writable:!0,value:a})))};$jscomp.polyfill("Array.prototype.find",function(e){return e?e:function(a,b){return $jscomp.findInternal(this,a,b).v}},"es6","es3");var xnm=xnm||{};xnm.aio=xnm.aio||{};xnm.aio.wemo=xnm.aio.wemo||{};
xnm.aio.wemo.Switch=function(){var e=function(a,b,d,c){this.ip=a;this.port=b;this.uuid=d;this.type="switch";c&&(this.type=c);this.CommandHandler=null};e.prototype.switchTo=function(a,b){var d=new (require("x.upnp.js").Device),c=this;d.init(this.ip,this.port,this.uuid);d._doSOAPRequest(d.getURL("/upnp/control/basicevent1"),"urn:Belkin:service:basicevent:1","SetBinaryState",{BinaryState:a},function(f){f?b&&b(f):(f=0,"insight"==c.type&&(f=1E3),b&&setTimeout(b,f))})};e.prototype._getBinaryState=function(a){var b=
new (require("x.upnp.js").Device);b.init(this.ip,this.port,this.uuid);b._doSOAPRequest(b.getURL("/upnp/control/basicevent1"),"urn:Belkin:service:basicevent:1","GetBinaryState",{BinaryState:1},function(d,c){d=null;c&&(c=c.find("BinaryState"),0<c.length&&(d=parseInt($(c[0]).text()),0==d?d="off":null!=d&&(d="on")));a&&a(d)})};e.prototype._getInsightState=function(a){var b=new (require("x.upnp.js").Device);b.init(this.ip,this.port,this.uuid);b._doSOAPRequest(b.getURL("/upnp/control/insight1"),"urn:Belkin:service:insight:1",
"GetInsightParams",null,function(d,c){d=null;c&&(c=c.find("InsightParams"),0<c.length&&(c=$(c[0]).text().split("|"),11==c.length&&(d=(parseInt(c[7])/1E3).toFixed(1))));a&&a(d)})};e.prototype.getState=function(a){var b=null,d=this;this._getBinaryState(function(c){c&&c?(b={state:c},"insight"==d.type?d._getInsightState(function(f){f&&(b.current=f);a&&a(b)}):a&&a(b)):a&&a(null)})};e.prototype.executeCommand=function(a,b,d){if("on"==b)this.switchTo(1,d);else if("off"==b)this.switchTo(0,d);else if("toggle"==
b){var c=this;this._getBinaryState(function(f){"off"==f?c.switchTo(1,d):c.switchTo(0,d)})}else d&&d()};e.prototype.getStates=function(a,b,d){var c=this;this.CommandHandler=a;this.getState(function(f){f&&b&&c.CommandHandler.setState?(c.CommandHandler.setState(b.id,f.state),f&&f.current&&c.CommandHandler.setState(b.id+":current",f.current)):f&&c.CommandHandler.receivedState&&c.CommandHandler.receivedState("wemo",c.ip+":"+c.port,f);d&&d(f)})};e.prototype.getStateValues=function(a,b){return b};e.prototype.executeCommandCreator=
function(a,b,d){b&&b.value?this.executeCommand(a,b.value,function(c){d&&d(c)}):d&&d(Error("command value is empty"))};e.prototype.getStatesCreator=function(a,b,d){this.getState(function(c){if(c){for(var f=[],h=0;h<b.length;h++){var k=b[h];if(k&&k.id&&k.status)switch(k.status.value){case "switchState":c.state&&f.push({id:k.id,status:c.state});break;case "powerState":c.current&&f.push({id:k.id,status:parseFloat(c.current)})}}d&&d(null,f)}else d&&d(Error("get state error"))})};e.prototype.toJSON=function(){return{sys:xnm.aio.wemo.DM.SYS,
type:this.type,ip:this.ip,port:this.port,uuid:this.uuid}};e.prototype.equalsTo=function(a){return a&&a instanceof e?this.ip==a.ip&&this.port==a.port:!1};e.parseJSON=function(a){return a.ip&&a.port?new e(a.ip,a.port,a.uuid,a.type):null};return e}();
xnm.aio.wemo.DM=function(){var e={"switch":{command:[{type:"enum",name:"on",ref:{value:"on"}},{type:"enum",name:"off",ref:{value:"off"}},{type:"enum",name:"toggle",ref:{value:"toggle"}}],status:[{type:"enum",name:"switch status",ref:{value:"switchState",options:["off","on"]}}]},insight:{command:[{type:"enum",name:"on",ref:{value:"on"}},{type:"enum",name:"off",ref:{value:"off"}},{type:"enum",name:"toggle",ref:{value:"toggle"}}],status:[{type:"enum",name:"switch status",ref:{value:"switchState",options:["off",
"on"]}},{type:"float",name:"power status",ref:{value:"powerState",scale:"0.1"}}]}},a=function(b,d){this.code=b;this.message=d;this.stack=Error().stack};a.prototype=Error();a.prototype.name="WemoDMError";a.prototype.code=0;a.ERROR_CODE={DEFAULT:0,INDEX_EXISTS:1,ID_EXISTS:2,INVALID:3,UNKNOW:4,NOT_FOUND:5,IP_EXISTS:6};return{SYS:"wemo",getIPDeviceType:function(){return[{sys:this.SYS,name:"Belkin WeMo"}]},createDevice:function(b,d,c){d=a.ERROR_CODE;b?b.type?b.ip?c(null,b):c(new a(d.INVALID,"ip is invalid")):
c(new a(d.INVALID,"type is invalid")):c(new a(d.INVALID,"info is invalid"))},updateDevice:function(b,d,c){d=a.ERROR_CODE;b?b.type?b.ip?c(null,b):c(new a(d.INVALID,"ip is invalid")):c(new a(d.INVALID,"type is invalid")):c(new a(d.INVALID,"info is invalid"))},deleteDevice:function(b,d,c){c()},applyUIFilter:function(b,d,c){var f=function(g,q){if("*"==g)return!0;for(var l=!1,m=0;m<g.length;m++)if(g[m]==q){l=!0;break}return l},h=function(g,q,l){var m=[];switch(l.catagory){case "command":g.command&&g.command.forEach(function(n){f(l.elems,
n.type)&&(n=JSON.parse(JSON.stringify(n)),m.push(n))});break;case "status":g.status&&g.status.forEach(function(n){f(l.elems,n.type)&&(n=JSON.parse(JSON.stringify(n)),m.push(n))})}return m},k=function(g,q){var l=[],m=xnm.aio.wemo.DM.getCommandStatusMap(g,c);m&&(g=h(m,g,q),l=l.concat(g));return l};if(!b.sys)return null;var r=JSON.parse(JSON.stringify(b)),p=null;switch(d.catagory){case "command":p=k(b,d);r.command=p;break;case "status":p=k(b,d);r.status=p;break;default:return null}return p&&0!=p.length?
r:null},getCommandStatusMap:function(b,d){return b.type?e[b.type]:null}}}();
xnm.aio.wemo.Handler=function(){var e=function(){this.detectedDevices={}};e.prototype.discoverDevices=function(a){var b=require("x.upnp.js");if(b){var d=this;b.discoverDevices(function(c){if("wemo"==c.type){var f=new xnm.aio.wemo.Switch(c.ip,c.port,c.uuid);c.subtype&&(f.type=c.subtype);d.detectedDevices[c.uuid]=f;a(f)}})}};e.prototype.getStateValues=function(a,b){return(new xnm.aio.wemo.Switch).getStateValues(a,b)};e.prototype.getDeviceCommandList=function(a,b){a=[];a.push({id:window.XC_Text.on,cmd:"on"});
a.push({id:window.XC_Text.off,cmd:"off"});return a};e.prototype.getDevice=function(a){return new xnm.aio.wemo.Switch(a.address,a.port,null,a.data)};e.prototype.devicemanager=xnm.aio.wemo.DM;e.prototype.registModule=function(a){a.register(xnm.aio.wemo.DM.SYS,"wemo")};e.prototype.resolveDevice=function(a){if(!a)return null;switch(a.type){case "switch":case "insight":return xnm.aio.wemo.Switch.parseJSON(a);default:return null}};e.prototype.getDeviceCommands=function(a,b){a=(a=xnm.aio.wemo.DM.applyUIFilter(a,
{catagory:"command",elems:"*"}))?a.command:[];b&&b(null,a)};e.prototype.getDeviceStatus=function(a,b){a=(a=xnm.aio.wemo.DM.applyUIFilter(a,{catagory:"status",elems:"*"}))?a.status:[];b&&b(null,a)};e.prototype.doCommand=function(a,b,d){var c=this.resolveDevice(a);c?c.executeCommandCreator(a,b,function(f){d&&d(f)}):d&&d(Error("device json format invalid"))};e.prototype.doStatus=function(a,b,d,c){var f=this.resolveDevice(b);f?f.getStatesCreator(null,[{id:a,device:b,status:d}],function(h,k){h?c&&c(h):
c&&c(null,k[0])}):c&&c(Error("device json format invalid"))};e.prototype.discoverWithTimeout=function(a,b){var d={};this.discoverDevices(function(c){c&&c.uuid&&!d[c.uuid]&&(d[c.uuid]=c)});setTimeout(function(){var c=[],f;for(f in d)d.hasOwnProperty(f)&&c.push(d[f]);b&&b(null,c)},a)};return e}();"undefined"!=typeof exports&&"undefined"!=typeof module&&module.exports&&(exports=module.exports=new xnm.aio.wemo.Handler);
