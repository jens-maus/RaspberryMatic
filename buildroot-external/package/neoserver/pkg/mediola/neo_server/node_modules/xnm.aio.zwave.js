var xnm=xnm||{};xnm.aio=xnm.aio||{};xnm.aio.zwave=xnm.aio.zwave||{};xnm.aio.zwave.ZWave=function(){this.ID="zwave";this.NAME="Z-Wave";this.GDT_ID="ZWAVE";this.GDT_ID2="ZWAVE2";this.CAN_BE_CONFIGURED=["37","38","49","64","67"]};xnm.aio.zwave.ZWave.prototype.canDeviceBeConfigured=function(a){if(!this.hasKey(a,["info","dpts"]))return!1;for(var b in a.info.dpts)if(0<=this.CAN_BE_CONFIGURED.indexOf(b))return!0;return!1};
xnm.aio.zwave.ZWave.prototype.exclusion=function(a,b,c){var d="http://"+a.info.ip+":"+a.info.port+"/cmd",f={XC_FNC:"ZWaveExclusion",address:-1};this.hasKey(b,["info","address"])&&(XC.debugf("[AIO.ZWAVE.exclusion] Device given. Address: "+b.info.address),delete f.address);a.info.password&&(f.auth=a.info.password);$.ajax({cache:!1,data:f,dataType:"json",url:d,success:function(a,e,b){e=null;a.XC_ERR?(e=Error(b.responseText),XC.debugf("[AIO.ZWAVE.exclusion] "+e.message)):XC.debugf("[AIO.ZWAVE.exclusion] "+
b.responseText);c&&c(e,a)},error:function(a,e,b){a=Error(b||e);XC.debugf("[AIO.ZWAVE.exclusion] "+a.message);c&&c(a)}})};
xnm.aio.zwave.ZWave.prototype.getDeviceSettings=function(a,b,c){var d="http://"+a.info.ip+":"+a.info.port+"/cmd";b={XC_FNC:"ZWaveGetDeviceSetting",deviceID:b.info.address};a.info.password&&(b.auth=a.info.password);$.ajax({cache:!1,contentType:"application/json",data:JSON.stringify(b),dataType:"json",method:"POST",url:d,success:function(a,b,e){b=null;a.XC_ERR?(b=Error(e.responseText),XC.debugf("[AIO.ZWAVE.getDeviceSettings] "+b.message)):XC.debugf("[AIO.ZWAVE.getDeviceSettings] "+e.responseText);c&&
c(b,a.XC_SUC)},error:function(a,b,e){a=Error(e||b);XC.debugf("[AIO.ZWAVE.getDeviceSettings] "+a.message);c&&c(a)}})};
xnm.aio.zwave.ZWave.prototype.getInterviewResults=function(a,b,c){var d=this,f="http://"+a.info.ip+":"+a.info.port+"/cmd";b={XC_FNC:"ZWaveListInterviewResults",address:b.info.address};a.info.password&&(b.auth=a.info.password);$.ajax({cache:!1,data:b,dataType:"json",url:f,success:function(a,b,g){b=null;a.XC_ERR?(b=Error(g.responseText),XC.debugf("[AIO.ZWAVE.getInterviewResults] "+b.message)):XC.debugf("[AIO.ZWAVE.getInterviewResults] "+g.responseText);d.isObject(a.XC_SUC)||(b=Error("No error response, but no XC_SUC data either."));
c&&c(b,a.XC_SUC)},error:function(a,b,g){a=Error(g||b);XC.debugf("[AIO.ZWAVE.getInterviewResults] "+a.message);c&&c(a)}})};
xnm.aio.zwave.ZWave.prototype.interview=function(a,b,c,d){a="ws://"+a.info.ip+":"+a.info.port+"/zwave2/inclusion";var f={command:"start"};b&&(f.command="updateInterview",f.address=b.info.address,f.instanceID=b.info.instance,f.commandClassID=c);var k=JSON.stringify(f),e=new WebSocket(a);e.onclose=function(a,b){XC.debugf("[AIO.ZWAVE.interview] WebSocket closed."+(" Code: "+a+". Message: "+b+"."))};e.onerror=function(a){XC.debugf("[AIO.ZWAVE.interview] "+a.message);e.close();d&&d(a,null)};e.onopen=function(){e.send(k,
null,function(a){a?(XC.debugf("[AIO.ZWAVE.interview] "+a.message),d&&d(a,null)):XC.debugf('[AIO.ZWAVE.interview] Send command "'+f.command+'".')})};e.onmessage=function(a,b){a=a.data;b=null;try{b=JSON.parse(a)}catch(h){XC.debugf("[AIO.ZWAVE.interview] "+h.message);e.close();d&&d(h,null);return}(1===b.progress||b.finish)&&XC.debugf("[AIO.ZWAVE.interview] "+a);b.finish&&e.close();d&&d(null,b)}};
xnm.aio.zwave.ZWave.prototype.setDeviceSettings=function(a,b,c,d){var f="http://"+a.info.ip+":"+a.info.port+"/cmd";b={XC_FNC:"ZWaveSetDeviceSetting",deviceID:b.info.address,setting:c};a.info.password&&(b.auth=a.info.password);$.ajax({cache:!1,contentType:"application/json",data:JSON.stringify(b),dataType:"json",method:"POST",url:f,success:function(a,b,c){b=null;a.XC_ERR?(b=Error(c.responseText),Log.error("[AIO.ZWAVE.setDeviceSettings] "+b.message)):Log.debug("[AIO.ZWAVE.setDeviceSettings] "+c.responseText);
d&&d(b,a.XC_SUC)},error:function(a,b,c){a=Error(c||b);Log.error("[AIO.ZWAVE.setDeviceSettings] "+a.message);d&&d(a)}})};xnm.aio.zwave.ZWave.prototype.isObject=function(a){return"object"===typeof a&&null!==a};xnm.aio.zwave.ZWave.prototype.hasKey=function(a,b){if(null===a||"object"!==typeof a||!b)return!1;Array.isArray(b)||(b=[b]);for(var c=0;c<b.length;c++){var d=b[c];if("object"===typeof a&&null!==a&&"undefined"!==typeof a[d])a=a[d];else return!1}return!0};xnm.aio.zwave.Handler=xnm.aio.zwave.ZWave;
"undefined"!=typeof exports&&"undefined"!=typeof module&&module.exports&&(exports=module.exports=new xnm.aio.zwave.Handler);
